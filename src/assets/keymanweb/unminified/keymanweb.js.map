{"version":3,"file":"keymanweb.js","sourceRoot":"","sources":["../source/kmwtypedefs.ts","../source/kmwexthtml.ts","../node_modules/promise-polyfill/lib/polyfill.js","../source/environment.inc.ts","../source/kmwdomevents.ts","../source/kmwstring.ts","../source/kmwdom.ts","../source/kmwdevice.ts","../source/kmwutils.ts","../source/kmwcallback.ts","../source/kmwkeyboards.ts","../source/kmwkeymaps.ts","../source/kmwhotkeys.ts","../source/kmwuimanager.ts","../source/kmwbase.ts","../source/keymanweb.ts","../source/kmwosk.ts","../source/kmwrotation.ts","../source/kmwnative.ts","../source/kmwlayout.ts","../source/kmwinit.ts","../source/closure.ts","../source/kmwapi.ts"],"names":[],"mappings":"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G,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;gBAChB,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;gBAChB,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;gBAChB,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;gBAEhB,EAAE,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC;gBACjB,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;gBAChB,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC;gBACjB,EAAE,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC;gBACjB,EAAE,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC;gBACjB,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;gBAChB,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC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","sourcesContent":["namespace com.keyman {\r\n  export class KeyEvent {\r\n      Ltarg: HTMLElement;\r\n      Lcode: number;\r\n      Lstates: number;\r\n      LmodifierChange: boolean;\r\n      Lmodifiers: number;\r\n      LisVirtualKeyCode: boolean;\r\n      LisVirtualKey: boolean;\r\n      vkCode: number\r\n  };\r\n\r\n  export class AttachmentInfo {\r\n    /**\r\n     * Tracks the control's independent keyboard selection, when applicable.\r\n     */\r\n    keyboard:       string;\r\n\r\n    /**\r\n     * Tracks the language code corresponding to the `keyboard` field.\r\n     */\r\n    languageCode:   string;\r\n\r\n    /**\r\n     * Tracks if the control has an aliased control for touch functionality.\r\n     * \r\n     * Future note - could be changed to track the DOMEventHandler instance used by this control;\r\n     *               this may be useful for an eventual hybrid touch/non-touch implementation.\r\n     */\r\n    touchEnabled:   boolean;\r\n\r\n    constructor(kbd: string, touch: boolean) {\r\n      this.keyboard = kbd;\r\n      this.touchEnabled = touch;\r\n    }\r\n  }\r\n\r\n  export class LegacyKeyEvent {\r\n    Ltarg: HTMLElement;\r\n    Lcode: number;\r\n    Lmodifiers: number;\r\n    LisVirtualKey: number;\r\n  }\r\n\r\n  export class KeyInformation {\r\n    vk: boolean;\r\n    code: number;\r\n    modifiers: number;\r\n  }\r\n\r\n  export class StyleCommand {\r\n    cmd: string;\r\n    state: number;\r\n\r\n    constructor(c: string, s:number) {\r\n      this.cmd = c;\r\n      this.state = s;\r\n    }\r\n  }\r\n}","// Defines a number of KMW objects.\r\n/// <reference path=\"kmwtypedefs.ts\"/>\r\n\r\ninterface Window {\r\n    // DOM type prototypes\r\n    HTMLElement:         typeof HTMLElement;\r\n    HTMLTextAreaElement: typeof HTMLTextAreaElement;\r\n    HTMLInputElement:    typeof HTMLInputElement;\r\n    HTMLIFrameElement:   typeof HTMLIFrameElement;\r\n    Document:            typeof Document;\r\n    Event:               typeof Event;\r\n    MouseEvent:          typeof MouseEvent;\r\n    TouchEvent:          typeof TouchEvent;\r\n}\r\n\r\ninterface Document {\r\n    _KeymanWebSelectionStart: number,\r\n    _KeymanWebSelectionEnd: number\r\n}\r\n\r\ninterface Element {\r\n    _kmwAttachment: com.keyman.AttachmentInfo,     // Used to track each input element's attachment data.\r\n    shim: HTMLElement,                  // Used in subkey elements for smooth fading.\r\n\r\n    _KeymanWebSelectionStart: number,\r\n    _KeymanWebSelectionEnd: number,\r\n\r\n    // Touch element extensions\r\n    base: HTMLElement,                  // Refers to the aliased element.  Is a property of the alias.\r\n    disabled: boolean,\r\n    kmwInput: boolean,\r\n    _kmwResizeHandler: (e: any) => void,\r\n\r\n    onselectstart: any,\r\n\r\n    // Used by our util.wait / util.alert system\r\n    dismiss: () => void\r\n}\r\n\r\ninterface HTMLDivElement {\r\n    onmspointerdown: any,\r\n    onmspointerup: any,\r\n    onmspointermove: any\r\n}\r\n\r\ninterface CSSStyleDeclaration {\r\n    MozBoxSizing: any,\r\n    // For legacy 'selection' management.\r\n    MozUserSelect: any, // Not necessary with Firefox 52+, which was released... in 2017.\r\n    KhtmlUserSelect: any, // No dating information for the rest at present.\r\n    UserSelect: any,\r\n    WebkitUserSelect: any\r\n}","'use strict';\n\n/**\n * @this {Promise}\n */\nfunction finallyConstructor(callback) {\n  var constructor = this.constructor;\n  return this.then(\n    function(value) {\n      return constructor.resolve(callback()).then(function() {\n        return value;\n      });\n    },\n    function(reason) {\n      return constructor.resolve(callback()).then(function() {\n        return constructor.reject(reason);\n      });\n    }\n  );\n}\n\n// Store setTimeout reference so promise-polyfill will be unaffected by\n// other code modifying setTimeout (like sinon.useFakeTimers())\nvar setTimeoutFunc = setTimeout;\n\nfunction noop() {}\n\n// Polyfill for Function.prototype.bind\nfunction bind(fn, thisArg) {\n  return function() {\n    fn.apply(thisArg, arguments);\n  };\n}\n\n/**\n * @constructor\n * @param {Function} fn\n */\nfunction Promise(fn) {\n  if (!(this instanceof Promise))\n    throw new TypeError('Promises must be constructed via new');\n  if (typeof fn !== 'function') throw new TypeError('not a function');\n  /** @type {!number} */\n  this._state = 0;\n  /** @type {!boolean} */\n  this._handled = false;\n  /** @type {Promise|undefined} */\n  this._value = undefined;\n  /** @type {!Array<!Function>} */\n  this._deferreds = [];\n\n  doResolve(fn, this);\n}\n\nfunction handle(self, deferred) {\n  while (self._state === 3) {\n    self = self._value;\n  }\n  if (self._state === 0) {\n    self._deferreds.push(deferred);\n    return;\n  }\n  self._handled = true;\n  Promise._immediateFn(function() {\n    var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n    if (cb === null) {\n      (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n      return;\n    }\n    var ret;\n    try {\n      ret = cb(self._value);\n    } catch (e) {\n      reject(deferred.promise, e);\n      return;\n    }\n    resolve(deferred.promise, ret);\n  });\n}\n\nfunction resolve(self, newValue) {\n  try {\n    // Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n    if (newValue === self)\n      throw new TypeError('A promise cannot be resolved with itself.');\n    if (\n      newValue &&\n      (typeof newValue === 'object' || typeof newValue === 'function')\n    ) {\n      var then = newValue.then;\n      if (newValue instanceof Promise) {\n        self._state = 3;\n        self._value = newValue;\n        finale(self);\n        return;\n      } else if (typeof then === 'function') {\n        doResolve(bind(then, newValue), self);\n        return;\n      }\n    }\n    self._state = 1;\n    self._value = newValue;\n    finale(self);\n  } catch (e) {\n    reject(self, e);\n  }\n}\n\nfunction reject(self, newValue) {\n  self._state = 2;\n  self._value = newValue;\n  finale(self);\n}\n\nfunction finale(self) {\n  if (self._state === 2 && self._deferreds.length === 0) {\n    Promise._immediateFn(function() {\n      if (!self._handled) {\n        Promise._unhandledRejectionFn(self._value);\n      }\n    });\n  }\n\n  for (var i = 0, len = self._deferreds.length; i < len; i++) {\n    handle(self, self._deferreds[i]);\n  }\n  self._deferreds = null;\n}\n\n/**\n * @constructor\n */\nfunction Handler(onFulfilled, onRejected, promise) {\n  this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n  this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n  this.promise = promise;\n}\n\n/**\n * Take a potentially misbehaving resolver function and make sure\n * onFulfilled and onRejected are only called once.\n *\n * Makes no guarantees about asynchrony.\n */\nfunction doResolve(fn, self) {\n  var done = false;\n  try {\n    fn(\n      function(value) {\n        if (done) return;\n        done = true;\n        resolve(self, value);\n      },\n      function(reason) {\n        if (done) return;\n        done = true;\n        reject(self, reason);\n      }\n    );\n  } catch (ex) {\n    if (done) return;\n    done = true;\n    reject(self, ex);\n  }\n}\n\nPromise.prototype['catch'] = function(onRejected) {\n  return this.then(null, onRejected);\n};\n\nPromise.prototype.then = function(onFulfilled, onRejected) {\n  // @ts-ignore\n  var prom = new this.constructor(noop);\n\n  handle(this, new Handler(onFulfilled, onRejected, prom));\n  return prom;\n};\n\nPromise.prototype['finally'] = finallyConstructor;\n\nPromise.all = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!arr || typeof arr.length === 'undefined')\n      throw new TypeError('Promise.all accepts an array');\n    var args = Array.prototype.slice.call(arr);\n    if (args.length === 0) return resolve([]);\n    var remaining = args.length;\n\n    function res(i, val) {\n      try {\n        if (val && (typeof val === 'object' || typeof val === 'function')) {\n          var then = val.then;\n          if (typeof then === 'function') {\n            then.call(\n              val,\n              function(val) {\n                res(i, val);\n              },\n              reject\n            );\n            return;\n          }\n        }\n        args[i] = val;\n        if (--remaining === 0) {\n          resolve(args);\n        }\n      } catch (ex) {\n        reject(ex);\n      }\n    }\n\n    for (var i = 0; i < args.length; i++) {\n      res(i, args[i]);\n    }\n  });\n};\n\nPromise.resolve = function(value) {\n  if (value && typeof value === 'object' && value.constructor === Promise) {\n    return value;\n  }\n\n  return new Promise(function(resolve) {\n    resolve(value);\n  });\n};\n\nPromise.reject = function(value) {\n  return new Promise(function(resolve, reject) {\n    reject(value);\n  });\n};\n\nPromise.race = function(values) {\n  return new Promise(function(resolve, reject) {\n    for (var i = 0, len = values.length; i < len; i++) {\n      values[i].then(resolve, reject);\n    }\n  });\n};\n\n// Use polyfill for setImmediate for performance gains\nPromise._immediateFn =\n  (typeof setImmediate === 'function' &&\n    function(fn) {\n      setImmediate(fn);\n    }) ||\n  function(fn) {\n    setTimeoutFunc(fn, 0);\n  };\n\nPromise._unhandledRejectionFn = function _unhandledRejectionFn(err) {\n  if (typeof console !== 'undefined' && console) {\n    console.warn('Possible Unhandled Promise Rejection:', err); // eslint-disable-line no-console\n  }\n};\n\n/** @suppress {undefinedVars} */\nvar globalNS = (function() {\n  // the only reliable means to get the global object is\n  // `Function('return this')()`\n  // However, this causes CSP violations in Chrome apps.\n  if (typeof self !== 'undefined') {\n    return self;\n  }\n  if (typeof window !== 'undefined') {\n    return window;\n  }\n  if (typeof global !== 'undefined') {\n    return global;\n  }\n  throw new Error('unable to locate global object');\n})();\n\nif (!('Promise' in globalNS)) {\n  globalNS['Promise'] = Promise;\n} else if (!globalNS.Promise.prototype['finally']) {\n  globalNS.Promise.prototype['finally'] = finallyConstructor;\n}\n","//Autogenerated file - do not modify!\nnamespace com.keyman.environment {\n  export var VERSION = \"11.0\";\n}  \n\n","namespace com.keyman {\r\n  /*\r\n  * Note that for many of the actual events represented by methods in this file, `this` is replaced \r\n  * automatically by JavaScript's event handling system.  As such, many 'wrapper' variants of the events\r\n  * exist to restore the object-oriented hierarchy below.\r\n  * \r\n  */\r\n\r\n  export class CommonDOMStates {\r\n    _KeyPressToSwallow: number;\r\n    _DisableInput: boolean = false;         // Should input be disabled?\r\n    _IgnoreNextSelChange: number = 0;       // when a visual keyboard key is mouse-down, ignore the next sel change because this stuffs up our history  \r\n    _Selection = null;\r\n    _SelectionControl: any = null;   // Type behavior is as with activeElement and the like.\r\n    \r\n    modStateFlags: number = 0;         // Tracks the present state of the physical keyboard's active modifier flags.  Needed for AltGr simulation.\r\n\r\n    activeElement: any;       // TODO:  Add type and fix resulting bugs!\r\n    lastActiveElement: any;   // TODO:  Add type and fix resulting bugs!\r\n\r\n    focusing: boolean;\r\n    focusTimer: number;\r\n\r\n    changed: boolean;         // Tracks if the element has been edited since gaining focus.\r\n\r\n    /* ----------------------- Static event-related methods ------------------------ */\r\n\r\n    setFocusTimer(): void {\r\n      this.focusing=true;\r\n\r\n      this.focusTimer = window.setTimeout(function() {\r\n        this.focusing=false;\r\n      }.bind(this), 1000)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Declares a base, non-touch oriented implementation of all relevant DOM-related event handlers and state functions.\r\n   */\r\n  export class DOMEventHandlers {\r\n    // TODO:  resolve/refactor out!\r\n    protected keyman: KeymanBase;\r\n\r\n    // This is only static within a given initialization of KeymanWeb.  Perhaps it would be best as an initialization \r\n    // parameter and member field?\r\n    static states: CommonDOMStates = new CommonDOMStates();\r\n\r\n    constructor(keyman: KeymanBase) {\r\n      this.keyman = keyman;\r\n    }\r\n\r\n    /**\r\n     * Handle receiving focus by simulated input field\r\n     */       \r\n    setFocus: (e?: TouchEvent|MSPointerEvent) => void = function(e?: TouchEvent|MSPointerEvent): void {\r\n      // Touch-only handler.\r\n    }.bind(this);\r\n    \r\n    /**\r\n     * Get simulated input field content\r\n     *    \r\n     * @param       {Object}        e     element (object) of simulated input field\r\n     * @return      {string}              entire text in simulated input field\r\n     */       \r\n    getText(e: HTMLElement): string {\r\n      // Touch-only method.\r\n      return '';\r\n    }\r\n    \r\n    /**\r\n     *Insert text into simulated input field at indicated character position\r\n      * \r\n      * @param       {Object}      e     simulated input field DIV\r\n      * @param       {?string}     t     text to insert in element\r\n      * @param       {?number}     cp    caret position (characters)     \r\n      */       \r\n    setText(e: HTMLElement, t?: string, cp?: number): void {\r\n      // Touch-only method.\r\n    }\r\n    \r\n    /**\r\n     * Get text up to the caret from simulated input field \r\n     *    \r\n     * @return      {string}   \r\n     */       \r\n    getTextBeforeCaret(e: HTMLElement): string {\r\n      // Touch-only method.\r\n      return '';\r\n    }\r\n\r\n    /**\r\n     * Replace text up to the caret in the simulated input field \r\n     *    \r\n     * @param       {Object}        e     element (object) of simulated input field\r\n     * @param       {string}        t     Context for simulated input field\r\n     */       \r\n    setTextBeforeCaret(e: HTMLElement, t: string): void {\r\n      // Touch-only method.\r\n    }\r\n\r\n    /**\r\n     * Description  Get current position of caret in simulated input field \r\n     *    \r\n     * @param       {Object}        e     element (object) of simulated input field\r\n     * @return      {number}              caret character position in simulated input field\r\n     */       \r\n    getTextCaret(e: HTMLElement): number {\r\n      // Touch-only method.\r\n      return 0;\r\n    }\r\n    \r\n    /**\r\n     * Set current position of caret in simulated input field then display the caret \r\n     *    \r\n     * @param       {Object}        e     element (object) of simulated input field\r\n     * @param       {number}        cp    caret character position in simulated input field\r\n     */       \r\n    setTextCaret(e: HTMLElement, cp: number): void {\r\n      // Touch-only method.\r\n    }\r\n    \r\n    /**\r\n     * Hides the simulated caret for touch-aliased elements.\r\n     */       \r\n    hideCaret(): void {\r\n      // Touch-only method.\r\n    }\r\n    \r\n    /**\r\n     * Toggle state of caret in simulated input field\r\n     */       \r\n    flashCaret: () => void = function(): void {\r\n      // Touch-only handler.\r\n    }.bind(this);\r\n\r\n    /**\r\n     * Correct the position and size of a duplicated input element\r\n     *    \r\n     * @param       {Object}        x     element\r\n     */       \r\n    updateInput(x: HTMLElement) {\r\n      // Touch-only method.\r\n    }\r\n\r\n    /** \r\n     * Handles touch-based loss of focus events.\r\n     */\r\n    setBlur: (e: FocusEvent) => void = function(e: FocusEvent) {\r\n      // Touch-only handler.\r\n    }.bind(this);\r\n\r\n    // End of I3363 (Build 301) additions\r\n\r\n    // Universal DOM event handlers (both desktop + touch)\r\n\r\n    //TODO: add more complete description of what ControlFocus really does\r\n    /**\r\n     * Respond to KeymanWeb-aware input element receiving focus \r\n     */    \r\n    _ControlFocus: (e: FocusEvent) => boolean = function(this: DOMEventHandlers, e: FocusEvent): boolean {\r\n      var Ltarg: HTMLElement | Document, Ln;\r\n      var device = this.keyman.util.device;\r\n      var osk = this.keyman.osk;\r\n\r\n      e = this.keyman._GetEventObject<FocusEvent>(e);     // I2404 - Manage IE events in IFRAMEs\r\n      Ltarg = this.keyman.util.eventTarget(e) as HTMLElement;\r\n      if (Ltarg == null) {\r\n        return true;\r\n      }\r\n    \r\n      // Prevent any action if a protected input field\r\n      if(device.touchable && (Ltarg.className == null || Ltarg.className.indexOf('keymanweb-input') < 0)) {\r\n        return true;\r\n      }\r\n\r\n      // Or if not a remappable input field\r\n      var en=Ltarg.nodeName.toLowerCase();\r\n      if(Ltarg.ownerDocument && Ltarg instanceof Ltarg.ownerDocument.defaultView.HTMLInputElement) {\r\n        var et=Ltarg.type.toLowerCase();\r\n        if(!(et == 'text' || et == 'search')) {\r\n          return true;\r\n        }\r\n      } else if((device.touchable || !Ltarg.isContentEditable) \r\n          && !(Ltarg.ownerDocument && Ltarg instanceof Ltarg.ownerDocument.defaultView.HTMLTextAreaElement)) {\r\n        return true;\r\n      }\r\n\r\n      DOMTouchHandlers.states.activeElement = Ltarg;  // I3363 (Build 301)  \r\n\r\n      if (Ltarg.nodeType == 3) { // defeat Safari bug\r\n        Ltarg = Ltarg.parentNode as HTMLElement;\r\n      }\r\n        \r\n      var LfocusTarg = Ltarg;\r\n\r\n      // Ensure that focussed element is visible above the keyboard\r\n      if(Ltarg.className == null || Ltarg.className.indexOf('keymanweb-input') < 0) {\r\n        if(this instanceof DOMTouchHandlers) {\r\n          (this as DOMTouchHandlers).scrollBody(Ltarg);\r\n        }\r\n      }\r\n          \r\n      if(Ltarg.ownerDocument && Ltarg instanceof Ltarg.ownerDocument.defaultView.HTMLIFrameElement) { //**TODO: check case reference\r\n        this.keyman.domManager._AttachToIframe(Ltarg as HTMLIFrameElement);\r\n        Ltarg=Ltarg.contentWindow.document;\r\n      }\r\n\r\n      //??keymanweb._Selection = null;\r\n\r\n      // We condition on 'priorElement' below as a check to allow KMW to set a default active keyboard.\r\n      var priorElement = DOMEventHandlers.states.lastActiveElement;\r\n      DOMEventHandlers.states.lastActiveElement = Ltarg;\r\n\r\n      if(this.keyman.uiManager.justActivated) {\r\n        this._BlurKeyboardSettings();\r\n      } else {\r\n        this._FocusKeyboardSettings(priorElement ? false : true);\r\n      }\r\n\r\n      // Always do the common focus stuff, instantly returning if we're in an editable iframe.\r\n      if(this._CommonFocusHelper(Ltarg)) {\r\n        return true;\r\n      };\r\n\r\n      Ltarg._KeymanWebSelectionStart = Ltarg._KeymanWebSelectionEnd = null; // I3363 (Build 301)\r\n\r\n      // Set element directionality (but only if element is empty)\r\n      if(Ltarg.ownerDocument && Ltarg instanceof Ltarg.ownerDocument.defaultView.HTMLElement) {\r\n        this.keyman.domManager._SetTargDir(Ltarg);\r\n      }\r\n\r\n      //Execute external (UI) code needed on focus if required\r\n      this.doControlFocused(LfocusTarg, DOMEventHandlers.states.lastActiveElement);\r\n    \r\n      // Force display of OSK for touch input device, or if a CJK keyboard, to ensure visibility of pick list\r\n      if(device.touchable) {\r\n        osk._Enabled=1;\r\n      } else {\r\n        // Conditionally show the OSK when control receives the focus\r\n        if(osk.ready) {\r\n          if(this.keyman.keyboardManager.isCJK()) {\r\n            osk._Enabled=1;\r\n          }\r\n          if(osk._Enabled) {\r\n            osk._Show();\r\n          } else {\r\n            osk._Hide(false);\r\n          }\r\n        }\r\n      }\r\n\r\n      return true;\r\n    }.bind(this);\r\n\r\n    /**\r\n     * Function     doControlFocused\r\n     * Scope        Private\r\n     * @param       {Object}            _target         element gaining focus\r\n     * @param       {Object}            _activeControl  currently active control\r\n     * @return      {boolean}   \r\n     * Description  Execute external (UI) code needed on focus\r\n     */       \r\n    doControlFocused(_target: HTMLElement, _activeControl: HTMLElement): boolean {\r\n      var p={};\r\n      p['target']=_target;\r\n      p['activeControl']=_activeControl;\r\n\r\n      return this.keyman.util.callEvent('kmw.controlfocused',p);\r\n    }\r\n\r\n    /**\r\n     * Respond to KMW losing focus on event\r\n     */    \r\n    _ControlBlur: (e: FocusEvent) => boolean = function(this: DOMEventHandlers, e: FocusEvent): boolean {\r\n      var Ltarg: HTMLElement | Document;  \r\n\r\n      e = this.keyman._GetEventObject<FocusEvent>(e);   // I2404 - Manage IE events in IFRAMEs\r\n      Ltarg = this.keyman.util.eventTarget(e) as HTMLElement;\r\n      if (Ltarg == null) {\r\n        return true;\r\n      }\r\n\r\n      DOMEventHandlers.states.activeElement = null; // I3363 (Build 301)\r\n\r\n      // Hide the touch device input caret, if applicable  I3363 (Build 301)\r\n      if(this instanceof DOMTouchHandlers) {\r\n        this.hideCaret();\r\n      }\r\n      \r\n      if (Ltarg.nodeType == 3) { // defeat Safari bug\r\n        Ltarg = Ltarg.parentNode as HTMLElement;\r\n      }\r\n\r\n      if(Ltarg.ownerDocument) {\r\n        if(Ltarg instanceof Ltarg.ownerDocument.defaultView.HTMLIFrameElement) {\r\n          Ltarg=Ltarg.contentWindow.document;\r\n        }\r\n          \r\n        if (Ltarg instanceof Ltarg.ownerDocument.defaultView.HTMLInputElement \r\n            || Ltarg instanceof Ltarg.ownerDocument.defaultView.HTMLTextAreaElement) {\r\n          //Ltarg._KeymanWebSelectionStart = Ltarg.selectionStart;\r\n          //Ltarg._KeymanWebSelectionEnd = Ltarg.selectionEnd;\r\n          Ltarg._KeymanWebSelectionStart = Ltarg.value._kmwCodeUnitToCodePoint(Ltarg.selectionStart);  //I3319\r\n          Ltarg._KeymanWebSelectionEnd = Ltarg.value._kmwCodeUnitToCodePoint(Ltarg.selectionEnd);  //I3319\r\n        }\r\n      }\r\n      \r\n      ////keymanweb._SelectionControl = null;    \r\n      this._BlurKeyboardSettings();\r\n\r\n      // Now that we've handled all prior-element maintenance, update the 'last active element'.\r\n      DOMEventHandlers.states.lastActiveElement = Ltarg;\r\n\r\n      /* If the KeymanWeb UI is active as a user changes controls, all UI-based effects should be restrained to this control in case\r\n      * the user is manually specifying languages on a per-control basis.\r\n      */\r\n      this.keyman.uiManager.justActivated = false;\r\n      \r\n      var isActivating = this.keyman.uiManager.isActivating;\r\n      if(!isActivating) {\r\n        this.keyman.keyboardManager.notifyKeyboard(0, Ltarg, 0);  // I2187\r\n      }\r\n\r\n      //e = this.keyman._GetEventObject<FocusEvent>(e);   // I2404 - Manage IE events in IFRAMEs  //TODO: is this really needed again????\r\n      this.doControlBlurred(Ltarg, e, isActivating);\r\n\r\n      // Hide the OSK when the control is blurred, unless the UI is being temporarily selected\r\n      if(this.keyman.osk.ready && !isActivating) {\r\n        this.keyman.osk._Hide(false);\r\n      }\r\n\r\n      this.doChangeEvent(Ltarg);\r\n      this.keyman.interface.resetContext();\r\n\r\n      return true;\r\n    }.bind(this);\r\n\r\n    /**\r\n     * Function     doControlBlurred\r\n     * Scope        Private\r\n     * @param       {Object}            _target       element losing focus\r\n     * @param       {Event}             _event        event object\r\n     * @param       {(boolean|number)}  _isActivating activation state\r\n     * @return      {boolean}      \r\n     * Description  Execute external (UI) code needed on blur\r\n     */       \r\n    doControlBlurred(_target: HTMLElement|Document, _event: Event, _isActivating: boolean|number): boolean {\r\n      var p={};\r\n      p['target']=_target;\r\n      p['event']=_event;\r\n      p['isActivating']=_isActivating;\r\n\r\n      return this.keyman.util.callEvent('kmw.controlblurred',p);\r\n    }\r\n\r\n    /**\r\n     * Function             _BlurKeyboardSettings\r\n     * Description          Stores the last active element's keyboard settings.  Should be called\r\n     *                      whenever a KMW-enabled page element loses control.\r\n     */\r\n    _BlurKeyboardSettings(PInternalName?: string, PLgCode?: string) {\r\n      var keyboardID = this.keyman.keyboardManager.activeKeyboard ? this.keyman.keyboardManager.activeKeyboard['KI'] : '';\r\n      var langCode = this.keyman.keyboardManager.getActiveLanguage();\r\n      \r\n      if(PInternalName !== undefined && PLgCode !== undefined) {\r\n        keyboardID = PInternalName;\r\n        langCode = PLgCode;\r\n      }\r\n      \r\n      var lastElem = DOMEventHandlers.states.lastActiveElement;\r\n      if(lastElem && lastElem._kmwAttachment.keyboard != null) {\r\n        lastElem._kmwAttachment.keyboard = keyboardID;\r\n        lastElem._kmwAttachment.languageCode = langCode;\r\n      } else {\r\n        this.keyman.globalKeyboard = keyboardID;\r\n        this.keyman.globalLanguageCode = langCode;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function             _FocusKeyboardSettings\r\n     * @param   {boolean}   blockGlobalChange   A flag indicating if the global keyboard setting should be ignored for this call.\r\n     * Description          Restores the newly active element's keyboard settings.  Should be called\r\n     *                      whenever a KMW-enabled page element gains control, but only once the prior\r\n     *                      element's loss of control is guaranteed.\r\n     */ \r\n    _FocusKeyboardSettings(blockGlobalChange: boolean) {\r\n      var lastElem = DOMEventHandlers.states.lastActiveElement;\r\n      if(lastElem && lastElem._kmwAttachment.keyboard != null) {      \r\n        this.keyman.keyboardManager.setActiveKeyboard(lastElem._kmwAttachment.keyboard, \r\n          lastElem._kmwAttachment.languageCode); \r\n      } else if(!blockGlobalChange) { \r\n        this.keyman.keyboardManager.setActiveKeyboard(this.keyman.globalKeyboard, this.keyman.globalLanguageCode);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function             _CommonFocusHelper\r\n     * @param   {Element}   target \r\n     * @returns {boolean}\r\n     * Description          Performs common state management for the various focus events of KeymanWeb.                      \r\n     *                      The return value indicates whether (true) or not (false) the calling event handler \r\n     *                      should be terminated immediately after the call.\r\n     */\r\n    _CommonFocusHelper(target: HTMLElement|Document): boolean {\r\n      var uiManager = this.keyman.uiManager;\r\n      //TODO: the logic of the following line doesn't look right!!  Both variables are true, but that doesn't make sense!\r\n      //_Debug(keymanweb._IsIEEditableIframe(Ltarg,1) + '...' +keymanweb._IsMozillaEditableIframe(Ltarg,1));\r\n      if(target.ownerDocument && target instanceof target.ownerDocument.defaultView.HTMLIFrameElement) {\r\n        if(!this.keyman.domManager._IsIEEditableIframe(target, 1) ||\r\n            !this.keyman.domManager._IsMozillaEditableIframe(target, 1)) {\r\n          DOMEventHandlers.states._DisableInput = true; \r\n          return true;\r\n        }\r\n      }\r\n      DOMEventHandlers.states._DisableInput = false; \r\n\r\n      if(!uiManager.justActivated) {\r\n        // Needs refactor when the Callbacks interface PR goes through!\r\n        this.keyman['interface']._DeadKeys = [];\r\n        this.keyman.keyboardManager.notifyKeyboard(0,target,1);  // I2187\r\n      }\r\n    \r\n      if(!uiManager.justActivated && DOMEventHandlers.states._SelectionControl != target) {\r\n        uiManager.isActivating = false;\r\n      }\r\n      uiManager.justActivated = false;\r\n\r\n      DOMEventHandlers.states._SelectionControl = target;\r\n      return false;\r\n    }\r\n\r\n    /**\r\n     * Function   _SelectionChange\r\n     * Scope      Private\r\n     * Description Respond to selection change event \r\n     */\r\n    _SelectionChange: () => boolean = function(this: DOMEventHandlers): boolean {\r\n      if(DOMEventHandlers.states._IgnoreNextSelChange) {\r\n        DOMEventHandlers.states._IgnoreNextSelChange--;\r\n      } \r\n      return true;\r\n    }.bind(this);\r\n\r\n\r\n    /**\r\n     * Function     _GetEventKeyCode\r\n     * Scope        Private\r\n     * @param       {Event}       e         Event object\r\n     * Description  Finds the key code represented by the event.\r\n     */\r\n    _GetEventKeyCode(e: KeyboardEvent) {\r\n      if (e.keyCode) {\r\n        return e.keyCode;\r\n      } else if (e.which) {\r\n        return e.which;\r\n      } else {\r\n        return null;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function     _GetKeyEventProperties\r\n     * Scope        Private\r\n     * @param       {Event}       e         Event object\r\n     * @param       {boolean=}    keyState  true if call results from a keyDown event, false if keyUp, undefined if keyPress\r\n     * @return      {Object.<string,*>}     KMW keyboard event object: \r\n     * Description  Get object with target element, key code, shift state, virtual key state \r\n     *                Ltarg=target element\r\n     *                Lcode=keyCode\r\n     *                Lmodifiers=shiftState\r\n     *                LisVirtualKeyCode e.g. ctrl/alt key\r\n     *                LisVirtualKey     e.g. Virtual key or non-keypress event\r\n     */    \r\n    _GetKeyEventProperties(e: KeyboardEvent, keyState?: boolean) {\r\n      var s = new com.keyman.KeyEvent();\r\n\r\n      e = this.keyman._GetEventObject(e);   // I2404 - Manage IE events in IFRAMEs\r\n      s.Ltarg = this.keyman.util.eventTarget(e) as HTMLElement;\r\n      if (s.Ltarg == null) {\r\n        return null;\r\n      }\r\n      if(e.cancelBubble === true) {\r\n        return null; // I2457 - Facebook meta-event generation mess -- two events generated for a keydown in Facebook contentEditable divs\r\n      }      \r\n\r\n      if (s.Ltarg.nodeType == 3) {// defeat Safari bug\r\n        s.Ltarg = s.Ltarg.parentNode as HTMLElement;\r\n      }\r\n\r\n      s.Lcode = this._GetEventKeyCode(e);\r\n      if (s.Lcode == null) {\r\n        return null;\r\n      }\r\n\r\n      var osk = this.keyman.osk, activeKeyboard = this.keyman.keyboardManager.activeKeyboard;\r\n\r\n      if(activeKeyboard && activeKeyboard['KM']) {\r\n        // K_SPACE is not handled by defaultKeyOutput for physical keystrokes unless using touch-aliased elements.\r\n        if(s.Lcode != osk.keyCodes['K_SPACE']) {\r\n          // So long as the key name isn't prefixed with 'U_', we'll get a default mapping based on the Lcode value.\r\n          // We need to determine the mnemonic base character - for example, SHIFT + K_PERIOD needs to map to '>'.\r\n          var mappedChar: string = osk.defaultKeyOutput('K_xxxx', s.Lcode, (e.getModifierState(\"Shift\") ? 0x10 : 0), false, null);\r\n          if(mappedChar) {\r\n            s.Lcode = mappedChar.charCodeAt(0);\r\n          } // No 'else' - avoid blocking modifier keys, etc.\r\n        }\r\n      }\r\n\r\n      // Stage 1 - track the true state of the keyboard's modifiers.\r\n      var prevModState = DOMEventHandlers.states.modStateFlags, curModState = 0x0000;\r\n      var ctrlEvent = false, altEvent = false;\r\n      \r\n      switch(s.Lcode) {\r\n        case osk.keyCodes['K_CTRL']:      // The 3 shorter \"K_*CTRL\" entries exist in some legacy keyboards.\r\n        case osk.keyCodes['K_LCTRL']:\r\n        case osk.keyCodes['K_RCTRL']:\r\n        case osk.keyCodes['K_CONTROL']:\r\n        case osk.keyCodes['K_LCONTROL']:\r\n        case osk.keyCodes['K_RCONTROL']:\r\n          ctrlEvent = true;\r\n          break;\r\n        case osk.keyCodes['K_LMENU']:     // The 2 \"K_*MENU\" entries exist in some legacy keyboards.\r\n        case osk.keyCodes['K_RMENU']:\r\n        case osk.keyCodes['K_ALT']:\r\n        case osk.keyCodes['K_LALT']:\r\n        case osk.keyCodes['K_RALT']:\r\n          altEvent = true;\r\n          break;\r\n      }\r\n\r\n      /**\r\n       * Two separate conditions exist that should trigger chiral modifier detection.  Examples below use CTRL but also work for ALT.\r\n       * \r\n       * 1.  The user literally just pressed CTRL, so the event has a valid `location` property we can utilize.  \r\n       *     Problem: its layer isn't presently activated within the OSK.\r\n       * \r\n       * 2.  CTRL has been held a while, so the OSK layer is valid, but the key event doesn't tell us the chirality of the active CTRL press.\r\n       *     Bonus issue:  RAlt simulation may cause erasure of this location property, but it should ONLY be empty if pressed in this case.\r\n       *     We default to the 'left' variants since they're more likely to exist and cause less issues with RAlt simulation handling.\r\n       * \r\n       * In either case, `e.getModifierState(\"Control\")` is set to true, but as a result does nothing to tell us which case is active.\r\n       * \r\n       * `e.location != 0` if true matches condition 1 and matches condition 2 if false.\r\n       */\r\n\r\n      curModState |= (e.getModifierState(\"Shift\") ? 0x10 : 0);\r\n\r\n      if(e.getModifierState(\"Control\")) {\r\n        curModState |= ((e.location != 0 && ctrlEvent) ? \r\n          (e.location == 1 ? osk.modifierCodes['LCTRL'] : osk.modifierCodes['RCTRL']) : // Condition 1\r\n          prevModState & 0x0003);                                                       // Condition 2\r\n      }\r\n      if(e.getModifierState(\"Alt\")) {\r\n        curModState |= ((e.location != 0 && altEvent) ? \r\n          (e.location == 1 ? osk.modifierCodes['LALT'] : osk.modifierCodes['RALT']) :   // Condition 1\r\n          prevModState & 0x000C);                                                       // Condition 2\r\n      }\r\n\r\n      // Stage 2 - detect state key information.  It can be looked up per keypress with no issue.\r\n      s.Lstates = 0;\r\n      \r\n      if(e.getModifierState(\"CapsLock\")) {\r\n        s.Lstates = osk.modifierCodes['CAPS'];\r\n      } else {\r\n        s.Lstates = osk.modifierCodes['NO_CAPS'];\r\n      }\r\n\r\n      if(e.getModifierState(\"NumLock\")) {\r\n        s.Lstates |= osk.modifierCodes['NUM_LOCK'];\r\n      } else {\r\n        s.Lstates |= osk.modifierCodes['NO_NUM_LOCK'];\r\n      }\r\n\r\n      if(e.getModifierState(\"ScrollLock\") || e.getModifierState(\"Scroll\")) {  // \"Scroll\" for IE9.\r\n        s.Lstates |= osk.modifierCodes['SCROLL_LOCK'];\r\n      } else {\r\n        s.Lstates |= osk.modifierCodes['NO_SCROLL_LOCK'];\r\n      }\r\n\r\n      // We need these states to be tracked as well for proper OSK updates.\r\n      curModState |= s.Lstates;\r\n\r\n      // Stage 3 - Set our modifier state tracking variable and perform basic AltGr-related management.\r\n      s.LmodifierChange = DOMEventHandlers.states.modStateFlags != curModState;\r\n      DOMEventHandlers.states.modStateFlags = curModState;\r\n\r\n      // Flip the shift bit if Caps Lock is active on mnemonic keyboards.\r\n      // Avoid signaling a change in the shift key's modifier state.  (The reason for this block's positioning.)\r\n      if(activeKeyboard && activeKeyboard['KM'] && e.getModifierState(\"CapsLock\")) {\r\n        if((s.Lcode >= 65 && s.Lcode <= 90) /* 'A' - 'Z' */ || (s.Lcode >= 97 && s.Lcode <= 122) /* 'a' - 'z' */) {\r\n          curModState ^= 0x10; // Flip the 'shift' bit.\r\n          s.Lcode ^= 0x20; // Flips the 'upper' vs 'lower' bit for the base 'a'-'z' ASCII alphabetics.\r\n        }\r\n      }\r\n\r\n      // For European keyboards, not all browsers properly send both key-up events for the AltGr combo.\r\n      var altGrMask = osk.modifierCodes['RALT'] | osk.modifierCodes['LCTRL'];\r\n      if((prevModState & altGrMask) == altGrMask && (curModState & altGrMask) != altGrMask) {\r\n        // We just released AltGr - make sure it's all released.\r\n        curModState &= ~ altGrMask;\r\n      }\r\n      // Perform basic filtering for Windows-based ALT_GR emulation on European keyboards.\r\n      if(curModState & osk.modifierCodes['RALT']) {\r\n        curModState &= ~osk.modifierCodes['LCTRL'];\r\n      }\r\n\r\n      // Stage 4 - map the modifier set to the appropriate keystroke's modifiers.\r\n      if(this.keyman.keyboardManager.isChiral()) {\r\n        s.Lmodifiers = curModState & osk.modifierBitmasks.CHIRAL;\r\n\r\n        // Note for future - embedding a kill switch here or in keymanweb.osk.emulatesAltGr would facilitate disabling\r\n        // AltGr / Right-alt simulation.\r\n        if(osk.emulatesAltGr() && (s.Lmodifiers & osk.modifierBitmasks['ALT_GR_SIM']) == osk.modifierBitmasks['ALT_GR_SIM']) {\r\n          s.Lmodifiers ^= osk.modifierBitmasks['ALT_GR_SIM'];\r\n          s.Lmodifiers |= osk.modifierCodes['RALT'];\r\n        }\r\n      } else {\r\n        // No need to sim AltGr here; we don't need chiral ALTs.\r\n        s.Lmodifiers = \r\n          (curModState & 0x10) | // SHIFT\r\n          ((curModState & (osk.modifierCodes['LCTRL'] | osk.modifierCodes['RCTRL'])) ? 0x20 : 0) | \r\n          ((curModState & (osk.modifierCodes['LALT'] | osk.modifierCodes['RALT']))   ? 0x40 : 0); \r\n      }\r\n\r\n      // The 0x6F used to be 0x60 - this adjustment now includes the chiral alt and ctrl modifiers in that check.\r\n      s.LisVirtualKeyCode = (typeof e.charCode != 'undefined' && e.charCode != null  &&  (e.charCode == 0 || (s.Lmodifiers & 0x6F) != 0));\r\n      s.LisVirtualKey = s.LisVirtualKeyCode || e.type != 'keypress';\r\n      \r\n      return s;\r\n    }\r\n\r\n    /**\r\n     * Function     _KeyDown\r\n     * Scope        Private\r\n     * Description  Processes keydown event and passes data to keyboard. \r\n     * \r\n     * Note that the test-case oriented 'recorder' stubs this method to facilitate keystroke\r\n     * recording for use in test cases.  If changing this function, please ensure the recorder is\r\n     * not affected.\r\n     */ \r\n    _KeyDown: (e: KeyboardEvent) => boolean = function(this: DOMEventHandlers, e: KeyboardEvent): boolean {\r\n      var Ldv: Document, eClass='';\r\n      var activeKeyboard = this.keyman.keyboardManager.activeKeyboard;\r\n      var osk = this.keyman.osk;\r\n      var util = this.keyman.util;\r\n      var kbdInterface = this.keyman['interface'];\r\n\r\n      DOMEventHandlers.states._KeyPressToSwallow = 0;\r\n      if(DOMEventHandlers.states._DisableInput || activeKeyboard == null) {\r\n        return true;\r\n      }\r\n\r\n      // Prevent mapping element is readonly or tagged as kmw-disabled\r\n      var el=util.eventTarget(e) as HTMLElement;\r\n      if(util.device.touchable) {\r\n        if(el && typeof el.kmwInput != 'undefined' && el.kmwInput == false) {\r\n          return true;\r\n        }\r\n      } else if(el && el.className.indexOf('kmw-disabled') >= 0) {\r\n        return true; \r\n      }\r\n      \r\n      // Or if OSK not yet ready (for any reason)\r\n      if(!osk.ready) {\r\n        return true;\r\n      }\r\n      \r\n      // Get event properties  \r\n      var Levent = this._GetKeyEventProperties(e, true);\r\n      if(Levent == null) {\r\n        return true;\r\n      }\r\n\r\n      switch(Levent.Lcode) {\r\n        case 8: \r\n          kbdInterface.clearDeadkeys();\r\n          break; // I3318 (always clear deadkeys after backspace) \r\n        case 16: //\"K_SHIFT\":16,\"K_CONTROL\":17,\"K_ALT\":18\r\n        case 17: \r\n        case 18: \r\n        case 20: //\"K_CAPS\":20, \"K_NUMLOCK\":144,\"K_SCROLL\":145\r\n        case 144:\r\n        case 145:\r\n          // For eventual integration - we bypass an OSK update for physical keystrokes when in touch mode.\r\n          this.keyman.keyboardManager.notifyKeyboard(Levent.Lcode,Levent.Ltarg,1); \r\n          if(!util.device.touchable) {\r\n            return osk._UpdateVKShift(Levent, Levent.Lcode-15, 1); // I2187\r\n          } else {\r\n            return true;\r\n          }\r\n      }\r\n\r\n      if(Levent.LmodifierChange) {\r\n        this.keyman.keyboardManager.notifyKeyboard(0,Levent.Ltarg,1); \r\n        osk._UpdateVKShift(Levent, 0, 1);\r\n      }\r\n\r\n      if(!window.event) {\r\n        // I1466 - Convert the - keycode on mnemonic as well as positional layouts\r\n        // FireFox, Mozilla Suite\r\n        if(this.keyman.keyMapManager.browserMap.FF['k'+Levent.Lcode]) {\r\n          Levent.Lcode=this.keyman.keyMapManager.browserMap.FF['k'+Levent.Lcode];\r\n        }\r\n      }\r\n      //else \r\n      //{\r\n      // Safari, IE, Opera?\r\n      //}\r\n      \r\n      if(!activeKeyboard['KM']) {\r\n        // Positional Layout\r\n\r\n        var LeventMatched=0;\r\n        /* 13/03/2007 MCD: Swedish: Start mapping of keystroke to US keyboard */\r\n        var Lbase=this.keyman.keyMapManager.languageMap[osk._BaseLayout];\r\n        if(Lbase && Lbase['k'+Levent.Lcode]) {\r\n          Levent.Lcode=Lbase['k'+Levent.Lcode];\r\n        }\r\n        /* 13/03/2007 MCD: Swedish: End mapping of keystroke to US keyboard */\r\n        \r\n        if(typeof(activeKeyboard['KM'])=='undefined'  &&  !(Levent.Lmodifiers & 0x60)) {\r\n          // Support version 1.0 KeymanWeb keyboards that do not define positional vs mnemonic\r\n          var Levent2: com.keyman.LegacyKeyEvent = {\r\n            Lcode:this.keyman.keyMapManager._USKeyCodeToCharCode(Levent),\r\n            Ltarg:Levent.Ltarg,\r\n            Lmodifiers:0,\r\n            LisVirtualKey:0\r\n          };\r\n\r\n          if(kbdInterface.processKeystroke(util.physicalDevice, Levent2.Ltarg, Levent2)) {\r\n            LeventMatched=1;\r\n          }\r\n        }\r\n        \r\n        LeventMatched = LeventMatched || kbdInterface.processKeystroke(util.physicalDevice,Levent.Ltarg,Levent);\r\n        \r\n        // Support backspace in simulated input DIV from physical keyboard where not matched in rule  I3363 (Build 301)\r\n        if(Levent.Lcode == 8 && !LeventMatched && Levent.Ltarg.className != null && Levent.Ltarg.className.indexOf('keymanweb-input') >= 0) {\r\n          this.keyman.interface.defaultBackspace();\r\n        }\r\n      } else {\r\n        // Mnemonic layout\r\n        if(Levent.Lcode == 8) { // I1595 - Backspace for mnemonic\r\n          DOMEventHandlers.states._KeyPressToSwallow = 1;\r\n          if(!kbdInterface.processKeystroke(util.physicalDevice,Levent.Ltarg,Levent)) {\r\n            this.keyman.interface.defaultBackspace(); // I3363 (Build 301)\r\n          }\r\n          return false;  //added 16/3/13 to fix double backspace on mnemonic layouts on desktop\r\n        }\r\n        else {\r\n          DOMEventHandlers.states._KeyPressToSwallow = 0;\r\n          LeventMatched = LeventMatched || kbdInterface.processKeystroke(util.physicalDevice,Levent.Ltarg,Levent);\r\n        }\r\n      }\r\n\r\n      if(!LeventMatched  &&  Levent.Lcode >= 96  &&  Levent.Lcode <= 111 && !activeKeyboard['KM']) {\r\n        // Number pad, numlock on\r\n        //      _Debug('KeyPress NumPad code='+Levent.Lcode+'; Ltarg='+Levent.Ltarg.tagName+'; LisVirtualKey='+Levent.LisVirtualKey+'; _KeyPressToSwallow='+keymanweb._KeyPressToSwallow+'; keyCode='+(e?e.keyCode:'nothing'));\r\n\r\n        if(Levent.Lcode < 106) {\r\n          var Lch = Levent.Lcode-48;\r\n        } else {\r\n          Lch = Levent.Lcode-64;\r\n        }\r\n        kbdInterface.output(0, Levent.Ltarg, String._kmwFromCharCode(Lch)); //I3319\r\n\r\n        LeventMatched = 1;\r\n      }\r\n    \r\n      if(LeventMatched) {\r\n        if(e  &&  e.preventDefault) {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n        }\r\n        DOMEventHandlers.states._KeyPressToSwallow = (e ? this._GetEventKeyCode(e) : 0);\r\n        return false;\r\n      } else {\r\n        DOMEventHandlers.states._KeyPressToSwallow = 0;\r\n      }\r\n      \r\n      if(Levent.Lcode == 8) {\r\n        /* Backspace - delete deadkeys, also special rule if desired? */\r\n        // This is needed to prevent jumping to previous page, but why???  // I3363 (Build 301)\r\n        if(Levent.Ltarg.className != null && Levent.Ltarg.className.indexOf('keymanweb-input') >= 0) {\r\n          return false;\r\n        }\r\n      }\r\n\r\n      if(typeof((Levent.Ltarg as HTMLElement).base) != 'undefined') {\r\n        // Simulated touch elements have no default text-processing - we need to rely on a strategy similar to\r\n        // that of the OSK here.\r\n        var ch = osk.defaultKeyOutput('',Levent.Lcode,Levent.Lmodifiers,false,Levent.Ltarg);\r\n        if(ch) {\r\n          kbdInterface.output(0, Levent.Ltarg, ch);\r\n          return false;\r\n        }\r\n      }\r\n\r\n      return true;\r\n    }.bind(this);\r\n\r\n    doChangeEvent(_target: HTMLElement|Document) {\r\n      if(DOMEventHandlers.states.changed) {\r\n        var event: Event;\r\n        if(typeof Event == 'function') {\r\n          event = new Event('change', {\"bubbles\": true, \"cancelable\": false});\r\n        } else { // IE path\r\n          event = document.createEvent(\"HTMLEvents\");\r\n          event.initEvent('change', true, false);\r\n        }\r\n\r\n        // Ensure that touch-aliased elements fire as if from the aliased element.\r\n        if(_target['base'] && _target['base']['kmw_ip']) {\r\n          _target = _target['base'];\r\n        }\r\n        _target.dispatchEvent(event);\r\n      }\r\n\r\n      DOMEventHandlers.states.changed = false;\r\n    }\r\n\r\n    /**\r\n     * Function     _KeyPress\r\n     * Scope        Private\r\n     * Description Processes keypress event (does not pass data to keyboard)\r\n     */       \r\n    _KeyPress: (e: KeyboardEvent) => boolean = function(this: DOMEventHandlers, e: KeyboardEvent): boolean {\r\n      var Levent;\r\n      if(DOMEventHandlers.states._DisableInput || this.keyman.keyboardManager.activeKeyboard == null) {\r\n        return true;\r\n      }\r\n\r\n      Levent = this._GetKeyEventProperties(e);\r\n      if(Levent == null || Levent.LisVirtualKey) {\r\n        return true;\r\n      }\r\n\r\n      // _Debug('KeyPress code='+Levent.Lcode+'; Ltarg='+Levent.Ltarg.tagName+'; LisVirtualKey='+Levent.LisVirtualKey+'; _KeyPressToSwallow='+keymanweb._KeyPressToSwallow+'; keyCode='+(e?e.keyCode:'nothing'));\r\n\r\n      /* I732 START - 13/03/2007 MCD: Swedish: Start positional keyboard layout code: prevent keystroke */\r\n      if(!this.keyman.keyboardManager.activeKeyboard['KM']) {\r\n        if(!DOMEventHandlers.states._KeyPressToSwallow) {\r\n          return true;\r\n        }\r\n        if(Levent.Lcode < 0x20 || ((<any>this.keyman)._BrowserIsSafari  &&  (Levent.Lcode > 0xF700  &&  Levent.Lcode < 0xF900))) {\r\n          return true;\r\n        }\r\n        e = this.keyman._GetEventObject<KeyboardEvent>(e);   // I2404 - Manage IE events in IFRAMEs\r\n        if(e) {\r\n          e.returnValue = false;\r\n        }\r\n        return false;\r\n      }\r\n      /* I732 END - 13/03/2007 MCD: Swedish: End positional keyboard layout code */\r\n      \r\n      if(DOMEventHandlers.states._KeyPressToSwallow || this.keyman['interface'].processKeystroke(this.keyman.util.physicalDevice,Levent.Ltarg,Levent)) {\r\n        DOMEventHandlers.states._KeyPressToSwallow=0;\r\n        if(e  &&  e.preventDefault) {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n        }\r\n        return false;\r\n      }\r\n      DOMEventHandlers.states._KeyPressToSwallow=0;\r\n      return true;\r\n    }.bind(this);\r\n\r\n    /**\r\n     * Function     _KeyUp\r\n     * Scope        Private\r\n     * Description Processes keyup event and passes event data to keyboard\r\n     */       \r\n    _KeyUp: (e: KeyboardEvent) => boolean = function(this: DOMEventHandlers, e: KeyboardEvent): boolean {\r\n      var keyboardManager = this.keyman.keyboardManager;\r\n      var osk = this.keyman.osk;\r\n\r\n      var Levent = this._GetKeyEventProperties(e, false);\r\n      if(Levent == null || !osk.ready) {\r\n        return true;\r\n      }\r\n\r\n      switch(Levent.Lcode) {\r\n        case 13:  \r\n          if(Levent.Ltarg instanceof Levent.Ltarg.ownerDocument.defaultView.HTMLTextAreaElement) {\r\n            break;\r\n          }\r\n        \r\n          if(Levent.Ltarg.base && Levent.Ltarg.base instanceof Levent.Ltarg.base.ownerDocument.defaultView.HTMLTextAreaElement) {\r\n            break;\r\n          }\r\n\r\n          // For input fields, move to next input element\r\n          if(Levent.Ltarg instanceof Levent.Ltarg.ownerDocument.defaultView.HTMLInputElement) {\r\n            var inputEle = Levent.Ltarg;\r\n            if(inputEle.type == 'search' || inputEle.type == 'submit') {\r\n              inputEle.form.submit();\r\n            } else {\r\n              this.keyman.domManager.moveToNext(false);\r\n            }\r\n          }\r\n          return true;        \r\n                  \r\n        case 16: //\"K_SHIFT\":16,\"K_CONTROL\":17,\"K_ALT\":18\r\n        case 17: \r\n        case 18: \r\n        case 20: //\"K_CAPS\":20, \"K_NUMLOCK\":144,\"K_SCROLL\":145\r\n        case 144:\r\n        case 145:\r\n          keyboardManager.notifyKeyboard(Levent.Lcode,Levent.Ltarg,0);\r\n          if(!this.keyman.util.device.touchable) {\r\n            return osk._UpdateVKShift(Levent, Levent.Lcode-15, 1);  // I2187\r\n          } else {\r\n            return true;\r\n          }\r\n      }\r\n      \r\n      if(Levent.LmodifierChange){\r\n        keyboardManager.notifyKeyboard(0,Levent.Ltarg,0); \r\n        osk._UpdateVKShift(Levent, 0, 1);  // I2187\r\n      }\r\n      \r\n      return false;\r\n    }.bind(this);\r\n  }\r\n\r\n  // -------------------------------------------------------------------------\r\n\r\n  /**\r\n   * Defines numerous functions for handling and modeling touch-based aliases.\r\n   */\r\n  export class DOMTouchHandlers extends DOMEventHandlers {\r\n    // Stores the simulated caret element.\r\n    caret: HTMLDivElement;\r\n    caretTimerId: number;\r\n\r\n    firstTouch: {\r\n      x: number;\r\n      y: number;\r\n    };\r\n\r\n    \r\n    constructor(keyman: KeymanBase) {\r\n      super(keyman);\r\n\r\n      this.initCaret();\r\n    }\r\n\r\n    initCaret(): void {\r\n      /**\r\n       * Create a caret to be appended to the scroller of the focussed input field. \r\n       * The caret is appended to the scroller so that it will automatically be clipped \r\n       * when the user manually scrolls it outside the element boundaries.          \r\n       * It is positioned exactly over the hidden span that is inserted between the\r\n       * text spans before and after the insertion point.          \r\n       */\r\n      this.caret=<HTMLDivElement> document.createElement('DIV');\r\n      var cs=this.caret.style;\r\n      cs.position='absolute';\r\n      cs.height='16px';           // default height, actual height set from element properties\r\n      cs.width='2px';\r\n      cs.backgroundColor='blue';\r\n      cs.border='none';\r\n      cs.left=cs.top='0px';           // actual position set relative to parent when displayed\r\n      cs.display='block';         \r\n      cs.visibility='hidden';\r\n      cs.zIndex='9998';           // immediately below the OSK\r\n\r\n      // Start the caret flash timer\r\n      this.caretTimerId = window.setInterval(this.flashCaret,500);\r\n    }\r\n\r\n    /**\r\n     * Handle receiving focus by simulated input field \r\n     *      \r\n     */       \r\n    setFocus: (e?: TouchEvent|MSPointerEvent) => void = function(this: DOMTouchHandlers, e?: TouchEvent|MSPointerEvent): void {\r\n      var kmw = this.keyman;\r\n      var osk = this.keyman.osk;\r\n      var util = this.keyman.util;\r\n\r\n      DOMEventHandlers.states.setFocusTimer();\r\n\r\n      var tEvent: {\r\n        clientX: number;\r\n        clientY: number;\r\n        target?: EventTarget;\r\n      };\r\n\r\n      if(Util.instanceof(e, \"TouchEvent\")) {\r\n          tEvent=(e as TouchEvent).touches[0];\r\n      } else { // Allow external code to set focus and thus display the OSK on touch devices if required (KMEW-123)\r\n        tEvent={clientX:0, clientY:0}\r\n        // Will usually be called from setActiveElement, which should define DOMEventHandlers.states.lastActiveElement\r\n        if(DOMEventHandlers.states.lastActiveElement) {\r\n          tEvent.target = DOMEventHandlers.states.lastActiveElement['kmw_ip'];\r\n        // but will default to first input or text area on page if DOMEventHandlers.states.lastActiveElement is null\r\n        } else {\r\n          tEvent.target = this.keyman.domManager.sortedInputs[0]['kmw_ip'];\r\n        }\r\n      }    \r\n      \r\n      var touchX=tEvent.clientX,touchY=tEvent.clientY;\r\n      var tTarg=tEvent.target as HTMLElement;\r\n      var scroller: HTMLElement;\r\n\r\n      // Identify the scroller element\r\n      if(Util.instanceof(tTarg, \"HTMLSpanElement\")) {\r\n        scroller=tTarg.parentNode as HTMLElement;\r\n      } else if(tTarg.className != null && tTarg.className.indexOf('keymanweb-input') >= 0) {\r\n        scroller=tTarg.firstChild as HTMLElement;\r\n      } else {\r\n        scroller=tTarg;\r\n      }\r\n\r\n      // And the actual target element        \r\n      var target=scroller.parentNode as HTMLElement;\r\n\r\n      // Move the caret and refocus if necessary     \r\n      if(DOMEventHandlers.states.activeElement != target) {\r\n        // Hide the KMW caret\r\n        this.hideCaret(); \r\n        DOMEventHandlers.states.activeElement=target;\r\n        // The issue here is that touching a DIV does not actually set the focus for iOS, even when enabled to accept focus (by setting tabIndex=0)\r\n        // We must explicitly set the focus in order to remove focus from any non-KMW input\r\n        target.focus();  //Android native browsers may not like this, but it is needed for Chrome, Safari\r\n      }  \r\n      \r\n      // Correct element directionality if required\r\n      this.keyman.domManager._SetTargDir(target);  \r\n      // What we really want to do is to blur any active element that is not a KMW input, \r\n      // but the following line does not work as might be expected, even though the correct element is referenced.\r\n      // It is as though blur is ignored if focus is supposed to have been moved, even if it has not in fact been moved?\r\n      //if(document.activeElement.nodeName != 'DIV' && document.activeElement.nodeName != 'BODY') document.activeElement.blur();\r\n      \r\n      // And display the OSK if not already visible\r\n      if(osk.ready && !osk._Visible) {\r\n        osk._Show();\r\n      }\r\n      \r\n      // If clicked on DIV, set caret to end of text\r\n      if(Util.instanceof(tTarg, \"HTMLDivElement\")) { \r\n        var x,cp;\r\n        x=util._GetAbsoluteX(scroller.firstChild as HTMLElement);        \r\n        if(target.dir == 'rtl') { \r\n          x += (scroller.firstChild as HTMLElement).offsetWidth;        \r\n          cp=(touchX > x ? 0 : 100000);\r\n        } else {\r\n          cp=(touchX<x ? 0 : 100000);\r\n        }\r\n    \r\n        this.setTextCaret(target,cp);\r\n        this.scrollInput(target);        \r\n      } else { // Otherwise, if clicked on text in SPAN, set at touch position\r\n        var caret,cp,cpMin,cpMax,x,y,dy,yRow,iLoop;\r\n        caret=scroller.childNodes[1]; //caret span\r\n        cpMin=0;\r\n        cpMax=this.getText(target)._kmwLength();\r\n        cp=this.getTextCaret(target);\r\n        dy=document.body.scrollTop;\r\n\r\n        // Vertical scrolling\r\n        if(target.base instanceof target.base.ownerDocument.defaultView.HTMLTextAreaElement) {\r\n          yRow=Math.round(target.base.offsetHeight/(target.base as HTMLTextAreaElement).rows);     \r\n          for(iLoop=0; iLoop<16; iLoop++)\r\n          {\r\n            y=util._GetAbsoluteY(caret)-dy;  //top of caret            \r\n            if(y > touchY && cp > cpMin && cp != cpMax) {cpMax=cp; cp=Math.round((cp+cpMin)/2);}\r\n            else if(y < touchY-yRow && cp < cpMax && cp != cpMin) {cpMin=cp; cp=Math.round((cp+cpMax)/2);}\r\n            else break;\r\n            this.setTextCaret(target,cp);\r\n          }\r\n\r\n          while(util._GetAbsoluteY(caret)-dy > touchY && cp > cpMin) {\r\n            this.setTextCaret(target,--cp);\r\n          }\r\n\r\n          while(util._GetAbsoluteY(caret)-dy < touchY-yRow && cp < cpMax) {\r\n            this.setTextCaret(target,++cp);\r\n          }\r\n        }\r\n\r\n        // Caret repositioning for horizontal scrolling of RTL text\r\n\r\n        // snapOrder - 'snaps' the touch location in a manner corresponding to the 'ltr' vs 'rtl' orientation.\r\n        // Think of it as performing a floor() function, but the floor depends on the origin's direction.\r\n        var snapOrder;\r\n        if(target.dir == 'rtl') {  // I would use arrow functions, but IE doesn't like 'em.\r\n          snapOrder = function(a, b) {\r\n            return a < b; \r\n          };\r\n        } else {\r\n          snapOrder = function(a, b) { \r\n            return a > b; \r\n          };\r\n        }\r\n\r\n        for(iLoop=0; iLoop<16; iLoop++) {\r\n          x=util._GetAbsoluteX(caret);  //left of caret            \r\n          if(snapOrder(x, touchX) && cp > cpMin && cp != cpMax) {\r\n            cpMax=cp; \r\n            cp=Math.round((cp+cpMin)/2);\r\n          } else if(!snapOrder(x, touchX) && cp < cpMax && cp != cpMin) {\r\n            cpMin=cp; \r\n            cp=Math.round((cp+cpMax)/2);\r\n          } else {\r\n            break;\r\n          }\r\n          this.setTextCaret(target,cp);\r\n        }\r\n\r\n        while(snapOrder(util._GetAbsoluteX(caret), touchX) && cp > cpMin) {\r\n          this.setTextCaret(target,--cp);\r\n        }\r\n        while(!snapOrder(util._GetAbsoluteX(caret), touchX) && cp < cpMax) {\r\n          this.setTextCaret(target,++cp);\r\n        }\r\n      }\r\n\r\n      /**\r\n       * This event will trigger before keymanweb.setBlur is triggered.  Now that we're allowing independent keyboard settings\r\n       * for controls, we have to act here to preserve the outgoing control's keyboard settings.\r\n       *\r\n       * If we 'just activated' the KeymanWeb UI, we need to save the new keyboard change as appropriate.\r\n       */  \r\n      this._BlurKeyboardSettings();\r\n\r\n      // With the attachment API update, we now directly track the old legacy control behavior.\r\n      DOMEventHandlers.states.lastActiveElement = target;\r\n\r\n      /**\r\n       * If we 'just activated' the KeymanWeb UI, we need to save the new keyboard change as appropriate.\r\n       * If not, we need to activate the control's preferred keyboard.\r\n       */\r\n      this._FocusKeyboardSettings(false);\r\n      \r\n      // Always do the common focus stuff, instantly returning if we're in an editable iframe.\r\n      // This parallels the if-statement in _ControlFocus - it may be needed as this if-statement in the future,\r\n      // despite its present redundancy.\r\n      if(this._CommonFocusHelper(target)) {\r\n        return;\r\n      }\r\n    }.bind(this);\r\n        \r\n    getText(e: HTMLElement): string {\r\n      if(e == null) {\r\n        return '';\r\n      }\r\n\r\n      return e.textContent;\r\n    } \r\n\r\n    setText(e: HTMLElement, t?: string, cp?: number): void {\r\n      if(e && e.childNodes.length > 0) {\r\n        var d=e.firstChild,tLen=0;\r\n        if(d.childNodes.length >= 3) {\r\n          var s1=<HTMLElement> d.childNodes[0], s2=<HTMLElement> d.childNodes[2],t1,t2;\r\n          \r\n          // Read current text if null passed (for caret positioning)\r\n          if(t === null) {\r\n            t1=s1.textContent;\r\n            t2=s2.textContent;\r\n            t=t1+t2;        \r\n          }\r\n\r\n          if(cp < 0) {\r\n            cp = 0;    //if(typeof t._kmwLength == 'undefined') return;\r\n          }\r\n          tLen=t._kmwLength();\r\n          \r\n          if(cp === null || cp > tLen) {\r\n            cp=tLen;\r\n          }\r\n          t1=t._kmwSubstr(0,cp);\r\n          t2=t._kmwSubstr(cp);\r\n                              \r\n          s1.textContent=t1;\r\n          s2.textContent=t2;\r\n        }\r\n      }\r\n\r\n      this.updateBaseElement(e,tLen); // KMW-3, KMW-29\r\n    }\r\n\r\n    getTextBeforeCaret(e: HTMLElement) {\r\n      if(e && e.childNodes.length > 1) {\r\n        var d=e.firstChild;\r\n        if(d.childNodes.length > 0) {\r\n          var s1=<HTMLElement> d.childNodes[0];\r\n          return s1.textContent;\r\n        }\r\n      }\r\n\r\n      return '';    \r\n    }\r\n        \r\n    setTextBeforeCaret(e: HTMLElement, t: string): void {\r\n      if(e && e.childNodes.length > 0) {\r\n        var d=e.firstChild,tLen=0;\r\n        if(d.childNodes.length > 1) {\r\n          var s1=<HTMLElement> d.childNodes[0], s2=<HTMLElement> d.childNodes[2];\r\n          // Collapse (trailing) whitespace to a single space for INPUT fields (also prevents wrapping)\r\n          if(e.base.nodeName != 'TEXTAREA') {\r\n            t=t.replace(/\\s+$/,' ');\r\n          }\r\n          s1.textContent=t;\r\n          // Test total length in order to control base element visibility \r\n          tLen=t.length;\r\n          tLen=tLen+s2.textContent.length;           \r\n        }\r\n      }\r\n      \r\n      // Update the base element then scroll into view if necessary      \r\n      this.updateBaseElement(e,tLen); //KMW-3, KMW-29      \r\n      this.scrollInput(e); \r\n    }\r\n\r\n    getTextCaret(e: HTMLElement): number {\r\n      return this.getTextBeforeCaret(e)._kmwLength();\r\n    }\r\n    \r\n    setTextCaret(e: HTMLElement, cp: number): void {\r\n      this.setText(e,null,cp);\r\n      this.showCaret(e);\r\n    }\r\n\r\n    hideCaret() {\r\n      var e=DOMEventHandlers.states.lastActiveElement, s=null;\r\n      if(e && e.className != null && e.className.indexOf('keymanweb-input') >= 0) {\r\n        // Always copy text back to underlying field on blur\r\n        if(e.base instanceof e.base.ownerDocument.defaultView.HTMLTextAreaElement\r\n            ||e.base instanceof e.base.ownerDocument.defaultView.HTMLInputElement) {\r\n          e.base.value = this.getText(e);\r\n        }\r\n        \r\n        // And set the scroller caret to the end of the element content\r\n        this.setText(e, null, 100000);\r\n        \r\n        // Set the element scroll to zero (or max for RTL INPUT)\r\n        var ss=(e.firstChild as HTMLElement).style;\r\n        if(e.base.nodeName == 'TEXTAREA') {\r\n          ss.top='0'; \r\n        } else {\r\n          if(e.base.dir == 'rtl') {\r\n            ss.left=(e.offsetWidth-(e.firstChild as HTMLElement).offsetWidth-8)+'px';\r\n          } else {\r\n            ss.left='0';\r\n          }\r\n        }\r\n        \r\n        \r\n        // And hide the caret and scrollbar       \r\n        if(this.caret.parentNode) {\r\n          this.caret.parentNode.removeChild(this.caret);\r\n        }\r\n\r\n        this.caret.style.visibility='hidden';\r\n        if(e.childNodes.length > 1 ) {\r\n          (e.childNodes[1] as HTMLElement).style.visibility='hidden';\r\n        }\r\n      }    \r\n    }\r\n\r\n    flashCaret: () => void = function(this: DOMTouchHandlers): void {\r\n      if(this.keyman.util.device.touchable && DOMEventHandlers.states.activeElement != null) {\r\n        var cs=this.caret.style;\r\n        cs.visibility = cs.visibility != 'visible' ? 'visible' : 'hidden';\r\n      }\r\n    }.bind(this);\r\n\r\n    /**\r\n     * Position the caret at the start of the second span within the scroller\r\n     *      \r\n     * @param   {Object}  e   input DIV element (copy of INPUT or TEXTAREA)\r\n     */\r\n    showCaret(e: HTMLElement) {                          \r\n      if(!e || !e.firstChild || (e.firstChild.childNodes.length<3)) {\r\n        return;\r\n      }\r\n\r\n      var scroller=e.firstChild, cs=this.caret.style, sp2=<HTMLElement>scroller.childNodes[1];\r\n      \r\n      // Attach the caret to this scroller and position it over the caret span\r\n      if(this.caret.parentNode != <Node>scroller) {\r\n        scroller.appendChild(this.caret);\r\n      }\r\n\r\n      cs.left=sp2.offsetLeft+'px'; \r\n      cs.top=sp2.offsetTop+'px';\r\n      cs.height=(sp2.offsetHeight-1)+'px';\r\n      cs.visibility='hidden';   // best to wait for timer to display caret\r\n      \r\n      // Scroll into view if required\r\n      this.scrollBody(e);\r\n    \r\n      // Display and position the scrollbar if necessary\r\n      this.setScrollBar(e);\r\n    }\r\n          \r\n    updateInput(x: HTMLDivElement) {\r\n      var util = this.keyman.util;\r\n\r\n      var xs=x.style,b=x.base,\r\n          s=window.getComputedStyle(b,null),\r\n          mLeft=parseInt(s.marginLeft,10),\r\n          mTop=parseInt(s.marginTop,10),\r\n          x1=util._GetAbsoluteX(b), y1=util._GetAbsoluteY(b);\r\n\r\n      var p=x.offsetParent as HTMLElement;\r\n      if(p) {\r\n        x1=x1-util._GetAbsoluteX(p);\r\n        y1=y1-util._GetAbsoluteY(p);\r\n      }\r\n      \r\n      if(isNaN(mLeft)) {\r\n        mLeft=0;\r\n      }\r\n      if(isNaN(mTop)) {\r\n        mTop=0;\r\n      }\r\n      \r\n      xs.left=(x1-mLeft)+'px';\r\n      xs.top=(y1-mTop)+'px';\r\n\r\n      // FireFox does not want the offset!\r\n      if(typeof(s.MozBoxSizing) != 'undefined') {\r\n        xs.left=x1+'px';\r\n        xs.top=y1+'px';\r\n      }     \r\n\r\n      var w=b.offsetWidth, h=b.offsetHeight,\r\n          pLeft=parseInt(s.paddingLeft,10), pRight=parseInt(s.paddingRight,10),      \r\n          pTop=parseInt(s.paddingTop,10), pBottom=parseInt(s.paddingBottom,10),\r\n          bLeft=parseInt(s.borderLeft,10), bRight=parseInt(s.borderRight,10),    \r\n          bTop=parseInt(s.borderTop,10), bBottom=parseInt(s.borderBottom,10);\r\n    \r\n      // If using content-box model, must subtract the padding and border, \r\n      // but *not* for border-box (as for WordPress PlugIn)\r\n      var boxSizing='undefined';\r\n      if(typeof(s.boxSizing) != 'undefined') {\r\n        boxSizing=s.boxSizing;\r\n      } else if(typeof(s.MozBoxSizing) != 'undefined') {\r\n        boxSizing=s.MozBoxSizing;\r\n      }\r\n\r\n      if(boxSizing == 'content-box') {\r\n        if(!isNaN(pLeft)) w -= pLeft;\r\n        if(!isNaN(pRight)) w -= pRight;\r\n        if(!isNaN(bLeft)) w -= bLeft;\r\n        if(!isNaN(bRight)) w -= bRight;\r\n        \r\n        if(!isNaN(pTop)) h -= pTop;\r\n        if(!isNaN(pBottom)) h -= pBottom;\r\n        if(!isNaN(bTop)) h -= bTop;\r\n        if(!isNaN(bBottom)) h -= bBottom;\r\n      }\r\n    \r\n      if(util.device.OS == 'Android') {\r\n        // FireFox - adjust padding to match input and text area defaults \r\n        if(typeof(s.MozBoxSizing) != 'undefined') {\r\n          xs.paddingTop=(pTop+1)+'px';\r\n          xs.paddingLeft=pLeft+'px';\r\n          \r\n          if(x.base.nodeName == 'TEXTAREA') {\r\n            xs.marginTop='1px';\r\n          } else {\r\n            xs.marginLeft='1px';\r\n          }\r\n\r\n          w--;\r\n          h--;\r\n        } else { // Chrome, Opera, native browser (?)\r\n          w++;\r\n          h++;\r\n        }\r\n      }\r\n\r\n      xs.width=w+'px';\r\n      xs.height=h+'px';   \r\n    }\r\n\r\n    /**\r\n     * Set content, visibility, background and borders of input and base elements (KMW-3,KMW-29) \r\n     *\r\n     * @param       {Object}        e     input element \r\n     * @param       {number}        n     length of text in field\r\n     */                      \r\n    updateBaseElement(e: HTMLElement, n: number) {\r\n      var Ldv = e.base.ownerDocument.defaultView;\r\n      if(e.base instanceof Ldv.HTMLInputElement ||e.base instanceof Ldv.HTMLTextAreaElement) {\r\n        e.base.value = this.getText(e); //KMW-29\r\n      } else {\r\n        e.base.textContent = this.getText(e);\r\n      }\r\n\r\n      e.style.backgroundColor=(n==0?'transparent':window.getComputedStyle(e.base,null).backgroundColor);\r\n      if(this.keyman.util.device.OS == 'iOS') {\r\n        e.base.style.visibility=(n==0?'visible':'hidden');\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Close OSK and remove simulated caret on losing focus\r\n     */          \r\n    cancelInput(): void { \r\n      DOMEventHandlers.states.activeElement=null; \r\n      this.hideCaret(); \r\n      this.keyman.osk.hideNow();\r\n    };\r\n\r\n    /**\r\n     * Handle losing focus from simulated input field \r\n     */\r\n    setBlur: (e: FocusEvent) => void = function(this: DOMTouchHandlers, e: FocusEvent) {\r\n      // This works OK for iOS, but may need something else for other platforms\r\n\r\n      this.keyman.interface.resetContext();\r\n\r\n      if(('relatedTarget' in e) && e.relatedTarget) {\r\n        var elem: HTMLElement = e.relatedTarget as HTMLElement;\r\n        this.doChangeEvent(elem);\r\n        if(elem.nodeName != 'DIV' || elem.className.indexOf('keymanweb-input') == -1) {\r\n          this.cancelInput(); \r\n          return;\r\n        }\r\n      }\r\n\r\n      //Hide the OSK\r\n      if(!DOMEventHandlers.states.focusing) {\r\n        this.cancelInput();\r\n      }\r\n    }.bind(this);\r\n\r\n    /**\r\n     * Display and position a scrollbar in the input field if needed\r\n     * \r\n     * @param   {Object}  e   input DIV element (copy of INPUT or TEXTAREA)\r\n     */\r\n    setScrollBar(e: HTMLElement) {\r\n      // Display the scrollbar if necessary.  Added TEXTAREA condition to correct rotation issue KMW-5.  Fixed for 310 beta.\r\n      var scroller=<HTMLElement>e.childNodes[0], sbs=(<HTMLElement>e.childNodes[1]).style;\r\n      if((scroller.offsetWidth > e.offsetWidth || scroller.offsetLeft < 0) && (e.base.nodeName != 'TEXTAREA')) {\r\n        sbs.height='4px';\r\n        sbs.width=100*(e.offsetWidth/scroller.offsetWidth)+'%';\r\n        sbs.left=100*(-scroller.offsetLeft/scroller.offsetWidth)+'%';\r\n        sbs.top='0';\r\n        sbs.visibility='visible';  \r\n      } else if(scroller.offsetHeight > e.offsetHeight || scroller.offsetTop < 0) {\r\n        sbs.width='4px';\r\n        sbs.height=100*(e.offsetHeight/scroller.offsetHeight)+'%';\r\n        sbs.top=100*(-scroller.offsetTop/scroller.offsetHeight)+'%';\r\n        sbs.left='0';    \r\n        sbs.visibility='visible';        \r\n      } else {\r\n        sbs.visibility='hidden';\r\n      }\r\n    }                    \r\n\r\n    /**\r\n     * Handle the touch move event for an input element\r\n     */         \r\n    dragInput: (e: TouchEvent|MouseEvent) => void = function(this: DOMTouchHandlers, e: TouchEvent|MouseEvent) {\r\n      // Prevent dragging window \r\n      e.preventDefault();\r\n      e.stopPropagation();      \r\n\r\n      // Identify the target from the touch list or the event argument (IE 10 only)\r\n      var target: HTMLElement;\r\n      \r\n      if(Util.instanceof(e, \"TouchEvent\")) {\r\n        target = (e as TouchEvent).targetTouches[0].target as HTMLElement;\r\n      } else {\r\n        target = e.target as HTMLElement;\r\n      }\r\n      if(target == null) {\r\n        return;\r\n      }\r\n      \r\n      // Identify the input element from the touch event target (touched element may be contained by input)\r\n      if(target.className == null || target.className.indexOf('keymanweb-input') < 0) target=<HTMLElement> target.parentNode;\r\n      if(target.className == null || target.className.indexOf('keymanweb-input') < 0) target=<HTMLElement> target.parentNode;\r\n      if(target.className == null || target.className.indexOf('keymanweb-input') < 0) return;\r\n      \r\n      var x, y;\r\n\r\n      if(Util.instanceof(e, \"TouchEvent\")) {\r\n        x = (e as TouchEvent).touches[0].screenX;\r\n        y = (e as TouchEvent).touches[0].screenY;\r\n      } else {\r\n        x = (e as MouseEvent).screenX;\r\n        y = (e as MouseEvent).screenY;\r\n      }\r\n                \r\n      // Allow content of input elements to be dragged horizontally or vertically\r\n      if(typeof this.firstTouch == 'undefined' || this.firstTouch == null) {\r\n        this.firstTouch={x:x,y:y};\r\n      } else {\r\n        var x0=this.firstTouch.x,y0=this.firstTouch.y,\r\n          scroller=target.firstChild as HTMLElement,dx,dy,x1;\r\n        \r\n        if(target.base.nodeName == 'TEXTAREA') {\r\n          var yOffset=parseInt(scroller.style.top,10);\r\n          if(isNaN(yOffset)) yOffset=0;\r\n          dy=y0-y;\r\n          if(dy < -4 || dy > 4) {\r\n            scroller.style.top=(yOffset<dy?yOffset-dy:0)+'px';\r\n            this.firstTouch.y=y;  \r\n          } \r\n        } else {\r\n          var xOffset=parseInt(scroller.style.left,10);\r\n          if(isNaN(xOffset)) xOffset=0;\r\n          dx=x0-x;\r\n          if(dx < -4 || dx > 4)\r\n          {\r\n            // Limit dragging beyond the defined text (to avoid dragging the text completely out of view)\r\n            var xMin=0,xMax=this.keyman.util._GetAbsoluteX(target)+target.offsetWidth-scroller.offsetWidth-32;\r\n            if(target.base.dir == 'rtl')xMin=16; else xMax=xMax-24;            \r\n            x1=xOffset-dx;\r\n            if(x1 > xMin) x1=xMin;\r\n            if(x1 < xMax) x1=xMax;\r\n            scroller.style.left=x1+'px';\r\n            this.firstTouch.x=x;       \r\n          }    \r\n        }\r\n      }\r\n      this.setScrollBar(target);\r\n    }.bind(this);\r\n\r\n    /**\r\n     * Scroll the input field horizontally (INPUT base element) or \r\n     * vertically (TEXTAREA base element) to bring the caret into view\r\n     * as text is entered or deleted form an element     \r\n     *      \r\n     * @param       {Object}      e        simulated input field object with focus\r\n     */         \r\n    scrollInput(e: HTMLElement) {\r\n      if(!e || !e.firstChild || e.className == null || e.className.indexOf('keymanweb-input') < 0 ) {\r\n        return;\r\n      }\r\n\r\n      var scroller=e.firstChild as HTMLElement;\r\n      if(scroller.childNodes.length < 3) {\r\n        return;\r\n      }\r\n\r\n      var util = this.keyman.util;\r\n\r\n      // Get the actual absolute position of the caret and the element \r\n      var s2=scroller.childNodes[1] as HTMLElement,\r\n        cx=util._GetAbsoluteX(s2),cy=util._GetAbsoluteY(s2),\r\n        ex=util._GetAbsoluteX(e),ey=util._GetAbsoluteY(e),\r\n        x=parseInt(scroller.style.left,10),\r\n        y=parseInt(scroller.style.top,10),\r\n        dx=0,dy=0; \r\n      \r\n      // Scroller offsets must default to zero\r\n      if(isNaN(x)) x=0; if(isNaN(y)) y=0;\r\n\r\n      // Scroll input field vertically if necessary\r\n      if(e.base instanceof e.base.ownerDocument.defaultView.HTMLTextAreaElement) { \r\n        var rowHeight=Math.round(e.offsetHeight/e.base.rows);\r\n        if(cy < ey) dy=cy-ey;\r\n        if(cy > ey+e.offsetHeight-rowHeight) dy=cy-ey-e.offsetHeight+rowHeight;   \r\n        if(dy != 0)scroller.style.top=(y<dy?y-dy:0)+'px';\r\n      } else { // or scroll horizontally if needed\r\n        if(cx < ex+8) dx=cx-ex-12;\r\n        if(cx > ex+e.offsetWidth-12) dx=cx-ex-e.offsetWidth+12;   \r\n        if(dx != 0)scroller.style.left=(x<dx?x-dx:0)+'px';\r\n      }    \r\n\r\n      // Display the caret (and scroll into view if necessary)\r\n      this.showCaret(e);\r\n    }\r\n\r\n    /**\r\n     * Scroll the document body vertically to bring the active input into view\r\n     * \r\n     * @param       {Object}      e        simulated input field object being focussed\r\n     */         \r\n    scrollBody(e: HTMLElement): void {\r\n      var osk = this.keyman.osk;\r\n      var util = this.keyman.util;\r\n\r\n      if(!e || e.className == null || e.className.indexOf('keymanweb-input') < 0 || !osk.ready) {\r\n        return;\r\n      }\r\n\r\n      // Get the absolute position of the caret\r\n      var s2=<HTMLElement>e.firstChild.childNodes[1], y=util._GetAbsoluteY(s2), t=window.pageYOffset,dy=0;\r\n      if(y < t) {\r\n        dy=y-t;\r\n      } else {\r\n        dy=y-t-(window.innerHeight-osk._Box.offsetHeight-s2.offsetHeight-2);\r\n        if(dy < 0) dy=0;\r\n      }    \r\n      // Hide OSK, then scroll, then re-anchor OSK with absolute position (on end of scroll event)\r\n      if(dy != 0) {\r\n        window.scrollTo(0,dy+window.pageYOffset);\r\n      }\r\n    }\r\n  }\r\n}","/***\r\n   KeymanWeb 11.0\r\n   Copyright 2019 SIL International\r\n***/\r\n\r\ninterface StringConstructor {\r\n  kmwFromCharCode(cp0: number): string,\r\n  _kmwFromCharCode(cp0: number): string,\r\n  kmwEnableSupplementaryPlane(bEnable: boolean)\r\n}\r\n\r\ninterface String {\r\n  kmwCharCodeAt(codePointIndex: number): number,\r\n  kmwCharAt(codePointIndex: number) : string,\r\n  kmwIndexOf(searchValue: string, fromIndex?: number) : number,\r\n  kmwLastIndexOf(searchValue: string, fromIndex?: number) : number,\r\n  kmwSlice(beginSlice: number, endSlice: number) : string,\r\n  kmwSubstring(start: number, length: number) : string,\r\n  kmwSubstr(start: number, length: number) : string,\r\n  kmwBMPSubstr(start: number, length: number) : string,\r\n  kmwLength(): number,\r\n  kmwBMPLength(): number,\r\n  kmwNextChar(codeUnitIndex: number): number,\r\n  kmwBMPNextChar(codeUnitIndex: number): number,\r\n  kmwPrevChar(codeUnitIndex: number): number,\r\n  kmwBMPPrevChar(codeUnitIndex: number): number,\r\n  kmwCodePointToCodeUnit(codePointIndex: number) : number,\r\n  kmwBMPCodePointToCodeUnit(codePointIndex: number) : number,\r\n  kmwCodeUnitToCodePoint(codeUnitIndex: number) : number,\r\n  kmwBMPCodeUnitToCodePoint(codeUnitIndex: number) : number,\r\n  _kmwCharCodeAt(codePointIndex: number): number,\r\n  _kmwCharAt(codePointIndex: number) : string,\r\n  _kmwIndexOf(searchValue: string, fromIndex?: number) : number,\r\n  _kmwLastIndexOf(searchValue: string, fromIndex?: number) : number,\r\n  _kmwSlice(beginSlice: number, endSlice: number) : string,\r\n  _kmwSubstring(start: number, length?: number) : string,\r\n  _kmwSubstr(start: number, length?: number) : string,\r\n  _kmwLength(): number,\r\n  _kmwNextChar(codeUnitIndex: number): number,\r\n  _kmwPrevChar(codeUnitIndex: number): number,\r\n  _kmwCodePointToCodeUnit(codePointIndex: number) : number,\r\n  _kmwCodeUnitToCodePoint(codeUnitIndex: number) : number,\r\n}\r\n\r\n/**\r\n * Constructs a string from one or more Unicode character codepoint values \r\n * passed as integer parameters.\r\n * \r\n * @param  {number} cp0,...   1 or more Unicode codepoints, e.g. 0x0065, 0x10000\r\n * @return {string|null}      The new String object.\r\n */\r\nString.kmwFromCharCode = function(cp0) {\r\n  var chars = [], i;\r\n  for (i = 0; i < arguments.length; i++) {\r\n    var c = Number(arguments[i]);\r\n    if (!isFinite(c) || c < 0 || c > 0x10FFFF || Math.floor(c) !== c) {\r\n      throw new RangeError(\"Invalid code point \" + c);\r\n    }\r\n    if (c < 0x10000) {\r\n      chars.push(c);\r\n    } else {\r\n      c -= 0x10000;\r\n      chars.push((c >> 10) + 0xD800);\r\n      chars.push((c % 0x400) + 0xDC00);\r\n    }\r\n  }\r\n  return String.fromCharCode.apply(undefined, chars);\r\n}\r\n\r\n/**\r\n * Returns a number indicating the Unicode value of the character at the given \r\n * code point index, with support for supplementary plane characters.\r\n * \r\n * @param  {number}  codePointIndex  The code point index into the string (not \r\n                                     the code unit index) to return\r\n * @return {number}                  The Unicode character value\r\n */\r\nString.prototype.kmwCharCodeAt = function(codePointIndex) {\r\n  var str = String(this);\r\n  var codeUnitIndex = 0;\r\n  \r\n  if (codePointIndex < 0 || codePointIndex  >= str.length) {\r\n    return NaN;\r\n  }\r\n\r\n  for(var i = 0; i < codePointIndex; i++) {\r\n    codeUnitIndex = str.kmwNextChar(codeUnitIndex);\r\n    if(codeUnitIndex === null) return NaN;\r\n  }\r\n  \r\n  var first = str.charCodeAt(codeUnitIndex);\r\n  if (first >= 0xD800 && first <= 0xDBFF && str.length > codeUnitIndex + 1) {\r\n    var second = str.charCodeAt(codeUnitIndex + 1);\r\n    if (second >= 0xDC00 && second <= 0xDFFF) {\r\n      return ((first - 0xD800) << 10) + (second - 0xDC00) + 0x10000;\r\n    }\r\n  }\r\n  return first;  \r\n}\r\n\r\n/**\r\n * Returns the code point index within the calling String object of the first occurrence\r\n * of the specified value, or -1 if not found.\r\n * \r\n * @param  {string}  searchValue    The value to search for\r\n * @param  {number}  [fromIndex]    Optional code point index to start searching from\r\n * @return {number}                 The code point index of the specified search value\r\n */\r\nString.prototype.kmwIndexOf = function(searchValue, fromIndex) {\r\n  var str = String(this);\r\n  var codeUnitIndex = str.indexOf(searchValue, fromIndex);\r\n  \r\n  if(codeUnitIndex < 0) {\r\n    return codeUnitIndex;\r\n  }\r\n  \r\n  var codePointIndex = 0;\r\n  for(var i = 0; i !== null && i < codeUnitIndex; i = str.kmwNextChar(i)) codePointIndex++;\r\n  return codePointIndex;\r\n}\r\n\r\n/**\r\n * Returns the code point index within the calling String object of the last occurrence \r\n * of the specified value, or -1 if not found.\r\n * \r\n * @param  {string}  searchValue    The value to search for\r\n * @param  {number}  fromIndex      Optional code point index to start searching from\r\n * @return {number}                 The code point index of the specified search value\r\n */\r\nString.prototype.kmwLastIndexOf = function(searchValue, fromIndex)\r\n{\r\n  var str = String(this);\r\n  var codeUnitIndex = str.lastIndexOf(searchValue, fromIndex);\r\n  \r\n  if(codeUnitIndex < 0) {\r\n    return codeUnitIndex;\r\n  }\r\n  \r\n  var codePointIndex = 0;\r\n  for(var i = 0; i !== null && i < codeUnitIndex; i = str.kmwNextChar(i)) codePointIndex++;\r\n  return codePointIndex;\r\n}\r\n\r\n/**\r\n * Returns the length of the string in code points, as opposed to code units.\r\n * \r\n * @return {number}                 The length of the string in code points\r\n */\r\nString.prototype.kmwLength = function() {\r\n  var str = String(this);\r\n  \r\n  if(str.length == 0) return 0;\r\n  \r\n  for(var i = 0, codeUnitIndex = 0; codeUnitIndex !== null; i++) \r\n    codeUnitIndex = str.kmwNextChar(codeUnitIndex);\r\n  return i;\r\n}\r\n\r\n/**\r\n * Extracts a section of a string and returns a new string.\r\n * \r\n * @param  {number}  beginSlice    The start code point index in the string to \r\n *                                 extract from\r\n * @param  {number}  endSlice      Optional end code point index in the string\r\n *                                 to extract to\r\n * @return {string}                The substring as selected by beginSlice and\r\n *                                 endSlice\r\n */\r\nString.prototype.kmwSlice = function(beginSlice, endSlice) {\r\n  var str = String(this);\r\n  var beginSliceCodeUnit = str.kmwCodePointToCodeUnit(beginSlice);\r\n  var endSliceCodeUnit = str.kmwCodePointToCodeUnit(endSlice);\r\n  if(beginSliceCodeUnit === null || endSliceCodeUnit === null) \r\n    return '';\r\n  else\r\n    return str.slice(beginSliceCodeUnit, endSliceCodeUnit);\r\n}\r\n\r\n/**\r\n * Returns the characters in a string beginning at the specified location through\r\n * the specified number of characters.\r\n * \r\n * @param  {number}  start         The start code point index in the string to \r\n *                                 extract from\r\n * @param  {number}  length        Optional length to extract\r\n * @return {string}                The substring as selected by start and length\r\n */\r\nString.prototype.kmwSubstr = function(start, length)\r\n{\r\n  var str = String(this);\r\n  if(start < 0) \r\n  {\r\n    start = str.kmwLength() + start;\r\n  }\r\n\tif(start < 0) start = 0;\r\n  var startCodeUnit = str.kmwCodePointToCodeUnit(start);\r\n  var endCodeUnit = startCodeUnit;\r\n  \r\n  if(startCodeUnit === null) return '';\r\n  \r\n  if(arguments.length < 2) {\r\n    endCodeUnit = str.length;\r\n  } else {\r\n    for(var i = 0; i < length; i++) endCodeUnit = str.kmwNextChar(endCodeUnit);\r\n  }\r\n  if(endCodeUnit === null)\r\n    return str.substring(startCodeUnit);\r\n  else\r\n    return str.substring(startCodeUnit, endCodeUnit);\r\n}\r\n\r\n/**\r\n * Returns the characters in a string between two indexes into the string.\r\n * \r\n * @param  {number}  indexA        The start code point index in the string to \r\n *                                 extract from\r\n * @param  {number}  indexB        The end code point index in the string to \r\n *                                 extract to\r\n * @return {string}                The substring as selected by indexA and indexB\r\n */\r\nString.prototype.kmwSubstring = function(indexA, indexB)\r\n{\r\n  var str = String(this),indexACodeUnit,indexBCodeUnit;\r\n  \r\n  if(typeof(indexB) == 'undefined') \r\n  {\r\n    indexACodeUnit = str.kmwCodePointToCodeUnit(indexA);\r\n    indexBCodeUnit =  str.length;    \r\n  } \r\n  else\r\n  {\r\n    if(indexA > indexB) { var c = indexA; indexA = indexB; indexB = c; }\r\n  \r\n    indexACodeUnit = str.kmwCodePointToCodeUnit(indexA);\r\n    indexBCodeUnit = str.kmwCodePointToCodeUnit(indexB);\r\n  }\r\n  if(isNaN(indexACodeUnit) || indexACodeUnit === null) indexACodeUnit = 0;\r\n  if(isNaN(indexBCodeUnit) || indexBCodeUnit === null) indexBCodeUnit = str.length;\r\n\r\n  return str.substring(indexACodeUnit, indexBCodeUnit);\r\n}\r\n\r\n/*\r\n  Helper functions\r\n*/\r\n\r\n/**\r\n * Returns the code unit index for the next code point in the string, accounting for\r\n * supplementary pairs \r\n *\r\n * @param  {number|null}  codeUnitIndex  The code unit position to increment\r\n * @return {number|null}                 The index of the next code point in the string,\r\n *                                       in code units\r\n */\r\nString.prototype.kmwNextChar = function(codeUnitIndex) {\r\n  var str = String(this);\r\n\r\n  if(codeUnitIndex === null || codeUnitIndex < 0 || codeUnitIndex >= str.length - 1) {\r\n    return null;\r\n  }\r\n  \r\n  var first = str.charCodeAt(codeUnitIndex);\r\n  if (first >= 0xD800 && first <= 0xDBFF && str.length > codeUnitIndex + 1) {\r\n    var second = str.charCodeAt(codeUnitIndex + 1);\r\n    if (second >= 0xDC00 && second <= 0xDFFF) {\r\n      if(codeUnitIndex == str.length - 2) {\r\n        return null;\r\n      }\r\n      return codeUnitIndex + 2;\r\n    }\r\n  }\r\n  return codeUnitIndex + 1;\r\n}\r\n\r\n/**\r\n * Returns the code unit index for the previous code point in the string, accounting\r\n * for supplementary pairs \r\n *\r\n * @param  {number|null}  codeUnitIndex  The code unit position to decrement\r\n * @return {number|null}                 The index of the previous code point in the\r\n *                                       string, in code units\r\n*/\r\nString.prototype.kmwPrevChar = function(codeUnitIndex) {\r\n  var str = String(this);\r\n\r\n  if(codeUnitIndex == null || codeUnitIndex <= 0 || codeUnitIndex > str.length) {\r\n    return null;\r\n  }\r\n  \r\n  var second = str.charCodeAt(codeUnitIndex - 1);\r\n  if (second >= 0xDC00 && second <= 0xDFFF && codeUnitIndex > 1) {\r\n    var first = str.charCodeAt(codeUnitIndex - 2);\r\n    if(first >= 0xD800 && first <= 0xDBFF) {\r\n      return codeUnitIndex - 2;\r\n    }\r\n  }\r\n  return codeUnitIndex - 1;\r\n}\r\n\r\n/**\r\n * Returns the corresponding code unit index to the code point index passed\r\n *\r\n * @param  {number|null} codePointIndex  A code point index in the string\r\n * @return {number|null}                 The corresponding code unit index\r\n */\r\nString.prototype.kmwCodePointToCodeUnit = function(codePointIndex) {\r\n  \r\n  if(codePointIndex === null) return null;\r\n  \r\n  var str = String(this);\r\n  var codeUnitIndex = 0;\r\n  \r\n  if(codePointIndex < 0) {\r\n    codeUnitIndex = str.length;\r\n    for(var i = 0; i > codePointIndex; i--) \r\n      codeUnitIndex = str.kmwPrevChar(codeUnitIndex);\t\r\n    return codeUnitIndex;\r\n  }\r\n  \r\n  if(codePointIndex == str.kmwLength()) return str.length;\r\n  \r\n  for(var i = 0; i < codePointIndex; i++)\r\n    codeUnitIndex = str.kmwNextChar(codeUnitIndex);\r\n  return codeUnitIndex;\r\n}\r\n\r\n/**\r\n * Returns the corresponding code point index to the code unit index passed\r\n *\r\n * @param  {number|null}  codeUnitIndex  A code unit index in the string\r\n * @return {number|null}                 The corresponding code point index\r\n */\r\nString.prototype.kmwCodeUnitToCodePoint = function(codeUnitIndex) {\r\n  var str = String(this);\r\n  \r\n  if(codeUnitIndex === null)\r\n    return null;\r\n  else if(codeUnitIndex == 0)\r\n    return 0;\r\n  else if(codeUnitIndex < 0)     \r\n    return str.substr(codeUnitIndex).kmwLength();\r\n  else\r\n    return str.substr(0,codeUnitIndex).kmwLength();\r\n}\r\n\r\n/**\r\n * Returns the character at a the code point index passed\r\n *\r\n * @param  {number}  codePointIndex  A code point index in the string\r\n * @return {string}                  The corresponding character\r\n */\r\nString.prototype.kmwCharAt = function(codePointIndex) {\r\n  var str = String(this);\r\n  \r\n  if(codePointIndex >= 0) return str.kmwSubstr(codePointIndex,1); else return '';\r\n}\r\n\r\n/**\r\n * String prototype library extensions for basic plane characters, \r\n * to simplify enabling or disabling supplementary plane functionality (I3319)\r\n */\r\n \r\n/**\r\n * Returns the code unit index for the next code point in the string\r\n *\r\n * @param  {number}  codeUnitIndex    A code point index in the string\r\n * @return {number|null}                   The corresponding character\r\n */ \r\nString.prototype.kmwBMPNextChar = function(codeUnitIndex)\r\n{\r\n  var str = String(this);\r\n  if(codeUnitIndex < 0 || codeUnitIndex >= str.length - 1) {\r\n    return null;\r\n  }\r\n  return codeUnitIndex + 1;\r\n}  \r\n\r\n/**\r\n * Returns the code unit index for the previous code point in the string\r\n *\r\n * @param  {number}  codeUnitIndex    A code unit index in the string\r\n * @return {number|null}                   The corresponding character\r\n */ \r\nString.prototype.kmwBMPPrevChar = function(codeUnitIndex)\r\n{\r\n  var str = String(this);\r\n\r\n  if(codeUnitIndex <= 0 || codeUnitIndex > str.length) {\r\n    return null;\r\n  }\r\n  return codeUnitIndex - 1;\r\n}  \r\n\r\n/**\r\n * Returns the code unit index for a code point index\r\n *\r\n * @param  {number}  codePointIndex   A code point index in the string\r\n * @return {number}                   The corresponding character\r\n */ \r\nString.prototype.kmwBMPCodePointToCodeUnit = function(codePointIndex)\r\n{\r\n  return codePointIndex;\r\n}\r\n\r\n/**\r\n * Returns the code point index for a code unit index\r\n *\r\n * @param  {number}  codeUnitIndex    A code point index in the string\r\n * @return {number}                   The corresponding character\r\n */ \r\nString.prototype.kmwBMPCodeUnitToCodePoint = function(codeUnitIndex)\r\n{\r\n  return codeUnitIndex;\r\n}\r\n\r\n/**\r\n * Returns the length of a BMP string\r\n *\r\n * @return {number}                   The length in code points\r\n */ \r\nString.prototype.kmwBMPLength = function()\r\n{\r\n  var str = String(this);\r\n  return str.length;\r\n}\r\n\r\n\r\n/**\r\n * Returns a substring \r\n *\r\n * @param  {number}  n\r\n * @param  {number}  ln\r\n * @return {string}                   \r\n */ \r\nString.prototype.kmwBMPSubstr = function(n,ln)\r\n{\r\n  var str=String(this);\r\n  if(n > -1) \r\n    return str.substr(n,ln);\r\n  else\r\n    return str.substr(str.length+n,-n);  \r\n}\r\n\r\n/**\r\n * Enable or disable supplementary plane string handling\r\n *\r\n * @param  {boolean}  bEnable\r\n */ \r\nString.kmwEnableSupplementaryPlane = function(bEnable)\r\n{\r\n  var p=String.prototype;\r\n  String._kmwFromCharCode = bEnable ? String.kmwFromCharCode : String.fromCharCode;\r\n  p._kmwCharAt = bEnable ? p.kmwCharAt : p.charAt;\r\n  p._kmwCharCodeAt = bEnable ? p.kmwCharCodeAt : p.charCodeAt;\r\n  p._kmwIndexOf = bEnable ? p.kmwIndexOf :p.indexOf;\r\n  p._kmwLastIndexOf = bEnable ? p.kmwLastIndexOf : p.lastIndexOf ;\r\n  p._kmwSlice = bEnable ? p.kmwSlice : p.slice;\r\n  p._kmwSubstring = bEnable ? p.kmwSubstring : p.substring;\r\n  p._kmwSubstr = bEnable ? p.kmwSubstr : p.kmwBMPSubstr;\r\n  p._kmwLength = bEnable ? p.kmwLength : p.kmwBMPLength;\r\n  p._kmwNextChar = bEnable ? p.kmwNextChar : p.kmwBMPNextChar;\r\n  p._kmwPrevChar = bEnable ? p.kmwPrevChar : p.kmwBMPPrevChar;\r\n  p._kmwCodePointToCodeUnit = bEnable ? p.kmwCodePointToCodeUnit : p.kmwBMPCodePointToCodeUnit;\r\n  p._kmwCodeUnitToCodePoint = bEnable ? p.kmwCodeUnitToCodePoint : p.kmwBMPCodeUnitToCodePoint;\r\n}\r\n\r\n","// Includes KMW-added property declaration extensions for HTML elements.\r\n/// <reference path=\"kmwexthtml.ts\" />\r\n// References the base KMW object.\r\n/// <reference path=\"kmwbase.ts\" />\r\n// References DOM event handling interfaces and classes.\r\n/// <reference path=\"kmwdomevents.ts\" />\r\n// Includes KMW string extension declarations.\r\n/// <reference path=\"kmwstring.ts\" />\r\n\r\nnamespace com.keyman {\r\n  /**\r\n   * This class serves as the intermediary between KeymanWeb and any given web page's elements.\r\n   */\r\n  export class DOMManager {\r\n    private keyman: KeymanBase;\r\n\r\n    /**\r\n     * Implements the AliasElementHandlers interface for touch interaction.\r\n     */\r\n    touchHandlers?: DOMTouchHandlers;\r\n\r\n    /**\r\n     * Implements stubs for the AliasElementHandlers interface for non-touch interaction.\r\n     */\r\n    nonTouchHandlers: DOMEventHandlers;\r\n\r\n    /**\r\n     * Tracks the attachment MutationObserver.\r\n     */\r\n    attachmentObserver: MutationObserver;\r\n\r\n    /**\r\n     * Tracks the enablement MutationObserver.\r\n     */\r\n    enablementObserver: MutationObserver;\r\n\r\n    /**\r\n     * Tracks a list of event-listening elements.  \r\n     * \r\n     * In touch mode, this should contain touch-aliasing DIVs, but will contain other elements in non-touch mode.\r\n     */\r\n    inputList: HTMLElement[] = [];            // List of simulated input divisions for touch-devices   I3363 (Build 301)\r\n\r\n    /**\r\n     * Tracks a visually-sorted list of elements that are KMW-enabled.\r\n     */\r\n    sortedInputs: HTMLElement[] = [];   // List of all INPUT and TEXTAREA elements ordered top to bottom, left to right\r\n\r\n    constructor(keyman: KeymanBase) {\r\n      this.keyman = keyman;\r\n      \r\n      if(keyman.util.device.touchable) {\r\n        this.touchHandlers = new DOMTouchHandlers(keyman);\r\n      }\r\n\r\n      this.nonTouchHandlers = new DOMEventHandlers(keyman);\r\n    }\r\n\r\n    shutdown() {\r\n      if(this.enablementObserver) {\r\n        this.enablementObserver.disconnect();\r\n      }\r\n      if(this.attachmentObserver) {\r\n        this.attachmentObserver.disconnect();\r\n      }\r\n  \r\n      for(let input of this.inputList) {\r\n        this.disableInputElement(input);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function     getHandlers\r\n     * Scope        Private\r\n     * @param       {Element}   Pelem  An input, textarea, or touch-alias element from the page.\r\n     * @returns     {Object}    \r\n     */\r\n    getHandlers(Pelem: HTMLElement): DOMEventHandlers {\r\n      var _attachObj = Pelem.base ? Pelem.base._kmwAttachment : Pelem._kmwAttachment;\r\n\r\n      if(_attachObj) {\r\n        return _attachObj.touchEnabled ? this.touchHandlers : this.nonTouchHandlers;\r\n      } else {\r\n        // Best guess solution.\r\n        return this.keyman.touchAliasing;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function     enableTouchElement\r\n     * Scope        Private\r\n     * @param       {Element}  Pelem   An input or textarea element from the page.\r\n     * @return      {boolean}  Returns true if it creates a simulated input element for Pelem; false if not.\r\n     * Description  Creates a simulated input element for the specified INPUT or TEXTAREA, comprising:\r\n     *              an outer DIV, matching the position, size and style of the base element\r\n     *              a scrollable DIV within that outer element\r\n     *              two SPAN elements within the scrollable DIV, to hold the text before and after the caret\r\n     *    \r\n     *              The left border of the second SPAN is flashed on and off as a visible caret  \r\n     * \r\n     *              Also ensures the element is registered on keymanweb's internal input list.\r\n     */\r\n    enableTouchElement(Pelem: HTMLElement) {\r\n      // Touch doesn't worry about iframes.\r\n      if(Pelem.tagName.toLowerCase() == 'iframe') {\r\n        return false;\r\n      }\r\n\r\n      if(this.isKMWDisabled(Pelem)) {\r\n        this.setupNonKMWTouchElement(Pelem);\r\n        return false;\r\n      } else {\r\n        // Initialize and protect input elements for touch-screen devices (but never for apps)\r\n        // NB: now set disabled=true rather than readonly, since readonly does not always \r\n        // prevent element from getting focus, e.g. within a LABEL element.\r\n        // c.f. http://kreotekdev.wordpress.com/2007/11/08/disabled-vs-readonly-form-fields/ \r\n        Pelem.kmwInput = true;\r\n      }\r\n\r\n      // Remove any handlers for \"NonKMWTouch\" elements, since we're enabling it here.\r\n      Pelem.removeEventListener('touchstart', this.nonKMWTouchHandler);\r\n\r\n      /*\r\n      *  Does this element already have a simulated touch element established?  If so,\r\n      *  just reuse it - if it isn't still in the input list!\r\n      */\r\n      if(Pelem['kmw_ip']) {\r\n\r\n        if(this.inputList.indexOf(Pelem['kmw_ip']) != -1) {\r\n          return false;\r\n        }\r\n\r\n        this.inputList.push(Pelem['kmw_ip']);\r\n        \r\n        console.log(\"Unexpected state - this element's simulated input DIV should have been removed from the page!\");\r\n\r\n        return true;   // May need setup elsewhere since it's just been re-added!\r\n      }\r\n\r\n      // The simulated touch element doesn't already exist?  Time to initialize it.\r\n      var x=document.createElement<'div'>('div'); \r\n      x['base']=x.base=Pelem;\r\n      x._kmwAttachment = Pelem._kmwAttachment; // It's an object reference we need to alias.\r\n      \r\n      // Set font for base element\r\n      this.enableInputElement(x, true);\r\n\r\n      // Add the exposed member 'kmw_ip' to allow page to refer to duplicated element\r\n      Pelem['kmw_ip']=x;\r\n      Pelem.disabled = true;\r\n\r\n      // Superimpose custom input fields for each input or textarea, unless readonly or disabled \r\n\r\n      // Copy essential styles from each base element to the new DIV      \r\n      var d,bs,xs,ds,ss1,ss2,ss3,x1,y1;\r\n\r\n      x.className='keymanweb-input';\r\n      x.dir=x.base.dir;\r\n      \r\n      // Add a scrollable interior div \r\n      d=document.createElement<'div'>('div'); \r\n      bs=window.getComputedStyle(x.base,null);\r\n      xs=x.style;\r\n      xs.overflow='hidden';\r\n      xs.position='absolute';\r\n      //xs.border='1px solid gray';\r\n      xs.border='hidden';      // hide when element empty - KMW-3\r\n      xs.border='none';\r\n      xs.borderRadius='5px';\r\n\r\n      // Add a scroll bar (horizontal for INPUT elements, vertical for TEXTAREA elements)\r\n      var sb=document.createElement<'div'>('div'), sbs=sb.style;\r\n      sbs.position='absolute';\r\n      sbs.height=sbs.width='4px';\r\n      sbs.left=sbs.top='0';\r\n      sbs.display='block';\r\n      sbs.visibility='hidden';          \r\n      sbs.backgroundColor='#808080';\r\n      sbs.borderRadius='2px';\r\n      \r\n      var s1: HTMLSpanElement, s2: HTMLSpanElement, s3: HTMLSpanElement;\r\n\r\n      // And add two spans for the text content before and after the caret, and a caret span\r\n      s1=document.createElement<'span'>('span');\r\n      s2=document.createElement<'span'>('span');\r\n      s3=document.createElement<'span'>('span');      \r\n      s1.innerHTML=s2.innerHTML=s3.innerHTML='';\r\n      s1.className=s2.className=s3.className='keymanweb-font';\r\n      d.appendChild(s1);\r\n      d.appendChild(s3);\r\n      d.appendChild(s2);\r\n      x.appendChild(d);\r\n      x.appendChild(sb);\r\n\r\n      // Adjust input element properties so that it matches the base element as closely as possible\r\n      ds=d.style;\r\n      ds.position='absolute'; \r\n\r\n      ss1=s1.style;ss2=s2.style;ss3=s3.style;ss1.border=ss2.border='none';\r\n      //ss1.backgroundColor='rgb(220,220,255)';ss2.backgroundColor='rgb(220,255,220)'; //only for testing \r\n      ss1.height=ss2.height='100%';          \r\n      ss1.fontFamily=ss2.fontFamily=ds.fontFamily=bs.fontFamily;\r\n\r\n      // Set vertical centering for input elements\r\n      if(x.base.nodeName.toLowerCase() == 'input') {\r\n        if(!isNaN(parseInt(bs.height,10))) {\r\n          ss1.lineHeight=ss2.lineHeight=bs.height;      \r\n        }\r\n      }\r\n      \r\n      // The invisible caret-positioning span must have a border to ensure that \r\n      // it remains in the layout, but colour doesn't matter, as it is never visible.\r\n      // Span margins are adjusted to compensate for the border and maintain text positioning.  \r\n      ss3.border='1px solid red';  \r\n      ss3.visibility='hidden';       \r\n      ss3.marginLeft=ss3.marginRight='-1px';\r\n      \r\n      // Set the outer element padding *after* appending the element, \r\n      // otherwise Firefox misaligns the two elements\r\n      xs.padding='8px';\r\n      \r\n      // Set internal padding to match the TEXTAREA and INPUT elements\r\n      ds.padding='0px 2px'; // OK for iPad, possibly device-dependent\r\n\r\n      if(this.keyman.util.device.OS == 'Android' && bs.backgroundColor == 'transparent') {\r\n        ds.backgroundColor='#fff';\r\n      } else {\r\n        ds.backgroundColor=bs.backgroundColor;\r\n      }\r\n      \r\n      // Set the tabindex to 0 to allow a DIV to accept focus and keyboard input \r\n      // c.f. http://www.w3.org/WAI/GL/WCAG20/WD-WCAG20-TECHS/SCR29.html\r\n      x.tabIndex=0; \r\n\r\n      // Disable (internal) pan and zoom on KMW input elements for IE10\r\n      x.style.msTouchAction='none';\r\n\r\n      // On touch event, reposition the text caret and prepare for OSK input\r\n      // Removed 'onfocus=' as that resulted in handling the event twice (on iOS, anyway) \r\n\r\n      // We know this to be the correct set of handlers because we're setting up a touch element.\r\n      var touchHandlers = this.touchHandlers;\r\n      \r\n      x.addEventListener('touchstart', touchHandlers.setFocus);\r\n      x.onmspointerdown=function(e: MSPointerEvent) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        return touchHandlers.setFocus(e);\r\n      };\r\n\r\n      x.addEventListener('touchend', function(e) {\r\n        e.stopPropagation();\r\n      });\r\n\r\n      x.onmspointerup=function(e) {\r\n        e.stopPropagation();\r\n      };\r\n      \r\n      // Disable internal scroll when input element in focus \r\n      x.addEventListener('touchmove', touchHandlers.dragInput, false);\r\n      x.onmspointermove=touchHandlers.dragInput;\r\n      \r\n      // Hide keyboard and caret when losing focus from simulated input field\r\n      x.onblur=touchHandlers.setBlur;\r\n      \r\n      // Note that touchend event propagates and is processed by body touchend handler\r\n      // re-setting the first touch point for a drag\r\n\r\n      if(x.base.nodeName.toLowerCase() == 'textarea') {\r\n        s1.style.whiteSpace=s2.style.whiteSpace='pre-wrap'; //scroll vertically\r\n      } else {\r\n        s1.style.whiteSpace=s2.style.whiteSpace='pre';      //scroll horizontally\r\n      }\r\n      \r\n      x.base.parentNode.appendChild(x);\r\n    \r\n      // Refresh style pointers, and match the field sizes\r\n      touchHandlers.updateInput(x);\r\n      xs=x.style; \r\n      xs.color=bs.color; //xs.backgroundColor=bs.backgroundColor; \r\n      xs.fontFamily=bs.fontFamily; xs.fontSize=bs.fontSize;\r\n      xs.fontWeight=bs.fontWeight; xs.textDecoration=bs.textDecoration;\r\n      xs.padding=bs.padding; xs.margin=bs.margin; \r\n      xs.border=bs.border; xs.borderRadius=bs.borderRadius;\r\n    \r\n      //xs.color='red';  //use only for checking alignment\r\n\r\n      // Prevent highlighting of underlying element (Android)\r\n      if('webkitTapHighlightColor' in xs) {\r\n        xs.webkitTapHighlightColor='rgba(0,0,0,0)';\r\n      }\r\n\r\n      if(x.base instanceof x.base.ownerDocument.defaultView.HTMLTextAreaElement) {\r\n        // Correct rows value if defaulted and box height set by CSS\r\n        // The rows value is used when setting the caret vertically\r\n\r\n        if(x.base.rows == 2) { // 2 is default value\r\n          var h=parseInt(bs.height,10)-parseInt(bs.paddingTop,10)-parseInt(bs.paddingBottom,10),\r\n            dh=parseInt(bs.fontSize,10),calcRows=Math.round(h/dh);\r\n          if(calcRows > x.base.rows+1) {\r\n            x.base.rows=calcRows;\r\n          }\r\n        }\r\n        ds.width=xs.width; ds.minHeight=xs.height;\r\n      } else {\r\n        ds.minWidth=xs.width; ds.height=xs.height;\r\n      }\r\n      x.base.style.visibility='hidden'; // hide by default: KMW-3\r\n      \r\n      // Add an explicit event listener to allow the duplicated input element \r\n      // to be adjusted for any changes in base element location or size\r\n      // This will be called for each element after any rotation, as well as after user-initiated changes\r\n      // It has to be wrapped in an anonymous function to preserve scope and be applied to each element.\r\n      (function(xx){\r\n        xx._kmwResizeHandler = function(e){\r\n          /* A timeout is needed to let the base element complete its resizing before our \r\n          * simulated element can properly resize itself.\r\n          * \r\n          * Not doing this causes errors if the input elements are resized for whatever reason, such as\r\n          * changing languages to a text with greater height.\r\n          */\r\n          window.setTimeout(function (){\r\n            touchHandlers.updateInput(xx);\r\n          }, 1);\r\n        };\r\n\r\n        xx.base.addEventListener('resize', xx._kmwResizeHandler, false);\r\n        xx.base.addEventListener('orientationchange', xx._kmwResizeHandler, false);\r\n      })(x);\r\n\r\n      var textValue: string;\r\n\r\n      if(x.base instanceof x.base.ownerDocument.defaultView.HTMLTextAreaElement \r\n          || x.base instanceof x.base.ownerDocument.defaultView.HTMLInputElement) {\r\n        textValue = x.base.value;\r\n      } else {\r\n        textValue = x.base.textContent;\r\n      }\r\n        \r\n      // And copy the text content\r\n      touchHandlers.setText(x, textValue, null);  \r\n\r\n      return true;\r\n    }\r\n\r\n    /**\r\n     * Function     disableTouchElement\r\n     * Scope        Private\r\n     * @param       {Element}  Pelem   An input or textarea element from the page.\r\n     * Description  Destroys the simulated input element for the specified INPUT or TEXTAREA and reverts\r\n     *              back to desktop-style 'enablement' for the base control.\r\n     */\r\n    disableTouchElement(Pelem: HTMLElement) {\r\n      // Do not check for the element being officially disabled - it's also used for detachment.\r\n\r\n      // Touch doesn't worry about iframes.\r\n      if(Pelem.tagName.toLowerCase() == 'iframe') {\r\n        return; // If/when we do support this, we'll need an iframe-level manager for it.\r\n      }\r\n\r\n      if(Pelem['kmw_ip']) {\r\n        var index = this.inputList.indexOf(Pelem['kmw_ip']);\r\n        if(index != -1) {\r\n          this.inputList.splice(index, 1);\r\n        }\r\n\r\n        Pelem.style.visibility='visible'; // hide by default: KMW-3\r\n        Pelem.disabled = false;\r\n        Pelem.removeEventListener('resize', Pelem['kmw_ip']._kmwResizeHandler);\r\n\r\n        // Disable touch-related handling code.\r\n        this.disableInputElement(Pelem['kmw_ip']);\r\n        \r\n        // We get weird repositioning errors if we don't remove our simulated input element - and permanently.\r\n        if(Pelem.parentNode) {\r\n          Pelem.parentNode.removeChild(Pelem['kmw_ip']);\r\n        }\r\n        delete Pelem['kmw_ip'];\r\n      }\r\n\r\n      this.setupNonKMWTouchElement(Pelem);\r\n    }\r\n\r\n    /** \r\n     * Function     nonKMWTouchHandler\r\n     * Scope        Private\r\n     * Description  A handler for KMW-touch-disabled elements when operating on touch devices.\r\n     */\r\n    nonKMWTouchHandler = function(x) {\r\n      DOMEventHandlers.states.focusing=false;\r\n      clearTimeout(DOMEventHandlers.states.focusTimer);\r\n      this.keyman.osk.hideNow();\r\n    }.bind(this);\r\n\r\n    /**\r\n     * Function     setupNonKMWTouchElement\r\n     * Scope        Private\r\n     * @param       {Element}    x  A child element of document.\r\n     * Description  Performs handling for the specified disabled input element on touch-based systems.\r\n     */\r\n    setupNonKMWTouchElement(x: HTMLElement) {\r\n      this.keyman.util.attachDOMEvent(x, 'touchstart', this.nonKMWTouchHandler, false);\r\n\r\n      // Signify that touch isn't enabled on the control.\r\n      if(this.isAttached(x)) {\r\n        x._kmwAttachment.touchEnabled = false;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function     enableInputElement\r\n     * Scope        Private\r\n     * @param       {Element}   Pelem   An element from the document to be enabled with full KMW handling.\r\n     * @param       {boolean=}   isAlias A flag that indicates if the element is a simulated input element for touch.\r\n     * Description  Performs the basic enabling setup for one element and adds it to the inputList if it is an input element.\r\n     *              Note that this method is called for both desktop and touch control routes; the touch route calls it from within\r\n     *              enableTouchElement as it must first establish the simulated touch element to serve as the alias \"input element\" here.\r\n     *              Note that the 'kmw-disabled' property is managed by the MutationObserver and by the surface API calls.\r\n     */       \r\n    enableInputElement(Pelem: HTMLElement, isAlias?: boolean) { \r\n      var baseElement = isAlias ? Pelem['base'] : Pelem;\r\n      if(!this.isKMWDisabled(baseElement)) {\r\n        if(Pelem instanceof Pelem.ownerDocument.defaultView.HTMLIFrameElement) {\r\n          this._AttachToIframe(Pelem);\r\n        } else { \r\n          baseElement.className = baseElement.className ? baseElement.className + ' keymanweb-font' : 'keymanweb-font';\r\n          this.inputList.push(Pelem);\r\n\r\n          this.keyman.util.attachDOMEvent(baseElement,'focus', this.getHandlers(Pelem)._ControlFocus);\r\n          this.keyman.util.attachDOMEvent(baseElement,'blur', this.getHandlers(Pelem)._ControlBlur);\r\n\r\n          // These need to be on the actual input element, as otherwise the keyboard will disappear on touch.\r\n          Pelem.onkeypress = this.getHandlers(Pelem)._KeyPress;\r\n          Pelem.onkeydown = this.getHandlers(Pelem)._KeyDown;\r\n          Pelem.onkeyup = this.getHandlers(Pelem)._KeyUp;      \r\n        }\r\n      } \r\n    }; \r\n\r\n    /**\r\n     * Function     disableInputElement\r\n     * Scope        Private\r\n     * @param       {Element}   Pelem   An element from the document to be enabled with full KMW handling.\r\n     * @param       {boolean=}   isAlias A flag that indicates if the element is a simulated input element for touch.\r\n     * Description  Inverts the process of enableInputElement, removing all event-handling from the element.\r\n     *              Note that the 'kmw-disabled' property is managed by the MutationObserver and by the surface API calls.\r\n     */       \r\n    disableInputElement(Pelem: HTMLElement, isAlias?: boolean) { \r\n      var baseElement = isAlias ? Pelem['base'] : Pelem;\r\n      // Do NOT test for pre-disabledness - we also use this to fully detach without officially 'disabling' via kmw-disabled.\r\n      if(Pelem instanceof Pelem.ownerDocument.defaultView.HTMLIFrameElement) {\r\n        this._DetachFromIframe(Pelem);\r\n      } else { \r\n        var cnIndex = baseElement.className.indexOf('keymanweb-font');\r\n        if(cnIndex > 0 && !isAlias) { // See note about the alias below.\r\n          baseElement.className = baseElement.className.replace('keymanweb-font', '').trim();\r\n        }\r\n\r\n        // Remove the element from our internal input tracking.\r\n        var index = this.inputList.indexOf(Pelem);\r\n        if(index > -1) {\r\n          this.inputList.splice(index, 1);\r\n        }\r\n\r\n        if(!isAlias) { // See note about the alias below.\r\n          this.keyman.util.detachDOMEvent(baseElement,'focus', this.getHandlers(Pelem)._ControlFocus);\r\n          this.keyman.util.detachDOMEvent(baseElement,'blur', this.getHandlers(Pelem)._ControlBlur);\r\n        }\r\n        // These need to be on the actual input element, as otherwise the keyboard will disappear on touch.\r\n        Pelem.onkeypress = null;\r\n        Pelem.onkeydown = null;\r\n        Pelem.onkeyup = null;      \r\n      }\r\n\r\n      // If we're disabling an alias, we should fully enable the base version.  (Thinking ahead to toggleable-touch mode.)\r\n      if(isAlias) {\r\n        this.inputList.push(baseElement);\r\n\r\n        baseElement.onkeypress = this.getHandlers(Pelem)._KeyPress;\r\n        baseElement.onkeydown = this.getHandlers(Pelem)._KeyDown;\r\n        baseElement.onkeyup = this.getHandlers(Pelem)._KeyUp;  \r\n      }\r\n\r\n      var lastElem = this.getLastActiveElement();\r\n      if(lastElem == Pelem || lastElem == Pelem['kmw_ip']) {\r\n        this.clearLastActiveElement();\r\n        this.keyman.keyboardManager.setActiveKeyboard(this.keyman.globalKeyboard, this.keyman.globalLanguageCode);\r\n        this.keyman.osk._Hide();\r\n      }\r\n      \r\n      return;\r\n    };\r\n\r\n        /**\r\n     * Function     isKMWDisabled\r\n     * Scope        Private\r\n     * @param       {Element}   x   An element from the page.\r\n     * @return      {boolean}      true if the element's properties indicate a 'disabled' state.\r\n     * Description  Examines attachable elements to determine their default enablement state.\r\n     */ \r\n    isKMWDisabled(x: HTMLElement): boolean {\r\n      var c = x.className;\r\n\r\n      // Exists for some HTMLElements.\r\n      if(x['readOnly']) {\r\n        return true;\r\n      } else if(c && c.indexOf('kmw-disabled') >= 0) {\r\n        return true;\r\n      }\r\n\r\n      return false;     \r\n    }\r\n\r\n    /**\r\n     * Function     attachToControl\r\n     * Scope        Public\r\n     * @param       {Element}    Pelem       Element to which KMW will be attached\r\n     * Description  Attaches KMW to control (or IFrame) \r\n     */  \r\n    attachToControl(Pelem: HTMLElement) {\r\n      var touchable = this.keyman.util.device.touchable;\r\n\r\n      // Exception for IFrame elements, in case of async loading issues.  (Fixes fun iframe loading bug with Chrome.)\r\n      if(this.isAttached(Pelem) && !(Pelem instanceof Pelem.ownerDocument.defaultView.HTMLIFrameElement)) {\r\n        return; // We're already attached.\r\n      }\r\n\r\n      if(this.isKMWInput(Pelem)) {\r\n        this.setupElementAttachment(Pelem);\r\n        if(!this.isKMWDisabled(Pelem)) {\r\n          if(touchable) {\r\n            this.enableTouchElement(Pelem);\r\n          } else {\r\n            this.enableInputElement(Pelem);\r\n          }\r\n        } else {\r\n          if(touchable) {\r\n            this.setupNonKMWTouchElement(Pelem);\r\n          }\r\n        }\r\n      } else if(touchable) {\r\n        this.setupNonKMWTouchElement(Pelem);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function     detachFromControl\r\n     * Scope        Public\r\n     * @param       {Element}    Pelem       Element from which KMW will detach\r\n     * Description  Detaches KMW from a control (or IFrame) \r\n     */  \r\n    detachFromControl(Pelem: HTMLElement) {\r\n      if(!this.isAttached(Pelem)) {\r\n        return;  // We never were attached.\r\n      }\r\n\r\n      // #1 - if element is enabled, disable it.  But don't manipulate the 'kmw-disabled' tag.\r\n      if(this.isKMWInput(Pelem)) {\r\n        // Is it already disabled?\r\n        if(!this.isKMWDisabled(Pelem)) {\r\n          this._DisableControl(Pelem);\r\n        } \r\n      }\r\n\r\n      // #2 - clear attachment data.      \r\n      this.clearElementAttachment(Pelem);\r\n    }\r\n\r\n    /**\r\n     * Function     isAttached\r\n     * Scope        Private\r\n     * @param       {Element}   x   An element from the page.\r\n     * @return      {boolean}       true if KMW is attached to the element, otherwise false.\r\n     */\r\n    isAttached(x: HTMLElement) {\r\n      return x._kmwAttachment ? true : false;\r\n    }\r\n\r\n    /**\r\n     * Function     isKMWInput\r\n     * Scope        Private\r\n     * @param       {Element}   x   An element from the page.\r\n     * @return      {boolean}      true if the element is viable for KMW attachment.\r\n     * Description  Examines potential input elements to determine whether or not they are viable for KMW attachment.\r\n     *              Also filters elements not supported for touch devices when device.touchable == true.\r\n     */ \r\n    isKMWInput(x: HTMLElement): boolean {\r\n      var touchable = this.keyman.util.device.touchable;\r\n\r\n      if(x instanceof x.ownerDocument.defaultView.HTMLTextAreaElement) {\r\n        return true;\r\n      } else if(x instanceof x.ownerDocument.defaultView.HTMLInputElement) {\r\n        if (x.type == 'text' || x.type == 'search') {\r\n          return true;\r\n        }\r\n      } else if(x instanceof x.ownerDocument.defaultView.HTMLIFrameElement && !touchable) { // Do not allow iframe attachment if in 'touch' mode.\r\n        try {\r\n          if(x.contentWindow.document) {  // Only allow attachment if the iframe's internal document is valid.\r\n            return true;\r\n          }\r\n        }\r\n        catch(err) { /* Do not attempt to access iframes outside this site */ }\r\n      } else if(x.isContentEditable && !touchable) { // Only allow contentEditable attachment outside of 'touch' mode.\r\n        return true;\r\n      }\r\n\r\n      return false;     \r\n    }\r\n\r\n    /**\r\n     * Function     setupElementAttachment\r\n     * Scope        Private\r\n     * @param       {Element}   x   An element from the page valid for KMW attachment\r\n     * Description  Establishes the base KeymanWeb data for newly-attached elements.\r\n     *              Does not establish input hooks, which are instead handled during enablement.  \r\n     */\r\n    setupElementAttachment(x: HTMLElement) {\r\n      // The `_kmwAttachment` property tag maintains all relevant KMW-maintained data regarding the element.\r\n      // It is disgarded upon de-attachment.\r\n      if(x._kmwAttachment) {\r\n        return;\r\n      } else {\r\n        x._kmwAttachment = new AttachmentInfo(null, this.keyman.util.device.touchable);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function     clearElementAttachment\r\n     * Scope        Private\r\n     * @param       {Element}   x   An element from the page valid for KMW attachment\r\n     * Description  Establishes the base KeymanWeb data for newly-attached elements.\r\n     *              Does not establish input hooks, which are instead handled during enablement.  \r\n     */\r\n    clearElementAttachment(x: HTMLElement) {\r\n      // We need to clear the object when de-attaching; helps prevent memory leaks.\r\n      x._kmwAttachment = null;\r\n    }\r\n\r\n    /**\r\n     * Function     _AttachToIframe\r\n     * Scope        Private\r\n     * @param       {Element}      Pelem       IFrame to which KMW will be attached\r\n     * Description  Attaches KeymanWeb to IFrame \r\n     */  \r\n    _AttachToIframe(Pelem: HTMLIFrameElement) {\r\n      var util = this.keyman.util;\r\n      \r\n      try {\r\n        var Lelem=Pelem.contentWindow.document;\r\n        /* editable Iframe */\r\n        if(Lelem) {\r\n          if(Lelem.designMode.toLowerCase() == 'on') {\r\n            // I2404 - Attach to IFRAMEs child objects, only editable IFRAMEs here\r\n            util.attachDOMEvent(Lelem,'focus', this.getHandlers(Pelem)._ControlFocus);\r\n            util.attachDOMEvent(Lelem,'blur', this.getHandlers(Pelem)._ControlBlur);\r\n            util.attachDOMEvent(Lelem,'keydown', this.getHandlers(Pelem)._KeyDown);\r\n            util.attachDOMEvent(Lelem,'keypress', this.getHandlers(Pelem)._KeyPress);\r\n            util.attachDOMEvent(Lelem,'keyup', this.getHandlers(Pelem)._KeyUp);\r\n          } else {\r\n            // Lelem is the IFrame's internal document; set 'er up!\r\n            this._SetupDocument(Lelem);\t   // I2404 - Manage IE events in IFRAMEs\r\n          }\r\n        }\r\n      }\r\n      catch(err)\r\n      {\r\n        // do not attempt to attach to the iframe as it is from another domain - XSS denied!\r\n      }  \r\n    }\r\n\r\n        /**\r\n     * Function     _DetachFromIframe\r\n     * Scope        Private\r\n     * @param       {Element}      Pelem       IFrame to which KMW will be attached\r\n     * Description  Detaches KeymanWeb from an IFrame \r\n     */  \r\n    _DetachFromIframe(Pelem: HTMLIFrameElement) {\r\n      var util = this.keyman.util;\r\n\r\n      try {\r\n        var Lelem=Pelem.contentWindow.document;\r\n        /* editable Iframe */\r\n        if(Lelem) {\r\n          if(Lelem.designMode.toLowerCase() == 'on') {\r\n            // Mozilla      // I2404 - Attach to  IFRAMEs child objects, only editable IFRAMEs here\r\n            util.detachDOMEvent(Lelem,'focus', this.getHandlers(Pelem)._ControlFocus);\r\n            util.detachDOMEvent(Lelem,'blur', this.getHandlers(Pelem)._ControlBlur);\r\n            util.detachDOMEvent(Lelem,'keydown', this.getHandlers(Pelem)._KeyDown);\r\n            util.detachDOMEvent(Lelem,'keypress', this.getHandlers(Pelem)._KeyPress);\r\n            util.detachDOMEvent(Lelem,'keyup', this.getHandlers(Pelem)._KeyUp);\r\n          } else {\r\n            // Lelem is the IFrame's internal document; set 'er up!\r\n            this._ClearDocument(Lelem);\t   // I2404 - Manage IE events in IFRAMEs\r\n          }\r\n        }\r\n      }\r\n      catch(err)\r\n      {\r\n        // do not attempt to attach to the iframe as it is from another domain - XSS denied!\r\n      }  \r\n    }\r\n\r\n    /**\r\n     * Function     _GetDocumentEditables\r\n     * Scope        Private\r\n     * @param       {Element}     Pelem     HTML element\r\n     * @return      {Array<Element>}        A list of potentially-editable controls.  Further filtering [as with isKMWInput() and\r\n     *                                      isKMWDisabled()] is required.\r\n     */\r\n    _GetDocumentEditables(Pelem: HTMLElement|Document): (HTMLElement|Document)[] {\r\n      var util = this.keyman.util;\r\n\r\n      var possibleInputs: (HTMLElement|Document)[] = [];\r\n\r\n      // Document.ownerDocument === null, so we better check that it's not null before proceeding.\r\n      if(Pelem.ownerDocument && Pelem instanceof Pelem.ownerDocument.defaultView.HTMLElement) {\r\n        var dv = Pelem.ownerDocument.defaultView;\r\n\r\n        if(Pelem instanceof dv.HTMLInputElement || Pelem instanceof dv.HTMLTextAreaElement) {\r\n          possibleInputs.push(Pelem);\r\n        } else if(Pelem instanceof dv.HTMLIFrameElement) {\r\n          possibleInputs.push(Pelem);\r\n        }\r\n      }\r\n\r\n      // Constructing it like this also allows for individual element filtering for the auto-attach MutationObserver without errors.\r\n      if(Pelem.getElementsByTagName) {\r\n        /**\r\n         * Function     LiTmp\r\n         * Scope        Private\r\n         * @param       {string}    _colon    type of element\r\n         * @return      {Array<Element>}  array of elements of specified type                       \r\n         * Description  Local function to get list of editable controls\r\n         */    \r\n        var LiTmp = function(_colon: string): HTMLElement[] {\r\n          return util.arrayFromNodeList(Pelem.getElementsByTagName(_colon));\r\n        };\r\n\r\n        // Note that isKMWInput() will block IFRAME elements as necessary for touch-based devices.\r\n        possibleInputs = possibleInputs.concat(LiTmp('INPUT'), LiTmp('TEXTAREA'), LiTmp('IFRAME'));\r\n      }\r\n      \r\n      // Not all active browsers may support the method, but only those that do would work with contenteditables anyway.\r\n      if(Pelem.querySelectorAll) {\r\n        possibleInputs = possibleInputs.concat(util.arrayFromNodeList(Pelem.querySelectorAll('[contenteditable]')));\r\n      }\r\n      \r\n      if(Pelem.ownerDocument && Pelem instanceof Pelem.ownerDocument.defaultView.HTMLElement && Pelem.isContentEditable) {\r\n        possibleInputs.push(Pelem);\r\n      }\r\n\r\n      return possibleInputs;\r\n    }\r\n\r\n    /**\r\n     * Function     _SetupDocument\r\n     * Scope        Private\r\n     * @param       {Element}     Pelem - the root element of a document, including IFrame documents.\r\n     * Description  Used to automatically attach KMW to editable controls, regardless of control path.\r\n     */\r\n    _SetupDocument(Pelem: HTMLElement|Document) { // I1961\r\n      var possibleInputs = this._GetDocumentEditables(Pelem);\r\n\r\n      for(var Li = 0; Li < possibleInputs.length; Li++) {\r\n        var input = possibleInputs[Li];\r\n\r\n        // It knows how to handle pre-loaded iframes appropriately.\r\n        this.attachToControl(possibleInputs[Li] as HTMLElement);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function     _ClearDocument\r\n     * Scope        Private\r\n     * @param       {Element}     Pelem - the root element of a document, including IFrame documents.\r\n     * Description  Used to automatically detach KMW from editable controls, regardless of control path.\r\n     *              Mostly used to clear out all controls of a detached IFrame.\r\n     */\r\n    _ClearDocument(Pelem: HTMLElement|Document) { // I1961\r\n      var possibleInputs = this._GetDocumentEditables(Pelem);\r\n\r\n      for(var Li = 0; Li < possibleInputs.length; Li++) {\r\n        var input = possibleInputs[Li];\r\n\r\n        // It knows how to handle pre-loaded iframes appropriately.\r\n        this.detachFromControl(possibleInputs[Li] as HTMLElement);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Set target element text direction (LTR or RTL), but only if the element is empty\r\n     *    \r\n     * If the element base directionality is changed after it contains content, unless all the text\r\n     * has the same directionality, text runs will be re-ordered which is confusing and causes\r\n     * incorrect caret positioning\r\n     *    \r\n     * @param       {Object}      Ptarg      Target element\r\n     */    \r\n    _SetTargDir(Ptarg: HTMLElement) {  \r\n      var elDir=(this.keyman.keyboardManager.isRTL()) ? 'rtl' : 'ltr';\r\n\r\n      if(Ptarg) {\r\n        if(this.keyman.util.device.touchable) {\r\n          if(Ptarg.textContent.length == 0) {\r\n            Ptarg.base.dir=Ptarg.dir=elDir;\r\n            this.getHandlers(Ptarg).setTextCaret(Ptarg,10000);\r\n          }\r\n        } else {\r\n          if(Ptarg instanceof Ptarg.ownerDocument.defaultView.HTMLInputElement \r\n              || Ptarg instanceof Ptarg.ownerDocument.defaultView.HTMLTextAreaElement) {\r\n            if((Ptarg as HTMLInputElement|HTMLTextAreaElement).value.length == 0) {\r\n              Ptarg.dir=elDir;\r\n            }\r\n          } else if(typeof Ptarg.textContent == \"string\" && Ptarg.textContent.length == 0) { // As with contenteditable DIVs, for example.\r\n            Ptarg.dir=elDir;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function     _DisableControl\r\n     * Scope        Private\r\n     * @param       {Element}      Pelem       Element to be disabled\r\n     * Description  Disable KMW control element \r\n     */    \r\n    _DisableControl(Pelem: HTMLElement) {\r\n      if(this.isAttached(Pelem)) { // Only operate on attached elements!        \r\n        if(this.keyman.util.device.touchable) {\r\n          this.disableTouchElement(Pelem);\r\n          this.setupNonKMWTouchElement(Pelem);\r\n\r\n          var keyman = this.keyman;\r\n        \r\n          // If a touch alias was removed, chances are it's gonna mess up our touch-based layout scheme, so let's update the touch elements.\r\n          window.setTimeout(function() {\r\n            this.listInputs();\r\n\r\n            for(var k = 0; k < this.sortedInputs.length; k++) {\r\n              if(this.sortedInputs[k]['kmw_ip']) {\r\n                this.getHandlers(Pelem).updateInput(this.sortedInputs[k]['kmw_ip']);\r\n              }\r\n            }\r\n          }.bind(this), 1);\r\n        } else {\r\n          this.listInputs(); // Fix up our internal input ordering scheme.\r\n        }\r\n        \r\n        this.disableInputElement(Pelem);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function     _EnableControl\r\n     * Scope        Private\r\n     * @param       {Element}    Pelem   Element to be enabled\r\n     * Description  Enable KMW control element \r\n     */    \r\n    _EnableControl(Pelem: HTMLElement) {\r\n      if(this.isAttached(Pelem)) { // Only operate on attached elements!\r\n        if(this.keyman.util.device.touchable) {\r\n          this.enableTouchElement(Pelem);\r\n\r\n          var keyman = this.keyman;\r\n\r\n          // If we just added a new input alias, some languages will mess up our touch-based layout scheme\r\n          // if we don't update the touch elements.\r\n          window.setTimeout(function() {\r\n            keyman.domManager.listInputs();\r\n\r\n            for(var k = 0; k < this.sortedInputs.length; k++) {\r\n              if(this.sortedInputs[k]['kmw_ip']) {\r\n                this.getHandlers(Pelem).updateInput(this.sortedInputs[k]['kmw_ip']);\r\n              }\r\n            }\r\n          }.bind(this), 1);\r\n        } else {\r\n          this.enableInputElement(Pelem);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Create an ordered list of all text and search input elements and textarea elements\r\n    // except any tagged with class 'kmw-disabled'\r\n    // TODO: email and url types should perhaps use default keyboard only\r\n    listInputs() {\r\n      var i,eList=[],\r\n        t1=document.getElementsByTagName<'input'>('input'),\r\n        t2=document.getElementsByTagName<'textarea'>('textarea');\r\n\r\n      var util = this.keyman.util;\r\n\r\n      for(i=0; i<t1.length; i++) {\r\n        switch(t1[i].type) {\r\n          case 'text':\r\n          case 'search':\r\n          case 'email':\r\n          case 'url':\r\n            if(t1[i].className.indexOf('kmw-disabled') < 0) {\r\n              eList.push({ip:t1[i],x:util._GetAbsoluteX(t1[i]),y:util._GetAbsoluteY(t1[i])});\r\n            }\r\n            break;    \r\n        }\r\n      }\r\n\r\n      for(i=0; i<t2.length; i++) { \r\n        if(t2[i].className.indexOf('kmw-disabled') < 0)\r\n          eList.push({ip:t2[i],x:util._GetAbsoluteX(t2[i]),y:util._GetAbsoluteY(t2[i])});\r\n      }\r\n      \r\n      /**\r\n       * Local function to sort by screen position\r\n       * \r\n       * @param       {Object}     e1     first object\r\n       * @param       {Object}     e2     second object\r\n       * @return      {number}            y-difference between object positions, or x-difference if y values the same\r\n       */       \r\n      var xySort=function(e1,e2)\r\n      {\r\n        if(e1.y != e2.y) return e1.y-e2.y;\r\n        return e1.x-e2.x;    \r\n      }\r\n      \r\n      // Sort elements by Y then X\r\n      eList.sort(xySort);\r\n      \r\n      // Create a new list of sorted elements\r\n      var tList=[];\r\n      for(i=0;i<eList.length;i++)\r\n        tList.push(eList[i].ip);\r\n    \r\n      // Return the sorted element list\r\n      this.sortedInputs=tList;\r\n    }\r\n\r\n    _EnablementMutationObserverCore = function(mutations: MutationRecord[]) {\r\n      for(var i=0; i < mutations.length; i++) {\r\n        var mutation = mutations[i];\r\n\r\n        // ( ? : ) needed as a null check.\r\n        var disabledBefore = mutation.oldValue ? mutation.oldValue.indexOf('kmw-disabled') >= 0 : false;\r\n        var disabledAfter = (mutation.target as HTMLElement).className.indexOf('kmw-disabled') >= 0;\r\n        \r\n        if(disabledBefore && !disabledAfter) {\r\n          this._EnableControl(mutation.target);\r\n        } else if(!disabledBefore && disabledAfter) {\r\n          this._DisableControl(mutation.target);\r\n        }\r\n\r\n        // 'readonly' triggers on whether or not the attribute exists, not its value.\r\n        if(!disabledAfter && mutation.attributeName == \"readonly\") {\r\n          var readonlyBefore = mutation.oldValue ? mutation.oldValue != null : false;\r\n          var elem = mutation.target;\r\n\r\n          if(elem instanceof elem.ownerDocument.defaultView.HTMLInputElement\r\n              || elem instanceof elem.ownerDocument.defaultView.HTMLTextAreaElement) {\r\n            var readonlyAfter = elem.readOnly;\r\n\r\n            if(readonlyBefore && !readonlyAfter) {\r\n              this._EnableControl(mutation.target);\r\n            } else if(!readonlyBefore && readonlyAfter) {\r\n              this._DisableControl(mutation.target);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }.bind(this);\r\n\r\n    _AutoAttachObserverCore = function(mutations: MutationRecord[]) {\r\n      var inputElementAdditions = [];\r\n      var inputElementRemovals = [];\r\n\r\n      for(var i=0; i < mutations.length; i++) {\r\n        var mutation = mutations[i];\r\n        \r\n        for(var j=0; j < mutation.addedNodes.length; j++) {\r\n          inputElementAdditions = inputElementAdditions.concat(this._GetDocumentEditables(mutation.addedNodes[j]));\r\n        }          \r\n\r\n        for(j = 0; j < mutation.removedNodes.length; j++) {\r\n          inputElementRemovals = inputElementRemovals.concat(this._GetDocumentEditables(mutation.removedNodes[j]));\r\n        }\r\n      }\r\n\r\n      for(var k = 0; k < inputElementAdditions.length; k++) {\r\n        if(this.isKMWInput(inputElementAdditions[k])) { // Apply standard element filtering!\r\n          this._MutationAdditionObserved(inputElementAdditions[k]);\r\n        }\r\n      }\r\n\r\n      for(k = 0; k < inputElementRemovals.length; k++) {\r\n        if(this.isKMWInput(inputElementRemovals[k])) { // Apply standard element filtering!\r\n          this._MutationRemovalObserved(inputElementRemovals[k]);\r\n        }\r\n      }\r\n\r\n      /* After all mutations have been handled, we need to recompile our .sortedInputs array, but only\r\n        * if any have actually occurred.\r\n        */\r\n      if(inputElementAdditions.length || inputElementRemovals.length) {\r\n        if(!this.keyman.util.device.touchable) {\r\n          this.listInputs();\r\n        } else if(this.keyman.util.device.touchable) {   // If something was added or removed, chances are it's gonna mess up our touch-based layout scheme, so let's update the touch elements.\r\n          var domManager = this;\r\n          window.setTimeout(function() {\r\n            domManager.listInputs();\r\n\r\n            for(var k = 0; k < this.sortedInputs.length; k++) {\r\n              if(this.sortedInputs[k]['kmw_ip']) {\r\n                this.keyman.touchAliasing.updateInput(this.sortedInputs[k]['kmw_ip']);\r\n              }\r\n            }\r\n          }.bind(this), 1);\r\n        }\r\n      }\r\n    }.bind(this);\r\n\r\n    /** \r\n     * Function     _MutationAdditionObserved\r\n     * Scope        Private\r\n     * @param       {Element}  Pelem     A page input, textarea, or iframe element.\r\n     * Description  Used by the MutationObserver event handler to properly setup any elements dynamically added to the document post-initialization.\r\n     * \r\n     */\r\n    _MutationAdditionObserved = function(Pelem: HTMLElement) {\r\n      if(Pelem instanceof Pelem.ownerDocument.defaultView.HTMLIFrameElement && !this.keyman.util.device.touchable) {\r\n        //Problem:  the iframe is loaded asynchronously, and we must wait for it to load fully before hooking in.\r\n\r\n        var domManager = this;\r\n\r\n        var attachFunctor = function() {  // Triggers at the same time as iframe's onload property, after its internal document loads.\r\n          domManager.attachToControl(Pelem);\r\n        };\r\n\r\n        Pelem.addEventListener('load', attachFunctor);\r\n\r\n        /* If the iframe has somehow already loaded, we can't expect the onload event to be raised.  We ought just\r\n        * go ahead and perform our callback's contents.\r\n        * \r\n        * keymanweb.domManager.attachToControl() is now idempotent, so even if our call 'whiffs', it won't cause long-lasting\r\n        * problems.\r\n        */\r\n        if(Pelem.contentDocument.readyState == 'complete') {\r\n          window.setTimeout(attachFunctor, 1);\r\n        }\r\n      } else {\r\n        this.attachToControl(Pelem);\r\n      }  \r\n    }\r\n\r\n    // Used by the mutation event handler to properly decouple any elements dynamically removed from the document.\r\n    _MutationRemovalObserved = function(Pelem: HTMLElement) {\r\n      var element = Pelem;\r\n      if(this.keyman.util.device.touchable) {\r\n        this.disableTouchElement(Pelem);\r\n      }\r\n\r\n      this.disableInputElement(Pelem); // Remove all KMW event hooks, styling.\r\n      this.clearElementAttachment(element);  // Memory management & auto de-attachment upon removal.\r\n    }\r\n\r\n    /**\r\n     * Function     disableControl\r\n     * Scope        Public\r\n     * @param       {Element}      Pelem       Element to be disabled\r\n     * Description  Disables a KMW control element \r\n     */    \r\n    disableControl(Pelem: HTMLElement) {\r\n      if(!this.isAttached(Pelem)) {\r\n        console.warn(\"KeymanWeb is not attached to element \" + Pelem);\r\n      } \r\n\r\n      var cn = Pelem.className;\r\n      if(cn.indexOf('kmw-disabled') < 0) { // if not already explicitly disabled...\r\n        Pelem.className = cn ? cn + ' kmw-disabled' : 'kmw-disabled';\r\n      }\r\n\r\n      // The rest is triggered within MutationObserver code.\r\n      // See _EnablementMutationObserverCore.\r\n    }\r\n\r\n    /**\r\n     * Function     enableControl\r\n     * Scope        Public\r\n     * @param       {Element}      Pelem       Element to be disabled\r\n     * Description  Disables a KMW control element \r\n     */    \r\n    enableControl = function(Pelem: HTMLElement) {\r\n      if(!this.isAttached(Pelem)) {\r\n        console.warn(\"KeymanWeb is not attached to element \" + Pelem);\r\n      } \r\n\r\n      var cn = Pelem.className;\r\n      var tagIndex = cn.indexOf('kmw-disabled');\r\n      if(tagIndex >= 0) { // if already explicitly disabled...\r\n        Pelem.className = cn.replace('kmw-disabled', '').trim();\r\n      }\r\n\r\n      // The rest is triggered within MutationObserver code.\r\n      // See _EnablementMutationObserverCore.\r\n    }\r\n\r\n    /* ------------- Page and document-level management events ------------------ */\r\n\r\n    _WindowLoad: (e: Event) => void = function(e: Event) {\r\n      //keymanweb.completeInitialization();\r\n      // Always return to top of page after a page reload\r\n      document.body.scrollTop=0;\r\n      if(typeof document.documentElement != 'undefined') {\r\n        document.documentElement.scrollTop=0;\r\n      }\r\n    }.bind(this);\r\n\r\n    /**\r\n     * Function     _WindowUnload\r\n     * Scope        Private\r\n     * Description  Remove handlers before detaching KMW window  \r\n     */    \r\n    _WindowUnload: () => void = function() {\r\n      // Allow the UI to release its own resources\r\n      this.keyman.uiManager.doUnload();\r\n      \r\n      // Allow the OSK to release its own resources\r\n      if(this.keyman.osk.ready) {\r\n        this.keyman.osk._Unload(); // I3363 (Build 301)\r\n      }\r\n      \r\n      this.clearLastActiveElement();\r\n    }.bind(this);\r\n\r\n    /* ------ Defines independent, per-control keyboard setting behavior for the API. ------ */\r\n\r\n    /**\r\n     * Function     setKeyboardForControl\r\n     * Scope        Public   \r\n     * @param       {Element}    Pelem    Control element \r\n     * @param       {string|null=}    Pkbd     Keyboard (Clears the set keyboard if set to null.)  \r\n     * @param       {string|null=}     Plc      Language Code\r\n     * Description  Set default keyboard for the control \r\n     */    \r\n    setKeyboardForControl(Pelem: HTMLElement, Pkbd?: string, Plc?: string) {\r\n      /* pass null for kbd to specify no default, or '' to specify the default system keyboard. */\r\n      if(Pkbd !== null && Pkbd !== undefined) {\r\n        var index = Pkbd.indexOf(\"Keyboard_\");\r\n        if(index < 0 && Pkbd != '') {\r\n          Pkbd = \"Keyboard_\" + Pkbd;\r\n        }\r\n      } else {\r\n        Plc = null;\r\n      }\r\n\r\n      if(Pelem instanceof Pelem.ownerDocument.defaultView.HTMLIFrameElement) {\r\n        console.warn(\"'keymanweb.setKeyboardForControl' cannot set keyboard on iframes.\");\r\n        return;\r\n      }\r\n\r\n      if(!this.isAttached(Pelem)) {\r\n        console.error(\"KeymanWeb is not attached to element \" + Pelem);\r\n        return;\r\n      } else {\r\n        Pelem._kmwAttachment.keyboard = Pkbd;\r\n        Pelem._kmwAttachment.languageCode = Plc;\r\n\r\n        // If Pelem is the focused element/active control, we should set the keyboard in place now.\r\n        // 'kmw_ip' is the touch-alias for the original page's control.\r\n\r\n        var lastElem = this.getLastActiveElement();\r\n        if(lastElem && (lastElem == Pelem || lastElem == Pelem['kmw_ip'])) {\r\n\r\n          if(Pkbd != null && Plc != null) { // Second part necessary for Closure.\r\n            this.keyman.keyboardManager.setActiveKeyboard(Pkbd, Plc);\r\n          } else {\r\n            this.keyman.keyboardManager.setActiveKeyboard(this.keyman.globalKeyboard, this.keyman.globalLanguageCode);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function     getKeyboardForControl\r\n     * Scope        Public   \r\n     * @param       {Element}    Pelem    Control element \r\n     * @return      {string|null}         The independently-managed keyboard for the control.\r\n     * Description  Returns the keyboard ID of the current independently-managed keyboard for this control.\r\n     *              If it is currently following the global keyboard setting, returns null instead.\r\n     */\r\n    getKeyboardForControl(Pelem: HTMLElement): string {\r\n      if(!this.isAttached(Pelem)) {\r\n        console.error(\"KeymanWeb is not attached to element \" + Pelem);\r\n        return null;\r\n      } else {\r\n        return Pelem._kmwAttachment.keyboard;\r\n      }\r\n    }\r\n    \r\n    /**\r\n     * Function     getLanguageForControl\r\n     * Scope        Public   \r\n     * @param       {Element}    Pelem    Control element \r\n     * @return      {string|null}         The independently-managed keyboard for the control.\r\n     * Description  Returns the language code used with the current independently-managed keyboard for this control.\r\n     *              If it is currently following the global keyboard setting, returns null instead.\r\n     */\r\n    getLanguageForControl(Pelem: HTMLElement): string {\r\n      if(!this.isAttached(Pelem)) {\r\n        console.error(\"KeymanWeb is not attached to element \" + Pelem);\r\n        return null;\r\n      } else {\r\n        return Pelem._kmwAttachment.languageCode;  // Should we have a version for the language code, too?\r\n      }\r\n    }\r\n\r\n    /* ------ End independent, per-control keyboard setting behavior definitions. ------ */\r\n\r\n    /**\r\n     * Set focus to last active target element (browser-dependent)\r\n     */    \r\n    focusLastActiveElement() {\r\n      var lastElem = this.getLastActiveElement();\r\n      if(!lastElem) {\r\n        return;\r\n      }\r\n\r\n      this.keyman.uiManager.justActivated = true;\r\n      if(lastElem.ownerDocument && lastElem instanceof lastElem.ownerDocument.defaultView.HTMLIFrameElement && \r\n          this.keyman.domManager._IsMozillaEditableIframe(lastElem as HTMLIFrameElement,0)) {\r\n        lastElem.ownerDocument.defaultView.focus(); // I3363 (Build 301)\r\n      } else if(lastElem.focus) {\r\n        lastElem.focus();\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Get the last active target element *before* KMW activated (I1297)\r\n     * \r\n     * @return      {Element}        \r\n     */    \r\n    getLastActiveElement(): HTMLElement {\r\n      return DOMEventHandlers.states.lastActiveElement;\r\n    }\r\n\r\n    clearLastActiveElement() {\r\n      DOMEventHandlers.states.lastActiveElement = null;\r\n    }\r\n\r\n    getActiveElement(): HTMLElement {\r\n      return DOMEventHandlers.states.activeElement;\r\n    }\r\n\r\n    _setActiveElement(Pelem: HTMLElement) {\r\n      DOMEventHandlers.states.activeElement = Pelem;\r\n    }\r\n\r\n    /**\r\n     *  Set the active input element directly optionally setting focus \r\n     * \r\n     *  @param  {Object|string} e         element id or element\r\n     *  @param  {boolean=}      setFocus  optionally set focus  (KMEW-123) \r\n     **/\r\n    setActiveElement(e: string|HTMLElement, setFocus?: boolean) {\r\n      if(typeof(e) == \"string\") { // Can't instanceof string, and String is a different type.\r\n        e=document.getElementById(e);\r\n      }\r\n\r\n      // Non-attached elements cannot be set as active.\r\n      if(!this.isAttached(e) && !this.keyman.isEmbedded) {\r\n        console.warn(\"Cannot set an element KMW is not attached to as the active element.\");\r\n        return;\r\n      }\r\n\r\n      // As this is an API function, someone may pass in the base of a touch element.\r\n      // We need to respond appropriately.\r\n      e = e['kmw_ip'] ? e['kmw_ip'] : e;\r\n\r\n      // If we're changing controls, don't forget to properly manage the keyboard settings!\r\n      // It's only an issue on 'native' (non-embedded) code paths.\r\n      if(!this.keyman.isEmbedded) {\r\n        this.keyman.touchAliasing._BlurKeyboardSettings();\r\n      }\r\n\r\n      // No need to reset context if we stay within the same element.\r\n      if(DOMEventHandlers.states.activeElement != e) {\r\n        this.keyman.interface.resetContext();\r\n      }\r\n\r\n      DOMEventHandlers.states.activeElement = DOMEventHandlers.states.lastActiveElement=e;\r\n      if(!this.keyman.isEmbedded) {\r\n        this.keyman.touchAliasing._FocusKeyboardSettings(false);\r\n      }\r\n\r\n      // Allow external focusing KMEW-123\r\n      if(arguments.length > 1 && setFocus) {\r\n        if(this.keyman.util.device.touchable) {\r\n          this.keyman.touchAliasing.setFocus();\r\n        } else {\r\n          this.focusLastActiveElement();\r\n        }\r\n      }\r\n    }\r\n\r\n    /** Sets the active input element only if it is presently null.\r\n     * \r\n     * @param  {Element}\r\n     */\r\n    initActiveElement(Lelem: HTMLElement) {\r\n      if(DOMEventHandlers.states.activeElement == null) {\r\n        DOMEventHandlers.states.activeElement = Lelem;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Move focus to next (or previous) input or text area element on TAB\r\n     *   Uses list of actual input elements\r\n     *     \r\n     *   Note that activeElement() on touch devices returns the DIV that overlays\r\n     *   the input element, not the element itself.\r\n     * \r\n     * @param      {number|boolean}  bBack     Direction to move (0 or 1)\r\n     */\r\n    moveToNext(bBack: number|boolean) {\r\n      var i,t=this.sortedInputs, activeBase=this.getActiveElement();\r\n      var touchable = this.keyman.util.device.touchable;\r\n      \r\n      if(t.length == 0) {\r\n        return;\r\n      }\r\n\r\n      // For touchable devices, get the base element of the DIV\r\n      if(touchable) {\r\n        activeBase=activeBase.base;\r\n      }\r\n\r\n      // Identify the active element in the list of inputs ordered by position\r\n      for(i=0; i<t.length; i++) {\r\n        if(t[i] == activeBase) break;\r\n      }\r\n\r\n      // Find the next (or previous) element in the list\r\n      i = bBack ? i-1 : i+1;\r\n      // Treat the list as circular, wrapping the index if necessary.\r\n      i = i >= t.length ? i-t.length : i;\r\n      i = i < 0 ? i+t.length : i;\r\n\r\n      // Move to the selected element\r\n      if(touchable) {\r\n        // Set focusing flag to prevent OSK disappearing \r\n        DOMEventHandlers.states.focusing=true;\r\n        var target=t[i]['kmw_ip'];\r\n\r\n        // Focus if next element is non-mapped\r\n        if(typeof(target) == 'undefined') {\r\n          t[i].focus();\r\n        } else { // Or reposition the caret on the input DIV if mapped\r\n          this.keyman.domManager.setActiveElement(target); // Handles both `lastActive` + `active`.\r\n          this.touchHandlers.setTextCaret(target,10000); // Safe b/c touchable == true.\r\n          this.touchHandlers.scrollInput(target);   // mousedown check\r\n          target.focus();\r\n        }\r\n      } else { // Behaviour for desktop browsers\r\n        t[i].focus();\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Move focus to user-specified element\r\n     * \r\n     *  @param  {string|Object}   e   element or element id\r\n     *           \r\n     **/\r\n    moveToElement(e:string|HTMLElement) {\r\n      var i;\r\n      \r\n      if(typeof(e) == \"string\") { // Can't instanceof string, and String is a different type.\r\n        e=document.getElementById(e);\r\n      }\r\n      \r\n      if(this.keyman.util.device.touchable && e['kmw_ip']) {\r\n        e['kmw_ip'].focus();\r\n      } else {\r\n        e.focus();\r\n      }\r\n    }\r\n\r\n    /* ----------------------- Editable IFrame methods ------------------- */\r\n\r\n    /**\r\n     * Function     _IsIEEditableIframe\r\n     * Scope        Private\r\n     * @param       {Object}          Pelem         Iframe element\r\n     *              {boolean|number}  PtestOn       1 to test if frame content is editable (TODO: unclear exactly what this is doing!)   \r\n     * @return      {boolean}\r\n     * Description  Test if element is an IE editable IFrame \r\n     */    \r\n    _IsIEEditableIframe(Pelem: HTMLIFrameElement, PtestOn?: number) {\r\n      var Ldv, Lvalid = Pelem  &&  (Ldv=Pelem.tagName)  &&  Ldv.toLowerCase() == 'body'  &&  (Ldv=Pelem.ownerDocument)  &&  Ldv.parentWindow;\r\n      return (!PtestOn  &&  Lvalid) || (PtestOn  &&  (!Lvalid || Pelem.isContentEditable));\r\n    }\r\n\r\n    /**\r\n     * Function     _IsMozillaEditableIframe\r\n     * Scope        Private\r\n     * @param       {Object}           Pelem    Iframe element\r\n     * @param       {boolean|number}   PtestOn  1 to test if 'designMode' is 'ON'    \r\n     * @return      {boolean} \r\n     * Description  Test if element is a Mozilla editable IFrame \r\n     */    \r\n    _IsMozillaEditableIframe(Pelem: HTMLIFrameElement, PtestOn?: number) {\r\n      var Ldv, Lvalid = Pelem  &&  (Ldv=(<any>Pelem).defaultView)  &&  Ldv.frameElement;  // Probable bug!\r\n      return (!PtestOn  &&  Lvalid) || (PtestOn  &&  (!Lvalid || Ldv.document.designMode.toLowerCase()=='on'));\r\n    }\r\n\r\n    /* ----------------------- Initialization methods ------------------ */\r\n    \r\n    /**\r\n     * Get the user-specified (or default) font for the first mapped input or textarea element\r\n     * before applying any keymanweb styles or classes\r\n     * \r\n     *  @return   {string}\r\n     **/                 \r\n    getBaseFont() {\r\n      var util = this.keyman.util;\r\n      var ipInput = document.getElementsByTagName<'input'>('input'),\r\n          ipTextArea=document.getElementsByTagName<'textarea'>('textarea'),\r\n          n=0,fs,fsDefault='Arial,sans-serif';\r\n      \r\n      // Find the first input element (if it exists)\r\n      if(ipInput.length == 0 && ipTextArea.length == 0) {\r\n        n=0;\r\n      } else if(ipInput.length > 0 && ipTextArea.length == 0) {\r\n        n=1;\r\n      } else if(ipInput.length == 0 && ipTextArea.length > 0) {\r\n        n=2;\r\n      } else {\r\n        var firstInput = ipInput[0];\r\n        var firstTextArea = ipTextArea[0];\r\n\r\n        if(firstInput.offsetTop < firstTextArea.offsetTop) {\r\n          n=1;\r\n        } else if(firstInput.offsetTop > firstTextArea.offsetTop) {\r\n          n=2;\r\n        } else if(firstInput.offsetLeft < firstTextArea.offsetLeft) {\r\n          n=1;\r\n        } else if(firstInput.offsetLeft > firstTextArea.offsetLeft) {\r\n          n=2;\r\n        }\r\n      }\r\n      \r\n      // Grab that font!\r\n      switch(n) {\r\n        case 0:\r\n          fs=fsDefault;\r\n        case 1:\r\n          fs=util.getStyleValue(ipInput[0],'font-family');\r\n        case 2:\r\n          fs=util.getStyleValue(ipTextArea[0],'font-family');\r\n      }\r\n      if(typeof(fs) == 'undefined' || fs == 'monospace') {\r\n        fs=fsDefault;\r\n      }\r\n      \r\n      return fs;\r\n    }\r\n\r\n    /**\r\n     * Function     Initialization\r\n     * Scope        Public\r\n     * @param       {Object}  arg     object array of user-defined properties\r\n     * Description  KMW window initialization  \r\n     */    \r\n    init: (arg:any) => Promise<any> = function(arg): Promise<any> { \r\n      var i,j,c,e,p,eTextArea,eInput,opt,dTrailer,ds;\r\n      var osk = this.keyman.osk;\r\n      var util = this.keyman.util;\r\n      var device = util.device;\r\n\r\n      // Local function to convert relative to absolute URLs\r\n      // with respect to the source path, server root and protocol \r\n      var fixPath = function(p) {\r\n        if(p.length == 0) return p;\r\n        \r\n        // Add delimiter if missing\r\n        if(p.substr(p.length-1,1) != '/') p = p+'/';\r\n\r\n        // Absolute\r\n        if((p.replace(/^(http)s?:.*/,'$1') == 'http') \r\n            || (p.replace(/^(file):.*/,'$1') == 'file'))\r\n          return p;         \r\n          \r\n        // Absolute (except for protocol)\r\n        if(p.substr(0,2) == '//')\r\n          return this.keyman.protocol+p;\r\n        \r\n        // Relative to server root\r\n        if(p.substr(0,1) == '/')\r\n          return this.keyman.rootPath+p.substr(1);\r\n\r\n        // Otherwise, assume relative to source path\r\n        return this.keyman.srcPath+p;\r\n      }.bind(this);\r\n      \r\n      // Explicit (user-defined) parameter initialization       \r\n      opt=this.keyman.options;\r\n      if(typeof(arg) == 'object' && arg !== null)\r\n      {\r\n        for(p in opt)\r\n        { \r\n          if(arg.hasOwnProperty(p)) opt[p] = arg[p];\r\n        }\r\n      }\r\n    \r\n      // Get default paths and device options\r\n      if(opt['root'] != '') {\r\n        this.keyman.rootPath = fixPath(opt['root']); \r\n      }\r\n\r\n      // Keyboards and fonts are located with respect to the server root by default          \r\n      //if(opt['keyboards'] == '') opt['keyboards'] = keymanweb.rootPath+'keyboard/';\r\n      //if(opt['fonts'] == '') opt['fonts'] = keymanweb.rootPath+'font/';\r\n    \r\n      // Resources are located with respect to the engine by default \r\n      if(opt['resources'] == '') {\r\n        opt['resources'] = this.keyman.srcPath;\r\n      }\r\n    \r\n      // Convert resource, keyboard and font paths to absolute URLs\r\n      opt['resources'] = fixPath(opt['resources']);\r\n      opt['keyboards'] = fixPath(opt['keyboards']);\r\n      opt['fonts'] = fixPath(opt['fonts']);    \r\n\r\n      // Set element attachment type    \r\n      if(opt['attachType'] == '') {\r\n        opt['attachType'] = 'auto';\r\n      }\r\n\r\n      // Set default device options\r\n      this.keyman.setDefaultDeviceOptions(opt);   \r\n      \r\n      // Only do remainder of initialization once!  \r\n      if(this.keyman.initialized) {\r\n        return Promise.resolve();\r\n      }\r\n\r\n      var keyman: KeymanBase = this.keyman;\r\n      var domManager = this;\r\n\r\n      // Do not initialize until the document has been fully loaded\r\n      if(document.readyState !== 'complete')\r\n      {\r\n        return new Promise(function(resolve) {\r\n          window.setTimeout(function(){\r\n            domManager.init(arg).then(function() {\r\n              resolve();\r\n            });\r\n          }, 50);\r\n        });\r\n      }\r\n\r\n      this.keyman._MasterDocument = window.document;\r\n\r\n      /**\r\n       * Initialization of touch devices and browser interfaces must be done \r\n       * after all resources are loaded, during final stage of initialization\r\n       *        \r\n       */            \r\n      \r\n      // Treat Android devices as phones if either (reported) screen dimension is less than 4\" \r\n      if(device.OS == 'Android')\r\n      {\r\n        // Determine actual device characteristics  I3363 (Build 301)\r\n        // TODO: device.dpi may no longer be needed - if so, get rid of it.\r\n        var dpi = device.getDPI(); //TODO: this will not work when called from HEAD!!\r\n        device.formFactor=((screen.height < 4.0 * dpi) || (screen.width < 4.0 * dpi)) ? 'phone' : 'tablet';\r\n      }\r\n    \r\n      // Set exposed initialization flag member for UI (and other) code to use \r\n      this.keyman.setInitialized(1);\r\n\r\n      // Finish keymanweb and OSK initialization once all necessary resources are available\r\n      osk.prepare();\r\n    \r\n      // Create and save the remote keyboard loading delay indicator\r\n      util.prepareWait();\r\n\r\n      // Register deferred keyboard stubs (addKeyboards() format)\r\n      this.keyman.keyboardManager.registerDeferredStubs();\r\n    \r\n      // Initialize the desktop UI\r\n      this.initializeUI();\r\n    \r\n      // Register deferred keyboards \r\n      this.keyman.keyboardManager.registerDeferredKeyboards();\r\n    \r\n      // Exit initialization here if we're using an embedded code path.\r\n      if(this.keyman.isEmbedded) {\r\n        if(!this.keyman.keyboardManager.setDefaultKeyboard()) {\r\n          console.error(\"No keyboard stubs exist - cannot initialize keyboard!\");\r\n        }\r\n        return Promise.resolve();\r\n      }\r\n\r\n      // Determine the default font for mapped elements\r\n      this.keyman.appliedFont=this.keyman.baseFont=this.getBaseFont();\r\n\r\n      // Add orientationchange event handler to manage orientation changes on mobile devices\r\n      // Initialize touch-screen device interface  I3363 (Build 301)\r\n      if(device.touchable) {\r\n        this.keyman.handleRotationEvents();\r\n      }    \r\n      // Initialize browser interface\r\n\r\n      if(this.keyman.options['attachType'] != 'manual') {\r\n        this._SetupDocument(document.documentElement);\r\n      }\r\n\r\n      // Create an ordered list of all input and textarea fields\r\n      this.listInputs();\r\n    \r\n      // Initialize the OSK and set default OSK styles\r\n      // Note that this should *never* be called before the OSK has been initialized.\r\n      // However, it possibly may be called before the OSK has been fully defined with the current keyboard, need to check.    \r\n      //osk._Load(); \r\n      \r\n      //document.body.appendChild(osk._Box); \r\n\r\n      //osk._Load(false);\r\n      \r\n      // I3363 (Build 301)\r\n      if(device.touchable) {\r\n        // Handle OSK touchend events (prevent propagation)\r\n        osk._Box.addEventListener('touchend',function(e){\r\n          e.stopPropagation();\r\n        }, false);\r\n\r\n        // Add a blank DIV to the bottom of the page to allow the bottom of the page to be shown\r\n        dTrailer=document.createElement('DIV');\r\n        ds=dTrailer.style;\r\n        ds.width='100%';\r\n        ds.height=(screen.width/2)+'px';\r\n        document.body.appendChild(dTrailer);  \r\n        \r\n        // On Chrome, scrolling up or down causes the URL bar to be shown or hidden \r\n        // according to whether or not the document is at the top of the screen.\r\n        // But when doing that, each OSK row top and height gets modified by Chrome\r\n        // looking very ugly.  Itwould be best to hide the OSK then show it again \r\n        // when the user scroll finishes, but Chrome has no way to reliably report\r\n        // the touch end event after a move. c.f. http://code.google.com/p/chromium/issues/detail?id=152913\r\n        // The best compromise behaviour is simply to hide the OSK whenever any \r\n        // non-input and non-OSK element is touched.\r\n        if(device.OS == 'Android' && navigator.userAgent.indexOf('Chrome') > 0) {\r\n          (<any>this.keyman).hideOskWhileScrolling=function(e) {           \r\n            if(typeof(osk._Box) == 'undefined') return;\r\n            if(typeof(osk._Box.style) == 'undefined') return;\r\n\r\n            // The following tests are needed to prevent the OSK from being hidden during normal input!\r\n            p=e.target.parentNode;\r\n            if(typeof(p) != 'undefined' && p != null) {\r\n              if(p.className.indexOf('keymanweb-input') >= 0) return; \r\n              if(p.className.indexOf('kmw-key-') >= 0) return; \r\n              if(typeof(p.parentNode) != 'undefined') {\r\n                p=p.parentNode;\r\n                if(p.className.indexOf('keymanweb-input') >= 0) return; \r\n                if(p.className.indexOf('kmw-key-') >= 0) return; \r\n              }\r\n            }          \r\n            osk.hideNow(); \r\n          }        \r\n          this.keyman.util.attachDOMEvent(document.body, 'touchstart', (<any>this.keyman).hideOskWhileScrolling, false);\r\n        } else {\r\n          (<any>this.keyman).conditionallyHideOsk = function() {\r\n            // Should not hide OSK if simply closing the language menu (30/4/15)\r\n            if((<any>keyman).hideOnRelease && !osk.lgList) osk.hideNow();\r\n            (<any>keyman).hideOnRelease=false;\r\n          };\r\n          (<any>this.keyman).hideOskIfOnBody = function(e) {\r\n            (<any>keyman).touchY=e.touches[0].screenY;\r\n            (<any>keyman).hideOnRelease=true;\r\n          };\r\n          (<any>this.keyman).cancelHideIfScrolling = function(e) {\r\n            var y=e.touches[0].screenY,y0=(<any>keyman).touchY;    \r\n            if(y-y0 > 5 || y0-y < 5) (<any>keyman).hideOnRelease = false;\r\n          };\r\n\r\n          this.keyman.util.attachDOMEvent(document.body, 'touchstart',(<any>this.keyman).hideOskIfOnBody,false);      \r\n          this.keyman.util.attachDOMEvent(document.body, 'touchmove',(<any>this.keyman).cancelHideIfScrolling,false);      \r\n          this.keyman.util.attachDOMEvent(document.body, 'touchend',(<any>this.keyman).conditionallyHideOsk,false);      \r\n        } \r\n      }\r\n\r\n      //document.body.appendChild(keymanweb._StyleBlock);\r\n    \r\n      // Restore and reload the currently selected keyboard, selecting a default keyboard if necessary.\r\n      this.keyman.keyboardManager.restoreCurrentKeyboard(); \r\n\r\n      /* Setup of handlers for dynamically-added and (eventually) dynamically-removed elements.\r\n        * Reference: https://developer.mozilla.org/en/docs/Web/API/MutationObserver\r\n        * \r\n        * We place it here so that it loads after most of the other UI loads, reducing the MutationObserver's overhead.\r\n        * Of course, we only want to dynamically add elements if the user hasn't enabled the manual attachment option.\r\n        */\r\n      \r\n      if(MutationObserver) {\r\n        var observationTarget = document.querySelector('body'), observationConfig: MutationObserverInit;\r\n        if(this.keyman.options['attachType'] != 'manual') { //I1961\r\n          observationConfig = { childList: true, subtree: true};\r\n          this.attachmentObserver = new MutationObserver(this._AutoAttachObserverCore);\r\n          this.attachmentObserver.observe(observationTarget, observationConfig);\r\n        }\r\n\r\n        /**\r\n         * Setup of handlers for dynamic detection of the kmw-disabled class tag that controls enablement.\r\n         */\r\n        observationConfig = { subtree: true, attributes: true, attributeOldValue: true, attributeFilter: ['class', 'readonly']};\r\n        this.enablementObserver = new MutationObserver(this._EnablementMutationObserverCore);\r\n        this.enablementObserver.observe(observationTarget, observationConfig);\r\n      } else {\r\n        console.warn(\"Your browser is outdated and does not support MutationObservers, a web feature \" + \r\n          \"needed by KeymanWeb to support dynamically-added elements.\");\r\n      }\r\n\r\n      // Set exposed initialization flag to 2 to indicate deferred initialization also complete\r\n      this.keyman.setInitialized(2);\r\n      return Promise.resolve();\r\n    }.bind(this);\r\n\r\n    /**\r\n     * Initialize the desktop user interface as soon as it is ready\r\n    **/       \r\n    initializeUI() {\r\n      if(this.keyman.ui && this.keyman.ui['initialize'] instanceof Function) {\r\n        this.keyman.ui['initialize']();\r\n        // Display the OSK (again) if enabled, in order to set its position correctly after\r\n        // adding the UI to the page \r\n        this.keyman.osk._Show();     \r\n      } else {\r\n        window.setTimeout(this.initializeUI.bind(this),1000);\r\n      }\r\n    }\r\n  }\r\n}","// The Device object definition -------------------------------------------------\r\n\r\nnamespace com.keyman {\r\n  export class Device {\r\n    touchable: boolean;\r\n    OS: string;\r\n    formFactor: string;\r\n    dyPortrait: number;\r\n    dyLandscape: number;\r\n    version: string;\r\n    orientation: string|number;\r\n    browser: string;\r\n\r\n    // Generates a default Device value.\r\n    constructor() {\r\n      this.touchable = !!('ontouchstart' in window);\r\n      this.OS = '';\r\n      this.formFactor='desktop';\r\n      this.dyPortrait=0;\r\n      this.dyLandscape=0;\r\n      this.version='0';\r\n      this.orientation=window.orientation;\r\n      this.browser='';\r\n    }\r\n\r\n    /**\r\n     * Get device horizontal DPI for touch devices, to set actual size of active regions\r\n     * Note that the actual physical DPI may be somewhat different.\r\n     * \r\n     * @return      {number}               \r\n     */       \r\n    getDPI(): number {\r\n      var t=document.createElement('DIV') ,s=t.style,dpi=96;\r\n      if(document.readyState !== 'complete') {\r\n        return dpi;\r\n      }\r\n      \r\n      t.id='calculateDPI';\r\n      s.position='absolute'; s.display='block';s.visibility='hidden';\r\n      s.left='10px'; s.top='10px'; s.width='1in'; s.height='10px';\r\n      document.body.appendChild(t);\r\n      dpi=(typeof window.devicePixelRatio == 'undefined') ? t.offsetWidth : t.offsetWidth * window.devicePixelRatio;\r\n      document.body.removeChild(t);\r\n      return dpi;    \r\n    }\r\n\r\n    detect() : void {\r\n      var IEVersion = Device._GetIEVersion();\r\n      \r\n      if(navigator && navigator.userAgent) {\r\n        var agent=navigator.userAgent;\r\n\r\n        if(agent.indexOf('iPad') >= 0) {\r\n          this.OS='iOS';\r\n          this.formFactor='tablet';\r\n          this.dyPortrait=this.dyLandscape=0;\r\n        } else if(agent.indexOf('iPhone') >= 0) { \r\n          this.OS='iOS';\r\n          this.formFactor='phone';\r\n          this.dyPortrait=this.dyLandscape=25;\r\n        } else if(agent.indexOf('Android') >= 0) {\r\n          this.OS='Android';\r\n          this.formFactor='phone';    // form factor may be redefined on initialization\r\n          this.dyPortrait=75;\r\n          this.dyLandscape=25;\r\n          try {\r\n            var rx=new RegExp(\"(?:Android\\\\s+)(\\\\d+\\\\.\\\\d+\\\\.\\\\d+)\");\r\n            this.version=agent.match(rx)[1];\r\n          } catch(ex) {}\r\n        } else if(agent.indexOf('Linux') >= 0) {\r\n          this.OS='Linux';\r\n        } else if(agent.indexOf('Macintosh') >= 0) {\r\n          this.OS='MacOSX';\r\n        } else if(agent.indexOf('Windows NT') >= 0) {\r\n          this.OS='Windows';\r\n          if(agent.indexOf('Touch') >= 0) {\r\n            this.formFactor='phone';   // will be redefined as tablet if resolution high enough\r\n          }\r\n          \r\n          // Windows Phone and Tablet PC\r\n          if(typeof navigator.msMaxTouchPoints == 'number' && navigator.msMaxTouchPoints > 0) {\r\n            this.touchable=true;\r\n          }\r\n        }\r\n      }\r\n\r\n      // var sxx=device.formFactor;\r\n      // Check and possibly revise form factor according to actual screen size (adjusted for Galaxy S, maybe OK generally?)\r\n      if(this.formFactor == 'tablet' && Math.min(screen.width,screen.height) < 400) {\r\n        this.formFactor='phone';\r\n      }\r\n\r\n      // Trust what iOS tells us for phone vs tablet.\r\n      if(this.formFactor == 'phone'  && Math.max(screen.width,screen.height) > 720 && this.OS != 'iOS') {\r\n        this.formFactor='tablet';\r\n      }\r\n\r\n      //                           alert(sxx+'->'+device.formFactor);\r\n      // Check for phony iOS devices (Win32 test excludes Chrome touch emulation on Windows)!\r\n      if(this.OS == 'iOS' && !('ongesturestart' in window) && navigator.platform != 'Win32') {\r\n        this.OS='Android';\r\n      }\r\n    \r\n      // Determine application or browser\r\n      this.browser='web';\r\n      if(IEVersion < 999) {\r\n        this.browser='ie';\r\n      } else {\r\n        if(this.OS == 'iOS' || this.OS.toLowerCase() == 'macosx') {\r\n          this.browser='safari';\r\n        }\r\n\r\n        var bMatch=/Firefox|Chrome|OPR|Safari|Edge/;\r\n        if(bMatch.test(navigator.userAgent)) {\r\n          if((navigator.userAgent.indexOf('Firefox') >= 0) && ('onmozorientationchange' in screen)) {\r\n            this.browser='firefox';\r\n          } else if(navigator.userAgent.indexOf('OPR') >= 0) {\r\n            this.browser='opera';\r\n          } else if(navigator.userAgent.indexOf(' Edge/') >= 0) {\r\n            // Edge is too common a word, so test for Edge/ :)\r\n            // Must come before Chrome and Safari test because\r\n            // Edge pretends to be both\r\n            this.browser='edge';\r\n          } else if(navigator.userAgent.indexOf('Chrome') >= 0) {\r\n            // This test must come before Safari test because on macOS,\r\n            // Chrome also reports \"Safari\"\r\n            this.browser='chrome';\r\n          } else if(navigator.userAgent.indexOf('Safari') >= 0) {\r\n            this.browser='safari';\r\n          }\r\n        } \r\n      }\r\n    }\r\n\r\n    static _GetIEVersion() {\r\n      var n, agent='';\r\n      \r\n      if('userAgent' in navigator) {\r\n        agent=navigator.userAgent;\r\n      }\r\n      \r\n      // Test first for old versions\r\n      if('selection' in document) {         // only defined for IE and not for IE 11!!!       \r\n        var appVer=navigator.appVersion;\r\n        n=appVer.indexOf('MSIE ');\r\n        if(n >= 0) {\r\n          // Check for quirks mode page, always return 6 if so\r\n          if((document as Document).compatMode == 'BackCompat') {\r\n            return 6;\r\n          }\r\n          \r\n          appVer=appVer.substr(n+5);\r\n          n=appVer.indexOf('.');\r\n          if(n > 0) {\r\n            return parseInt(appVer.substr(0,n),10);\r\n          }\r\n        }              \r\n      }\r\n        \r\n      // Finally test for IE 11 (and later?)\r\n      n=agent.indexOf('Trident/');\r\n      if(n < 0) {\r\n        return 999;\r\n      }\r\n      \r\n      agent=agent.substr(n+8);\r\n      n=agent.indexOf('.');\r\n      if(n > 0){\r\n        return parseInt(agent.substr(0,n),10)+4;\r\n      }\r\n    \r\n      return 999;\r\n    }\r\n  }\r\n}","// Includes KMW-added property declaration extensions for HTML elements.\r\n/// <reference path=\"kmwexthtml.ts\" />\r\n// Includes the Device definition set.\r\n/// <reference path=\"kmwdevice.ts\" />\r\n\r\nnamespace com.keyman {\r\n  class DOMEventTracking {\r\n    Pelem: EventTarget;\r\n    Peventname: string;\r\n    Phandler: (Object) => boolean;\r\n    PuseCapture?: boolean\r\n\r\n    constructor(Pelem: EventTarget, Peventname: string, Phandler: (Object) => boolean, PuseCapture?: boolean) {\r\n      this.Pelem = Pelem;\r\n      this.Peventname = Peventname.toLowerCase();\r\n      this.Phandler = Phandler;\r\n      this.PuseCapture = PuseCapture;\r\n    }\r\n\r\n    equals(other: DOMEventTracking): boolean {\r\n      return this.Pelem == other.Pelem && this.Peventname == other.Peventname &&\r\n        this.Phandler == other.Phandler && this.PuseCapture == other.PuseCapture;\r\n    }\r\n  };\r\n\r\n  export class Util {\r\n    // Generalized component event registration\r\n    device: Device;\r\n    activeDevice: Device;\r\n    physicalDevice: Device;\r\n\r\n    linkedStylesheets: (HTMLLinkElement|HTMLStyleElement)[] = [];\r\n\r\n    waiting: HTMLDivElement;                  // The element displayed for util.wait and util.alert.\r\n\r\n    // An object mapping event names to individual event lists.  Maps strings to arrays.\r\n    private events: { [name: string]: ((Object) => boolean)[];} = {};\r\n    private currentEvents: string[] = [];  // The event messaging call stack.\r\n\r\n    private domEvents: DOMEventTracking[] = [];\r\n\r\n    private embeddedFonts: any[] = [];     // Array of currently embedded font descriptor entries.  (Is it just a string?)\r\n\r\n    // Consider refactoring keymanweb.options to within Util.\r\n\r\n    private keyman: KeymanBase; // Closure doesn't like relying on the global object from within a class def.\r\n\r\n    constructor(keyman: any) {\r\n      this.initDevices();\r\n\r\n      this.keyman = keyman;\r\n    }\r\n\r\n    // Possible alternative:  https://www.npmjs.com/package/language-tags\r\n    // This would necessitate linking in a npm module into compiled KeymanWeb, though.\r\n    ['getLanguageCodes'](lgCode: string): string[] {\r\n      if(lgCode.indexOf('-')==-1) {\r\n        return [lgCode];\r\n      } else {\r\n        return lgCode.split('-');\r\n      }\r\n    }\r\n\r\n    initDevices(): void {\r\n      this.device = new Device();\r\n      this.physicalDevice = new Device();\r\n      this.activeDevice = this.device;\r\n\r\n      // Initialize the true device values.\r\n      this.device.detect();\r\n\r\n      /* DEBUG: Force touch device   (Build 360)\r\n      \r\n      device.touchable = true;\r\n      device.browser = 'safari';\r\n      device.formFactor = 'tablet';\r\n      device.OS = 'iOS';\r\n      \r\n      END DEBUG */\r\n\r\n      /* If we've made it to this point of initialization and aren't anything else, KeymanWeb assumes \r\n      * we're a desktop.  Since we don't yet support desktops with touch-based input, we disable it here.\r\n      */                     \r\n      if(this.device.formFactor == 'desktop') {\r\n        this.device.touchable = false;\r\n      }\r\n\r\n      /**\r\n       * Represents hardware-based keystrokes regardless of the 'true' device, facilitating hardware keyboard input\r\n       * whenever touch-based input is available.\r\n       */\r\n      this.physicalDevice = new Device();\r\n      this.physicalDevice.touchable = false;\r\n      this.physicalDevice.browser = this.device.browser;\r\n      this.physicalDevice.formFactor = 'desktop';\r\n      this.physicalDevice.OS = this.device.OS;\r\n    }\r\n\r\n    /**\r\n     * Function     arrayFromNodeList\r\n     * Scope        Public\r\n     * @param       {Object}    nl a node list, as returned from getElementsBy_____ methods.\r\n     * Description  Transforms a node list into an array.   * \r\n     * @return      {Array<Element>}\r\n     */\r\n    arrayFromNodeList(nl: NodeList|HTMLCollectionOf<Element>): HTMLElement[] {\r\n      var res = [];\r\n      for(var i=0; i < nl.length; i++) {\r\n        res.push(nl[i]);\r\n      }\r\n      return res;\r\n    }\r\n\r\n    /**\r\n     * Function    addEventListener\r\n     * Scope       Private\r\n     * @param      {string}     event     name of event prefixed by module, e.g. osk.touchmove\r\n     * @param      {function(Object)}   func      event handler\r\n     * @return     {boolean}         \r\n     * Description Add (or replace) an event listener for this component \r\n     */    \r\n    addEventListener(event: string, func: (Object) => boolean): boolean {\r\n      this.removeEventListener(event, func);\r\n      this.events[event].push(func);\r\n      return true;\r\n    }    \r\n    \r\n    /**\r\n     * Function    removeEventListener\r\n     * Scope       Private\r\n     * @param      {string}     event     name of event prefixed by module, e.g. osk.touchmove\r\n     * @param      {function(Object)}   func      event handler\r\n     * @return     {boolean}         \r\n     * Description Remove the specified function from the listeners for this event \r\n     */    \r\n    removeEventListener(event: string, func: (Object) => boolean): boolean {\r\n      if(typeof this.events[event] == 'undefined') {\r\n        this.events[event] = [];\r\n      }\r\n\r\n      for(var i=0; i<this.events[event].length; i++) {\r\n        if(this.events[event][i] == func) { \r\n          this.events[event].splice(i, 1);\r\n          return true;\r\n        }\r\n      }\r\n      return false;\r\n    }\r\n    \r\n    /**\r\n     * Function    callEvent\r\n     * Scope       Private\r\n     * @param      {string}     event     name of event prefixed by module, e.g. osk.touchmove\r\n     * @param      {Array}      params    parameter array for function\r\n     * @return     {boolean}         \r\n     * Description Invoke an event using any function with up to four arguments \r\n     */    \r\n    callEvent(event: string, params: Object|Object[]): boolean {\r\n      if(typeof this.events[event] == 'undefined') {\r\n        return true;\r\n      }\r\n\r\n      if(this.currentEvents.indexOf(event) != -1) {\r\n        return false;  // Avoid event messaging recursion!\r\n      }\r\n\r\n      this.currentEvents.push(event);    \r\n\r\n      for(var i=0; i<this.events[event].length; i++) {\r\n        var func=this.events[event][i], result=false;\r\n        try {\r\n          result=func(params); \r\n        } catch(strExcept) { \r\n          result=false; \r\n        } //don't know whether to use true or false here      \r\n        if(result === false) {\r\n          this.currentEvents.pop(); \r\n          return false;\r\n        }\r\n      }    \r\n      this.currentEvents.pop();\r\n      return true;\r\n    }\r\n    \r\n    /**\r\n     * Function     attachDOMEvent: Note for most browsers, adds an event to a chain, doesn't stop existing events  \r\n     * Scope        Public\r\n     * @param       {Object}    Pelem       Element (or IFrame-internal Document) to which event is being attached\r\n     * @param       {string}    Peventname  Name of event without 'on' prefix\r\n     * @param       {function(Object)}  Phandler    Event handler for event\r\n     * @param       {boolean=}  PuseCapture True only if event to be handled on way to target element      \r\n     * Description  Attaches event handler to element DOM event\r\n     */  \r\n    attachDOMEvent(Pelem: EventTarget, Peventname: string, Phandler: (Object) => boolean, PuseCapture?: boolean): void {\r\n      this.detachDOMEvent(Pelem, Peventname, Phandler, PuseCapture);\r\n      Pelem.addEventListener(Peventname, Phandler, PuseCapture?true:false);\r\n\r\n      // Since we're attaching to the DOM, these events should be tracked for detachment during shutdown.\r\n      var event = new DOMEventTracking(Pelem, Peventname, Phandler, PuseCapture);\r\n      this.domEvents.push(event);\r\n    }\r\n\r\n    /**\r\n     * Function     detachDOMEvent\r\n     * Scope        Public\r\n     * @param       {Object}    Pelem       Element from which event is being detached\r\n     * @param       {string}    Peventname  Name of event without 'on' prefix\r\n     * @param       {function(Object)}  Phandler    Event handler for event\r\n     * @param       {boolean=}  PuseCapture True if event was being handled on way to target element      \r\n     * Description Detaches event handler from element [to prevent memory leaks]\r\n     */  \r\n    detachDOMEvent(Pelem: EventTarget, Peventname: string, Phandler: (Object) => boolean, PuseCapture?: boolean): void {\r\n      Pelem.removeEventListener(Peventname, Phandler, PuseCapture);\r\n\r\n      // Since we're detaching, we should drop the tracking data from the old event.\r\n      var event = new DOMEventTracking(Pelem, Peventname, Phandler, PuseCapture);\r\n      for(var i = 0; i < this.domEvents.length; i++) {\r\n        if(this.domEvents[i].equals(event)) {\r\n          this.domEvents.splice(i, 1);\r\n          break;\r\n        }\r\n      }\r\n    }    \r\n\r\n    /**\r\n     * Function     getOption\r\n     * Scope        Public\r\n     * @param       {string}    optionName  Name of option\r\n     * @param       {*=}        dflt        Default value of option\r\n     * @return      {*}               \r\n     * Description  Returns value of named option\r\n     */  \r\n    getOption(optionName:string, dflt:any): any {\r\n      if(optionName in this.keyman.options) {\r\n        return this.keyman.options[optionName]; \r\n      } else if(arguments.length > 1) {\r\n        return dflt;\r\n      } else {\r\n        return '';\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function     setOption\r\n     * Scope        Public\r\n     * @param       {string}    optionName  Name of option\r\n     * @param       {*=}        value       Value of option\r\n     * Description  Sets value of named option\r\n     */  \r\n    setOption(optionName,value) {\r\n      this.keyman.options[optionName] = value;\r\n    }\r\n    \r\n    /**\r\n     * Function     getAbsoluteX\r\n     * Scope        Public\r\n     * @param       {Object}    Pobj        HTML element\r\n     * @return      {number}               \r\n     * Description  Returns x-coordinate of Pobj element absolute position with respect to page\r\n     */\r\n    _GetAbsoluteX(Pobj: HTMLElement): number { // I1476 - Handle SELECT overlapping END\r\n      var Lobj: HTMLElement\r\n\r\n      if(!Pobj) {\r\n        return 0;\r\n      }\r\n      \r\n      var Lcurleft = Pobj.offsetLeft ? Pobj.offsetLeft : 0;\r\n      Lobj = Pobj;   \t// I2404 - Support for IFRAMEs\r\n\r\n      if (Lobj.offsetParent) {\r\n        while (Lobj.offsetParent) {\r\n          Lobj = Lobj.offsetParent as HTMLElement;\r\n          Lcurleft += Lobj.offsetLeft;\r\n        }\r\n      }\r\n      // Correct position if element is within a frame (but not if the controller is in document within that frame)\r\n      if(Lobj && Lobj.ownerDocument && (Pobj.ownerDocument != this.keyman._MasterDocument)) {\r\n        var Ldoc=Lobj.ownerDocument;   // I2404 - Support for IFRAMEs\r\n\r\n        if(Ldoc && Ldoc.defaultView && Ldoc.defaultView.frameElement) {\r\n          return Lcurleft + this._GetAbsoluteX(<HTMLElement>Ldoc.defaultView.frameElement) - Ldoc.documentElement.scrollLeft;\r\n        }\r\n      }\r\n      return Lcurleft;\r\n    }\r\n\r\n    getAbsoluteX = this._GetAbsoluteX;\r\n\r\n    /**\r\n     * Function     getAbsoluteY\r\n     * Scope        Public\r\n     * @param       {Object}    Pobj        HTML element\r\n     * @return      {number}               \r\n     * Description  Returns y-coordinate of Pobj element absolute position with respect to page\r\n     */  \r\n    _GetAbsoluteY(Pobj: HTMLElement): number {\r\n      var Lobj: HTMLElement\r\n\r\n      if(!Pobj) {\r\n        return 0;\r\n      }\r\n      var Lcurtop = Pobj.offsetTop ? Pobj.offsetTop : 0;\r\n      Lobj = Pobj;  // I2404 - Support for IFRAMEs\r\n\r\n      if (Lobj.ownerDocument && Lobj instanceof Lobj.ownerDocument.defaultView.HTMLElement) {\r\n        while (Lobj.offsetParent) {\r\n          Lobj = Lobj.offsetParent as HTMLElement;\r\n          Lcurtop += Lobj.offsetTop;\r\n        }\r\n      }\r\n\r\n      // Correct position if element is within a frame (but not if the controller is in document within that frame)\r\n      if(Lobj && Lobj.ownerDocument && (Pobj.ownerDocument != this.keyman._MasterDocument)) {\r\n        var Ldoc=Lobj.ownerDocument;   // I2404 - Support for IFRAMEs\r\n\r\n        if(Ldoc && Ldoc.defaultView && Ldoc.defaultView.frameElement) {\r\n          return Lcurtop + this._GetAbsoluteY(<HTMLElement>Ldoc.defaultView.frameElement) - Ldoc.documentElement.scrollTop;\r\n        }\r\n      }\r\n      return Lcurtop;\r\n    }\r\n\r\n    getAbsoluteY = this._GetAbsoluteY;\r\n\r\n    /**\r\n     * Function     getAbsolute\r\n     * Scope        Public\r\n     * @param       {Object}    Pobj        HTML element\r\n     * @return      {Object.<string,number>}               \r\n     * Description  Returns absolute position of Pobj element with respect to page\r\n     */  \r\n    _GetAbsolute(Pobj: HTMLElement) {\r\n      var p={\r\n        /* @ export */\r\n        x: this._GetAbsoluteX(Pobj),\r\n        /* @ export */\r\n        y: this._GetAbsoluteY(Pobj)\r\n      };\r\n      return p;\r\n    }\r\n\r\n    getAbsolute = this._GetAbsolute;\r\n    \r\n    /**\r\n     * Select start handler (to replace multiple inline handlers) (Build 360)  \r\n     */\r\n    selectStartHandler = function() {\r\n      return false;\r\n    }\r\n\r\n    /**\r\n     * Default mouse down event handler (to replace multiple inline handlers) (Build 360)   \r\n     */\r\n    mouseDownPreventDefaultHandler(e: MouseEvent) {\r\n      if(e) {\r\n        e.preventDefault();\r\n      }\r\n    }\r\n\r\n    // Found a bit of magic formatting that allows dynamic return typing for a specified element tag!\r\n    _CreateElement<E extends \"style\"|\"script\"|\"div\"|\"canvas\"|\"span\">(nodeName:E) {\r\n      var e = document.createElement<E>(nodeName);\r\n\r\n      // Make element unselectable (Internet Explorer)\r\n      if (typeof e.onselectstart != 'undefined') { //IE route\r\n        e.onselectstart=this.selectStartHandler; // Build 360\r\n      } else { // And for well-behaved browsers (may also work for IE9+, but not necessary)\r\n        e.style.MozUserSelect=\"none\";\r\n        e.style.KhtmlUserSelect=\"none\";\r\n        e.style.UserSelect=\"none\";\r\n        e.style.WebkitUserSelect=\"none\";\r\n      }    \r\n      return e;\r\n    }\r\n\r\n    createElement = this._CreateElement;\r\n                \r\n    /**\r\n     * Function     getIEVersion\r\n     * Scope        Public\r\n     * @return      {number}               \r\n     * Description  Return IE version number (or 999 if browser not IE)\r\n     */       \r\n    getIEVersion() {\r\n      return Device._GetIEVersion();\r\n    }\r\n\r\n    getFontSizeStyle(e: HTMLElement|string): {val: number, absolute: boolean} {\r\n      var val: number;\r\n      var fs: string;\r\n\r\n      if(typeof e == 'string') {\r\n        fs = e;\r\n      } else {\r\n        fs = e.style.fontSize;\r\n      }\r\n\r\n      if(fs.indexOf('em') != -1) {\r\n        val = parseFloat(fs.substr(0, fs.indexOf('em')));\r\n        return {val: val, absolute: false};\r\n      } else if(fs.indexOf('px') != -1) {\r\n        val = parseFloat(fs.substr(0, fs.indexOf('px')));\r\n        return {val: val, absolute: true};\r\n      } else if(fs.indexOf('%') != -1) {\r\n        val = parseFloat(fs.substr(0, fs.indexOf('%')));\r\n        return {val: val/100, absolute: false};\r\n      } else {\r\n        // Cannot parse.\r\n        return null;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Get browser-independent computed style value for element\r\n     * \r\n     * @param       {Element}     e             HTML element\r\n     * @param       {string}      s             CSS style name \r\n     * @return      {*}               \r\n     */       \r\n    getStyleValue(e:HTMLElement, s:string) { \r\n      // Build 349: error trap added, since on iOS, getPropertyValue may fail \r\n      // and crash in some cases, possibly if passed a text node \r\n      try  \r\n      {\r\n        if(e && (typeof(window.getComputedStyle) != 'undefined')) {\r\n            return window.getComputedStyle(e,'').getPropertyValue(s);\r\n        }\r\n      }    \r\n      catch(ex){}\r\n      \r\n      // Return empty string if unable to get style value\r\n      return '';\r\n    }    \r\n\r\n    /**\r\n     * Get browser-independent computed style integer value for element  (Build 349)\r\n     * \r\n     * @param       {Element}     e             HTML element\r\n     * @param       {string}      s             CSS style name \r\n     * @param       {number=}     d             default value if NaN   \r\n     * @return      {number}                    integer value of style\r\n     */       \r\n    getStyleInt(e: HTMLElement, s: string, d:number): number {\r\n      var x=parseInt(this.getStyleValue(e,s),10);\r\n      if(!isNaN(x)) {\r\n        return x;\r\n      }\r\n      \r\n      // Return the default value if numeric, else 0 \r\n      if(typeof(d) == 'number') {\r\n        return d; \r\n      } else {\r\n        return 0;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Expose the touchable state for UIs - will disable external UIs entirely\r\n     **/      \r\n    isTouchDevice(): boolean {\r\n      return this.device.touchable;\r\n    }\r\n    \r\n    /**\r\n     * Get orientation of tablet or phone  display\r\n     *    \r\n     * @return      {boolean}               \r\n     */       \r\n    portraitView() { // new for I3363 (Build 301)\r\n      return !this.landscapeView();\r\n    }\r\n    \r\n    /**\r\n     * Get orientation of tablet or phone  display\r\n     *    \r\n     * @return      {boolean}               \r\n     */       \r\n    landscapeView(): boolean\t{ // new for I3363 (Build 301)\r\n      var orientation: number;\r\n\r\n      // Assume portrait mode if orientation undefined\r\n      if(typeof window.orientation != 'undefined') { // Used by iOS Safari\r\n        // Else landscape for +/-90, portrait for 0, +/-180   \r\n        orientation = window.orientation as number;\r\n      } else if(typeof window.screen.orientation != 'undefined') { // Used by Firefox, Chrome\r\n        orientation = window.screen.orientation.angle;\r\n      }\r\n      \r\n      if(orientation !== undefined) {\r\n        return (Math.abs(orientation/90) == 1); \r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n    \r\n    /**\r\n     * Get viewport scale factor for this document\r\n     *    \r\n     * @return      {number}               \r\n     */       \r\n    getViewportScale(): number {\r\n      // This can sometimes fail with some browsers if called before document defined,\r\n      // so catch the exception\r\n      try {\r\n        // Get viewport width\r\n        var viewportWidth = document.documentElement.clientWidth;\r\n\r\n        // Return a default value if screen width is greater than the viewport width (not fullscreen). \r\n        if(screen.width > viewportWidth) {\r\n          return 1;\r\n        }\r\n        \r\n        // Get the orientation corrected screen width \r\n        var screenWidth = screen.width;\r\n        if(this.landscapeView()) {\r\n          // Take larger of the two dimensions\r\n          if(screen.width < screen.height) {\r\n            screenWidth = screen.height;\r\n          }\r\n        } else {\r\n          // Take smaller of the two dimensions\r\n          if(screen.width > screen.height) {\r\n            screenWidth = screen.height;\r\n          }\r\n        }\r\n        // Calculate viewport scale\r\n        return Math.round(100*screenWidth / window.innerWidth)/100;\r\n      } catch(ex) {\r\n        return 1;\r\n      }\r\n    }\r\n    \r\n    /**\r\n     * Return height of URL bar on mobile devices, if visible\r\n     * TODO: This does not seem to be right, so is not currently used   \r\n     *    \r\n     * @return      {number}               \r\n     */       \r\n    barHeight(): number {\r\n      var dy=0;\r\n      if(this.device.formFactor == 'phone') {\r\n        dy=screen.height/2-window.innerHeight-(this.landscapeView() ? this.device.dyLandscape: this.device.dyPortrait);\r\n      }\r\n      return dy;\r\n    }\r\n    \r\n    /**\r\n     * Function     _EncodeEntities\r\n     * Scope        Private\r\n     * @param       {string}      P_txt         string to be encoded\r\n     * @return      {string}                    encoded (html-safe) string               \r\n     * Description Encode angle brackets and ampersand in text string\r\n     */       \r\n    _EncodeEntities(P_txt: string): string {\r\n      return P_txt.replace('&','&amp;').replace('<','&lt;').replace('>','&gt;');  // I1452 part 2\r\n    }  \r\n\r\n    /**\r\n     * Function     createShim\r\n     * Scope        Public  \r\n     * Description  [Deprecated] Create an IFRAME element to go between KMW and drop down (to fix IE6 bug)\r\n     * @deprecated\r\n     */    \r\n    createShim(): void {    // I1476 - Handle SELECT overlapping BEGIN\r\n      console.warn(\"The util.createShim function is deprecated, as its old functionality is no longer needed.  \" +\r\n        \"It and references to its previously-produced shims may be safely removed.\");\r\n      return;\r\n    }\r\n\r\n    // I1476 - Handle SELECT overlapping BEGIN\r\n    \r\n    /**\r\n     * Function     showShim\r\n     * Scope        Public\r\n     * @param       {Object}      Pvkbd         Visual keyboard DIV element \r\n     * @param       {Object}      Pframe        IFRAME shim element\r\n     * @param       {Object}      Phelp         OSK Help DIV element               \r\n     * Description  [Deprecated] Display iFrame under OSK at its currently defined position, to allow OSK to overlap SELECT elements (IE6 fix)  \r\n     * @deprecated\r\n     */    \r\n    showShim(Pvkbd: HTMLElement, Pframe: HTMLElement, Phelp: HTMLElement) {\r\n      console.warn(\"The util.showShim function is deprecated, as its old functionality is no longer needed.  It may be safely removed.\");\r\n    }\r\n\r\n    /**\r\n     * Function     hideShim\r\n     * Scope        Public\r\n     * @param       {Object}      Pframe        IFRAME shim element\r\n     * Description  [Deprecated] Hide iFrame shim containing OSK\r\n     * @deprecated\r\n     */    \r\n    hideShim(Pframe: HTMLElement) {\r\n      console.warn(\"The util.hideShim function is deprecated, as its old functionality is no longer needed.  It may be safely removed.\"); \r\n    }\r\n\r\n    /**\r\n     * Function     rgba\r\n     * Scope        Public\r\n     * @param       {Object}      s           element style object\r\n     * @param       {number}      r           red value, 0-255\r\n     * @param       {number}      g           green value, 0-255\r\n     * @param       {number}      b           blue value, 0-255\r\n     * @param       {number}      a           opacity value, 0-1.0\r\n     * @return      {string}                  background colour style string\r\n     * Description  Browser-independent alpha-channel management\r\n     */       \r\n    rgba(s: HTMLStyleElement, r:number, g:number, b:number, a:number): string {\r\n      var bgColor='transparent';\r\n      try {\r\n        bgColor='rgba('+r+','+g+','+b+','+a+')';\r\n      } catch(ex) {\r\n        bgColor='rgb('+r+','+g+','+b+')';\r\n      }    \r\n\r\n      return bgColor;\r\n    }\r\n    \r\n    /**\r\n     * Add a stylesheet to a page programmatically, for use by the OSK, the UI or the page creator \r\n     * \r\n     * @param       {string}        s             style string\r\n     * @return      {Object}                      returns the object reference\r\n     **/      \r\n    addStyleSheet(s: string): HTMLStyleElement {\r\n      var _ElemStyle: HTMLStyleElement = <HTMLStyleElement>document.createElement<'style'>('style'); \r\n\r\n      _ElemStyle.type = 'text/css';\r\n      _ElemStyle.appendChild(document.createTextNode(s));\r\n\r\n      var _ElemHead=document.getElementsByTagName('HEAD'); \r\n      if(_ElemHead.length > 0) {\r\n        _ElemHead[0].appendChild(_ElemStyle);\r\n      } else {\r\n        document.body.appendChild(_ElemStyle); // Won't work on Chrome, ah well\r\n      }\r\n\r\n      this.linkedStylesheets.push(_ElemStyle);\r\n\r\n      return _ElemStyle;\r\n    }\r\n\r\n    /**\r\n     * Remove a stylesheet element\r\n     * \r\n     * @param       {Object}        s             style sheet reference\r\n     * @return      {boolean}                     false if element is not a style sheet\r\n     **/      \r\n    removeStyleSheet(s: HTMLStyleElement) {\r\n      if(s == null || typeof(s) != 'object') {\r\n        return false;\r\n      }\r\n\r\n      if(s.nodeName != 'STYLE') {\r\n        return false;\r\n      }\r\n\r\n      if(typeof(s.parentNode) == 'undefined' || s.parentNode == null) {\r\n        return false;\r\n      }\r\n\r\n      s.parentNode.removeChild(s);\r\n      return true;\r\n    }\r\n\r\n    /**\r\n     * Add a reference to an external stylesheet file\r\n     * \r\n     * @param   {string}  s   path to stylesheet file\r\n     */      \r\n    linkStyleSheet(s: string): void {\r\n      var headElements=document.getElementsByTagName('head');\r\n      if(headElements.length > 0) {\r\n        var linkElement=document.createElement('link');\r\n        linkElement.type='text/css';\r\n        linkElement.rel='stylesheet';\r\n        linkElement.href=s;\r\n        this.linkedStylesheets.push(linkElement);\r\n        headElements[0].appendChild(linkElement);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Add a stylesheet with a font-face CSS descriptor for the embedded font appropriate \r\n     * for the browser being used\r\n     *      \r\n     * @param    {Object}  fd  keymanweb font descriptor\r\n     **/\r\n    addFontFaceStyleSheet(fd: any) { // TODO:  Font descriptor object needs definition!\r\n      // Test if a valid font descriptor\r\n      if(typeof(fd) == 'undefined') return;\r\n\r\n      if(typeof(fd['files']) == 'undefined') fd['files']=fd['source'];                                       \r\n      if(typeof(fd['files']) == 'undefined') return;\r\n\r\n      var i,ttf='',woff='',eot='',svg='',fList=[];\r\n      \r\n  // TODO: 22 Aug 2014: check that font path passed from cloud is actually used!\r\n      \r\n      // Do not add a new font-face style sheet if already added for this font\r\n      for(i=0; i<this.embeddedFonts.length; i++) {\r\n        if(this.embeddedFonts[i] == fd['family']) {\r\n          return;\r\n        }\r\n      }\r\n      \r\n      if(typeof(fd['files']) == 'string') {\r\n        fList[0]=fd['files'];\r\n      } else {\r\n        fList=fd['files'];\r\n      }\r\n      \r\n      for(i=0;i<fList.length;i++) {\r\n        if(fList[i].toLowerCase().indexOf('.ttf') > 0) ttf=fList[i];\r\n        if(fList[i].toLowerCase().indexOf('.woff') > 0) woff=fList[i];\r\n        if(fList[i].toLowerCase().indexOf('.eot') > 0) eot=fList[i];\r\n        if(fList[i].toLowerCase().indexOf('.svg') > 0) svg=fList[i];\r\n      }\r\n\r\n      // Font path qualified to support page-relative fonts (build 347)\r\n      if(ttf != '' && (ttf.indexOf('/') < 0))  {\r\n        ttf = this.keyman.options['fonts']+ttf;\r\n      }\r\n\r\n      if(woff != '' && (woff.indexOf('/') < 0)) {\r\n        woff = this.keyman.options['fonts']+woff;\r\n      }\r\n\r\n      if(eot != '' && (eot.indexOf('/') < 0)) {\r\n      eot = this.keyman.options['fonts']+eot;\r\n      }\r\n\r\n      if(svg != '' && (svg.indexOf('/') < 0)) {\r\n        svg = this.keyman.options['fonts']+svg;\r\n      }\r\n\r\n      // Build the font-face definition according to the browser being used\r\n      var s='@font-face {\\nfont-family:'\r\n        +fd['family']+';\\nfont-style:normal;\\nfont-weight:normal;\\n';\r\n      \r\n      // Detect if Internet Explorer and version if so\r\n      var IE=Device._GetIEVersion(); \r\n      \r\n      // Build the font source string according to the browser, \r\n      // but return without adding the style sheet if the required font type is unavailable\r\n      \r\n      // Modern browsers: use WOFF, TTF and fallback finally to SVG. Don't provide EOT\r\n      if(IE >= 9) {\r\n        if(this.device.OS == 'iOS') {       \r\n          if(ttf != '') { \r\n            // Modify the url if required to prevent caching  \r\n            ttf = this.unCached(ttf);  \r\n            s=s+'src:url(\\''+ttf+'\\') format(\\'truetype\\');';\r\n          } else {\r\n            return;\r\n          }\r\n        } else {\r\n          var s0 = [];\r\n          \r\n          if(this.device.OS == 'Android') {\r\n            // Android 4.2 and 4.3 have bugs in their rendering for some scripts \r\n            // with embedded ttf or woff.  svg mostly works so is a better initial\r\n            // choice on the Android browser.\r\n            if(svg != '') {\r\n              s0.push(\"url('\"+svg+\"') format('svg')\");\r\n            }\r\n\r\n            if(woff != '') {\r\n              s0.push(\"url('\"+woff+\"') format('woff')\");\r\n            }\r\n\r\n            if(ttf != '') {\r\n              s0.push(\"url('\"+ttf+\"') format('truetype')\");\r\n            }\r\n          } else {\r\n            if(woff != '') {\r\n              s0.push(\"url('\"+woff+\"') format('woff')\");\r\n            }\r\n\r\n            if(ttf != '') {\r\n              s0.push(\"url('\"+ttf+\"') format('truetype')\");\r\n            }\r\n\r\n            if(svg != '') {\r\n              s0.push(\"url('\"+svg+\"') format('svg')\");\r\n            }\r\n          }\r\n\r\n          if(s0.length == 0) {\r\n            return;\r\n          }\r\n          \r\n          s += 'src:'+s0.join(',')+';';\r\n        }\r\n      } else { // IE 6-8\r\n        if(eot != '') {\r\n          s=s+'src:url(\\''+eot+'\\');';\r\n        } else {\r\n          return;\r\n        }\r\n      }\r\n\r\n      s=s+'\\n}\\n';    \r\n    \r\n      this.addStyleSheet(s);\r\n      this.embeddedFonts.push(fd['family']);\r\n    }\r\n    \r\n    /**\r\n     * Allow forced reload if necessary (stub only here)\r\n     *    \r\n     *  @param  {string}  s unmodified URL\r\n     *  @return {string}    modified URL         \r\n     */\r\n    unCached(s: string): string {\r\n      // var t=(new Date().getTime());\r\n      // s = s + '?v=' + t;\r\n      return s;\r\n    }       \r\n    \r\n    /**\r\n     * Document cookie parsing for use by kernel, OSK, UI etc.\r\n     * \r\n     * @param       {string=}       cn        cookie name (optional)\r\n     * @return      {Object}                  array of names and strings, or array of variables and values\r\n     */      \r\n    loadCookie(cn?: string) {\r\n      var v={};\r\n      if(arguments.length > 0) {\r\n        var cx = this.loadCookie();\r\n        for(var t in cx) {\r\n          if(t == cn) {\r\n            var d = decodeURIComponent(cx[t]).split(';');\r\n            for(var i=0; i<d.length; i++) {\r\n              var xc = d[i].split('=');\r\n              if(xc.length > 1) {\r\n                v[xc[0]] = xc[1];\r\n              } else {\r\n                v[xc[0]] = '';\r\n              }\r\n            }\r\n          }\r\n        } \r\n      } else { \r\n        if(typeof(document.cookie) != 'undefined' && document.cookie != '') {\r\n          var c = document.cookie.split(/;\\s*/);\r\n          for(var i = 0; i < c.length; i++) {\r\n            var d = c[i].split('=');\r\n            if(d.length == 2) {\r\n              v[d[0]] = d[1];\r\n            }\r\n          }\r\n        }\r\n      }\r\n      return v;\r\n    }\r\n    \r\n    /**\r\n     * Standard cookie saving for use by kernel, OSK, UI etc.\r\n     * \r\n     * @param       {string}      cn            name of cookie\r\n     * @param       {Object}      cv            object with array of named arguments and values\r\n     */      \r\n    saveCookie(cn: string, cv) {\r\n      var s='';\r\n      for(var v in cv) {\r\n        s = s + v+'='+cv[v]+\";\";\r\n      }\r\n\r\n      var d = new Date(new Date().valueOf() + 1000 * 60 * 60 * 24 * 30).toUTCString();\r\n      document.cookie = cn+'='+encodeURIComponent(s)+'; path=/; expires='+d;//Fri, 31 Dec 2099 23:59:59 GMT;';\r\n    }\r\n    \r\n    /**\r\n     * Function     toNumber\r\n     * Scope        Public\r\n     * @param       {string}      s            numeric string\r\n     * @param       {number}      dflt         default value\r\n     * @return      {number}               \r\n     * Description  Return string converted to integer or default value\r\n     */       \r\n    toNumber(s: string, dflt: number): number {\r\n      var x = parseInt(s,10);\r\n      return isNaN(x) ? dflt : x;\r\n    }\r\n\r\n    /**\r\n     * Function     toNumber\r\n     * Scope        Public\r\n     * @param       {string}      s            numeric string\r\n     * @param       {number}      dflt         default value\r\n     * @return      {number}               \r\n     * Description  Return string converted to real value or default value\r\n     */       \r\n    toFloat(s: string, dflt: number): number {\r\n      var x = parseFloat(s);\r\n      return isNaN(x) ? dflt : x;\r\n    }\r\n    \r\n    /**\r\n     * Function     toNzString\r\n     * Scope        Public\r\n     * @param       {*}           item         variable to test\r\n     * @param       {?*=}         dflt         default value\r\n     * @return      {*}               \r\n     * Description  Test if a variable is null, false, empty string, or undefined, and return as string\r\n     */\r\n    nzString(item: any, dflt: any): string {\r\n      var dfltValue = '';\r\n      if(arguments.length > 1) {\r\n        dfltValue = dflt;\r\n      }\r\n\r\n      if(typeof(item) == 'undefined') {\r\n        return dfltValue;\r\n      }\r\n\r\n      if(item == null) {\r\n        return dfltValue;\r\n      }\r\n\r\n      if(item == 0 || item == '') {\r\n        return dfltValue;\r\n      }\r\n\r\n      return ''+item;\r\n    }\r\n\r\n    /**\r\n     * Function     deepCopy\r\n     * Scope        Private\r\n     * @param       {Object}      p           object to copy\r\n     * @param       {Array=}      c0          array member being copied\r\n     * @return      {Object}                  clone ('deep copy') of object\r\n     * Description  Makes an actual copy (not a reference) of an object, copying simple members, \r\n     *              arrays and member objects but not functions, so use with care!\r\n     */              \r\n    deepCopy<T>(p:T, c0): T {\r\n      var c = c0 || {};\r\n      for (var i in p) {\r\n        if(typeof p[i] === 'object') {\r\n          c[i] = (p[i].constructor === Array ) ? [] : {};\r\n          this.deepCopy(p[i],c[i]);\r\n        } \r\n        else {\r\n          c[i] = p[i];\r\n        }\r\n      }\r\n\r\n      return c;\r\n    }\r\n\r\n    /**\r\n     * Return the event target for any browser\r\n     *    \r\n     * @param       {Event}      e        event\r\n     * @return      {Object}              HTML element\r\n     */       \r\n    eventTarget(e: Event): EventTarget {\r\n      if(!e) {\r\n        return null;\r\n      } else if (e.target) {       // most browsers\r\n        return e.target;\r\n      } else if (e.srcElement) {\r\n        return e.srcElement;\r\n      } else if(window.event) { //IE 8 (and earlier)\r\n        return window.event.srcElement;\r\n      } else {\r\n        return null;            // shouldn't happen!\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Return the event type for any browser\r\n     *    \r\n     * @param       {Event}      e        event\r\n     * @return      {string}              type of event\r\n     */       \r\n    eventType(e: Event): string {\r\n      if(e && e.type) {         // most browsers\r\n        return e.type;\r\n      } else if(window.event) { // IE 8 (and earlier)\r\n        return window.event.type;\r\n      } else {\r\n        return '';              // shouldn't happen!\r\n      }\r\n    }\r\n    \r\n    /**\r\n     * Customized alert \r\n     *    \r\n     * @param     {string}        s       alert text\r\n     * @param     {function()=}   fn      function to call when alert dismissed\r\n     */       \r\n    alert(s: string, fn?: () => void): void {\r\n      var bg = this.waiting, nn=bg.firstChild.childNodes;\r\n      (nn[0] as HTMLElement).style.display='block';\r\n      (nn[1] as HTMLElement).className='kmw-alert-text'; \r\n      (nn[1] as HTMLElement).innerHTML=s;\r\n      (nn[2] as HTMLElement).style.display='none';\r\n      bg.style.display='block';\r\n      if(arguments.length > 1) {\r\n        bg.dismiss=fn;\r\n      } else {\r\n        bg.dismiss=null;\r\n      }\r\n    }\r\n\r\n    // Stub definition to be fleshed out depending upon native/embedded mode.\r\n    wait(s: string|boolean): void {\r\n\r\n    }\r\n    \r\n    /**\r\n     *  Prepare the background and keyboard loading wait message box\r\n     *  Should not be called before options are defined during initialization\r\n     **/           \r\n    prepareWait(): void { \r\n      var bg: HTMLDivElement = <HTMLDivElement>document.createElement('DIV'),\r\n          lb=document.createElement('DIV'),\r\n          lt=document.createElement('DIV'),    \r\n          gr=document.createElement('DIV'),\r\n          bx=document.createElement('DIV');\r\n\r\n      bg.className='kmw-wait-background';\r\n      lb.className='kmw-wait-box';\r\n      bg.dismiss=null;\r\n      lt.className='kmw-wait-text';\r\n      gr.className='kmw-wait-graphic';\r\n      bx.className='kmw-alert-close';\r\n\r\n      // Close alert if anywhere in box is touched, since close box is too small on mobiles \r\n      lb.onmousedown=lb.onclick=function(e) {\r\n        // Ignore if waiting, only handle for alert\r\n        if(bx.style.display == 'block') {\r\n          bg.style.display='none';\r\n          if(bg.dismiss) {\r\n            bg.dismiss();\r\n          }\r\n        }\r\n      };\r\n\r\n      lb.addEventListener('touchstart', lb.onclick, false);\r\n      bg.onmousedown=bg.onclick=function(e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      \r\n      }\r\n      bg.addEventListener('touchstart', bg.onclick, false);\r\n      lb.appendChild(bx);\r\n      lb.appendChild(lt);\r\n      lb.appendChild(gr);\r\n      bg.appendChild(lb);\r\n      document.body.appendChild(bg);\r\n      this.waiting=bg;    \r\n    }\r\n\r\n    shutdown() {\r\n      // Remove all event-handler references rooted in KMW events.\r\n      this.events = {};\r\n\r\n      // Remove all events linking to elements of the original, unaltered page.\r\n      // This should sever any still-existing page ties to this instance of KMW,\r\n      // allowing browser GC to do its thing.\r\n      for(let event of this.domEvents) {\r\n        this.detachDOMEvent(event.Pelem, event.Peventname, event.Phandler, event.PuseCapture);\r\n      }\r\n\r\n      // Remove any KMW-added DOM element clutter.\r\n      this.waiting.parentNode.removeChild(this.waiting);\r\n\r\n      for(let ss of this.linkedStylesheets) {\r\n        if(ss.remove) {\r\n          ss.remove();\r\n        } else if(ss.parentNode) {\r\n          ss.parentNode.removeChild(ss);\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Get path of keymanweb script, for relative references\r\n     * \r\n     * *** This is not currently used, but may possibly be needed if ***\r\n     * *** script identification during loading proves unreliable.   ***         \r\n     *\r\n     *  @param    {string}      sName   filename prefix  \r\n     *  @return   {string}      path to source, with trailing slash\r\n    **/           \r\n    myPath(sName: string): string {\r\n      var i, scripts=document.getElementsByTagName('script'), ss;\r\n      \r\n      for(i=0; i<scripts.length; i++) {\r\n        ss=scripts[i];\r\n        if(ss.src.indexOf(sName) >= 0) {\r\n          return ss.src.substr(0,ss.src.lastIndexOf('/')+1);\r\n        }\r\n      }\r\n\r\n      return '';\r\n    }\r\n\r\n    // Prepend the appropriate protocol if not included in path\r\n    prependProtocol(path: string): string {\r\n      var pattern = new RegExp('^https?:');\r\n    \r\n      if(pattern.test(path)) {\r\n        return path;\r\n      } else if(path.substr(0,2) == '//') {\r\n        return this.keyman.protocol+path;\r\n      } else if(path.substr(0,1) == '/') {\r\n        return this.keyman.protocol+'/'+path;\r\n      } else {\r\n        return this.keyman.protocol+'//'+path;\r\n      }  \r\n    }\r\n    \r\n    /**\r\n     * Return the appropriate test string for a given font\r\n     * \r\n     * TODO: Tidy up and remove arrays once 'sample' included in font metadata\r\n     * \r\n     *  @param  {Object}    fd    font meta-data object\r\n     *  @return {string}          string to compare width\r\n     *\r\n     */                   \r\n    testString(fd): string {\r\n      var fontName=fd['family'], \r\n      i,s='BESbswy';\r\n\r\n      if('sample' in fd && typeof(fd['sample']) == 'string') {\r\n        return s+fd['sample'];\r\n      }\r\n\r\n      var f=['TamilWeb','TibetanWeb','LatinWeb','CherokeeWeb',    \r\n            'EgyptianWeb','SinhalaWeb','KhmerWeb','ArabicWeb',\r\n            'BurmeseWeb','LaoWeb','OriyaWeb','GeezWeb'],\r\n          t=['\\u0BBE\\u0BF5','\\u0F7F\\u0FD0','\\u02B0\\u02A4','\\u13D0\\u13C9',\r\n            '\\uA723\\uF7D3','\\u0DD8\\u0DA3','\\u17D6\\u178E','\\u0639\\u06B3',\r\n            '\\u1038\\u1024','\\u0EC0\\u0EDD','\\u0B03\\u0B06','\\u1361\\u132C'];\r\n\r\n      for(i=0; i<f.length; i++) {\r\n        if(fontName == f[i]) {\r\n          return s+t[i];\r\n        }\r\n      }\r\n\r\n      return s; \r\n    }\r\n\r\n    /**\r\n     * Test if a font is installed (or available) on the target platform\r\n     *    \r\n     * @param       {Object}        fd    font structure\r\n     * @return      {boolean}             true if font available\r\n     */       \r\n    checkFont(fd): boolean {\r\n      var fontReady=false, fontName=fd['family'];\r\n      \r\n      // Create an absolute positioned div and two paragraph elements with spans for the test string.\r\n      // The paragraph elements ensure that the spans are measured from the same point, otherwise\r\n      // pixel rounding can result in different widths for the same string and styles.\r\n      // Using a separate invisible DIV is more reliable than other positioning.\r\n      var d=document.createElement('DIV'), ds=d.style,\r\n          p1=document.createElement('P'),\r\n          p2=document.createElement('P'),\r\n          t1=document.createElement('SPAN'), s1=t1.style,\r\n          t2=document.createElement('SPAN'), s2=t2.style;\r\n\r\n      ds.position='absolute';\r\n      ds.top='10px';\r\n      ds.left='10px';\r\n      ds.visibility='hidden';\r\n      document.body.appendChild(d);\r\n      d.appendChild(p1);\r\n      d.appendChild(p2); \r\n      p1.appendChild(t1);\r\n      p2.appendChild(t2); \r\n\r\n      // Firefox fails without the !important prefix on the fallback font, \r\n      // apparently applying the same font to both elements.\r\n      // But it also fails to distinguish the two if !important is added to the test font!  \r\n      // *** TODO: See if still true after changes Dec 2013 *** \r\n      // Must apply !important tag to font-family, but must apply it to the CSS style, not the JS object member\r\n      // c.f. http://stackoverflow.com/questions/462537/overriding-important-style-using-javascript \r\n      t1.setAttribute('style','font-family:monospace !important');\r\n      s2.fontFamily=fontName+',monospace'; \r\n      s1.fontSize=s2.fontSize='24px';      // Not too large, to avoid wrapping or overflow \r\n      \r\n      // Include narrow and wide characters from each unique script\r\n      t1.innerHTML=t2.innerHTML=this.testString(fd); \r\n      \r\n      // Compare the actual width of each span. Checking monospace, serif, \r\n      // and sans-serif helps to avoid falsely reporting the font as ready\r\n      // The width must be different for all three tests.\r\n      if(t1.offsetWidth != t2.offsetWidth) { \r\n        t1.setAttribute('style','font-family:sans-serif !important');\r\n        s2.fontFamily=fontName+',sans-serif';\r\n        if(t1.offsetWidth != t2.offsetWidth) {\r\n          t1.setAttribute('style','font-family:serif !important');\r\n          s2.fontFamily=fontName+',serif';        \r\n        }\r\n      }\r\n\r\n      fontReady=(t1.offsetWidth != t2.offsetWidth);\r\n      \r\n      // Delete test elements\r\n      p1.removeChild(t1);\r\n      p2.removeChild(t2);\r\n      d.removeChild(p1);\r\n      d.removeChild(p2);\r\n      document.body.removeChild(d);\r\n\r\n      return fontReady;\r\n    }\r\n\r\n    /**\r\n     * Check a font descriptor for font availability, returning true if undefined\r\n     * \r\n     *  @param  {Object}  fd  font descriptor member of keyboard stub\r\n     *  @return {boolean}           \r\n     **/\r\n    checkFontDescriptor(fd): boolean {  \r\n      if(typeof(fd) == 'undefined' || typeof(fd['family']) != 'string') {\r\n        return true;\r\n      }\r\n\r\n      return this.checkFont(fd);\r\n    }\r\n\r\n    /**\r\n     * Checks the type of an input DOM-related object while ensuring that it is checked against the correct prototype,\r\n     * as class prototypes are (by specification) scoped upon the owning Window.\r\n     * \r\n     * See https://stackoverflow.com/questions/43587286/why-does-instanceof-return-false-on-chrome-safari-and-edge-and-true-on-firefox\r\n     * for more details.\r\n     * \r\n     * @param {Element|Event}   Pelem       An element of the web page or one of its IFrame-based subdocuments.\r\n     * @param {string}          className   The plain-text name of the expected Element type.\r\n     * @return {boolean}\r\n     */\r\n    static instanceof(Pelem: Event|EventTarget, className: string): boolean {\r\n      var scopedClass;\r\n\r\n      if (Pelem['Window']) { // Window objects contain the class definitions for types held within them.  So, we can check for those.\r\n        return className == 'Window';\r\n      } else if (Pelem['defaultView']) { // Covers Document.\r\n        scopedClass = Pelem['defaultView'][className];\r\n      } else if(Pelem['ownerDocument']) {\r\n        scopedClass = (Pelem as Node).ownerDocument.defaultView[className];\r\n      } else if(Pelem['target']) {\r\n        var event = Pelem as Event;\r\n\r\n        if(this.instanceof(event.target, 'Window')) {\r\n          scopedClass = event.target[className]; \r\n        } else if(this.instanceof(event.target, 'Document')) {\r\n          scopedClass = (event.target as Document).defaultView[className];\r\n        } else if(this.instanceof(event.target, 'HTMLElement')) {\r\n          scopedClass = (event.target as HTMLElement).ownerDocument.defaultView[className];\r\n        }\r\n      }\r\n\r\n      if(scopedClass) {\r\n        return Pelem instanceof scopedClass;\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nimport Util = com.keyman.Util;","/// <reference path=\"kmwexthtml.ts\" />  // Includes KMW-added property declaration extensions for HTML elements.\r\n/// <reference path=\"kmwtypedefs.ts\" /> // Includes type definitions for basic KMW types.\r\n/// <reference path=\"kmwbase.ts\" />\r\n\r\n/***\r\n   KeymanWeb 11.0\r\n   Copyright 2019 SIL International\r\n***/\r\n\r\nnamespace com.keyman {\r\n  /*\r\n  * Type alias definitions to reflect the parameters of the fullContextMatch() callback (KMW 10+).\r\n  * No constructors or methods since keyboards will not utilize the same backing prototype, and\r\n  * property names are shorthanded to promote minification.\r\n  */\r\n  type PlainKeyboardStore = string;\r\n\r\n  export type KeyboardStoreElement = (string|StoreNonCharEntry);\r\n  export type ComplexKeyboardStore = KeyboardStoreElement[]; \r\n\r\n  type KeyboardStore = PlainKeyboardStore | ComplexKeyboardStore;\r\n\r\n  type RuleChar = string;\r\n\r\n  class RuleDeadkey {\r\n    /** Discriminant field - 'd' for Deadkey.\r\n     */\r\n    ['t']: 'd';\r\n\r\n    /**\r\n     * Value:  the deadkey's ID.\r\n     */\r\n    ['d']: number; // For 'd'eadkey; also reflects the Deadkey class's 'd' property.\r\n  }\r\n\r\n  class ContextAny {\r\n    /** Discriminant field - 'a' for `any()`.\r\n     */\r\n    ['t']: 'a';\r\n\r\n    /**\r\n     * Value:  the store to search.\r\n     */\r\n    ['a']: KeyboardStore; // For 'a'ny statement.\r\n\r\n    /**\r\n     * If set to true, negates the 'any'.\r\n     */\r\n    ['n']: boolean|0|1;\r\n  }\r\n\r\n  class RuleIndex {\r\n    /** Discriminant field - 'i' for `index()`.\r\n     */\r\n    ['t']: 'i';\r\n    \r\n    /**\r\n     * Value: the Store from which to output\r\n     */\r\n    ['i']: KeyboardStore;\r\n    \r\n    /**\r\n     * Offset: the offset in context for the corresponding `any()`.\r\n     */\r\n    ['o']: number;\r\n  }\r\n\r\n  class ContextEx {\r\n    /** Discriminant field - 'c' for `context()`.\r\n     */\r\n    ['t']: 'c';\r\n    \r\n    /**\r\n     * Value:  The offset into the current rule's context to be matched.\r\n     */\r\n    ['c']: number; // For 'c'ontext statement.\r\n  }\r\n\r\n  class ContextNul {\r\n    /** Discriminant field - 'n' for `nul`\r\n     */\r\n    ['t']: 'n';\r\n  }\r\n\r\n  class StoreBeep {\r\n    /** Discriminant field - 'b' for `beep`\r\n     */\r\n    ['t']: 'b';\r\n  }\r\n\r\n  type ContextNonCharEntry = RuleDeadkey | ContextAny | RuleIndex | ContextEx | ContextNul;\r\n  type ContextEntry = RuleChar | ContextNonCharEntry;\r\n\r\n  type StoreNonCharEntry = RuleDeadkey | StoreBeep;\r\n\r\n  /**\r\n   * Cache of context storing and retrieving return values from KC\r\n   * Must be reset prior to each keystroke and after any text changes\r\n   * MCD 3/1/14   \r\n   **/         \r\n  class CachedContext {\r\n    _cache: string[][];\r\n    \r\n    reset(): void { \r\n      this._cache = []; \r\n    }\r\n\r\n    get(n: number, ln: number): string { \r\n      // return null; // uncomment this line to disable context caching\r\n      if(typeof this._cache[n] == 'undefined') {\r\n        return null;\r\n      } else if(typeof this._cache[n][ln] == 'undefined') {\r\n        return null;\r\n      }\r\n      return this._cache[n][ln];\r\n    }\r\n\r\n    set(n: number, ln: number, val: string): void { \r\n      if(typeof this._cache[n] == 'undefined') { \r\n        this._cache[n] = []; \r\n      } \r\n      this._cache[n][ln] = val; \r\n    }\r\n  };\r\n\r\n  type CachedExEntry = {valContext: (string|number)[], deadContext: Deadkey[]};\r\n  /** \r\n   * An extended version of cached context storing designed to work with \r\n   * `fullContextMatch` and its helper functions.\r\n   */\r\n  class CachedContextEx {\r\n    _cache: CachedExEntry[][];\r\n    \r\n    reset(): void {\r\n      this._cache = [];\r\n    }\r\n\r\n    get(n: number, ln: number): CachedExEntry {\r\n      // return null; // uncomment this line to disable context caching\r\n      if(typeof this._cache[n] == 'undefined') {\r\n        return null;\r\n      } else if(typeof this._cache[n][ln] == 'undefined') {\r\n        return null;\r\n      }\r\n      return this._cache[n][ln];\r\n    }\r\n\r\n    set(n: number, ln: number, val: CachedExEntry): void { \r\n      if(typeof this._cache[n] == 'undefined') { \r\n        this._cache[n] = []; \r\n      } \r\n      this._cache[n][ln] = val; \r\n    }\r\n  };\r\n\r\n  // Defines the base Deadkey-tracking object.\r\n  class Deadkey {\r\n    p: number;  // Position of deadkey\r\n    d: number;  // Numerical id of the deadkey\r\n    o: number;  // Ordinal value of the deadkey (resolves same-place conflicts)\r\n    matched: number;\r\n\r\n    static ordinalSeed: number = 0;\r\n\r\n    constructor(pos: number, id: number) {\r\n      this.p = pos;\r\n      this.d = id;\r\n      this.o = Deadkey.ordinalSeed++;\r\n    }\r\n\r\n    match(p: number, d: number): boolean {\r\n      var result:boolean = (this.p == p && this.d == d);\r\n\r\n      return result;\r\n    }\r\n\r\n    set(): void {\r\n      this.matched = 1;\r\n    }\r\n\r\n    reset(): void {\r\n      this.matched = 0;\r\n    }\r\n\r\n    before(other: Deadkey): boolean {\r\n      return this.o < other.o;\r\n    }\r\n  }\r\n\r\n  class BeepData {\r\n    e: HTMLElement;\r\n    c: string;\r\n\r\n    constructor(e: HTMLElement) {\r\n      this.e = e;\r\n      this.c = e.style.backgroundColor;\r\n    }\r\n\r\n    reset(): void {\r\n      this.e.style.backgroundColor = this.c;\r\n    }\r\n  }\r\n\r\n  export class KeyboardInterface {\r\n    keymanweb: KeymanBase;\r\n    cachedContext: CachedContext = new CachedContext();\r\n    cachedContextEx: CachedContextEx = new CachedContextEx();\r\n\r\n    TSS_LAYER:    number = 33;\r\n    TSS_PLATFORM: number = 31;\r\n\r\n    _AnyIndices:  number[] = [];    // AnyIndex - array of any/index match indices\r\n    _BeepObjects: BeepData[] = [];  // BeepObjects - maintains a list of active 'beep' visual feedback elements\r\n    _BeepTimeout: number = 0;       // BeepTimeout - a flag indicating if there is an active 'beep'. \r\n                                    // Set to 1 if there is an active 'beep', otherwise leave as '0'.\r\n    _DeadKeys: Deadkey[] = [];      // DeadKeys - array of matched deadkeys\r\n\r\n    constructor(kmw: KeymanBase) {\r\n      this.keymanweb = kmw;\r\n    }\r\n\r\n    /**\r\n     * Function     KSF\r\n     * Scope        Public\r\n     * Description  Save keyboard focus\r\n     */    \r\n    saveFocus(): void {\r\n      DOMEventHandlers.states._IgnoreNextSelChange = 1;\r\n    }\r\n      \r\n    /**\r\n     * Function     KT\r\n     * Scope        Public\r\n     * @param       {string}      Ptext     Text to insert\r\n     * @param       {?number}     PdeadKey  Dead key number, if any (???)\r\n     * @return      {boolean}               true if inserted\r\n     * Description  Insert text into active control\r\n     */    \r\n    insertText(Ptext: string, PdeadKey:number): boolean {\r\n      this.resetContextCache();\r\n      //_DebugEnter('InsertText');\r\n      var Lelem: Document|HTMLElement = this.keymanweb.domManager.getLastActiveElement(), Ls, Le, Lkc, Lv=false;\r\n      if(Lelem != null) {\r\n        Ls=Lelem._KeymanWebSelectionStart;\r\n        Le=Lelem._KeymanWebSelectionEnd;\r\n\r\n        this.keymanweb.uiManager.setActivatingUI(true);\r\n        DOMEventHandlers.states._IgnoreNextSelChange = 100;\r\n        this.keymanweb.domManager.focusLastActiveElement();\r\n        \r\n        if(Lelem.ownerDocument && Lelem instanceof Lelem.ownerDocument.defaultView.HTMLIFrameElement \r\n            && this.keymanweb.domManager._IsMozillaEditableIframe(Lelem, 0)) {\r\n          Lelem = (<any>Lelem).documentElement;  // I3363 (Build 301)\r\n        }\r\n        \r\n        Lelem._KeymanWebSelectionStart=Ls;\r\n        Lelem._KeymanWebSelectionEnd=Le;\r\n        DOMEventHandlers.states._IgnoreNextSelChange = 0;\r\n        if(Ptext!=null) {\r\n          this.output(0, Lelem, Ptext);\r\n        }\r\n        if((typeof(PdeadKey)!=='undefined') && (PdeadKey !== null)) {\r\n          this.deadkeyOutput(0, Lelem, PdeadKey);\r\n        }\r\n        Lelem._KeymanWebSelectionStart=null;\r\n        Lelem._KeymanWebSelectionEnd=null;\r\n        Lv=true;\r\n      }\r\n      //_DebugExit('InsertText');\r\n      return Lv;\r\n    }\r\n    \r\n    /**\r\n     * Function     registerKeyboard  KR                    \r\n     * Scope        Public\r\n     * @param       {Object}      Pk      Keyboard  object\r\n     * Description  Register and load the keyboard\r\n     */    \r\n    registerKeyboard(Pk): void {\r\n      this.keymanweb.keyboardManager._registerKeyboard(Pk);\r\n    }\r\n\r\n    /**\r\n     * Add the basic keyboard parameters (keyboard stub) to the array of keyboard stubs\r\n     * If no language code is specified in a keyboard it cannot be registered, \r\n     * and a keyboard stub must be registered before the keyboard is loaded \r\n     * for the keyboard to be usable.\r\n     * \r\n     * @param       {Object}      Pstub     Keyboard stub object\r\n     * @return      {?number}               1 if already registered, else null\r\n     */    \r\n    registerStub(Pstub): number {\r\n      return this.keymanweb.keyboardManager._registerStub(Pstub);\r\n    }\r\n\r\n    /**\r\n     * Get *cached or uncached* keyboard context for a specified range, relative to caret\r\n     * \r\n     * @param       {number}      n       Number of characters to move back from caret\r\n     * @param       {number}      ln      Number of characters to return\r\n     * @param       {Object}      Pelem   Element to work with (must be currently focused element)\r\n     * @return      {string}              Context string \r\n     * \r\n     * Example     [abcdef|ghi] as INPUT, with the caret position marked by |:\r\n     *             KC(2,1,Pelem) == \"e\"\r\n     *             KC(3,3,Pelem) == \"def\"\r\n     *             KC(10,10,Pelem) == \"abcdef\"  i.e. return as much as possible of the requested string\r\n     */    \r\n    \r\n    context(n: number, ln:number, Pelem:HTMLElement): string {\r\n      var v = this.cachedContext.get(n, ln);\r\n      if(v !== null) {\r\n        return v;\r\n      }\r\n      \r\n      var r = this.keymanweb.KC_(n, ln, Pelem);\r\n      this.cachedContext.set(n, ln, r);\r\n      return r;\r\n    }\r\n    \r\n    /**\r\n     * Function     nul           KN    \r\n     * Scope        Public\r\n     * @param       {number}      n       Length of context to check\r\n     * @param       {Object}      Ptarg   Element to work with (must be currently focused element)\r\n     * @return      {boolean}             True if length of context is less than or equal to n\r\n     * Description  Test length of context, return true if the length of the context is less than or equal to n\r\n     * \r\n     * Example     [abc|def] as INPUT, with the caret position marked by |:\r\n     *             KN(3,Pelem) == TRUE\r\n     *             KN(2,Pelem) == FALSE\r\n     *             KN(4,Pelem) == TRUE\r\n     */    \r\n    nul(n: number, Ptarg: HTMLElement): boolean {\r\n      var cx=this.context(n+1, 1, Ptarg);\r\n      \r\n      // With #31, the result will be a replacement character if context is empty.\r\n      return cx === \"\\uFFFE\";\r\n    }\r\n\r\n    /**\r\n     * Function     contextMatch  KCM   \r\n     * Scope        Public\r\n     * @param       {number}      n       Number of characters to move back from caret\r\n     * @param       {Object}      Ptarg   Focused element\r\n     * @param       {string}      val     String to match\r\n     * @param       {number}      ln      Number of characters to return\r\n     * @return      {boolean}             True if selected context matches val\r\n     * Description  Test keyboard context for match\r\n     */    \r\n    contextMatch(n: number, Ptarg: HTMLElement, val: string, ln: number): boolean {\r\n      //KeymanWeb._Debug('KeymanWeb.KCM(n='+n+', Ptarg, val='+val+', ln='+ln+'): return '+(kbdInterface.context(n,ln,Ptarg)==val)); \r\n      var cx=this.context(n, ln, Ptarg);\r\n      if(cx === val) {\r\n        return true; // I3318\r\n      }\r\n      this._DeadkeyResetMatched(); // I3318\r\n      return false;\r\n    }\r\n\r\n    /**\r\n     * Builds the *cached or uncached* keyboard context for a specified range, relative to caret\r\n     * \r\n     * @param       {number}      n       Number of characters to move back from caret\r\n     * @param       {number}      ln      Number of characters to return\r\n     * @param       {Object}      Pelem   Element to work with (must be currently focused element)\r\n     * @return      {Array}               Context array (of strings and numbers) \r\n     */\r\n    private _BuildExtendedContext(n: number, ln: number, Ptarg: HTMLElement): CachedExEntry {\r\n      var cache = this.cachedContextEx.get(n, ln); \r\n      if(cache !== null) {\r\n        return cache;\r\n      } else {\r\n        // By far the easiest way to correctly build what we want is to start from the right and work to what we need.\r\n        // We may have done it for a similar cursor position before.\r\n        cache = this.cachedContextEx.get(n, n);\r\n        if(cache === null) {\r\n          // First, let's make sure we have a cloned, sorted copy of the deadkey array.\r\n          this._DeadKeys.sort(function(a: Deadkey, b: Deadkey) {\r\n            // We want descending order, so we want 'later' deadkeys first.\r\n            if(a.p != b.p) {\r\n              return b.p - a.p;\r\n            } else {\r\n              return b.o - a.o;\r\n            }\r\n          });\r\n\r\n          var unmatchedDeadkeys = [].concat(this._DeadKeys);\r\n\r\n          // Time to build from scratch!\r\n          var index = 0;\r\n          cache = { valContext: [], deadContext: []};\r\n          while(cache.valContext.length < n) {\r\n            // As adapted from `deadkeyMatch`.\r\n            var sp=this._SelPos(Ptarg);\r\n            var deadPos = sp - index;\r\n            if(unmatchedDeadkeys.length > 0 && unmatchedDeadkeys[0].p == deadPos) {\r\n              // Take the deadkey.\r\n              cache.deadContext[n-cache.valContext.length-1] = unmatchedDeadkeys[0];\r\n              cache.valContext = [unmatchedDeadkeys[0].d].concat(cache.valContext);\r\n              unmatchedDeadkeys.splice(0, 1);\r\n            } else {\r\n              // Take the character.  We get \"\\ufffe\" if it doesn't exist.\r\n              var kc = this.context(++index, 1, Ptarg);\r\n              cache.valContext = ([kc] as (string|number)[]).concat(cache.valContext);\r\n            }\r\n          }\r\n          this.cachedContextEx.set(n, n, cache);\r\n        }\r\n\r\n        // Now that we have the cache...\r\n        var subCache = cache;\r\n        subCache.valContext = subCache.valContext.slice(0, ln);\r\n        for(var i=0; i < subCache.valContext.length; i++) {\r\n          if(subCache[i] == '\\ufffe') {\r\n            subCache.valContext.splice(0, 1);\r\n            subCache.deadContext.splice(0, 1);\r\n          }\r\n        }\r\n\r\n        if(subCache.valContext.length == 0) {\r\n          subCache.valContext = ['\\ufffe'];\r\n          subCache.deadContext = [];\r\n        }\r\n\r\n        this.cachedContextEx.set(n, ln, subCache);\r\n\r\n        return subCache;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function       fullContextMatch    KFCM\r\n     * Scope          Private\r\n     * @param         {number}    n       Number of characters to move back from caret\r\n     * @param         {Object}    Ptarg   Focused element\r\n     * @param         {Array}     rule    An array of ContextEntries to match.\r\n     * @return        {boolean}           True if the fully-specified rule context matches the current KMW state.\r\n     * \r\n     * A KMW 10+ function designed to bring KMW closer to Keyman Desktop functionality,\r\n     * near-directly modeling (externally) the compiled form of Desktop rules' context section.\r\n     */\r\n    fullContextMatch(n: number, Ptarg: HTMLElement, rule: ContextEntry[]): boolean {\r\n      // Stage one:  build the context index map.\r\n      var fullContext = this._BuildExtendedContext(n, rule.length, Ptarg);\r\n      var context = fullContext.valContext;\r\n      var deadContext = fullContext.deadContext;\r\n\r\n      var mismatch = false;\r\n\r\n      // This symbol internally indicates lack of context in a position.  (See KC_)\r\n      const NUL_CONTEXT = \"\\uFFFE\";\r\n\r\n      var assertNever = function(x: never): never {\r\n        // Could be accessed by improperly handwritten calls to `fullContextMatch`.\r\n        throw new Error(\"Unexpected object in fullContextMatch specification: \" + x);\r\n      }\r\n\r\n      // Stage two:  time to match against the rule specified.\r\n      for(var i=0; i < rule.length; i++) {\r\n        if(typeof rule[i] == 'string') {\r\n          var str = rule[i] as string;\r\n          if(str !== context[i]) {\r\n            mismatch = true;\r\n            break;\r\n          }\r\n        } else {\r\n          // TypeScript needs a cast to this intermediate type to do its discriminated union magic.\r\n          var r = rule[i] as ContextNonCharEntry;\r\n          switch(r.t) {\r\n            case 'd':\r\n              // We still need to set a flag here; \r\n              if(r['d'] !== context[i]) {\r\n                mismatch = true;\r\n              } else {\r\n                deadContext[i].set();\r\n              }\r\n              break;\r\n            case 'a':\r\n              var lookup: KeyboardStoreElement;\r\n\r\n              if(typeof context[i] == 'string') {\r\n                lookup = context[i] as string;\r\n              } else {\r\n                lookup = {'t': 'd', 'd': context[i] as number};\r\n              }\r\n\r\n              var result = this.any(i, lookup, r.a);\r\n\r\n              if(!r.n) { // If it's a standard 'any'...\r\n                if(!result) {\r\n                  mismatch = true;\r\n                } else if(deadContext[i] !== undefined) {\r\n                  // It's a deadkey match, so indicate that.\r\n                  deadContext[i].set();\r\n                }\r\n                // 'n' for 'notany'.  If we actually match or if we have nul context (\\uFFFE), notany fails.\r\n              } else if(r.n && (result || context[i] !== NUL_CONTEXT)) {\r\n                mismatch = true;\r\n              }\r\n              break;\r\n            case 'i':\r\n              // The context will never hold a 'beep.'\r\n              var ch = this._Index(r.i, r.o) as string | RuleDeadkey;\r\n\r\n              if(ch !== undefined && (typeof(ch) == 'string' ? ch : ch.d) !== context[i]) {\r\n                mismatch = true;\r\n              } else if(deadContext[i] !== undefined) {\r\n                deadContext[i].set();\r\n              }\r\n              break;\r\n            case 'c':            \r\n              if(context[r.c - 1] !== context[i]) {\r\n                mismatch = true;\r\n              } else if(deadContext[i] !== undefined) {\r\n                deadContext[i].set();\r\n              }\r\n              break;\r\n            case 'n':\r\n              // \\uFFFE is the internal 'no context here sentinel'.\r\n              if(context[i] != NUL_CONTEXT) {\r\n                mismatch = true;\r\n              }\r\n              break;\r\n            default:\r\n              assertNever(r);\r\n          }\r\n        }\r\n      }\r\n\r\n      if(mismatch) {\r\n        // Reset the matched 'any' indices, if any.\r\n        this._DeadkeyResetMatched();\r\n        this._AnyIndices = [];\r\n      }\r\n\r\n      return !mismatch;\r\n    }\r\n\r\n    /**\r\n     * Function     KIK      \r\n     * Scope        Public\r\n     * @param       {Object}  e   keystroke event\r\n     * @return      {boolean}     true if keypress event\r\n     * Description  Test if event as a keypress event\r\n     */    \r\n    isKeypress(e: KeyEvent):boolean {\r\n      if(this.keymanweb.keyboardManager.activeKeyboard['KM']) {   // I1380 - support KIK for positional layouts\r\n        return !e.LisVirtualKey;             // will now return true for U_xxxx keys, but not for T_xxxx keys\r\n      } else {\r\n        return this.keymanweb.keyMapManager._USKeyCodeToCharCode(e) ? true : false; // I1380 - support KIK for positional layouts\r\n      }\r\n    }\r\n    \r\n    /**\r\n     * Function     keyMatch      KKM      \r\n     * Scope        Public\r\n     * @param       {Object}      e           keystroke event\r\n     * @param       {number}      Lruleshift\r\n     * @param       {number}      Lrulekey\r\n     * @return      {boolean}                 True if key matches rule\r\n     * Description  Test keystroke with modifiers against rule\r\n     */    \r\n    keyMatch(e: KeyEvent, Lruleshift:number, Lrulekey:number): boolean {\r\n      var retVal = false; // I3318\r\n      var keyCode = (e.Lcode == 173 ? 189 : e.Lcode);  //I3555 (Firefox hyphen issue)\r\n\r\n      var bitmask = this.keymanweb.keyboardManager.getKeyboardModifierBitmask();\r\n      var modifierBitmask = bitmask & this.keymanweb.osk.modifierBitmasks[\"ALL\"];\r\n      var stateBitmask = bitmask & this.keymanweb.osk.stateBitmasks[\"ALL\"];\r\n\r\n      if(e.vkCode > 255) {\r\n        keyCode = e.vkCode; // added to support extended (touch-hold) keys for mnemonic layouts\r\n      }\r\n        \r\n      if(e.LisVirtualKey || keyCode > 255) {\r\n        if((Lruleshift & 0x4000) == 0x4000 || (keyCode > 255)) { // added keyCode test to support extended keys\r\n          retVal = ((Lrulekey == keyCode) && ((Lruleshift & modifierBitmask) == e.Lmodifiers)); //I3318, I3555\r\n          retVal = retVal && this.stateMatch(e, Lruleshift & stateBitmask);\r\n        }\r\n      } else if((Lruleshift & 0x4000) == 0) {\r\n        retVal = (keyCode == Lrulekey); // I3318, I3555\r\n      }\r\n      if(!retVal) {\r\n        this._DeadkeyResetMatched();  // I3318\r\n      }\r\n      return retVal; // I3318\r\n    };\r\n\r\n    /**\r\n     * Function     stateMatch    KSM\r\n     * Scope        Public\r\n     * @param       {Object}      e       keystroke event\r\n     * @param       {number}      Lstate  \r\n     * Description  Test keystroke against state key rules\r\n     */\r\n    stateMatch(e: KeyEvent, Lstate: number) {\r\n      return ((Lstate & e.Lstates) == Lstate);\r\n    }\r\n\r\n    /**\r\n     * Function     keyInformation  KKI\r\n     * Scope        Public\r\n     * @param       {Object}      e\r\n     * @return      {Object}              Object with event's virtual key flag, key code, and modifiers\r\n     * Description  Get object with extended key event information\r\n     */    \r\n    keyInformation(e: KeyEvent): KeyInformation {\r\n      var ei = new KeyInformation();\r\n      ei['vk'] = e.LisVirtualKey;\r\n      ei['code'] = e.Lcode;\r\n      ei['modifiers'] = e.Lmodifiers;\r\n      return ei;\r\n    };\r\n\r\n    /**\r\n     * Function     deadkeyMatch  KDM      \r\n     * Scope        Public\r\n     * @param       {number}      n       current cursor position\r\n     * @param       {Object}      Ptarg   target element\r\n     * @param       {number}      d       deadkey\r\n     * @return      {boolean}             True if deadkey found selected context matches val\r\n     * Description  Match deadkey at current cursor position\r\n     */    \r\n    deadkeyMatch(n: number, Ptarg: HTMLElement, d: number): boolean {\r\n      if(this._DeadKeys.length == 0) {\r\n        return false; // I3318\r\n      }\r\n\r\n      var sp=this._SelPos(Ptarg);\r\n      n = sp - n;\r\n      for(var i = 0; i < this._DeadKeys.length; i++) {\r\n        // Don't re-match an already-matched deadkey.  It's possible to have two identical \r\n        // entries, and they should be kept separately.\r\n        if(this._DeadKeys[i].match(n, d) && !this._DeadKeys[i].matched) {\r\n          this._DeadKeys[i].set();\r\n          // Assumption:  since we match the first possible entry in the array, we\r\n          // match the entry with the lower ordinal - the 'first' deadkey in the position.\r\n          return true; // I3318\r\n        }\r\n      }\r\n      this._DeadkeyResetMatched(); // I3318\r\n\r\n      return false;\r\n    }\r\n    \r\n    /**\r\n     * Function     beepReset   KBR      \r\n     * Scope        Public\r\n     * Description  Reset/terminate beep or flash (not currently used: Aug 2011)\r\n     */    \r\n    beepReset(): void {\r\n      this.resetContextCache();\r\n\r\n      var Lbo;\r\n      this._BeepTimeout = 0;\r\n      for(Lbo=0;Lbo<this._BeepObjects.length;Lbo++) { // I1511 - array prototype extended\r\n        this._BeepObjects[Lbo].reset();\r\n      }\r\n      this._BeepObjects = [];\r\n    }\r\n      \r\n    /**\r\n     * Function     beep          KB      \r\n     * Scope        Public\r\n     * @param       {Object}      Pelem     element to flash\r\n     * Description  Flash body as substitute for audible beep; notify embedded device to vibrate\r\n     */    \r\n    beep(Pelem: HTMLElement|Document): void {\r\n      this.resetContextCache();\r\n      \r\n      var Pdoc = Pelem as Document;  // Shorthand for following if, which verifies if it actually IS a Document.\r\n      if(Pdoc.defaultView && Pelem instanceof Pdoc.defaultView.Document) {\r\n        Pelem=Pdoc.body; // I1446 - beep sometimes fails to flash when using OSK and rich control\r\n      }\r\n\r\n      Pelem = Pelem as HTMLElement; // After previous block, true.\r\n      \r\n      if(!Pelem.style || typeof(Pelem.style.backgroundColor)=='undefined') {\r\n        return;\r\n      }\r\n\r\n      for(var Lbo=0; Lbo<this._BeepObjects.length; Lbo++) { // I1446 - beep sometimes fails to return background color to normal\r\n                                                                  // I1511 - array prototype extended\r\n        if(this._BeepObjects[Lbo].e == Pelem) {\r\n          return;\r\n        }\r\n      }\r\n      \r\n      this._BeepObjects = this.keymanweb._push(this._BeepObjects, new BeepData(Pelem));\r\n      Pelem.style.backgroundColor = '#000000';\r\n      if(this._BeepTimeout == 0) {\r\n        this._BeepTimeout = 1;\r\n        window.setTimeout(this.beepReset.bind(this), 50);\r\n      }\r\n\r\n      if ('beepKeyboard' in this.keymanweb) {\r\n        this.keymanweb['beepKeyboard']();\r\n      }\r\n    }\r\n\r\n    _ExplodeStore(store: KeyboardStore): ComplexKeyboardStore {\r\n      if(typeof(store) == 'string') {\r\n        var kbdTag = this.keymanweb.keyboardManager.getActiveKeyboardTag();\r\n\r\n        // Is the result cached?\r\n        if(kbdTag.stores[store]) {\r\n          return kbdTag.stores[store];\r\n        }\r\n\r\n        // Nope, so let's build its cache.\r\n        var result: ComplexKeyboardStore = [];\r\n        for(var i=0; i < store._kmwLength(); i++) {\r\n          result.push(store._kmwCharAt(i));\r\n        }\r\n\r\n        // Cache the result for later!\r\n        kbdTag.stores[store] = result;\r\n        return result;\r\n      } else {\r\n        return store;\r\n      }\r\n    }\r\n    \r\n    /**\r\n     * Function     any           KA      \r\n     * Scope        Public\r\n     * @param       {number}      n     character position (index) \r\n     * @param       {string}      ch    character to find in string\r\n     * @param       {string}      s     'any' string   \r\n     * @return      {boolean}           True if character found in 'any' string, sets index accordingly\r\n     * Description  Test for character matching\r\n     */    \r\n    any(n: number, ch: KeyboardStoreElement, s: KeyboardStore): boolean {\r\n      if(ch == '') {\r\n        return false;\r\n      }\r\n      \r\n      s = this._ExplodeStore(s);\r\n      var Lix = -1;\r\n      for(var i=0; i < s.length; i++) {\r\n        if(typeof(s[i]) == 'string') {\r\n          if(s[i] == ch) {\r\n            Lix = i;\r\n            break;\r\n          }\r\n        } else if(s[i]['d'] === ch['d']) {\r\n          Lix = i;\r\n          break;\r\n        }\r\n      }\r\n      this._AnyIndices[n] = Lix;\r\n      return Lix >= 0;\r\n    }\r\n\r\n    /**\r\n     * Function     _Index\r\n     * Scope        Public \r\n     * @param       {string}      Ps      string\r\n     * @param       {number}      Pn      index\r\n     * Description  Returns the character from a store string according to the offset in the index array\r\n     */\r\n    _Index(Ps: KeyboardStore, Pn: number): KeyboardStoreElement {        \r\n      Ps = this._ExplodeStore(Ps);\r\n\r\n      if(this._AnyIndices[Pn-1] < Ps.length) {   //I3319\r\n        return Ps[this._AnyIndices[Pn-1]];\r\n      } else {\r\n        /* Should not be possible for a compiled keyboard, but may arise \r\n        * during the development of handwritten keyboards.\r\n        */\r\n        console.warn(\"Unmatched contextual index() statement detected in rule with index \" + Pn + \"!\");\r\n        return \"\";\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function     indexOutput   KIO\r\n     * Scope        Public\r\n     * @param       {number}      Pdn     no of character to overwrite (delete)\r\n     * @param       {string}      Ps      string\r\n     * @param       {number}      Pn      index\r\n     * @param       {Object}      Pelem   element to output to\r\n     * Description  Output a character selected from the string according to the offset in the index array\r\n     */\r\n    indexOutput(Pdn: number, Ps: KeyboardStore, Pn: number, Pelem: HTMLElement): void {\r\n      this.resetContextCache();\r\n\r\n      var assertNever = function(x: never): never {\r\n        // Could be accessed by improperly handwritten calls to `fullContextMatch`.\r\n        throw new Error(\"Unexpected object in fullContextMatch specification: \" + x);\r\n      }\r\n\r\n      var indexChar = this._Index(Ps, Pn);\r\n      if(indexChar !== \"\") {\r\n        if(typeof indexChar == 'string' ) {\r\n          this.output(Pdn,Pelem,indexChar);  //I3319\r\n        } else if(indexChar['t']) {\r\n          var storeEntry = indexChar as StoreNonCharEntry;\r\n\r\n          switch(storeEntry.t) {\r\n            case 'b': // Beep commands may appear within stores.\r\n              this.beep(Pelem);\r\n              break;\r\n            case 'd':\r\n              this.deadkeyOutput(Pdn, Pelem, indexChar['d']);\r\n              break;\r\n            default:\r\n              assertNever(storeEntry);\r\n          }\r\n        } else { // For keyboards developed during 10.0's alpha phase - t:'d' was assumed.\r\n          this.deadkeyOutput(Pdn, Pelem, indexChar['d']);\r\n        }\r\n      } \r\n    }\r\n    \r\n    \r\n    /**\r\n     * Function     deleteContext KDC  \r\n     * Scope        Public\r\n     * @param       {number}      dn      number of context entries to overwrite\r\n     * @param       {Object}      Pelem   element to output to \r\n     * @param       {string}      s       string to output   \r\n     * Description  Keyboard output\r\n     */\r\n    deleteContext(dn: number, Pelem): void {\r\n      var context: CachedExEntry;\r\n\r\n      // We want to control exactly which deadkeys get removed.\r\n      if(dn > 0) {\r\n        context = this._BuildExtendedContext(dn, dn, Pelem);\r\n        for(var i=0; i < context.deadContext.length; i++) {\r\n          var dk = context.deadContext[i];\r\n\r\n          if(dk) {\r\n            // Remove deadkey in context.\r\n            var index = this._DeadKeys.indexOf(dk);\r\n            this._DeadKeys.splice(index, 1);\r\n\r\n            // Reduce our reported context size.\r\n            dn--;\r\n          }\r\n        }\r\n      }\r\n\r\n      // If a matched deadkey hasn't been deleted, we don't WANT to delete it.\r\n      this._DeadkeyResetMatched();\r\n\r\n      // Why reinvent the wheel?  Delete the remaining characters by 'inserting a blank string'.\r\n      this.output(dn, Pelem, '');\r\n    }\r\n\r\n    /**\r\n     * Function     output        KO  \r\n     * Scope        Public\r\n     * @param       {number}      dn      number of characters to overwrite\r\n     * @param       {Object}      Pelem   element to output to \r\n     * @param       {string}      s       string to output   \r\n     * Description  Keyboard output\r\n     */\r\n    output(dn: number, Pelem, s:string): void {\r\n      this.resetContextCache();\r\n      \r\n      // KeymanTouch for Android uses direct insertion of the character string\r\n      if('oninserttext' in this.keymanweb) {\r\n        this.keymanweb['oninserttext'](dn,s);\r\n      }\r\n\r\n      var Ldoc: Document;\r\n      if(Pelem.body) {\r\n        Ldoc=Pelem;\r\n      } else {\r\n        Ldoc=Pelem.ownerDocument;\t// I1481 - integration with rich editors not working 100%\r\n      }\r\n      var Li, Ldv;\r\n    \r\n      if(Pelem.className.indexOf('keymanweb-input') >= 0) {\r\n        var t=this.keymanweb.touchAliasing.getTextBeforeCaret(Pelem);\r\n        if(dn > 0) {\r\n          t=t._kmwSubstr(0,t._kmwLength()-dn)+s; \r\n        } else {\r\n          t=t+s;\r\n        }\r\n        \r\n        this.keymanweb.touchAliasing.setTextBeforeCaret(Pelem,t);\r\n\r\n        // Adjust deadkey positions\r\n        this._DeadkeyDeleteMatched(); // I3318\r\n        if(dn >= 0) {        \r\n          this._DeadkeyAdjustPos(this._SelPos(Pelem), -dn + s._kmwLength()); // I3318,I3319\r\n        }\r\n\r\n        if((dn >= 0 || s) && Pelem == DOMEventHandlers.states.activeElement) {\r\n          // Record that we've made an edit.\r\n          DOMEventHandlers.states.changed = true;\r\n        }\r\n        return;\r\n      }\r\n    \r\n      if (Ldoc  &&  (Ldv=Ldoc.defaultView)  &&  Ldv.getSelection  &&  \r\n          (Ldoc.designMode.toLowerCase() == 'on' || Pelem.contentEditable == 'true' || Pelem.contentEditable == 'plaintext-only' || Pelem.contentEditable === '')      \r\n        ) { // I2457 - support contentEditable elements in mozilla, webkit\r\n        /* Editable iframe and contentEditable elements for mozilla */\r\n        var _IsEditableIframe = Ldoc.designMode.toLowerCase() == 'on';\r\n        if(_IsEditableIframe) {\r\n          var _CacheableCommands = this._CacheCommands(Ldoc);\r\n        }\r\n      \r\n        var Lsel = Ldv.getSelection();\r\n        var LselectionStart = Lsel.focusNode.nodeValue ? Lsel.focusNode.substringData(0,Lsel.focusOffset)._kmwLength() : 0;  // I3319\r\n        \r\n        if(!Lsel.isCollapsed) {\r\n          Lsel.deleteFromDocument();  // I2134, I2192\r\n        }\r\n        //KeymanWeb._Debug('KO: focusOffset='+Lsel.focusOffset+', dn='+dn+', s='+s+' focusNode.type='+Lsel.focusNode.nodeType+', focusNode.parentNode.tagName='+(Lsel.focusNode.parentNode?Lsel.focusNode.parentNode.tagName:'NULL') );\r\n\r\n        var Lrange = Lsel.getRangeAt(0);\r\n        if(dn > 0) {\r\n          Lrange.setStart(Lsel.focusNode, Lsel.focusOffset - Lsel.focusNode.nodeValue.substr(0,Lsel.focusOffset)._kmwSubstr(-dn).length); // I3319\r\n          Lrange.deleteContents();\r\n        }\r\n\r\n        //KeymanWeb._Debug('KO: focusOffset='+Lsel.focusOffset+', dn='+dn+', s='+s+' focusNode.type='+Lsel.focusNode.nodeType+', focusNode.parentNode.tagName='+(Lsel.focusNode.parentNode?Lsel.focusNode.parentNode.tagName:'NULL') );\r\n\r\n        if(s._kmwLength() > 0) { // I2132 - exception if s.length > 0, I3319\r\n          if(Lsel.focusNode.nodeType == 3) {\r\n            // I2134, I2192\r\n            // Already in a text node\r\n            //KeymanWeb._Debug('KO: Already in a text node, adding \"'+s+'\": '+Lsel.focusOffset + '-> '+Lsel.toString());\r\n            var LfocusOffset = Lsel.focusOffset;\r\n            //KeymanWeb._Debug('KO: node.text=\"'+Lsel.focusNode.data+'\", node.length='+Lsel.focusNode.length);\r\n            Lsel.focusNode.insertData(Lsel.focusOffset, s);\r\n            try {\r\n              Lsel.extend(Lsel.focusNode, LfocusOffset + s.length); \r\n            } catch(e) {\r\n              // Chrome (through 4.0 at least) throws an exception because it has not synchronised its content with the selection.  scrollIntoView synchronises the content for selection\r\n              Lsel.focusNode.parentNode.scrollIntoView();\r\n              Lsel.extend(Lsel.focusNode, LfocusOffset + s.length);\r\n            }\r\n          } else {\r\n            // Create a new text node - empty control\r\n            //KeymanWeb._Debug('KO: Creating a new text node for \"'+s+'\"');\r\n            var n = Ldoc.createTextNode(s);\r\n            Lrange.insertNode(n);\r\n            Lsel.extend(n,s.length);\r\n          }\r\n        }\r\n\r\n        if(_IsEditableIframe) {\r\n          this._CacheCommandsReset(Ldoc, _CacheableCommands, null);// I2457 - support contentEditable elements in mozilla, webkit\r\n        }\r\n        \r\n        Lsel.collapseToEnd();\r\n\r\n        // Adjust deadkey positions \r\n        if(dn >= 0) {\r\n          this._DeadkeyDeleteMatched();                                  // I3318\r\n          this._DeadkeyAdjustPos(LselectionStart, -dn + s._kmwLength()); // I3318\r\n        } // Internet Explorer   (including IE9)   \r\n      } else if (Pelem.setSelectionRange) {                                        \r\n        var LselectionStart, LselectionEnd;\r\n              \r\n        if(Pelem._KeymanWebSelectionStart != null) {// changed to allow a value of 0\r\n          LselectionStart = Pelem._KeymanWebSelectionStart;\r\n          LselectionEnd = Pelem._KeymanWebSelectionEnd;\r\n        } else {\r\n          LselectionStart = Pelem.value._kmwCodeUnitToCodePoint(Pelem.selectionStart);  // I3319\r\n          LselectionEnd = Pelem.value._kmwCodeUnitToCodePoint(Pelem.selectionEnd);      // I3319\r\n        }\r\n        \r\n        var LscrollTop, LscrollLeft;\r\n        if(Pelem.type.toLowerCase() == 'textarea' && typeof(Pelem.scrollTop) != 'undefined') {\r\n          LscrollTop = Pelem.scrollTop; LscrollLeft = Pelem.scrollLeft;\r\n        }\r\n\r\n        if(dn < 0) {// Don't delete, leave context alone (dn = -1)\r\n          Pelem.value = Pelem.value._kmwSubstring(0,LselectionStart) + s + Pelem.value._kmwSubstring(LselectionEnd);    //I3319\r\n          dn = 0;\r\n        } else if(LselectionStart < dn) {\r\n          Pelem.value = s + Pelem.value._kmwSubstring(LselectionEnd); //I3319\r\n        } else {\r\n          Pelem.value = Pelem.value._kmwSubstring(0,LselectionStart-dn) + s + Pelem.value._kmwSubstring(LselectionEnd); //I3319\r\n        }\r\n\r\n        // Adjust deadkey positions \r\n        if(dn >= 0) {\r\n          this._DeadkeyDeleteMatched(); // I3318\r\n          this._DeadkeyAdjustPos(LselectionStart, -dn + s._kmwLength()); // I3318,I3319\r\n        }\r\n\r\n        if (typeof(LscrollTop) != 'undefined') {\r\n          Pelem.scrollTop = LscrollTop;\r\n          Pelem.scrollLeft = LscrollLeft;\r\n        } \r\n        var caretPos=LselectionStart-dn+s._kmwLength();                   // I3319\r\n        var caretPosUnits=Pelem.value._kmwCodePointToCodeUnit(caretPos);  // I3319\r\n        \r\n        Pelem.setSelectionRange(caretPosUnits,caretPosUnits);             // I3319\r\n        Pelem._KeymanWebSelectionStart = null; Pelem._KeymanWebSelectionEnd = null;      \r\n      }\r\n\r\n      // Refresh element content after change (if needed)\r\n      if(typeof(this.keymanweb.refreshElementContent) == 'function') {\r\n        this.keymanweb.refreshElementContent(Pelem);\r\n      }\r\n\r\n      if((dn >= 0 || s) && Pelem == DOMEventHandlers.states.activeElement) {\r\n        // Record that we've made an edit.\r\n        DOMEventHandlers.states.changed = true;\r\n      }\r\n    }\r\n  \r\n    \r\n    /**\r\n     * Function     deadkeyOutput KDO      \r\n     * Scope        Public\r\n     * @param       {number}      Pdn     no of character to overwrite (delete) \r\n     * @param       {Object}      Pelem   element to output to \r\n     * @param       {number}      Pd      deadkey id\r\n     * Description  Record a deadkey at current cursor position, deleting Pdn characters first\r\n     */    \r\n    deadkeyOutput(Pdn: number, Pelem: HTMLElement|Document, Pd: number): void {\r\n      this.resetContextCache();\r\n\r\n      if(Pdn >= 0) {\r\n        this.output(Pdn,Pelem,\"\");  //I3318 corrected to >=\r\n      }\r\n\r\n      var Lc: Deadkey = new Deadkey(this._SelPos(Pelem as HTMLElement), Pd);\r\n\r\n      // Aim to put the newest deadkeys first.\r\n      this._DeadKeys=[Lc].concat(this._DeadKeys);      \r\n      //    _DebugDeadKeys(Pelem, 'KDeadKeyOutput: dn='+Pdn+'; deadKey='+Pd);\r\n    }\r\n\r\n    /**\r\n     * Function     _CacheCommands\r\n     * Scope        Private\r\n     * @param       {Object}    _Document\r\n     * @return      {Array.<string>}        List of style commands that are cacheable\r\n     * Description  Build reate list of styles that can be applied in iframes\r\n     */    \r\n    private _CacheCommands = function(_Document: Document): StyleCommand[] { // I1204 - style application in IFRAMEs, I2192, I2134, I2192   \r\n      //var _CacheableBackColor='backcolor';\r\n\r\n      var _CacheableCommands=[\r\n        new StyleCommand('backcolor',1), new StyleCommand('fontname',1), new StyleCommand('fontsize',1), \r\n        new StyleCommand('forecolor',1), new StyleCommand('bold',0), new StyleCommand('italic',0), \r\n        new StyleCommand('strikethrough',0), new StyleCommand('subscript',0),\r\n        new StyleCommand('superscript',0), new StyleCommand('underline',0)\r\n      ];\r\n      if(_Document.defaultView) {\r\n        this.keymanweb._push(_CacheableCommands,['hilitecolor',1]);\r\n      }\r\n        \r\n      for(var n=0;n < _CacheableCommands.length; n++) { // I1511 - array prototype extended\r\n        //KeymanWeb._Debug('Command:'+_CacheableCommands[n][0]);\r\n        this.keymanweb._push(_CacheableCommands[n], _CacheableCommands[n][1] ?\r\n            _Document.queryCommandValue(_CacheableCommands[n][0]) :\r\n            _Document.queryCommandState(_CacheableCommands[n][0]));\r\n      }\r\n      return _CacheableCommands;\r\n    }\r\n    \r\n    /**\r\n     * Function     _CacheCommandReset\r\n     * Scope        Private\r\n     * @param       {Object} _Document\r\n     *             _CacheableCommands\r\n     *             _func      \r\n     * Description  Restore styles in IFRAMEs (??)\r\n     */    \r\n    private _CacheCommandsReset = function(_Document: HTMLDocument, _CacheableCommands: StyleCommand[], _func: () => void): void {\r\n      for(var n=0;n < _CacheableCommands.length; n++) { // I1511 - array prototype extended\r\n        //KeymanWeb._Debug('ResetCacheCommand:'+_CacheableCommands[n][0]+'='+_CacheableCommands[n][2]);\r\n        if(_CacheableCommands[n][1]) {\r\n          if(_Document.queryCommandValue(_CacheableCommands[n][0]) != _CacheableCommands[n][2]) {\r\n            if(_func) {\r\n              _func();\r\n            }\r\n            _Document.execCommand(_CacheableCommands[n][0], false, _CacheableCommands[n][2]);\r\n          }\r\n        } else if(_Document.queryCommandState(_CacheableCommands[n][0]) != _CacheableCommands[n][2]) {\r\n          if(_func) {\r\n            _func();\r\n          }\r\n          //KeymanWeb._Debug('executing command '+_CacheableCommand[n][0]);\r\n          _Document.execCommand(_CacheableCommands[n][0], false, null);\r\n        }\r\n      }\r\n    }\r\n    \r\n    /**\r\n     * KIFS compares the content of a system store with a string value \r\n     * \r\n     * @param       {number}      systemId    ID of the system store to test (only TSS_LAYER currently supported)\r\n     * @param       {string}      strValue    String value to compare to\r\n     * @param       {Object}      Pelem       Currently active element (may be needed by future tests)     \r\n     * @return      {boolean}                 True if the test succeeds \r\n     */       \r\n    ifStore(systemId: number, strValue: string, Pelem: HTMLElement): boolean {\r\n      var result=true;\r\n      if(systemId == this.TSS_LAYER) {\r\n        result = (this.keymanweb.osk.layerId === strValue);\r\n      } else if(systemId == this.TSS_PLATFORM) {\r\n        var i,constraint,constraints=strValue.split(' ');\r\n        for(i=0; i<constraints.length; i++) {\r\n          constraint=constraints[i].toLowerCase();\r\n          switch(constraint) {\r\n            case 'touch':\r\n            case 'hardware':\r\n              if(this.keymanweb.util.activeDevice.touchable != (constraint == 'touch')) {\r\n                result=false;\r\n              }\r\n              break;\r\n\r\n            case 'macos':\r\n            case 'mac':\r\n              constraint = 'macosx';\r\n              // fall through\r\n            case 'macosx':\r\n            case 'windows':\r\n            case 'android':\r\n            case 'ios':\r\n            case 'linux':\r\n              if(this.keymanweb.util.activeDevice.OS.toLowerCase() != constraint) {\r\n                result=false;\r\n              }\r\n              break;\r\n          \r\n            case 'tablet':\r\n            case 'phone':\r\n            case 'desktop':\r\n              if(this.keymanweb.util.device.formFactor != constraint) {\r\n                result=false;\r\n              }\r\n              break;\r\n\r\n            case 'web':\r\n              if(this.keymanweb.util.device.browser == 'native') {\r\n                result=false; // web matches anything other than 'native'\r\n              }\r\n              break;\r\n              \r\n            case 'native':\r\n              // This will return true for embedded KeymanWeb\r\n            case 'ie':\r\n            case 'chrome':\r\n            case 'firefox':\r\n            case 'safari':\r\n            case 'edge':\r\n            case 'opera':\r\n              if(this.keymanweb.util.device.browser != constraint) {\r\n                result=false;\r\n              }\r\n              break;\r\n              \r\n            default:\r\n              result=false;\r\n          }\r\n          \r\n        }\r\n      }\r\n      return result; //Moved from previous line, now supports layer selection, Build 350 \r\n    }\r\n\r\n    /**\r\n     * KSETS sets the value of a system store to a string  \r\n     * \r\n     * @param       {number}      systemId    ID of the system store to set (only TSS_LAYER currently supported)\r\n     * @param       {string}      strValue    String to set as the system store content \r\n     * @param       {Object}      Pelem       Currently active element (may be needed in future tests)     \r\n     * @return      {boolean}                 True if command succeeds\r\n     *                                        (i.e. for TSS_LAYER, if the layer is successfully selected)\r\n     */    \r\n    setStore(systemId: number, strValue: string, Pelem: HTMLElement): boolean {\r\n      this.resetContextCache();\r\n      if(systemId == this.TSS_LAYER) {\r\n        return this.keymanweb.osk.showLayer(strValue);     //Buld 350, osk reference now OK, so should work\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Load an option store value from a cookie or default value\r\n     * \r\n     * @param       {string}      kbdName     keyboard internal name\r\n     * @param       {string}      storeName   store (option) name, embedded in cookie name\r\n     * @param       {string}      dfltValue   default value\r\n     * @return      {string}                  current or default option value   \r\n     */    \r\n    loadStore(kbdName: string, storeName:string, dfltValue:string): string {\r\n      this.resetContextCache();\r\n      var cName='KeymanWeb_'+kbdName+'_Option_'+storeName,cValue=this.keymanweb.util.loadCookie(cName);\r\n      if(typeof cValue[storeName] != 'undefined') {\r\n        return decodeURIComponent(cValue[storeName]);\r\n      } else {\r\n        return dfltValue;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Save an option store value to a cookie \r\n     * \r\n     * @param       {string}      storeName   store (option) name, embedded in cookie name\r\n     * @param       {string}      optValue    option value to save\r\n     * @return      {boolean}                 true if save successful\r\n     */    \r\n    saveStore(storeName:string, optValue:string): boolean {\r\n      this.resetContextCache();\r\n      var kbd=this.keymanweb.keyboardManager.activeKeyboard;\r\n      if(!kbd || typeof kbd['KI'] == 'undefined' || kbd['KI'] == '') {\r\n        return false;\r\n      }\r\n      \r\n      var cName='KeymanWeb_'+kbd['KI']+'_Option_'+storeName, cValue=encodeURIComponent(optValue);\r\n\r\n      this.keymanweb.util.saveCookie(cName,cValue);\r\n      return true;\r\n    }\r\n\r\n    resetContextCache(): void {\r\n      this.cachedContext.reset();\r\n      this.cachedContextEx.reset();\r\n    }\r\n    \r\n    // I3318 - deadkey changes START\r\n    /**\r\n     * Function     _DeadkeyResetMatched\r\n     * Scope        Private\r\n     * Description  Clear all matched deadkey flags\r\n     */       \r\n    _DeadkeyResetMatched(): void {                   \r\n      for(let dk of this._DeadKeys) {\r\n        dk.reset();\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function     _DeadkeyDeleteMatched\r\n     * Scope        Private\r\n     * Description  Delete matched deadkeys from context\r\n     */       \r\n    _DeadkeyDeleteMatched(): void {              \r\n      var _Dk = this._DeadKeys;\r\n      for(var Li = 0; Li < _Dk.length; Li++) {\r\n        if(_Dk[Li].matched) {\r\n          _Dk.splice(Li--,1); // Don't forget to decrement!\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function     _DeadkeyAdjustPos\r\n     * Scope        Private\r\n     * @param       {number}      Lstart      start position in context\r\n     * @param       {number}      Ldelta      characters to adjust by   \r\n     * Description  Adjust saved positions of deadkeys in context\r\n     */       \r\n    _DeadkeyAdjustPos(Lstart: number, Ldelta: number): void {\r\n      for(let dk of this._DeadKeys) {\r\n        if(dk.p > Lstart) {\r\n          dk.p += Ldelta;\r\n        }\r\n      }\r\n    }\r\n\r\n    clearDeadkeys = function(): void {\r\n      this._DeadKeys = [];\r\n    }\r\n    // I3318 - deadkey changes END\r\n\r\n    doInputEvent(_target: HTMLElement|Document) {\r\n      var event: Event;\r\n      // TypeScript doesn't yet recognize InputEvent as a type!\r\n      if(typeof window['InputEvent'] == 'function') {\r\n        event = new window['InputEvent']('input', {\"bubbles\": true, \"cancelable\": false});\r\n      } // No else - there is no supported version in some browsers.\r\n\r\n      // Ensure that touch-aliased elements fire as if from the aliased element.\r\n      if(_target['base'] && _target['base']['kmw_ip']) {\r\n        _target = _target['base'];\r\n      }\r\n\r\n      if(_target && event) {\r\n        _target.dispatchEvent(event);\r\n      }\r\n    }\r\n\r\n    defaultBackspace(Pelem?: HTMLElement|Document) {\r\n      if(!Pelem) {\r\n        Pelem = this.keymanweb.domManager.getLastActiveElement();\r\n      }\r\n\r\n      this.output(1, Pelem, \"\");\r\n      this.doInputEvent(Pelem);\r\n    }\r\n\r\n    /**\r\n     * Function     processKeystroke\r\n     * Scope        Private\r\n     * @param       {Object}        device      The device object properties to be utilized for this keystroke.\r\n     * @param       {Object}        element     The page element receiving input\r\n     * @param       {Object}        keystroke   The input keystroke (with its properties) to be mapped by the keyboard.\r\n     * Description  Encapsulates calls to keyboard input processing.\r\n     * @returns     {number}        0 if no match is made, otherwise 1.\r\n     */\r\n    processKeystroke(device, element: HTMLElement, keystroke:KeyEvent|LegacyKeyEvent) {\r\n      // Clear internal state tracking data from prior keystrokes.\r\n      (<any>this.keymanweb)._CachedSelectionStart = null; // I3319     \r\n      this._DeadkeyResetMatched();       // I3318    \r\n      this.resetContextCache();\r\n\r\n      // Ensure the settings are in place so that KIFS/ifState activates and deactivates\r\n      // the appropriate rule(s) for the modeled device.\r\n      this.keymanweb.util.activeDevice = device;\r\n\r\n      // Calls the start-group of the active keyboard.\r\n      var matched = this.keymanweb.keyboardManager.activeKeyboard['gs'](element, keystroke);\r\n\r\n      if(matched) {\r\n        this.doInputEvent(element);\r\n      }\r\n\r\n      return matched;\r\n    }\r\n    \r\n    /**\r\n     * Legacy entry points (non-standard names)- included only to allow existing IME keyboards to continue to be used\r\n     */\r\n    ['getLastActiveElement'](): HTMLElement {\r\n      return this.keymanweb.domManager.getLastActiveElement(); \r\n    }\r\n\r\n    ['focusLastActiveElement'](): void { \r\n      this.keymanweb.domManager.focusLastActiveElement(); \r\n    }\r\n\r\n    //The following entry points are defined but should not normally be used in a keyboard, as OSK display is no longer determined by the keyboard\r\n    ['hideHelp'](): void {\r\n      this.keymanweb.osk._Hide(true);\r\n    }\r\n\r\n    ['showHelp'](Px: number, Py: number): void {\r\n      this.keymanweb.osk._Show(Px,Py);\r\n    }\r\n\r\n    ['showPinnedHelp'](): void {\r\n      this.keymanweb.osk.userPositioned=true; \r\n      this.keymanweb.osk._Show(-1,-1);\r\n    }\r\n\r\n    resetContext() {\r\n      this.keymanweb.osk.layerId = 'default';\r\n\r\n      this.clearDeadkeys();\r\n      this.resetContextCache();\r\n      this.resetVKShift();\r\n\r\n      this.keymanweb.osk._Show();\r\n    };\r\n\r\n    setNumericLayer() {\r\n      var i;\r\n      for(i=0; i<this.keymanweb.osk.layers.length; i++) {\r\n        if (this.keymanweb.osk.layers[i].id == 'numeric') {\r\n          this.keymanweb.osk.layerId = 'numeric';\r\n          this.keymanweb.osk._Show();\r\n        }\r\n      }\r\n    };\r\n\r\n    /**\r\n     * Function     _SelPos\r\n     * Scope        Private\r\n     * @param       {Object}  Pelem   Element\r\n     * @return      {number}          Selection start\r\n     * Description  Get start of selection (with supplementary plane modifications)\r\n     */   \r\n    _SelPos(Pelem: HTMLElement) {\r\n      var Ldoc: Document, Ldv: Window, isMSIE=(Device._GetIEVersion()<999); // I3363 (Build 301)\r\n\r\n      if((<any>this.keymanweb).isPositionSynthesized())\r\n        return this.keymanweb.touchAliasing.getTextCaret(Pelem);\r\n\r\n      if(Pelem._KeymanWebSelectionStart) {\r\n        return Pelem._KeymanWebSelectionStart;\r\n      } else if ((Ldoc = Pelem.ownerDocument) && (Ldv=Ldoc.defaultView)) {\r\n        // Mozilla, IE9 \r\n        if(Pelem instanceof Ldv.HTMLInputElement || Pelem instanceof Ldv.HTMLTextAreaElement) {\r\n          if(Pelem.setSelectionRange) {\r\n            return Pelem.value.substr(0, Pelem.selectionStart)._kmwLength();\r\n          } // contentEditable elements, Mozilla midas\r\n        } else if(Ldv.getSelection &&  Pelem.ownerDocument.designMode.toLowerCase() == 'on') {\r\n          var Lsel = Ldv.getSelection();\r\n          if(Lsel.focusNode.nodeType == 3) \r\n            return (Lsel.focusNode as Text).substringData(0,Lsel.focusOffset)._kmwLength(); \r\n        }\r\n      }\r\n      \r\n\r\n    \r\n      \r\n      return 0;\r\n    }\r\n\r\n    /**\r\n     * Reset OSK shift states when entering or exiting the active element\r\n     **/    \r\n    resetVKShift() {\r\n      if(!this.keymanweb.uiManager.isActivating) \r\n      {\r\n        if(this.keymanweb.osk._UpdateVKShift) {\r\n          this.keymanweb.osk._UpdateVKShift(null,15,0);  //this should be enabled !!!!! TODO\r\n        }\r\n      }\r\n    }\r\n  }\r\n}","/// <reference path=\"kmwbase.ts\" />\r\n\r\nnamespace com.keyman {\r\n  class CloudRequestEntry {\r\n    id: string;\r\n    language?: string;\r\n    version?: string;\r\n\r\n    constructor(id: string, language?: string) {\r\n      this.id = id;\r\n      this.language = language;\r\n    }\r\n\r\n    toString(): string {\r\n      var kbid=this.id; \r\n      var lgid=''; \r\n      var kvid='';  \r\n\r\n      if(this.language) {\r\n        kbid=kbid+'@'+this.language;\r\n        if(this.version) {\r\n          kbid=kbid+'@'+this.version;\r\n        }\r\n      } else {\r\n        if(this.version) {\r\n          kbid=kbid+'@@'+this.version;\r\n        }\r\n      }\r\n\r\n      //TODO: add specifier validation... \r\n\r\n      return kbid;\r\n    }\r\n  }\r\n\r\n  class KeyboardFont {\r\n    'family': string;\r\n    'files': string;\r\n    'path': string;\r\n\r\n    constructor(fontObj: any, fontPath: string) {\r\n      this['family'] = fontObj['family'];\r\n      this['files'] = fontObj['source'];\r\n      this['path'] = fontPath;\r\n    }\r\n  }\r\n\r\n  export class KeyboardStub {\r\n    'KI': string;\r\n    'KLC': string;\r\n\r\n    'KN': string;\r\n    'KL': string;\r\n    'KR': string;\r\n    'KRC': string;\r\n\r\n    'KF': string;\r\n\r\n    'KFont': KeyboardFont;\r\n    'KOskFont': KeyboardFont;\r\n\r\n    // Used when loading a stub's keyboard.\r\n    asyncLoader?: any;\r\n\r\n    constructor(id: string, langCode: string) {\r\n      this['KI'] = 'Keyboard_' + id;\r\n      this['KLC'] = langCode;\r\n    }\r\n  }\r\n\r\n  export class KeyboardTag {\r\n    stores: {[text: string]: ComplexKeyboardStore} = {};\r\n  }\r\n\r\n  export class KeyboardManager {\r\n    // Language regions as defined by cloud server\r\n    static readonly regions = ['World','Africa','Asia','Europe','South America','North America','Oceania','Central America','Middle East'];\r\n    static readonly regionCodes = ['un','af','as','eu','sa','na','oc','ca','me'];\r\n\r\n    keymanweb: KeymanBase;\r\n\r\n    activeStub: KeyboardStub = null;\r\n    keyboardStubs: KeyboardStub[] = [];\r\n\r\n    deferredStubs: any[] = []; // The list of user-provided keyboard stub registration objects.\r\n    deferredKRS = [];          // Array of pending keyboard stubs from KRS, to register after initialization\r\n    deferredKR = [];           // Array of pending keyboards, to be installed at end of initialization\r\n\r\n    // The following was not actually utilized within KeymanWeb; I think it's handled via different logic.  \r\n    // See setDefaultKeyboard() below.\r\n    dfltStub = null;           // First keyboard stub loaded - default for touch-screen devices, ignored on desktops\r\n\r\n    activeKeyboard: any; // We might can define a more precise def, though...\r\n    keyboards: any[] = [];\r\n\r\n    \r\n    languageList: any[] = null; // List of keyboard languages available for KeymanCloud\r\n    languagesPending: any[] = [];     // Array of languages waiting to be registered\r\n\r\n    linkedScripts: HTMLScriptElement[] = [];\r\n\r\n    constructor(kmw: KeymanBase) {\r\n      this.keymanweb = kmw;\r\n    }\r\n\r\n    getActiveKeyboardName(): string {\r\n      return this.activeKeyboard ? this.activeKeyboard['KI'] : '';\r\n    }\r\n\r\n    getActiveKeyboardTag(): KeyboardTag {\r\n      return this.activeKeyboard ? this.activeKeyboard['_kmw'] : null;\r\n    }\r\n\r\n    getActiveLanguage(): string {\r\n      if(this.activeStub == null) {\r\n        return '';\r\n      } else {\r\n        return this.activeStub['KLC'];\r\n      }\r\n    }\r\n        \r\n    /**\r\n     * Get an associative array of keyboard identification strings\r\n     *   This was defined as an array, so is kept that way, but  \r\n     *   Javascript treats it as an object anyway \r\n     *    \r\n     * @param       {Object}    Lkbd       Keyboard object\r\n     * @return      {Object}               Copy of keyboard identification strings\r\n     * \r\n     */    \r\n    private _GetKeyboardDetail = function(Lkbd) { // I2078 - Full keyboard detail\r\n      var Lr={};  \r\n      Lr['Name'] = Lkbd['KN'];\r\n      Lr['InternalName'] =  Lkbd['KI'];\r\n      Lr['LanguageName'] = Lkbd['KL'];  // I1300 - Add support for language names\r\n      Lr['LanguageCode'] = Lkbd['KLC']; // I1702 - Add support for language codes, region names, region codes, country names and country codes\r\n      Lr['RegionName'] = Lkbd['KR'];\r\n      Lr['RegionCode'] = Lkbd['KRC'];\r\n      Lr['CountryName'] = Lkbd['KC'];\r\n      Lr['CountryCode'] = Lkbd['KCC'];\r\n      Lr['KeyboardID'] = Lkbd['KD'];\r\n      Lr['Font'] = Lkbd['KFont'];\r\n      Lr['OskFont'] = Lkbd['KOskFont'];  \r\n      return Lr;\r\n    }\r\n\r\n    /**\r\n     * Get array of available keyboard stubs \r\n     * \r\n     * @return   {Array}     Array of available keyboards\r\n     * \r\n     */    \r\n    getDetailedKeyboards() {\r\n      var Lr = [], Ln, Lstub, Lrn;\r\n\r\n      for(Ln=0; Ln < this.keyboardStubs.length; Ln++)  // I1511 - array prototype extended\r\n      {    \r\n        Lstub = this.keyboardStubs[Ln];\r\n        Lrn = this._GetKeyboardDetail(Lstub);  // I2078 - Full keyboard detail\r\n        Lr=this.keymanweb._push(Lr,Lrn); // TODO:  Resolve without need for the cast.\r\n      } \r\n      return Lr;\r\n    }\r\n\r\n    registerDeferredStubs() {\r\n      this.addKeyboardArray(this.deferredStubs);\r\n        \r\n      // KRS stubs (legacy format registration)    \r\n      for(var j=0; j<this.deferredKRS.length; j++) {\r\n        this._registerStub(this.deferredKRS[j]);\r\n      }\r\n    }\r\n\r\n    registerDeferredKeyboards() {\r\n      for(var j=0; j<this.deferredKR.length; j++) {\r\n        this._registerKeyboard(this.deferredKR[j]);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Register a fully specified keyboard (add meta-data for each language) immediately \r\n     * \r\n     * @param  {Object}  arg\r\n     * @returns {boolean}   \r\n     **/              \r\n    addStub(arg: any): boolean {\r\n      if(typeof(arg['id']) != 'string') {\r\n        return false;\r\n      }\r\n\r\n      if(typeof(arg['language']) != \"undefined\") {\r\n        console.warn(\"The 'language' property for keyboard stubs has been deprecated.  Please use the 'languages' property instead.\");\r\n        arg['languages'] = arg['language'];\r\n      }\r\n\r\n      if(typeof(arg['languages']) == 'undefined') {\r\n        return false;\r\n      }\r\n      \r\n      // Default the keyboard name to its id, capitalized\r\n      if(typeof(arg['name']) != 'string') {\r\n        arg['name'] = arg['id'].replace('_',' ');\r\n        arg['name'] = arg['name'].substr(0,1).toUpperCase()+arg['name'].substr(1);\r\n      }\r\n\r\n      var lgArg=arg['languages'];\r\n      var lgList=[], i, lg;\r\n      if(typeof(lgArg.length) == 'undefined') {\r\n        lgList[0] = lgArg;\r\n      } else {\r\n        lgList = lgArg;\r\n      }\r\n\r\n      var localOptions={\r\n        'keyboardBaseUri': this.keymanweb.options['keyboards'],\r\n        'fontBaseUri': this.keymanweb.options['fonts']\r\n      };\r\n\r\n      // Add a stub for each correctly specified language\r\n      for(i=0; i<lgList.length; i++) {\r\n        this.mergeStub(arg, lgList[i], localOptions);\r\n      }\r\n\r\n      return true;\r\n    }\r\n\r\n    /**\r\n     *  Create or update a keyboard meta-data 'stub' during keyboard registration\r\n     * \r\n     *  Cross-reference with https://help.keyman.com/developer/engine/web/11.0/reference/core/addKeyboards.\r\n     *  \r\n     *  @param  {Object}  kp  (partial) keyboard meta-data object (`spec` object)\r\n     *  @param  {Object}  lp  language object (`spec.languages` object)\r\n     *  @param  {Object}  options   KeymanCloud callback options\r\n     **/\r\n    mergeStub(kp: any, lp: any, options) {\r\n      var sp: KeyboardStub = this.findStub(kp['id'], lp['id']);\r\n      var isNew: boolean = false;\r\n\r\n      if(sp == null) {\r\n        sp= new KeyboardStub(kp['id'], lp['id']);\r\n        this.keyboardStubs.push(sp);\r\n        isNew = true;\r\n      }\r\n\r\n      // Accept region as number (from Cloud server), code, or name\r\n      var region=lp['region'], rIndex=0;\r\n      if(typeof(region) == 'number') {\r\n        if(region < 1 || region > 9) {\r\n          rIndex = 0;\r\n        } else {\r\n          rIndex = region-1;\r\n        }\r\n      } else if(typeof(region) == 'string') {\r\n        var list = (region.length == 2 ? KeyboardManager.regionCodes : KeyboardManager.regions);\r\n        for(var i=0; i<list.length; i++) {\r\n          if(region.toLowerCase() == list[i].toLowerCase()) {\r\n            rIndex=i;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n\r\n      var rx: RegExp;\r\n\r\n      sp['KL'] = (typeof sp['KL'] === 'undefined') ? lp['name'] : sp['KL'];\r\n      sp['KR'] = (typeof sp['KR'] === 'undefined') ? KeyboardManager.regions[rIndex] : sp['KR'];\r\n      sp['KRC'] = (typeof sp['KRC'] === 'undefined') ? KeyboardManager.regionCodes[rIndex] : sp['KRC'];\r\n      sp['KN'] = (typeof sp['KN'] === 'undefined') ? kp['name'] : sp['KN'];\r\n\r\n      if(typeof(sp['KF']) == 'undefined') {\r\n        rx=RegExp('^(([\\\\.]/)|([\\\\.][\\\\.]/)|(/))|(:)');\r\n        sp['KF'] = kp['filename'];\r\n\r\n        if(!rx.test(sp['KF'])) {\r\n          sp['KF'] = options['keyboardBaseUri']+sp['KF'];\r\n        }\r\n      } \r\n      \r\n      // Font path defined by cloud entry\r\n      var fontPath=options['fontBaseUri'];\r\n      \r\n      // or overridden locally, in page source\r\n      if(this.keymanweb.options['fonts'] != '') {\r\n        fontPath=this.keymanweb.options['fonts'];\r\n        rx=new RegExp('^https?\\\\:');\r\n        if(!rx.test(fontPath)) {\r\n          if(fontPath.substr(0,2) == '//') {\r\n            fontPath = this.keymanweb.protocol + fontPath;\r\n          } else if(fontPath.substr(0,1) == '/') {\r\n            fontPath = this.keymanweb.rootPath + fontPath.substr(1);\r\n          } else {\r\n            fontPath = this.keymanweb.rootPath + fontPath;\r\n          }\r\n        }\r\n      }\r\n      else {\r\n        this.keymanweb.options.fonts=fontPath;\r\n      }\r\n      \r\n      // Add font specifiers where necessary and not overridden by user\r\n      if(typeof(lp['font']) != 'undefined') {\r\n        sp['KFont'] = (typeof sp['KFont'] === 'undefined') ? new KeyboardFont(lp['font'], fontPath) : sp['KFont'];\r\n      }\r\n\r\n      // Fixed OSK font issue Github #7 (9/1/2015)\r\n      if(typeof(lp['oskFont']) != 'undefined') {\r\n        sp['KOskFont'] = (typeof sp['KOskFont'] === 'undefined') ? new KeyboardFont(lp['oskFont'], fontPath) : sp['KOskFont'];\r\n      }           \r\n\r\n      // Update the UI \r\n      this.doKeyboardRegistered(sp['KI'],sp['KL'],sp['KN'],sp['KLC'],sp['KP']);\r\n\r\n      // If we have no activeStub because there were no stubs, set the new keyboard as active.\r\n      // Do not trigger on merges.\r\n      if(!this.activeStub && isNew && this.keyboardStubs.length == 1) {\r\n        // #676: We call _SetActiveKeyboard so we can avoid overwriting \r\n        // cookies that determine our active keyboard at page load time\r\n        this.doBeforeKeyboardChange(sp['KI'], sp['KLC']);\r\n        this._SetActiveKeyboard(sp['KI'], sp['KLC'], false);\r\n        this.doKeyboardChange(sp['KI'], sp['KLC']);\r\n      }\r\n    }\r\n\r\n    /**\r\n     *  Find a keyboard stub by id in the registered keyboards list\r\n     *  \r\n     *  @param  {string}  kid   internal keyboard id (without 'Keyboard_' prefix)\r\n     *  @param  {string}  lgid  language code\r\n     *  \r\n     **/                 \r\n    findStub(kid: string, lgid: string): KeyboardStub {\r\n      var i;\r\n      for(i=0; i<this.keyboardStubs.length; i++) {\r\n        if((this.keyboardStubs[i]['KI'] == 'Keyboard_'+kid) && (this.keyboardStubs[i]['KLC'] == lgid)) {\r\n          return this.keyboardStubs[i];\r\n        }\r\n      }\r\n\r\n      return null;\r\n    }\r\n\r\n    // Called on the embedded path at the end of its initialization.\r\n    setDefaultKeyboard() {\r\n      if(this.keyboardStubs.length > 0) {\r\n        // Select the first stub as our active keyboard.\r\n        this._SetActiveKeyboard(this.keyboardStubs[0]['KI'], this.keyboardStubs[0]['KLC']);\r\n        return true;\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Allow to change active keyboard by (internal) keyboard name\r\n     * \r\n     * @param       {string}    PInternalName   Internal name\r\n     * @param       {string}    PLgCode         Language code\r\n     */    \r\n    setActiveKeyboard(PInternalName: string, PLgCode: string): Promise<void> {\r\n      //TODO: This does not make sense: the callbacks should be in _SetActiveKeyboard, not here,\r\n      //      since this is always called FROM the UI, which should not need notification.\r\n      //      If UI callbacks are needed at all, they should be within _SetActiveKeyboard \r\n\r\n      // Skip on embedded which namespaces packageID::Keyboard_keyboardID\r\n      if(!this.keymanweb.isEmbedded && PInternalName && PInternalName.indexOf(\"Keyboard_\") != 0) {\r\n        PInternalName = \"Keyboard_\" + PInternalName;\r\n      }\r\n\r\n      this.doBeforeKeyboardChange(PInternalName,PLgCode);     \r\n      let p = this._SetActiveKeyboard(PInternalName,PLgCode,true);    \r\n      if(this.keymanweb.domManager.getLastActiveElement() != null) {\r\n        this.keymanweb.domManager.focusLastActiveElement(); // TODO:  Resolve without need for the cast.\r\n      }\r\n      // If we ever allow PLgCode to be set by default, we can auto-detect the language code\r\n      // after the _SetActiveKeyboard call.\r\n      // if(!PLgCode && (<KeymanBase>keymanweb).keyboardManager.activeStub) {\r\n      //   PLgCode = (<KeymanBase>keymanweb).keyboardManager.activeStub['KLC'];\r\n      // }\r\n      this.doKeyboardChange(PInternalName, PLgCode);\r\n\r\n      return p;\r\n    }\r\n    \r\n    /**\r\n     * Change active keyboard to keyboard selected by (internal) name and language code\r\n     * \r\n     *  Test if selected keyboard already loaded, and simply update active stub if so.\r\n     *  Otherwise, insert a script to download and insert the keyboard from the repository\r\n     *  or user-indicated file location. \r\n     * \r\n     * Note that the test-case oriented 'recorder' stubs this method to provide active\r\n     * keyboard stub information.  If changing this function, please ensure the recorder is\r\n     * not affected.\r\n     * \r\n     * @param       {string}    PInternalName\r\n     * @param       {string=}    PLgCode\r\n     * @param       {boolean=}   saveCookie   \r\n     */    \r\n    _SetActiveKeyboard(PInternalName: string, PLgCode?: string, saveCookie?: boolean): Promise<void> {\r\n      var n, Ln;\r\n\r\n      var util = this.keymanweb.util;\r\n      var osk = this.keymanweb.osk;\r\n\r\n      // Set default language code\r\n      if(arguments.length < 2 || (!PLgCode)) {\r\n        PLgCode='---'; \r\n      }\r\n\r\n      // Check that the saved keyboard is currently registered\r\n      for(n=0; n < this.keyboardStubs.length; n++) {\r\n        if(PInternalName == this.keyboardStubs[n]['KI']) {\r\n          if(PLgCode == this.keyboardStubs[n]['KLC'] || PLgCode == '---') break;\r\n        }\r\n      }\r\n\r\n      // Mobile device addition: force selection of the first keyboard if none set\r\n      if(util.device.touchable && (PInternalName == '' || PInternalName == null || n >= this.keyboardStubs.length)) {\r\n        if(this.keyboardStubs.length != 0) {\r\n          PInternalName=this.keyboardStubs[0]['KI'];\r\n          PLgCode=this.keyboardStubs[0]['KLC'];   \r\n        }\r\n      }\r\n\r\n      // Save name of keyboard (with language code) as a cookie\r\n      if(arguments.length > 2 && saveCookie) {\r\n        this.saveCurrentKeyboard(PInternalName,PLgCode);\r\n      }\r\n\r\n      // Check if requested keyboard and stub are currently active\r\n      if(this.activeStub && this.activeKeyboard && this.activeKeyboard['KI'] == PInternalName \r\n        && this.activeStub['KI'] == PInternalName     //this part of test should not be necessary, but keep anyway\r\n        && this.activeStub['KLC'] == PLgCode && !this.keymanweb.mustReloadKeyboard                                 \r\n        ) return Promise.resolve();   \r\n\r\n      // Check if current keyboard matches requested keyboard, but not stub\r\n      if(this.activeKeyboard && (this.activeKeyboard['KI'] == PInternalName)) {\r\n        // If so, simply update the active stub\r\n        for(Ln=0; Ln<this.keyboardStubs.length; Ln++) {\r\n          if((this.keyboardStubs[Ln]['KI'] == PInternalName) \r\n            && (this.keyboardStubs[Ln]['KLC'] == PLgCode)) {\r\n            this.activeStub = this.keyboardStubs[Ln]; \r\n            \r\n            // Append a stylesheet for this keyboard for keyboard specific styles \r\n            // or if needed to specify an embedded font\r\n            osk.appendStyleSheet();\r\n            \r\n            // Re-initializate OSK before returning if required\r\n            if(this.keymanweb.mustReloadKeyboard) {\r\n              osk._Load();\r\n            }\r\n            return Promise.resolve();\r\n          }\r\n        }\r\n      }\r\n\r\n      this.activeKeyboard = null;\r\n      this.activeStub = null;\r\n\r\n      // Hide OSK and do not update keyboard list if using internal keyboard (desktops)\r\n      if(PInternalName == '') {\r\n        osk._Hide(false); \r\n\r\n        if(!this.keymanweb.isEmbedded) {\r\n          util.wait(false);\r\n        }\r\n\r\n        return Promise.resolve();\r\n      }\r\n\r\n      // Determine if the keyboard was previously loaded but is not active and use the prior load if so.\r\n      for(Ln=0; Ln<this.keyboards.length; Ln++) { // I1511 - array prototype extended\r\n        if(this.keyboards[Ln]['KI'] == PInternalName) {\r\n          this.activeKeyboard = this.keyboards[Ln];\r\n          this.keymanweb.domManager._SetTargDir(this.keymanweb.domManager.getLastActiveElement());  // I2077 - LTR/RTL timing\r\n        \r\n          // and update the active stub\r\n          for(var Ls=0; Ls<this.keyboardStubs.length; Ls++) {\r\n            if((this.keyboardStubs[Ls]['KI'] == PInternalName) && \r\n              (this.keyboardStubs[Ls]['KLC'] == PLgCode || PLgCode == '---')) {\r\n              this.activeStub = this.keyboardStubs[Ls]; \r\n              break;\r\n            }\r\n          }\r\n          break;\r\n        }\r\n      }\r\n\r\n      if(this.activeKeyboard == null) {\r\n        for(Ln=0; Ln<this.keyboardStubs.length; Ln++) { // I1511 - array prototype extended\r\n          if((this.keyboardStubs[Ln]['KI'] == PInternalName) \r\n            && ((this.keyboardStubs[Ln]['KLC'] == PLgCode) || (PLgCode == '---'))) {\r\n            // Force OSK display for CJK keyboards (keyboards using a pick list)\r\n            if(this.isCJK(this.keyboardStubs[Ln]) || util.device.touchable) {\r\n              osk._Enabled = 1;\r\n            }\r\n\r\n            // Create a script to load from the server - when it finishes loading, it will register itself, \r\n            //  detect that it is active, and focus as appropriate. The second test is needed to allow recovery from a failed script load\r\n\r\n            // Ensure we're not already loading the keyboard.\r\n            if(!this.keyboardStubs[Ln].asyncLoader) {   \r\n              // Always (temporarily) hide the OSK when loading a new keyboard, to ensure that a failure to load doesn't leave the current OSK displayed\r\n              if(osk.ready) {\r\n                osk._Hide(false);\r\n              }\r\n\r\n              var loadingStub = this.keyboardStubs[Ln];\r\n              // Tag the stub so that we don't double-load the keyboard!\r\n              loadingStub.asyncLoader = {};\r\n\r\n              var kbdName = loadingStub['KN'];\r\n              var lngName = loadingStub['KL'];\r\n              kbdName = kbdName.replace(/\\s*keyboard\\s*/i, '');\r\n\r\n              // Setup our default error-messaging callback if it should be implemented.\r\n              loadingStub.asyncLoader.callback = function(altString, msgType) {\r\n                var msg = altString || 'Sorry, the '+kbdName+' keyboard for '+lngName+' is not currently available.';\r\n                \r\n                // Thanks, Closure errors.  \r\n                if(!this.keymanweb.isEmbedded) {\r\n                  util.wait(false);\r\n                  util.alert(altString || msg, function() {\r\n                    this.keymanweb['setActiveKeyboard'](''); // The API call!\r\n                  }.bind(this));\r\n                }\r\n\r\n                switch(msgType) { // in case we extend this later.\r\n                  case 'err':\r\n                    console.error(msg);\r\n                    break;\r\n                  case 'warn':\r\n                  default:\r\n                    console.warn(msg);\r\n                    break;\r\n                }\r\n\r\n                if(Ln > 0) {\r\n                  var Ps = this.keyboardStubs[0];\r\n                  this._SetActiveKeyboard(Ps['KI'], Ps['KLC'], true);\r\n                }\r\n              }.bind(this);\r\n\r\n              loadingStub.asyncLoader.timer = window.setTimeout(loadingStub.asyncLoader.callback, 10000);\r\n\r\n              //Display the loading delay bar (Note: only append 'keyboard' if not included in name.) \r\n              if(!this.keymanweb.isEmbedded) {\r\n                util.wait('Installing keyboard<br/>' + kbdName);\r\n              }\r\n              \r\n              // Installing the script immediately does not work reliably if two keyboards are\r\n              // loaded in succession if there is any delay in downloading the script.\r\n              // It works much more reliably if deferred (KMEW-101, build 356)\r\n              // The effect of a delay can also be tested, for example, by setting the timeout to 5000\r\n              var manager = this;\r\n              loadingStub.asyncLoader.promise = new Promise(function(resolve, reject) {\r\n                window.setTimeout(function(){\r\n                  manager.installKeyboard(resolve, reject, loadingStub);\r\n                },0);\r\n              });\r\n            }\r\n            this.activeStub=this.keyboardStubs[Ln];\r\n            return this.keyboardStubs[Ln].asyncLoader.promise;\r\n          }\r\n        }\r\n        this.keymanweb.domManager._SetTargDir(this.keymanweb.domManager.getLastActiveElement());  // I2077 - LTR/RTL timing\r\n      }\r\n\r\n      var Pk=this.activeKeyboard;  // I3319\r\n      if(Pk !== null)  // I3363 (Build 301)\r\n        String.kmwEnableSupplementaryPlane(Pk && ((Pk['KS'] && (Pk['KS'] == 1)) || (Pk['KN'] == 'Hieroglyphic'))); // I3319\r\n      \r\n      // Initialize the OSK (provided that the base code has been loaded)\r\n      osk._Load();\r\n      return Promise.resolve();\r\n    }\r\n\r\n    /**\r\n     * Install a keyboard script that has been downloaded from a keyboard server\r\n     * Operates as the core of a Promise, hence the 'resolve' and 'reject' parameters.\r\n     * \r\n     *  @param  {Object}  kbdStub   keyboard stub to be loaded.\r\n     *    \r\n     **/      \r\n    installKeyboard(resolve: () => void, reject: () => void, kbdStub: KeyboardStub) {\r\n      var util = this.keymanweb.util;\r\n      var osk = this.keymanweb.osk;\r\n\r\n      var Lscript = util._CreateElement('script');\r\n      Lscript.charset=\"UTF-8\";        // KMEW-89\r\n      Lscript.type = 'text/javascript';\r\n\r\n      // Preserve any namespaced IDs by use of the script's id tag attribute!\r\n      if(this.keymanweb.isEmbedded) {\r\n        Lscript.id = kbdStub['KI'];\r\n      }\r\n\r\n      var kbdFile = kbdStub['KF'];\r\n      var kbdLang = kbdStub['KL'];\r\n      var kbdName = kbdStub['KN'];\r\n\r\n      var manager = this;\r\n\r\n      // Add a handler for cases where the new <script> block fails to load.\r\n      Lscript.addEventListener('error', function() {\r\n        if(kbdStub.asyncLoader.timer !== null) {\r\n          // Clear the timeout timer.\r\n          window.clearTimeout(kbdStub.asyncLoader.timer);\r\n          kbdStub.asyncLoader.timer = null;\r\n        }\r\n\r\n        // We already know the load has failed... why wait?\r\n        kbdStub.asyncLoader.callback('Cannot find the ' + kbdName + ' keyboard for ' + kbdLang + '.', 'warn');\r\n        kbdStub.asyncLoader = null;\r\n\r\n        reject();\r\n      }, false);\r\n\r\n      \r\n      // The load event will activate a newly-loaded keyboard if successful and report an error if it is not.\r\n      Lscript.addEventListener('load', function() {\r\n        if(kbdStub.asyncLoader.timer !== null) {\r\n          // Clear the timeout timer.\r\n          window.clearTimeout(kbdStub.asyncLoader.timer);\r\n          kbdStub.asyncLoader.timer = null;\r\n        }\r\n\r\n        // To determine if the load was successful, we'll need to check the keyboard array for our desired keyboard.\r\n        // Test if keyboard already loaded\r\n        var kbd = manager.getKeyboardByID(kbdStub['KI']), Li;\r\n        if(kbd) {  // Is cleared upon a successful load.\r\n          \r\n          //Activate keyboard, if it's still the active stub.\r\n          if(kbdStub == manager.activeStub) {\r\n            manager.doBeforeKeyboardChange(kbd['KI'],kbdStub['KLC']);\r\n            manager.activeKeyboard=kbd;\r\n\r\n            if(manager.keymanweb.domManager.getLastActiveElement() != null) { // TODO:  Resolve without need for the cast.\r\n              manager.keymanweb.uiManager.justActivated = true; // TODO:  Resolve without need for the cast.\r\n              manager.keymanweb.domManager._SetTargDir(manager.keymanweb.domManager.getLastActiveElement());\r\n            }\r\n\r\n            String.kmwEnableSupplementaryPlane(kbd && ((kbd['KS'] && kbd['KS'] == 1) || kbd['KN'] == 'Hieroglyphic')); // I3319 - SMP extension, I3363 (Build 301)\r\n            manager.saveCurrentKeyboard(kbd['KI'], kbdStub['KLC']);\r\n          \r\n            // Prepare and show the OSK for this keyboard\r\n            osk._Load();\r\n          } \r\n  \r\n          // Remove the wait message, if defined\r\n          if(!manager.keymanweb.isEmbedded) {\r\n            util.wait(false);\r\n          }\r\n\r\n          kbdStub.asyncLoader = null; \r\n          resolve();\r\n          // A handler portion for cases where the new <script> block loads, but fails to process.\r\n        } else {  // Output error messages even when embedded - they're useful when debugging the apps and KMEA/KMEI engines.\r\n          kbdStub.asyncLoader.callback('Error registering the ' + kbdName + ' keyboard for ' + kbdLang + '.', 'error');\r\n          kbdStub.asyncLoader = null; \r\n          reject();\r\n        }\r\n      }, false);\r\n\r\n      // IE likes to instantly start loading the file when assigned to an element, so we do this after the rest\r\n      // of our setup.  This method is not relocated here (yet) b/c it varies based upon 'native' vs 'embedded'.\r\n      Lscript.src = this.keymanweb.getKeyboardPath(kbdFile);\r\n\r\n      try {\r\n        document.body.appendChild(Lscript);\r\n        this.linkedScripts.push(Lscript);\r\n      }\r\n      catch(ex) {\r\n        try {\r\n          document.getElementsByTagName('head')[0].appendChild(Lscript);\r\n        } catch(ex2) {\r\n          reject();\r\n        }\r\n      }            \r\n    }\r\n\r\n    /* TODO: why not use util.loadCookie and saveCookie?? */  \r\n    \r\n    /**\r\n     * Function     saveCurrentKeyboard\r\n     * Scope        Private\r\n     * @param       {string}    PInternalName       name of keyboard\r\n     * @param       {string}    PLgCode             language code   \r\n     * Description Saves current keyboard as a cookie\r\n     */    \r\n    private saveCurrentKeyboard(PInternalName: string, PLgCode: string) {\r\n      var s = \"current=\"+PInternalName+\":\"+PLgCode;\r\n      this.keymanweb.util.saveCookie('KeymanWeb_Keyboard',{'current':PInternalName+':'+PLgCode});\r\n\r\n      // Additionally, make sure we save the (upcoming) per-control keyboard settings.\r\n      // This allows us to ensure the keyboard is set correctly without waiting for focus event\r\n      // triggers - very helpful for automated testing.\r\n      if(!this.keymanweb.isEmbedded) {\r\n        this.keymanweb.touchAliasing._BlurKeyboardSettings(PInternalName, PLgCode);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Restore the most recently used keyboard, if still available\r\n     */    \r\n    restoreCurrentKeyboard() {\r\n      var stubs = this.keyboardStubs, i, n=stubs.length;\r\n\r\n      // Do nothing if no stubs loaded\r\n      if(stubs.length < 1) return;\r\n\r\n      // If no saved keyboard, default to US English, else first loaded stub\r\n      var d=this.getSavedKeyboard();            \r\n      var t=d.split(':'); \r\n\r\n      // Identify the stub with the saved keyboard\r\n      t=d.split(':'); \r\n      if(t.length < 2) t[1]='';\r\n\r\n      // This loop is needed to select the correct stub when several apply to a given keyboard\r\n      // TODO: There should be a better way!\r\n      for(i=0; i<n; i++)\r\n      {\r\n        if(stubs[i]['KI'] == t[0] && (stubs[i]['KLC'] == t[1] || t[1] == '')) break;\r\n      }\r\n    \r\n      // Sets the default stub (as specified with the `getSavedKeyboard` call) as active.\r\n      // if((i < n) || (device.touchable && (this.activeKeyboard == null)))\r\n      if((i < n) || (this.activeKeyboard == null))\r\n      {\r\n        this._SetActiveKeyboard(t[0],t[1],false);\r\n        this.keymanweb.globalKeyboard = t[0];\r\n        this.keymanweb.globalLanguageCode = t[1];\r\n\r\n        this.doKeyboardChange(t[0],t[1]);        // And update the UI if necessary\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Gets the cookie for the name and language code of the most recently active keyboard\r\n     * \r\n     *  Defaults to US English, but this needs to be user-set in later revision (TODO)      \r\n     * \r\n     * @return      {string}          InternalName:LanguageCode \r\n     **/    \r\n    getSavedKeyboard(): string {  \r\n      var v = this.keymanweb.util.loadCookie('KeymanWeb_Keyboard');\r\n      \r\n      if(typeof(v['current']) != 'string') {\r\n        return 'Keyboard_us:eng';\r\n      }\r\n      \r\n      // Check that the requested keyboard is included in the available keyboard stubs\r\n      var n, stubs = this.keyboardStubs,kd;\r\n\r\n      for(n=0; n<stubs.length; n++) {\r\n        kd=stubs[n]['KI']+':'+stubs[n]['KLC'];\r\n        if(kd == v['current']) return kd;\r\n      }\r\n\r\n      // Default to US English if available (but don't assume it is first)\r\n      for(n=0; n<stubs.length; n++) {\r\n        kd=stubs[n]['KI']+':'+stubs[n]['KLC'];\r\n        if(kd == 'Keyboard_us:eng') return kd;\r\n      }\r\n      \r\n      // Otherwise use the first keyboard stub\r\n      if(stubs.length > 0) {\r\n        return stubs[0]['KI']+':'+stubs[0]['KLC'];\r\n      }\r\n      \r\n      // Or US English if no stubs loaded (should never happen)\r\n      return 'Keyboard_us:eng';\r\n    }\r\n\r\n    /**\r\n     * Function    isCJK\r\n     * Scope       Public\r\n     * @param      {Object=}  k0 \r\n     * @return     {boolean}\r\n     * Description Tests if active keyboard (or optional argument) uses a pick list (Chinese, Japanese, Korean, etc.)\r\n     *             (This function accepts either keyboard structure.)   \r\n     */    \r\n    isCJK(k0?: any|KeyboardStub) { // I3363 (Build 301)\r\n      var k = this.activeKeyboard, lg=''; \r\n\r\n      if(arguments.length > 0) {\r\n        k = k0;\r\n      }\r\n      \r\n      if(k) {\r\n        if(typeof(k['KLC']) != 'undefined') {\r\n          lg = k['KLC'];\r\n        } else if(typeof(k['LanguageCode']) != 'undefined') {\r\n          lg = k['LanguageCode'];\r\n        }\r\n      }\r\n      \r\n      return ((lg == 'cmn') || (lg == 'jpn') || (lg == 'kor'));\r\n    }\r\n\r\n    isRTL(k0?): boolean {\r\n      var k = k0 || this.activeKeyboard;\r\n      return (k != null) && (k['KRTL']);\r\n    }\r\n\r\n    /**\r\n     * Function     isChiral\r\n     * Scope        Public\r\n     * @param       {string|Object=}   k0\r\n     * @return      {boolean}\r\n     * Description  Tests if the active keyboard (or optional argument) uses chiral modifiers.\r\n     */\r\n    isChiral(k0?) {\r\n      if(typeof(k0) == \"string\") {\r\n        k0 = this.getKeyboardByID(k0);\r\n      }\r\n\r\n      return !!(this.getKeyboardModifierBitmask(k0) & this.keymanweb.osk.modifierBitmasks.IS_CHIRAL);\r\n    }\r\n\r\n    /**\r\n     * Function     getKeyboardModifierBitmask\r\n     * Scope        Private\r\n     * @param       {Object=}   k0\r\n     * @return      {number}\r\n     * Description  Obtains the currently-active modifier bitmask for the active keyboard.\r\n     */\r\n    getKeyboardModifierBitmask(k0?) {\r\n      var k=this.activeKeyboard;\r\n      \r\n      if(arguments.length > 0 && typeof k0 != 'undefined') {\r\n        k = k0;\r\n      }\r\n\r\n      if(!k) {\r\n        return 0x0000;\r\n      }\r\n\r\n      if(k['KMBM']) {\r\n        return k['KMBM'];\r\n      }\r\n\r\n      return this.keymanweb.osk.modifierBitmasks['NON_CHIRAL'];\r\n    }\r\n\r\n    getFont(k0?) {\r\n      var k = k0 || this.activeKeyboard;\r\n\r\n      if(k && k['KV']) {\r\n        return k['KV']['F'];\r\n      }\r\n      \r\n      return null;\r\n    }\r\n\r\n    /**\r\n     * Function     _getKeyboardByID\r\n     * Scope        Private\r\n     * @param       {string}  keyboardID\r\n     * @return      {Object|null}\r\n     * Description  Returns the internal, registered keyboard object - not the stub, but the keyboard itself.\r\n     */\r\n    private getKeyboardByID(keyboardID: string):any {\r\n      var Li;\r\n      for(Li=0; Li<this.keyboards.length; Li++) {\r\n        if(keyboardID == this.keyboards[Li]['KI']) {\r\n          return this.keyboards[Li];\r\n        }\r\n      }\r\n\r\n      return null;\r\n    }\r\n\r\n    /* ------------------------------------------------------------\r\n    *  Definitions for adding, removing, and requesting keyboards.\r\n    *  ------------------------------------------------------------ \r\n    */\r\n\r\n    /**\r\n     * Function       isUniqueRequest\r\n     * Scope          Private\r\n     * @param         {Object}    tEntry\r\n     * Description    Checks to ensure that the stub isn't already loaded within KMW or subject\r\n     *                to an already-pending request.\r\n     */\r\n    isUniqueRequest(cloudList: {id: string, language?: string}[], tEntry: CloudRequestEntry) {\r\n      var k;\r\n\r\n      if(this.findStub(tEntry.id, tEntry.language) == null) {\r\n        for(k=0; k < cloudList.length; k++) {\r\n          if(cloudList[k].id == tEntry['id'] && cloudList[k].language == tEntry.language) {\r\n            return false;\r\n          }\r\n        }\r\n        return true;\r\n      } else {\r\n        return false;\r\n      }\r\n    };\r\n\r\n    /**\r\n     * Build 362: addKeyboardArray() link to Cloud. One or more arguments may be used\r\n     * \r\n     * @param {string|Object} x keyboard name string or keyboard metadata JSON object\r\n     * \r\n     */  \r\n    addKeyboardArray(x: any[] | IArguments): void {\r\n      // Store all keyboard meta-data for registering later if called before initialization\r\n      if(!this.keymanweb.initialized) {\r\n        for(var k=0; k<x.length; k++) {\r\n          this.deferredStubs.push(x[k]);\r\n        }\r\n        return;\r\n      }\r\n\r\n      // Ignore empty array passed as argument\r\n      if(x.length == 0) {\r\n        return;\r\n      }\r\n    \r\n      // Create a temporary array of metadata objects from the arguments used\r\n      var i,j,kp,kbid,lgid,kvid,cmd='',comma='';\r\n      var cloudList: CloudRequestEntry[] = [];\r\n\r\n      var tEntry: CloudRequestEntry;\r\n\r\n      for(i=0; i<x.length; i++) {\r\n        if(typeof(x[i]) == 'string' && (<string>x[i]).length > 0) {\r\n          var pList=(<string>x[i]).split('@'),lList=[''];\r\n          if(pList[0].toLowerCase() == 'english') {\r\n            pList[0] = 'us';\r\n          }\r\n\r\n          if(pList.length > 1) {\r\n            lList=pList[1].split(',');\r\n          }\r\n\r\n          for(j=0; j<lList.length; j++) {\r\n            tEntry = new CloudRequestEntry(pList[0]);\r\n\r\n            if(lList[j] != '') {\r\n              tEntry.language=lList[j];\r\n            }\r\n\r\n            if(pList.length > 2) {\r\n              tEntry.version=pList[2];\r\n            }\r\n\r\n            // If we've already registered or requested a stub for this keyboard-language pairing,\r\n            // don't bother with a cloud request.\r\n            if(this.isUniqueRequest(cloudList, tEntry)) {\r\n              cloudList.push(tEntry);\r\n            }\r\n          }\r\n        }\r\n        if(typeof(x[i]) == 'object' && x[i] != null) {\r\n          // Register any local keyboards immediately:\r\n          // - must specify filename, keyboard name, language codes, region codes\r\n          // - no request will be sent to cloud\r\n          var stub: KeyboardStub = <KeyboardStub> x[i];\r\n\r\n          if(typeof(x[i]['filename']) == 'string') {                                                   \r\n            if(!this.addStub(x[i])) {\r\n              alert('To use a custom keyboard, you must specify file name, keyboard name, language, language code and region code.');\r\n            }\r\n          } else {\r\n            if(x[i]['language']) {\r\n              console.warn(\"The 'language' property for keyboard stubs has been deprecated.  Please use the 'languages' property instead.\");\r\n              x[i]['languages'] = x[i]['language'];\r\n            }\r\n\r\n            lList=x[i]['languages'];\r\n                \r\n            //Array or single entry?\r\n            if(typeof(lList.length) == 'number') {\r\n              for(j=0; j<lList.length; j++) {\r\n                tEntry = new CloudRequestEntry(x[i]['id'], x[i]['languages'][j]['id']);\r\n                if(this.isUniqueRequest(cloudList, tEntry)) {\r\n                  cloudList.push(tEntry);\r\n                }\r\n              }\r\n            } else { // Single language element\r\n              tEntry = new CloudRequestEntry(x[i]['id'], x[i]['languages'][j]['id']);\r\n              if(this.isUniqueRequest(cloudList, tEntry)) {\r\n                cloudList.push(tEntry);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n      \r\n      // Return if all keyboards being registered are local and fully specified\r\n      if(cloudList.length == 0) {\r\n        return;\r\n      }\r\n\r\n      // Update the keyboard metadata list from keyman.com - build the command\r\n      cmd='&keyboardid=';\r\n      for(i=0; i<cloudList.length; i++) {      \r\n        cmd=cmd+comma+cloudList[i].toString();\r\n        comma=',';\r\n      }  \r\n      \r\n      // Request keyboard metadata from the Keyman Cloud keyboard metadata server\r\n      this.keymanCloudRequest(cmd,false);\r\n    }\r\n\r\n    /** \r\n     *  Register a keyboard for each associated language\r\n     *  \r\n     *  @param  {Object}  kp  Keyboard Object or Object array      \r\n     *  @param  {Object}  options   keymanCloud callback options\r\n     *  @param  {number}  nArg  keyboard index in argument array   \r\n     *       \r\n     **/   \r\n    registerLanguagesForKeyboard(kp, options, nArg:number) {\r\n      var i,j,id,nDflt=0,kbId='';\r\n      \r\n      // Do not attempt to process badly formatted requests\r\n      if(typeof(kp) == 'undefined') {\r\n        return;\r\n      }\r\n      \r\n      if(typeof(options['keyboardid']) == 'string') {\r\n        kbId = options['keyboardid'].split(',')[nArg];\r\n      }\r\n\r\n      // When keyboards requested by language code, several keyboards may be returned as an array\r\n      if(typeof(kp.length) == 'number') {\r\n        // If language code is suffixed by $, register all keyboards for this language\r\n        if(kp.length == 1 || kbId.substr(-1,1) == '$' || kbId == '') {      \r\n          for(i=0; i<kp.length; i++) {\r\n            this.registerLanguagesForKeyboard(kp[i],options,nArg);\r\n          }\r\n        }\r\n        // Register the default keyboard for the language code\r\n        // Until a default is defined, the default will be the Windows keyboard, \r\n        // that is, the keyboard named for the language (exception: English:US), or the\r\n        // first keyboard found.\r\n        else {\r\n          for(i=0; i<kp.length; i++) {\r\n            id=kp[i].id.toLowerCase();\r\n            if(id == 'us') {\r\n              id='english';\r\n            }\r\n\r\n            for(j=0; j<kp[i]['languages'].length; j++) {\r\n              if(id == kp[i]['languages'][j]['name'].toLowerCase()) {\r\n                nDflt = i;\r\n                break;\r\n              }\r\n            }          \r\n          }\r\n\r\n          this.registerLanguagesForKeyboard(kp[nDflt],options,nArg);\r\n        }\r\n      } else { // Otherwise, process a single keyboard for the specified languages \r\n        // May need to filter returned stubs by language\r\n        var lgCode=kbId.split('@')[1];\r\n        if(typeof(lgCode) == 'string') {\r\n          lgCode=lgCode.replace(/\\$$/,'');\r\n        }\r\n        \r\n        // Can only add keyboard stubs for defined languages\r\n        var ll=kp['languages'];\r\n        if(typeof(ll) != 'undefined') {\r\n          if(typeof(ll.length) == 'number') {\r\n            for(i=0; i<ll.length; i++) {\r\n              if(typeof(lgCode) == 'undefined' || ll[i]['id'] == lgCode) {\r\n                this.mergeStub(kp,ll[i],options);\r\n              }\r\n            }\r\n          } else {\r\n            this.mergeStub(kp,ll,options);\r\n          }\r\n        }\r\n      }                              \r\n    }\r\n\r\n    /**\r\n     * Call back from cloud for adding keyboard metadata\r\n     * \r\n     * @param {Object}    x   metadata object\r\n     **/                  \r\n    register(x) {\r\n      var options=x['options'];\r\n    \r\n      // Always clear the timer associated with this callback\r\n      if(x['timerid']) {\r\n        window.clearTimeout(x['timerid']);\r\n      }\r\n      \r\n      // Indicate if unable to register keyboard\r\n      if(typeof(x['error']) == 'string') {\r\n        var badName='';\r\n        if(typeof(x['keyboardid']) == 'string') {\r\n          badName = x['keyboardid'].substr(0,1).toUpperCase()+x['keyboardid'].substr(1);\r\n        }\r\n\r\n        this.serverUnavailable(badName+' keyboard not found.');\r\n        return;\r\n      }\r\n      \r\n      // Ignore callback unless the context is defined\r\n      if(typeof(options) == 'undefined' || typeof(options['context']) == 'undefined') {\r\n        return;\r\n      }\r\n\r\n      // Register each keyboard for the specified language codes\r\n      if(options['context'] == 'keyboard') {\r\n        var i,kp=x['keyboard'];\r\n        // Process array of keyboard definitions\r\n        if(typeof(kp.length) == 'number') {\r\n          for(i=0; i<kp.length; i++) {\r\n            this.registerLanguagesForKeyboard(kp[i],options,i);\r\n          }\r\n        } else { // Process a single keyboard definition\r\n          this.registerLanguagesForKeyboard(kp,options,0);\r\n        }\r\n      } else if(options['context'] == 'language') { // Download the full list of supported keyboard languages\r\n        this.languageList = x['languages'];\r\n        if(this.languagesPending) {\r\n          this.addLanguageKeyboards(this.languagesPending);\r\n        }\r\n        this.languagesPending = [];      \r\n      }\r\n    }\r\n\r\n    /**\r\n     *  Add default or all keyboards for a given language\r\n     *  \r\n     *  @param  {Object}   languages    Array of language names\r\n     **/           \r\n    addLanguageKeyboards(languages) {\r\n      var i, j, lgName, cmd, first, addAll;\r\n      \r\n      // Defer registering keyboards by language until the language list has been loaded\r\n      if(this.languageList == null) {                       \r\n        first = (this.languagesPending.length == 0);\r\n\r\n        for(i=0; i<languages.length; i++) {\r\n          this.languagesPending.push(languages[i]);\r\n        }\r\n\r\n        if(first) {\r\n          this.keymanCloudRequest('',true);\r\n        }   \r\n      } else { // Identify and register each keyboard by language name\r\n        cmd = '';\r\n        for(i=0; i<languages.length; i++) {\r\n          lgName = languages[i].toLowerCase();\r\n          addAll = (lgName.substr(-1,1) == '$'); \r\n          if(addAll) {\r\n            lgName = lgName.substr(0,lgName.length-1);\r\n          }\r\n\r\n          for(j=0; j<this.languageList.length; j++) {\r\n            if(lgName == this.languageList[j]['name'].toLowerCase()) {\r\n              if(cmd != '') {\r\n                cmd = cmd + ',';\r\n              }\r\n\r\n              cmd = cmd+'@'+this.languageList[j]['id'];\r\n              if(addAll) {\r\n                cmd = cmd + '$';\r\n              }\r\n\r\n              break;\r\n            }\r\n          }\r\n        }\r\n\r\n        if(cmd == '') {\r\n          this.keymanweb.util.alert('No keyboards are available for '+languages[0]+'. '\r\n            +'Does it have another language name?');\r\n        } else {\r\n          this.keymanCloudRequest('&keyboardid='+cmd,false);\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n     *  Request keyboard metadata from the Keyman Cloud keyboard metadata server\r\n     *   \r\n     *  @param  {string}   cmd        command string\r\n     *  @param  {boolean?} byLanguage if true, context=languages, else context=keyboards \r\n     **/\r\n    keymanCloudRequest(cmd: string, byLanguage?: boolean) {         \r\n      var URL='https://api.keyman.com/cloud/4.0/', tFlag, \r\n        Lscript = this.keymanweb.util._CreateElement('script');\r\n      \r\n      URL = URL + ((arguments.length > 1) && byLanguage ? 'languages' : 'keyboards')\r\n        +'?jsonp=keyman.register&languageidtype=bcp47&version='+this.keymanweb['version']+'.'+KeymanBase['__BUILD__'];\r\n\r\n      var kbdManager = this;\r\n      \r\n      // Set callback timer\r\n      tFlag='&timerid='+window.setTimeout(\r\n        function(){\r\n          kbdManager.serverUnavailable(cmd);\r\n        }\r\n        ,10000);    \r\n    \r\n      Lscript.charset=\"UTF-8\";                     \r\n      Lscript.src = URL+cmd+tFlag;       \r\n      Lscript.type = 'text/javascript';       \r\n      try {                                  \r\n        document.body.appendChild(Lscript);  \r\n        }\r\n      catch(ex) {                                                     \r\n        document.getElementsByTagName('head')[0].appendChild(Lscript);\r\n        }                  \r\n    }\r\n\r\n    /**\r\n     *  Display warning if Keyman Cloud server fails to respond\r\n     * \r\n     *  @param  {string}  cmd command string sent to Cloud\r\n     *          \r\n     **/       \r\n    private serverUnavailable(cmd) {\r\n      this.keymanweb.util.alert(cmd == '' ? 'Unable to connect to Keyman Cloud server!' : cmd);\r\n      this.keymanweb.warned=true;\r\n    }\r\n\r\n    /**\r\n     * Build 362: removeKeyboards() remove keyboard from list of available keyboards\r\n     * \r\n     * @param {string} x keyboard name string\r\n     * \r\n     */  \r\n    removeKeyboards(x: string) {\r\n      if(arguments.length == 0) {\r\n        return false;\r\n      }\r\n\r\n      var i, j;\r\n      var success = true, activeRemoved = false, anyRemoved = false;;\r\n\r\n      for(i=0; i<arguments.length; i++) {           \r\n        for(j=this.keyboardStubs.length-1; j>=0; j--) {\r\n          if('Keyboard_'+arguments[i] == this.keyboardStubs[j]['KI']) {                 \r\n            if('Keyboard_'+arguments[i] == this.getActiveKeyboardName()) {\r\n              activeRemoved = true;\r\n            }\r\n\r\n            anyRemoved = true;\r\n            this.keyboardStubs.splice(j,1);\r\n            break;\r\n          }\r\n        }\r\n\r\n        if(j < 0) {\r\n          success = false;\r\n        }\r\n      } \r\n\r\n      if(activeRemoved) {\r\n        if(this.keyboardStubs.length > 0) {\r\n        // Always reset to the first remaining keyboard\r\n          this._SetActiveKeyboard(this.keyboardStubs[0]['KI'],this.keyboardStubs[0]['KLC'],true);\r\n        } else {\r\n          this._SetActiveKeyboard('', '', false);\r\n        }\r\n        // This is likely to be triggered by a UI call of some sort, and we need to treat\r\n        // this call as such to properly maintain the globalKeyboard setting.\r\n        this.keymanweb.uiManager.justActivated = true;\r\n      }\r\n\r\n      if(anyRemoved) {\r\n        // Update the UI keyboard menu\r\n        this.doKeyboardUnregistered();\r\n      }\r\n        \r\n      return success;\r\n    }\r\n\r\n    /**\r\n     * Function     _registerKeyboard  KR                    \r\n     * Scope        Public\r\n     * @param       {Object}      Pk      Keyboard  object\r\n     * Description  Register and load the keyboard\r\n     */    \r\n    _registerKeyboard(Pk) {\r\n      // If initialization not yet complete, list the keyboard to be registered on completion of initialization\r\n      if(!this.keymanweb.initialized) {\r\n        this.deferredKR.push(Pk);\r\n        return;\r\n      }\r\n\r\n      if(Pk['_kmw']) {\r\n        console.error(\"The keyboard _kmw property is a reserved field for engine use only; this keyboard is invalid.\");\r\n        return;\r\n      } else {\r\n        Pk['_kmw'] = new KeyboardTag();\r\n      }\r\n      \r\n      var Li,Lstub;\r\n\r\n      // For package namespacing with KMEA/KMEI.\r\n      if(this.keymanweb.isEmbedded) {\r\n        this.keymanweb.preserveID(Pk);\r\n      }\r\n\r\n      // Check if the active stub refers to this keyboard, else find applicable stub\r\n\r\n      var Ps=this.activeStub;\r\n      var savedActiveStub = this.activeStub;\r\n      if(!Ps || !('KI' in Ps) || (Ps['KI'] != Pk['KI'])) {         \r\n        // Find the first stub for this keyboard\r\n        for(Lstub=0; Lstub < this.keyboardStubs.length; Lstub++) { // I1511 - array prototype extended\r\n          Ps=this.keyboardStubs[Lstub];\r\n          if(Pk['KI'] == Ps['KI']) {\r\n            break;\r\n          }\r\n\r\n          Ps=null;\r\n        }\r\n      } \r\n      \r\n      // Build 369: ensure active stub defined when loading local keyboards \r\n      if(this.activeStub == null && Ps != null) {\r\n        this.activeStub = Ps;\r\n      }\r\n      \r\n      // Register the stub for this language (unless it is already registered)\r\n      // keymanweb.KRS(Ps?Ps:Pk); \r\n\r\n      // Test if keyboard already loaded\r\n      for(Li=0; Li<this.keyboards.length; Li++) {\r\n        if(Pk['KI'] == this.keyboards[Li]['KI']) {\r\n          return;\r\n        }\r\n      }\r\n    \r\n      // Append to keyboards array\r\n      this.keyboards=this.keymanweb._push(this.keyboards, Pk); // TODO:  Resolve without need for the cast.\r\n\r\n      // Execute any external (UI) code needed after loading keyboard\r\n      this.doKeyboardLoaded(Pk['KI']);\r\n\r\n      // Restore the originally-active stub to its prior state.  No need to change it permanently.\r\n      this.activeStub = savedActiveStub;\r\n    }\r\n\r\n    /**\r\n     * Add the basic keyboard parameters (keyboard stub) to the array of keyboard stubs\r\n     * If no language code is specified in a keyboard it cannot be registered, \r\n     * and a keyboard stub must be registered before the keyboard is loaded \r\n     * for the keyboard to be usable.\r\n     * \r\n     * @param       {Object}      Pstub     Keyboard stub object\r\n     * @return      {?number}               1 if already registered, else null\r\n     */\r\n    _registerStub(Pstub): number {\r\n      var Lk;\r\n      \r\n      // In initialization not complete, list the stub to be registered on completion of initialization\r\n      if(!this.keymanweb.initialized) {\r\n        this.deferredKRS.push(Pstub);\r\n        return null;\r\n      }\r\n\r\n      // The default stub is always the first keyboard stub loaded [and will be ignored by desktop browsers - not for beta, anyway]\r\n      if(this.dfltStub == null) {\r\n        this.dfltStub=Pstub;\r\n        //if(device.formFactor == 'desktop') return 1;    //Needs further thought before release\r\n      }\r\n\r\n      // If no language code has been defined, and no stub has been registered for this keyboard, register with empty string as the language code\r\n      if(this.keymanweb.isEmbedded) {\r\n        this.keymanweb.namespaceID(Pstub);\r\n      } // else leave undefined.  It's nice to condition upon.\r\n      if(typeof(Pstub['KLC']) == 'undefined') {\r\n        Pstub['KLC'] = '';\r\n      }\r\n      if(typeof(Pstub['KL']) == 'undefined') {\r\n        Pstub['KL'] = 'undefined';\r\n      }\r\n\r\n      // If language code already defined (or not specified in stub), check to see if stub already registered\r\n      for(Lk=0; Lk < this.keyboardStubs.length; Lk++) {\r\n        if(this.keyboardStubs[Lk]['KI'] == Pstub['KI']) {\r\n          if(Pstub['KLC'] == '' || (this.keyboardStubs[Lk]['KLC'] == Pstub['KLC'])) {\r\n            return 1; // no need to register\r\n          }\r\n        }\r\n      }\r\n    \r\n      // Register stub (add to KeyboardStubs array)\r\n      this.keyboardStubs=this.keymanweb._push(this.keyboardStubs, Pstub); // TODO:  Resolve without need for the cast.\r\n\r\n      // TODO: Need to distinguish between initial loading of a large number of stubs and any subsequent loading.\r\n      //   UI initialization should not be needed for each registration, only at end.\r\n      // Reload this keyboard if it was the last active keyboard and \r\n      // make any changes needed by UI for new keyboard stub\r\n      // (Uncommented for Build 360)\r\n      this.doKeyboardRegistered(Pstub['KI'],Pstub['KL'],Pstub['KN'],Pstub['KLC'],Pstub['KP']);\r\n\r\n      // If we have no activeStub because there were no stubs, set the new keyboard as active.\r\n      // Do not trigger on merges.\r\n      if(!this.activeStub && this.dfltStub == Pstub && this.keyboardStubs.length == 1) {\r\n        this.setActiveKeyboard(Pstub['KI'], Pstub['KLC']);\r\n      }\r\n\r\n      return null;\r\n    }\r\n\r\n    /*\r\n    * Last part - the events.\r\n    */\r\n\r\n    /**\r\n     * Execute external (UI) code needed on registering keyboard, used\r\n     * to update each UIs language menu   \r\n     *    \r\n     * Note that the argument object is not at present used by any UI,\r\n     * since the menu is always fully recreated when needed, but the arguments   \r\n     * remain defined to allow for possible use in future (Aug 2014)\r\n     *    \r\n     * @param       {string}            _internalName\r\n     * @param       {string}            _language\r\n     * @param       {string}            _keyboardName\r\n     * @param       {string}            _languageCode\r\n     * @param       {string=}           _packageID        Used by KMEA/KMEI to track .kmp related info.\r\n     * @return      {boolean}\r\n     */       \r\n    doKeyboardRegistered(_internalName: string, _language: string, _keyboardName: string,\r\n        _languageCode: string, _packageID?: string): boolean {\r\n      var p={'internalName':_internalName,'language':_language,'keyboardName':_keyboardName,'languageCode':_languageCode};\r\n      \r\n      // Utilized only by our embedded codepaths.\r\n      if(_packageID) {\r\n        p['package'] = _packageID;\r\n      }\r\n      return this.keymanweb.util.callEvent('kmw.keyboardregistered',p);\r\n    }\r\n    \r\n    /**\r\n     * Execute external (UI) code to rebuild menu when deregistering keyboard\r\n     *    \r\n     * @return      {boolean}   \r\n     */       \r\n\r\n    doKeyboardUnregistered(): boolean {\r\n      var p={};     \r\n      return this.keymanweb.util.callEvent('kmw.keyboardregistered',p);    \r\n    }\r\n    \r\n    /**\r\n     * Execute external (UI) code needed on loading keyboard\r\n     * \r\n     * @param       {string}            _internalName\r\n     * @return      {boolean}   \r\n     */       \r\n    doKeyboardLoaded(_internalName: string): boolean {\r\n      var p={};\r\n      p['keyboardName']=_internalName; \r\n      return this.keymanweb.util.callEvent('kmw.keyboardloaded', p);\r\n    }\r\n      \r\n    /**\r\n     * Function     doBeforeKeyboardChange\r\n     * Scope        Private\r\n     * @param       {string}            _internalName\r\n     * @param       {string}            _languageCode\r\n     * @return      {boolean}   \r\n     * Description  Execute external (UI) code needed before changing keyboard\r\n     */       \r\n    doBeforeKeyboardChange(_internalName: string, _languageCode: string): boolean {\r\n      var p={};\r\n      p['internalName']=_internalName;\r\n      p['languageCode']=_languageCode;\r\n      return this.keymanweb.util.callEvent('kmw.beforekeyboardchange',p);\r\n    }\r\n\r\n    /**\r\n     * Execute external (UI) code needed *after* changing keyboard\r\n     * \r\n     * @param       {string}            _internalName\r\n     * @param       {string}            _languageCode\r\n     * @param       {boolean=}           _indirect\r\n     * @return      {boolean}   \r\n     */       \r\n    doKeyboardChange(_internalName: string, _languageCode: string, _indirect?:boolean): boolean {                      \r\n      var p={};\r\n      p['internalName']=_internalName;\r\n      p['languageCode']=_languageCode; \r\n      p['indirect']=(arguments.length > 2 ? _indirect : false);\r\n      return this.keymanweb.util.callEvent('kmw.keyboardchange', p);\r\n    }\r\n\r\n        \r\n    /**\r\n     * Function     _NotifyKeyboard\r\n     * Scope        Private\r\n     * @param       {number}    _PCommand     event code (16,17,18) or 0\r\n     * @param       {Object}    _PTarget      target element\r\n     * @param       {number}    _PData        1 or 0    \r\n     * Description  Notifies keyboard of keystroke or other event\r\n     */    \r\n    notifyKeyboard = function(_PCommand: number, _PTarget: HTMLElement|Document, _PData: number) { // I2187\r\n      var activeKeyboard = this.activeKeyboard;\r\n\r\n      if(activeKeyboard != null && typeof(activeKeyboard['KNS']) == 'function') {\r\n        activeKeyboard['KNS'](_PCommand, _PTarget, _PData);\r\n      }\r\n    }\r\n\r\n    shutdown() {\r\n      for(let script of this.linkedScripts) {\r\n        if(script.remove) {\r\n          script.remove();\r\n        } else if(script.parentNode) {\r\n          script.parentNode.removeChild(script);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}","/***\r\n   KeymanWeb 11.0\r\n   Copyright 2019 SIL International\r\n***/\r\nnamespace com.keyman {\r\n\r\n  class KeyMap {\r\n    [keycode: string]: number;\r\n  }\r\n\r\n  class BrowserKeyMaps {\r\n    FF:     KeyMap = new KeyMap();\r\n    Safari: KeyMap = new KeyMap();\r\n    Opera:  KeyMap = new KeyMap();\r\n\r\n    constructor() {\r\n      //ffie['k109'] = 189; // -    // These two number-pad VK rules are *not* correct for more recent FF! JMD 8/11/12\r\n      //ffie['k107'] = 187; // =    // FF 3.0 // I2062\r\n      this.FF['k61'] = 187;  // =   // FF 2.0\r\n      this.FF['k59'] = 186;  // ;\r\n    }\r\n  }\r\n\r\n  class LanguageKeyMaps {\r\n    [languageCode: string]: KeyMap;\r\n\r\n    constructor() {\r\n      /* I732 START - 13/03/2007 MCD: Swedish: Start mapping of keystroke to US keyboard #2 */\r\n      // Swedish key map\r\n      this['se'] = new KeyMap();\r\n      this['se']['k220'] =  192; // `\r\n      this['se']['k187'] =  189; // -\r\n      this['se']['k219'] =  187; // =\r\n      this['se']['k221'] =  219; // [\r\n      this['se']['k186'] =  221; // ]\r\n      this['se']['k191'] =  220; // \\\r\n      this['se']['k192'] =  186; // ;\r\n      this['se']['k189'] =  191; // /\r\n\r\n      this['uk'] = new KeyMap();  // I1299\r\n      this['uk']['k223'] =  192; // // ` U+00AC (logical not) =>  ` ~\r\n      this['uk']['k192'] =  222; // ' @  =>  ' \"\r\n      this['uk']['k222'] =  226; // # ~  => K_oE2     // I1504 - UK keyboard mixup #, \\\r\n      this['uk']['k220'] =  220; // \\ |  => \\ |       // I1504 - UK keyboard mixup #, \\\r\n    }\r\n  }\r\n\r\n  export class KeyMapManager {\r\n    browserMap: BrowserKeyMaps = new BrowserKeyMaps();\r\n    languageMap: LanguageKeyMaps = new LanguageKeyMaps();\r\n\r\n    _usCharCodes: KeyMap[];\r\n\r\n    constructor() {\r\n      this._usCodeInit();\r\n    }\r\n\r\n    _usCodeInit() {\r\n      var s0=new KeyMap(),s1=new KeyMap();\r\n\r\n      s0['k192'] = 96;\r\n      s0['k49'] = 49;\r\n      s0['k50'] = 50;\r\n      s0['k51'] = 51;\r\n      s0['k52'] = 52;\r\n      s0['k53'] = 53;\r\n      s0['k54'] = 54;\r\n      s0['k55'] = 55;\r\n      s0['k56'] = 56;\r\n      s0['k57'] = 57;\r\n      s0['k48'] = 48;\r\n      s0['k189'] = 45;\r\n      s0['k187'] = 61;\r\n      s0['k81'] = 113;\r\n      s0['k87'] = 119;\r\n      s0['k69'] = 101;\r\n      s0['k82'] = 114;\r\n      s0['k84'] = 116;\r\n      s0['k89'] = 121;\r\n      s0['k85'] = 117;\r\n      s0['k73'] = 105;\r\n      s0['k79'] = 111;\r\n      s0['k80'] = 112;\r\n      s0['k219'] = 91;\r\n      s0['k221'] = 93;\r\n      s0['k220'] = 92;\r\n      s0['k65'] = 97;\r\n      s0['k83'] = 115;\r\n      s0['k68'] = 100;\r\n      s0['k70'] = 102;\r\n      s0['k71'] = 103;\r\n      s0['k72'] = 104;\r\n      s0['k74'] = 106;\r\n      s0['k75'] = 107;\r\n      s0['k76'] = 108;\r\n      s0['k186'] = 59;\r\n      s0['k222'] = 39;\r\n      s0['k90'] = 122;\r\n      s0['k88'] = 120;\r\n      s0['k67'] = 99;\r\n      s0['k86'] = 118;\r\n      s0['k66'] = 98;\r\n      s0['k78'] = 110;\r\n      s0['k77'] = 109;\r\n      s0['k188'] = 44;\r\n      s0['k190'] = 46;\r\n      s0['k191'] = 47;\r\n\r\n      s1['k192'] = 126;\r\n      s1['k49'] = 33;\r\n      s1['k50'] = 64;\r\n      s1['k51'] = 35;\r\n      s1['k52'] = 36;\r\n      s1['k53'] = 37;\r\n      s1['k54'] = 94;\r\n      s1['k55'] = 38;\r\n      s1['k56'] = 42;\r\n      s1['k57'] = 40;\r\n      s1['k48'] = 41;\r\n      s1['k189'] = 95;\r\n      s1['k187'] = 43;\r\n      s1['k81'] = 81;\r\n      s1['k87'] = 87;\r\n      s1['k69'] = 69;\r\n      s1['k82'] = 82;\r\n      s1['k84'] = 84;\r\n      s1['k89'] = 89;\r\n      s1['k85'] = 85;\r\n      s1['k73'] = 73;\r\n      s1['k79'] = 79;\r\n      s1['k80'] = 80;\r\n      s1['k219'] = 123;\r\n      s1['k221'] = 125;\r\n      s1['k220'] = 124;\r\n      s1['k65'] = 65;\r\n      s1['k83'] = 83;\r\n      s1['k68'] = 68;\r\n      s1['k70'] = 70;\r\n      s1['k71'] = 71;\r\n      s1['k72'] = 72;\r\n      s1['k74'] = 74;\r\n      s1['k75'] = 75;\r\n      s1['k76'] = 76;\r\n      s1['k186'] = 58;\r\n      s1['k222'] = 34;\r\n      s1['k90'] = 90;\r\n      s1['k88'] = 88;\r\n      s1['k67'] = 67;\r\n      s1['k86'] = 86;\r\n      s1['k66'] = 66;\r\n      s1['k78'] = 78;\r\n      s1['k77'] = 77;\r\n      s1['k188'] = 60;\r\n      s1['k190'] = 62;\r\n      s1['k191'] = 63;\r\n\r\n      this._usCharCodes = [s0,s1];\r\n    }\r\n\r\n    /**\r\n     * Function     _USKeyCodeToCharCode\r\n     * Scope        Private\r\n     * @param       {Event}     Levent      KMW event object\r\n     * @return      {number}                Character code \r\n     * Description Translate keyboard codes to standard US layout codes\r\n     */    \r\n    _USKeyCodeToCharCode(Levent: KeyEvent) {\r\n      return this._usCharCodes[Levent.Lmodifiers & 0x10 ? 1 : 0]['k'+Levent.Lcode];\r\n    };\r\n  }\r\n}","namespace com.keyman {\r\n\r\n  class Hotkey {\r\n    code: number;\r\n    shift: number;\r\n    handler: () => void\r\n\r\n    constructor(code: number, shift: number, handler: () => void) {\r\n      this.code = code;\r\n      this.shift = shift;\r\n      this.handler = handler;\r\n    }\r\n\r\n    matches(keyCode: number, shiftState: number): boolean {\r\n      return (this.code == keyCode && this.shift == shiftState);\r\n    }\r\n  }\r\n\r\n  export class HotkeyManager {\r\n    keyman: KeymanBase;\r\n    hotkeys: Hotkey[] = [];\r\n\r\n    constructor(keyman: KeymanBase) {\r\n      this.keyman = keyman;\r\n    }\r\n\r\n    /**\r\n     * Function     addHotkey\r\n     * Scope        Public\r\n     * @param       {number}            keyCode\r\n     * @param       {number}            shiftState\r\n     * @param       {function(Object)}  handler\r\n     * Description  Add hot key handler to array of document-level hotkeys triggered by key up event\r\n     */\r\n    addHotKey(keyCode: number, shiftState: number, handler: () => void) {\r\n      // Test if existing handler for this code and replace it if so\r\n      for(var i=0; i<this.hotkeys.length; i++) {\r\n        if(this.hotkeys[i].code == keyCode && this.hotkeys[i].shift == shiftState) {\r\n          this.hotkeys[i].handler = handler;\r\n          return;\r\n        }\r\n      }\r\n\r\n      // Otherwise add it to the array\r\n      this.hotkeys.push(new Hotkey(keyCode, shiftState, handler));\r\n    }              \r\n\r\n    /**\r\n     * Function     removeHotkey\r\n     * Scope        Public\r\n     * @param       {number}        keyCode\r\n     * @param       {number}        shiftState\r\n     * Description  Remove a hot key handler from array of document-level hotkeys triggered by key up event\r\n     */\r\n    /*keymanweb['removeHotKey'] = */removeHotkey(keyCode: number, shiftState: number) {\r\n      for(var i=0; i<this.hotkeys.length; i++) {\r\n        if(this.hotkeys[i].matches(keyCode, shiftState)) {\r\n          this.hotkeys.splice(i,1);\r\n          return;\r\n        }\r\n      }\r\n    }\r\n                  \r\n    /**\r\n     * Function     _Process\r\n     * Scope        Private\r\n     * @param       {Event}       e       event\r\n     * Description  Passes control to handlers according to the hotkey pressed\r\n     */\r\n    _Process: (e: KeyboardEvent) => boolean = function(e: KeyboardEvent) {\r\n      if(!e) {\r\n        e = window.event as KeyboardEvent;\r\n      }\r\n\r\n      var _Lcode = this.keyman.domManager.nonTouchHandlers._GetEventKeyCode(e);\r\n      if(_Lcode == null) {\r\n        return false;\r\n      }\r\n      \r\n      // Removed testing of e.shiftKey==null  I3363 (Build 301)\r\n      var _Lmodifiers = \r\n        (e.shiftKey ? 0x10 : 0) |\r\n        (e.ctrlKey ? 0x20 : 0) | \r\n        (e.altKey ? 0x40 : 0);\r\n\r\n      for(var i=0; i<this.hotkeys.length; i++) {  \r\n        if(this.hotkeys[i].matches(_Lcode, _Lmodifiers)) { \r\n          this.hotkeys[i].Handler(); \r\n          e.returnValue = false; \r\n          if(e && e.preventDefault) e.preventDefault(); \r\n          e.cancelBubble = true; \r\n          return false; \r\n        }\r\n      }\r\n      return true;\r\n    }.bind(this);  \r\n  }\r\n}","namespace com.keyman {\r\n\r\n  export class UIState {\r\n    ['activated']: boolean;\r\n    ['activationPending']: boolean;\r\n\r\n    constructor(pending: boolean, activated: boolean) {\r\n      this['activationPending'] = pending;\r\n      this['activated'] = activated;\r\n    }\r\n  }\r\n\r\n  export class UIManager {\r\n    keyman: KeymanBase;\r\n\r\n    isActivating: boolean = false;    // ActivatingKeymanWebUI - is the KeymanWeb DIV in process of being clicked on?\r\n    justActivated: boolean = false;   // JustActivatedKeymanWebUI - focussing back to control after KeymanWeb UI interaction\r\n\r\n    constructor(keyman: KeymanBase) {\r\n      this.keyman = keyman;\r\n    }\r\n\r\n    /**\r\n     * Function     getUIState\r\n     * Scope        Public   \r\n     * @return      {Object.<string,boolean>}\r\n     * Description  Return object with activation state of UI:\r\n     *                activationPending (bool):   KMW being activated\r\n     *                activated         (bool):   KMW active    \r\n     */    \r\n    getUIState(): UIState {\r\n      return new UIState(this.isActivating, this.justActivated);\r\n    }\r\n\r\n    /**\r\n     * Set or clear the IsActivatingKeymanWebUI flag (exposed function)\r\n     * \r\n     * @param       {(boolean|number)}  state  Activate (true,false)\r\n     */\r\n    setActivatingUI(state: boolean|number) {\r\n      this.isActivating = state ? true : false;\r\n    }\r\n\r\n    /**\r\n     * Function     doLoad\r\n     * Scope        Private\r\n     * @return      {boolean}   \r\n     * Description  Execute UI initialization code after loading the UI\r\n     *              // Appears to be unused; could be eliminated?  Though, doUnload IS used.\r\n     */       \r\n    doLoad() {\r\n      var p={};\r\n      return this.keyman.util.callEvent('kmw.loaduserinterface',p);\r\n    }\r\n\r\n    /**\r\n     * Function     doUnload\r\n     * Scope        Private\r\n     * @return      {boolean}   \r\n     * Description  Execute UI cleanup code before unloading the UI (may not be required?)\r\n     */       \r\n    doUnload = function() {\r\n      var p={};\r\n      return this.keyman.util.callEvent('kmw.unloaduserinterface',p);\r\n    }\r\n  }\r\n}","// Includes KMW-added property declaration extensions for HTML elements.\r\n/// <reference path=\"kmwexthtml.ts\" />\r\n// Includes a promise polyfill (needed for IE)\r\n/// <reference path=\"../node_modules/promise-polyfill/lib/polyfill.js\" />\r\n// Defines build-environment includes, since `tsc` doesn't provide a compile-time define.\r\n/// <reference path=\"environment.inc.ts\" />\r\n// Defines the web-page interface object.\r\n/// <reference path=\"kmwdom.ts\" />\r\n// Includes KMW-added property declaration extensions for HTML elements.\r\n/// <reference path=\"kmwutils.ts\" />\r\n// Defines the keyboard callback object.\r\n/// <reference path=\"kmwcallback.ts\" />\r\n// Defines keyboard data & management classes.\r\n/// <reference path=\"kmwkeyboards.ts\" />\r\n// Defines built-in keymapping.\r\n/// <reference path=\"kmwkeymaps.ts\" />\r\n// Defines KMW's hotkey management object.\r\n/// <reference path=\"kmwhotkeys.ts\" />\r\n// Defines the ui management code that tracks UI activation and such.\r\n/// <reference path=\"kmwuimanager.ts\" />\r\n\r\n/***\r\n   KeymanWeb 11.0\r\n   Copyright 2017-2019 SIL International\r\n***/\r\nnamespace com.keyman {\r\n  export class KeymanBase {\r\n    _TitleElement = null;      // I1972 - KeymanWeb Titlebar should not be a link\r\n    _IE = 0;                   // browser version identification\r\n    _MasterDocument = null;    // Document with controller (to allow iframes to distinguish local/master control)\r\n    _HotKeys = [];             // Array of document-level hotkey objects\r\n    warned = false;            // Warning flag (to prevent multiple warnings)\r\n    baseFont = 'sans-serif';   // Default font for mapped input elements\r\n    appliedFont = '';          // Chain of fonts to be applied to mapped input elements\r\n    fontCheckTimer = null;     // Timer for testing loading of embedded fonts\r\n    srcPath = '';              // Path to folder containing executing keymanweb script\r\n    rootPath = '';             // Path to server root\r\n    protocol = '';             // Protocol used for the KMW script.\r\n    mustReloadKeyboard = false;// Force keyboard refreshing even if already loaded\r\n    globalKeyboard = null;     // Indicates the currently-active keyboard for controls without independent keyboard settings.\r\n    globalLanguageCode = null; // Indicates the language code corresponding to `globalKeyboard`.\r\n    isEmbedded = false;        // Indicates if the KeymanWeb instance is embedded within a mobile app.\r\n                                // Blocks full page initialization when set to `true`.\r\n    refocusTimer = 0;          // Tracks a timeout event that aids of OSK modifier/state key tracking when the document loses focus.\r\n\r\n    initialized: number;       // Signals the initialization state of the KeymanWeb system.\r\n    'build' = 300;           // TS needs this to be defined within the class.\r\n\r\n    // Used as placeholders during initialization.\r\n    // The corresponding class properties should be dropped after a refactor;\r\n    // this is an intermediate solution while doing the big conversion.\r\n    static _srcPath: string;\r\n    static _rootPath: string;\r\n    static _protocol: string;\r\n    static __BUILD__: number;\r\n\r\n    // Internal objects\r\n    ['util']: Util;\r\n    ['osk']: any;\r\n    ['ui']: any;\r\n    ['interface']: KeyboardInterface;\r\n    keyboardManager: KeyboardManager;\r\n    domManager: DOMManager;\r\n    hotkeyManager: HotkeyManager;\r\n    uiManager: UIManager;\r\n    keyMapManager: KeyMapManager;\r\n\r\n    touchAliasing: DOMEventHandlers;\r\n\r\n    // Defines option-tracking object as a string map.\r\n    options: { [name: string]: string; } = {\r\n      'root':'',\r\n      'resources':'',\r\n      'keyboards':'',\r\n      'fonts':'',\r\n      'attachType':'',\r\n      'ui':null\r\n    };;\r\n\r\n\r\n    // Stub functions (defined later in code only if required)\r\n    setDefaultDeviceOptions(opt){}     \r\n    getStyleSheetPath(s){return s;}\r\n    getKeyboardPath(f, p?){return f;}\r\n    KC_(n, ln, Pelem){return '';} \r\n    handleRotationEvents(){}\r\n    // Will serve as an API function for a workaround, in case of future touch-alignment issues.\r\n    ['alignInputs'](eleList?: HTMLElement[]){}\r\n    hideInputs() {};\r\n    namespaceID(Pstub) {};\r\n    preserveID(Pk) {};\r\n\r\n    setInitialized(val: number) {\r\n      this.initialized = this['initialized'] = val;\r\n    }\r\n\r\n    refreshElementContent = null;\r\n\r\n    // -------------\r\n\r\n    constructor() {\r\n      // Allow internal minification of the public modules.\r\n      this.util = this['util'] = new Util(this);\r\n      window['KeymanWeb'] = this.interface = this['interface'] = new KeyboardInterface(this);\r\n      this.osk = this['osk'] = {ready:false};\r\n      this.ui = this['ui'] = null;\r\n\r\n      this.keyboardManager = new KeyboardManager(this);\r\n      this.domManager = new DOMManager(this);\r\n      this.hotkeyManager = new HotkeyManager(this);\r\n      this.uiManager = new UIManager(this);\r\n      this.keyMapManager = new KeyMapManager();\r\n\r\n      // Load properties from their static variants.\r\n      this['build'] = KeymanBase.__BUILD__;\r\n      this.srcPath = KeymanBase._srcPath;\r\n      this.rootPath = KeymanBase._rootPath;\r\n      this.protocol = KeymanBase._protocol;\r\n\r\n      this['version'] = com.keyman.environment.VERSION;\r\n      this['helpURL'] = 'http://help.keyman.com/go';\r\n      this.setInitialized(0);\r\n\r\n      // Signals that a KMW load has occurred in order to prevent double-loading.\r\n      this['loaded'] = true;\r\n    }\r\n\r\n    delayedInit() {\r\n      // Track the selected Event-handling object.\r\n      this.touchAliasing = this.util.device.touchable ? this.domManager.touchHandlers : this.domManager.nonTouchHandlers;\r\n    }\r\n\r\n    /**\r\n     * Triggers a KeymanWeb engine shutdown to facilitate a full system reset.\r\n     * This function is designed for use with KMW unit-testing, which reloads KMW\r\n     * multiple times to test the different initialization paths.\r\n     */\r\n    ['shutdown']() {\r\n      this.domManager.shutdown();\r\n      this.osk.shutdown();\r\n      this.util.shutdown();\r\n      this.keyboardManager.shutdown();\r\n\r\n      if(this.ui && this.ui.shutdown) {\r\n        this.ui.shutdown();\r\n      }\r\n\r\n      DOMEventHandlers.states = new CommonDOMStates();\r\n    }\r\n\r\n    /**\r\n     * Expose font testing to allow checking that SpecialOSK or custom font has\r\n     * been correctly loaded by browser\r\n     * \r\n     *  @param  {string}  fName   font-family name\r\n     *  @return {boolean}         true if available\r\n     **/         \r\n    ['isFontAvailable'](fName: string): boolean {\r\n      return this.util.checkFont({'family':fName});\r\n    }\r\n\r\n    /**\r\n     * Function     addEventListener\r\n     * Scope        Public\r\n     * @param       {string}            event     event to handle\r\n     * @param       {function(Event)}   func      event handler function\r\n     * @return      {boolean}                     value returned by util.addEventListener\r\n     * Description  Wrapper function to add and identify KeymanWeb-specific event handlers\r\n     */       \r\n    ['addEventListener'](event: string, func): boolean {\r\n      return this.util.addEventListener('kmw.'+event, func);\r\n    }\r\n\r\n      /**\r\n     * Function     _GetEventObject\r\n     * Scope        Private   \r\n     * @param       {Event=}     e     Event object if passed by browser\r\n     * @return      {Event|null}       Event object              \r\n     * Description Gets the event object from the window when using Internet Explorer\r\n     *             and handles getting the event correctly in frames \r\n     */     \r\n    _GetEventObject<E extends Event>(e: E) {  // I2404 - Attach to controls in IFRAMEs\r\n      if (!e) {\r\n        e = window.event as E;\r\n        if(!e) {\r\n          var elem: HTMLElement|Document = this.domManager.getLastActiveElement();\r\n          if(elem) {\r\n            elem = elem.ownerDocument;\r\n            var win: Window;\r\n            if(elem) {\r\n              win = elem.defaultView;\r\n            }\r\n            if(!win) {\r\n              return null;\r\n            }\r\n            \r\n            e = win.event as E;\r\n          }\r\n        }\r\n      }\r\n      \r\n      return e;    \r\n    }\r\n\r\n    /**\r\n     * Function     _push\r\n     * Scope        Private   \r\n     * @param       {Array}     Parray    Array   \r\n     * @param       {*}         Pval      Value to be pushed or appended to array   \r\n     * @return      {Array}               Returns extended array\r\n     * Description  Push (if possible) or append a value to an array \r\n     */  \r\n    _push<T>(Parray: T[], Pval: T) {\r\n      if(Parray.push) {\r\n        Parray.push(Pval);\r\n      } else {\r\n        Parray=Parray.concat(Pval);\r\n      }\r\n      return Parray;\r\n    }\r\n\r\n    // Base object API definitions\r\n\r\n    /**\r\n     * Function     attachToControl\r\n     * Scope        Public\r\n     * @param       {Element}    Pelem       Element to which KMW will be attached\r\n     * Description  Attaches KMW to control (or IFrame) \r\n     */  \r\n    ['attachToControl'](Pelem: HTMLElement) {\r\n      this.domManager.attachToControl(Pelem);\r\n    }\r\n\r\n    /**\r\n     * Function     detachFromControl\r\n     * Scope        Public\r\n     * @param       {Element}    Pelem       Element from which KMW will detach\r\n     * Description  Detaches KMW from a control (or IFrame) \r\n     */  \r\n    ['detachFromControl'](Pelem: HTMLElement) {\r\n      this.domManager.detachFromControl(Pelem);\r\n    }\r\n\r\n    /**\r\n     * Exposed function to load keyboards by name. One or more arguments may be used\r\n     * \r\n     * @param {string|Object} x keyboard name string or keyboard metadata JSON object\r\n     * \r\n     */  \r\n    ['addKeyboards'](x) {\r\n      if(arguments.length == 0) {\r\n        this.keyboardManager.keymanCloudRequest('',false);\r\n      } else {\r\n        this.keyboardManager.addKeyboardArray(arguments);\r\n      }\r\n    }\r\n    \r\n    /**\r\n     *  Add default or all keyboards for a given language\r\n     *  \r\n     *  @param  {string}   arg    Language name (multiple arguments allowed)\r\n     **/           \r\n    ['addKeyboardsForLanguage'](arg) {\r\n      this.keyboardManager.addLanguageKeyboards(arguments);\r\n    }\r\n    \r\n    /**\r\n     * Call back from cloud for adding keyboard metadata\r\n     * \r\n     * @param {Object}    x   metadata object\r\n     **/                  \r\n    ['register'](x) {                     \r\n      this.keyboardManager.register(x);\r\n    }\r\n\r\n    /**\r\n     * Build 362: removeKeyboards() remove keyboard from list of available keyboards\r\n     * \r\n     * @param {string} x keyboard name string\r\n     * \r\n     */  \r\n    ['removeKeyboards'](x) {\r\n      return this.keyboardManager.removeKeyboards(x);\r\n    }\r\n\r\n    /**\r\n     * Allow to change active keyboard by (internal) keyboard name\r\n     * \r\n     * @param       {string}    PInternalName   Internal name\r\n     * @param       {string}    PLgCode         Language code\r\n     */    \r\n    ['setActiveKeyboard'](PInternalName: string, PLgCode: string): Promise<void> {\r\n      return this.keyboardManager.setActiveKeyboard(PInternalName,PLgCode);\r\n    }\r\n    \r\n    /**\r\n     * Function     getActiveKeyboard\r\n     * Scope        Public\r\n     * @return      {string}      Name of active keyboard\r\n     * Description  Return internal name of currently active keyboard\r\n     */    \r\n    ['getActiveKeyboard'](): string {\r\n      return this.keyboardManager.getActiveKeyboardName();\r\n    }\r\n\r\n    /**\r\n     * Function    getActiveLanguage\r\n     * Scope       Public\r\n     * @return     {string}         language code\r\n     * Description Return language code for currently selected language\r\n     */    \r\n    ['getActiveLanguage'](): string {\r\n      return this.keyboardManager.getActiveLanguage();\r\n    }\r\n\r\n    ['isAttached'](x: HTMLElement): boolean {\r\n      return this.domManager.isAttached(x);\r\n    }\r\n\r\n    /**\r\n     * Function    isCJK\r\n     * Scope       Public\r\n     * @param      {Object=}  k0 \r\n     * @return     {boolean}\r\n     * Description Tests if active keyboard (or optional argument) uses a pick list (Chinese, Japanese, Korean, etc.)\r\n     *             (This function accepts either keyboard structure.)   \r\n     */    \r\n    ['isCJK'](k0) { \r\n      return this.keyboardManager.isCJK(k0);\r\n    }\r\n\r\n    /**\r\n     * Function     isChiral\r\n     * Scope        Public\r\n     * @param       {string|Object=}   k0\r\n     * @return      {boolean}\r\n     * Description  Tests if the active keyboard (or optional argument) uses chiral modifiers.\r\n     */\r\n    ['isChiral'](k0?) {\r\n      return this.keyboardManager.isChiral(k0);\r\n    }\r\n\r\n    /**\r\n     * Get keyboard meta data for the selected keyboard and language\r\n     * \r\n     * @param       {string}    PInternalName     Internal name of keyboard\r\n     * @param       {string=}   PlgCode           language code\r\n     * @return      {Object}                      Details of named keyboard \r\n     *                                            \r\n     **/    \r\n    ['getKeyboard'](PInternalName: string, PlgCode?: string) {\r\n      var Ln, Lrn;\r\n\r\n      var kbdList = this.keyboardManager.getDetailedKeyboards();\r\n\r\n      for(Ln=0; Ln < kbdList.length; Ln++) {\r\n        Lrn = kbdList[Ln];\r\n\r\n        if(Lrn['InternalName'] == PInternalName || Lrn['InternalName'] == \"Keyboard_\" + PInternalName) { \r\n          if(arguments.length < 2) {\r\n            return Lrn;\r\n          }\r\n\r\n          if(Lrn['LanguageCode'] == PlgCode) {\r\n            return Lrn;\r\n          }\r\n        } \r\n      }\r\n\r\n      return null;\r\n    }\r\n    \r\n    /**\r\n     * Get array of available keyboard stubs \r\n     * \r\n     * @return   {Array}     Array of available keyboards\r\n     * \r\n     */    \r\n    ['getKeyboards']() {\r\n      return this.keyboardManager.getDetailedKeyboards();\r\n    }\r\n\r\n    /**\r\n     * Gets the cookie for the name and language code of the most recently active keyboard\r\n     * \r\n     *  Defaults to US English, but this needs to be user-set in later revision (TODO)      \r\n     * \r\n     * @return      {string}          InternalName:LanguageCode \r\n     */    \r\n    ['getSavedKeyboard']() {\r\n      return this.keyboardManager.getSavedKeyboard();  \r\n    }\r\n\r\n    /**\r\n     * Function     Initialization\r\n     * Scope        Public\r\n     * @param       {Object}  arg     object array of user-defined properties\r\n     * Description  KMW window initialization  \r\n     */    \r\n    ['init'](arg): Promise<any> {\r\n      return this.domManager.init(arg);\r\n    }\r\n\r\n    /**\r\n     * Function     resetContext\r\n     * Scope        Public\r\n     * Description  Revert OSK to default layer and clear any deadkeys and modifiers\r\n     */\r\n    ['resetContext']() {\r\n      this.interface.resetContext();\r\n    };\r\n\r\n    /**\r\n     * Function     setNumericLayer\r\n     * Scope        Public\r\n     * Description  Set OSK to numeric layer if it exists\r\n     */\r\n    ['setNumericLayer']() {\r\n      this.interface.setNumericLayer();\r\n    };\r\n\r\n    /**\r\n     * Function     disableControl\r\n     * Scope        Public\r\n     * @param       {Element}      Pelem       Element to be disabled\r\n     * Description  Disables a KMW control element \r\n     */    \r\n    ['disableControl'](Pelem: HTMLElement) {\r\n      this.domManager.disableControl(Pelem);\r\n    }\r\n\r\n    /**\r\n     * Function     enableControl\r\n     * Scope        Public\r\n     * @param       {Element}      Pelem       Element to be disabled\r\n     * Description  Disables a KMW control element \r\n     */    \r\n    ['enableControl'](Pelem: HTMLMapElement) {\r\n      this.domManager.enableControl(Pelem);\r\n    }\r\n    \r\n    /**\r\n     * Function     setKeyboardForControl\r\n     * Scope        Public   \r\n     * @param       {Element}    Pelem    Control element \r\n     * @param       {string|null=}    Pkbd     Keyboard (Clears the set keyboard if set to null.)  \r\n     * @param       {string|null=}     Plc      Language Code\r\n     * Description  Set default keyboard for the control \r\n     */    \r\n    ['setKeyboardForControl'](Pelem: HTMLElement, Pkbd?: string, Plc?: string) {\r\n      this.domManager.setKeyboardForControl(Pelem, Pkbd, Plc);\r\n    }\r\n\r\n    /**\r\n     * Function     getKeyboardForControl\r\n     * Scope        Public   \r\n     * @param       {Element}    Pelem    Control element \r\n     * @return      {string|null}         The independently-managed keyboard for the control.\r\n     * Description  Returns the keyboard ID of the current independently-managed keyboard for this control.\r\n     *              If it is currently following the global keyboard setting, returns null instead.\r\n     */\r\n    ['getKeyboardForControl'](Pelem) {\r\n      this.domManager.getKeyboardForControl(Pelem);\r\n    }\r\n\r\n    /**\r\n     * Function     getLanguageForControl\r\n     * Scope        Public   \r\n     * @param       {Element}    Pelem    Control element \r\n     * @return      {string|null}         The independently-managed keyboard for the control.\r\n     * Description  Returns the language code used with the current independently-managed keyboard for this control.\r\n     *              If it is currently following the global keyboard setting, returns null instead.\r\n     */\r\n    ['getLanguageForControl'](Pelem) {\r\n      this.domManager.getLanguageForControl(Pelem);\r\n    }\r\n\r\n    /**\r\n     * Set focus to last active target element (browser-dependent)\r\n     */    \r\n    ['focusLastActiveElement']() {\r\n      this.domManager.focusLastActiveElement();\r\n    }\r\n    \r\n    /**\r\n     * Get the last active target element *before* KMW activated (I1297)\r\n     * \r\n     * @return      {Object}        \r\n     */    \r\n    ['getLastActiveElement']() {\r\n      return this.domManager.getLastActiveElement();\r\n    }\r\n\r\n    /**\r\n     *  Set the active input element directly optionally setting focus \r\n     * \r\n     *  @param  {Object|string} e         element id or element\r\n     *  @param  {boolean=}      setFocus  optionally set focus  (KMEW-123) \r\n     **/\r\n    ['setActiveElement'](e: string|HTMLElement, setFocus: boolean) {\r\n      return this.domManager.setActiveElement(e, setFocus);\r\n    }\r\n\r\n    /**\r\n     * Move focus to user-specified element\r\n     * \r\n     *  @param  {string|Object}   e   element or element id\r\n     *           \r\n     **/\r\n    ['moveToElement'](e: string|HTMLElement) {\r\n      this.domManager.moveToElement(e);\r\n    }\r\n\r\n    /**\r\n     * Function     addHotkey\r\n     * Scope        Public\r\n     * @param       {number}            keyCode\r\n     * @param       {number}            shiftState\r\n     * @param       {function(Object)}  handler\r\n     * Description  Add hot key handler to array of document-level hotkeys triggered by key up event\r\n     */\r\n    ['addHotKey'](keyCode: number, shiftState: number, handler: () => void) {\r\n      this.hotkeyManager.addHotKey(keyCode, shiftState, handler);\r\n    }\r\n\r\n    /**\r\n     * Function     removeHotkey\r\n     * Scope        Public\r\n     * @param       {number}        keyCode\r\n     * @param       {number}        shiftState\r\n     * Description  Remove a hot key handler from array of document-level hotkeys triggered by key up event\r\n     */\r\n    ['removeHotKey'](keyCode: number, shiftState: number) {\r\n      this.hotkeyManager.removeHotkey(keyCode, shiftState);\r\n    }\r\n\r\n    /**\r\n     * Function     getUIState\r\n     * Scope        Public   \r\n     * @return      {Object.<string,(boolean|number)>}\r\n     * Description  Return object with activation state of UI:\r\n     *                activationPending (bool):   KMW being activated\r\n     *                activated         (bool):   KMW active    \r\n     */    \r\n    ['getUIState'](): UIState {\r\n      return this.uiManager.getUIState();\r\n    }\r\n\r\n    /**\r\n     * Set or clear the IsActivatingKeymanWebUI flag (exposed function)\r\n     * \r\n     * @param       {(boolean|number)}  state  Activate (true,false)\r\n     */\r\n    ['activatingUI'](state: boolean) {\r\n      this.uiManager.setActivatingUI(state);\r\n    } \r\n\r\n    // Functions that might be added later\r\n    ['beepKeyboard']: () => void;\r\n    ['oninserttext']: (dn: number, s: string) => void;\r\n  }\r\n}\r\n\r\n/**\r\n * Determine path and protocol of executing script, setting them as\r\n * construction defaults.\r\n *    \r\n * This can only be done during load when the active script will be the  \r\n * last script loaded.  Otherwise the script must be identified by name.\r\n*/\r\nvar scripts = document.getElementsByTagName('script');\r\nvar ss = scripts[scripts.length-1].src;\r\nvar sPath = ss.substr(0,ss.lastIndexOf('/')+1);\r\n\r\nimport KeymanBase = com.keyman.KeymanBase;\r\n\r\nKeymanBase._srcPath = sPath;\r\nKeymanBase._rootPath = sPath.replace(/(https?:\\/\\/)([^\\/]*)(.*)/,'$1$2/');\r\nKeymanBase._protocol = sPath.replace(/(.{3,5}:)(.*)/,'$1');\r\n\r\n/** @define {number} build counter that gets set by the build environment */\r\nKeymanBase.__BUILD__ = 299;\r\n\r\n/**  \r\n * Base code: Declare major component namespaces, instances, and utility functions \r\n */  \r\n\r\n// If a copy of the script is already loaded, detect this and prevent re-initialization / data reset.\r\nif(!window['keyman'] || !window['keyman']['loaded']) {\r\n\r\n  (function() {\r\n    /* The base object call may need to be moved into a separate, later file eventually.\r\n     * It will be necessary to override methods with kmwnative.ts and kmwembedded.ts before the\r\n     * affected objects are initialized.\r\n     * \r\n     * We only recreate the 'keyman' object if it's not been loaded.\r\n     * As this is the base object, not creating it prevents a KMW system reset.\r\n     */\r\n    var keymanweb = window['keyman'] = new KeymanBase();\r\n    \r\n    // Define public OSK, user interface and utility function objects \r\n\r\n    var osk: any = keymanweb['osk'];\r\n    var ui: any = keymanweb['ui'] = {};\r\n    \r\n    osk.highlightSubKeys = function(k,x,y){}\r\n    osk.createKeyTip = function(){}\r\n    osk.optionKey = function(e,keyName,keyDown){}\r\n    osk.showKeyTip = function(key,on){}  \r\n    osk.waitForFonts = function(kfd,ofd){return true;}\r\n  })();\r\n}","// Includes KMW-added property declaration extensions for HTML elements.\r\n/// <reference path=\"kmwexthtml.ts\" />\r\n// Includes KMW string extension declarations.\r\n/// <reference path=\"kmwstring.ts\" />\r\n// Includes type definitions for basic KMW types.\r\n/// <reference path=\"kmwtypedefs.ts\" />\r\n\r\n/***\r\n   KeymanWeb 11.0\r\n   Copyright 2019 SIL International\r\n***/\r\n\r\n// If KMW is already initialized, the KMW script has been loaded more than once. We wish to prevent resetting the \r\n// KMW system, so we use the fact that 'initialized' is only 1 / true after all scripts are loaded for the initial\r\n// load of KMW.\r\nif(!window['keyman']['initialized']) { \r\n\r\n  // Continued KeymanWeb initialization.\r\n  (function() \r\n  {\r\n\r\n    // Declare KeymanWeb, OnScreen Keyboard and Util object variables\r\n    var keymanweb=window['keyman'],osk=keymanweb['osk'],util=keymanweb['util'], device=util.device;\r\n    var kbdInterface=keymanweb['interface'];\r\n\r\n    /**\r\n     * Function     debug\r\n     * Scope        Private\r\n     * @param       {(string|Object)}     s   string (or object) to print\r\n     * Description  Simple debug display (upper right of screen)\r\n     *              Extended to support multiple arguments May 2015   \r\n     */       \r\n    keymanweb['debug']=keymanweb.debug=function(s){\r\n      var p;\r\n      if(keymanweb.debugElement == null)\r\n      {\r\n        var d=document.createElement('DIV'),ds=d.style;\r\n        ds.position='absolute';ds.width='30%';ds.maxHeight='50%';ds.top='0';ds.right='0';\r\n        ds.minHeight='50px'; ds.border='1px solid blue'; ds.whiteSpace='pre-line';ds.overflowY='scroll';\r\n        p=document.createElement('P'); p.id='debug_output';p.style.margin='2px';\r\n        d.appendChild(p);\r\n        document.body.appendChild(d);   \r\n        keymanweb.debugElement=p;  \r\n      } \r\n      if((p=document.getElementById('debug_output')) == null) return; \r\n\r\n      if(arguments.length == 0)\r\n        if(typeof p.textContent != 'undefined') p.textContent=''; else p.innerHTML='';\r\n      else\r\n      {\r\n        var ts=new Date().toTimeString().substr(3,5),t=ts+' ',t1,k,m,sx;\r\n        for(k=0; k<arguments.length; k++)\r\n        {\r\n          if(k > 0) t = t + '; ';\r\n          sx = arguments[k];\r\n          if(typeof sx == 'object')\r\n          {\r\n            if(sx == null)\r\n            {\r\n              t = t + 'null';\r\n            }\r\n            else\r\n            {\r\n              t1 = '';\r\n              for(m in sx) \r\n              {\r\n                if(t1.length > 0) t1 = t1 + ', ';\r\n                t1 = t1 + m + ':';              \r\n                switch(typeof sx[m])\r\n                {\r\n                  case 'string':\r\n                  case 'number':\r\n                  case 'boolean':\r\n                    t1 = t1 + sx[m]; break;\r\n                  default:\r\n                    t1 = t1 + typeof sx[m]; break;\r\n                }\r\n                if(t1.length > 1024) \r\n                {\r\n                  t1 = t1.substr(0,1000)+'...'; break;\r\n                }\r\n              }\r\n              if(t1.length > 0) t = t + '{' + t1 + '}';\r\n            }\r\n          }\r\n          else\r\n          {\r\n            t = t + sx;\r\n          }\r\n        } \r\n        // Truncate if necessary to avoid memory problems\r\n        if(t.length > 1500) t = t.substr(0,1500) + ' (more)';  \r\n        \r\n        if(typeof p.textContent != 'undefined')\r\n          p.textContent=t+'\\n'+p.textContent;\r\n        else\r\n          p.innerHTML=t+'<br />'+p.innerHTML;\r\n        \r\n      }\r\n    }\r\n\r\n    /*\r\n     * The following code existed here as part of the original pre-conversion JavaScript source, performing some inline initialization.\r\n     * Ideally, this will be refactored once proper object-orientation of the codebase within TypeScript is complete.\r\n     */\r\n    keymanweb.debugElement=null;\r\n    var dbg=keymanweb.debug;\r\n        \r\n    keymanweb.delayedInit();\r\n\r\n    // I732 START - Support for European underlying keyboards #1\r\n    if(typeof(window['KeymanWeb_BaseLayout']) !== 'undefined') \r\n      osk._BaseLayout = window['KeymanWeb_BaseLayout'];\r\n    else\r\n      osk._BaseLayout = 'us';    \r\n    \r\n    \r\n    keymanweb._BrowserIsSafari = (navigator.userAgent.indexOf('AppleWebKit') >= 0);  // I732 END - Support for European underlying keyboards #1      \r\n\r\n  //TODO: find all references to next three routines and disambiguate!!\r\n    \r\n    // Complete page initialization only after the page is fully loaded, including any embedded fonts\r\n    // This avoids the need to use a timer to test for the fonts\r\n    \r\n    util.attachDOMEvent(window, 'load', keymanweb.domManager._WindowLoad,false);\r\n    util.attachDOMEvent(window, 'unload', keymanweb.domManager._WindowUnload,false);  // added fourth argument (default value)       \r\n    \r\n    // *** I3319 Supplementary Plane modifications - end new code\r\n\r\n    util.attachDOMEvent(document, 'keyup', keymanweb.hotkeyManager._Process, false);  \r\n\r\n    util.attachDOMEvent(window, 'focus', keymanweb.interface.resetVKShift.bind(keymanweb.interface), false);  // I775\r\n    util.attachDOMEvent(window, 'blur', keymanweb.interface.resetVKShift.bind(keymanweb.interface), false);   // I775\r\n    \r\n    // Initialize supplementary plane string extensions\r\n    String.kmwEnableSupplementaryPlane(false);    \r\n\r\n  })();\r\n}","/// <reference path=\"kmwexthtml.ts\" />  // Includes KMW-added property declaration extensions for HTML elements.\r\n/// <reference path=\"kmwstring.ts\" />  // Includes KMW string extension declarations.\r\n\r\nnamespace com.keyman {\r\n  export class OSKKeySpec {\r\n    id: string;\r\n    text?: string;\r\n    sp?: string;\r\n    width: string;\r\n    layer?: string; // Added during OSK construction.\r\n    nextlayer?: string;\r\n    pad?: string;\r\n    widthpc?: number; // Added during OSK construction.\r\n    padpc?: number; // Added during OSK construction.\r\n\r\n    constructor(id: string, text?: string, width?: string, sp?: string, nextlayer?: string, pad?: string) {\r\n      this.id = id;\r\n      this.text = text;\r\n      this.width = width ? width : \"50\";\r\n      this.sp = sp;\r\n      this.nextlayer = nextlayer;\r\n      this.pad = pad;\r\n    }\r\n  }\r\n\r\n  export abstract class OSKKey {\r\n    spec: OSKKeySpec;\r\n    readonly layer: string; // The layer in which the key resides (not the key spec's 'act as layer' property)\r\n\r\n    constructor(spec: OSKKeySpec, layer: string) {\r\n      this.spec = spec;\r\n      this.layer = layer;\r\n    }\r\n\r\n    abstract getId(): string;\r\n\r\n    /**\r\n     * Uses canvas.measureText to compute and return the width of the given text of given font in pixels.\r\n     * \r\n     * @param {String} text The text to be rendered.\r\n     * @param {String} style The CSSStyleDeclaration for an element to measure against, without modification.\r\n     * \r\n     * @see https://stackoverflow.com/questions/118241/calculate-text-width-with-javascript/21015393#21015393\r\n     * This version has been substantially modified to work for this particular application.\r\n     */\r\n    static getTextWidth(text: string, style: {fontFamily?: string, fontSize: string}) {\r\n      // A final fallback - having the right font selected makes a world of difference.\r\n      if(!style.fontFamily) {\r\n        style.fontFamily = getComputedStyle(document.body).fontFamily;\r\n      }\r\n\r\n      if(!style.fontSize || style.fontSize == \"\") {\r\n        style.fontSize = '1em';\r\n      }\r\n\r\n      let fontFamily = style.fontFamily;\r\n\r\n      // Use of `getComputedStyle` is ideal, but in many of our use cases its preconditions are not met.\r\n      // The following allows us to calculate the font size in those situations.\r\n      let emScale = (<KeymanBase> window['keyman']).osk.getKeyEmFontSize();\r\n      let fontSpec = (<KeymanBase> window['keyman']).util.getFontSizeStyle(style.fontSize);\r\n\r\n      var fontSize: string;\r\n      if(fontSpec.absolute) {\r\n        // We've already got an exact size - use it!\r\n        fontSize = fontSpec.val + 'px';\r\n      } else {\r\n        fontSize = fontSpec.val * emScale + 'px';\r\n      }\r\n\r\n      // re-use canvas object for better performance\r\n      var canvas = OSKKey.getTextWidth['canvas'] || (OSKKey.getTextWidth['canvas'] = document.createElement(\"canvas\"));\r\n      var context = canvas.getContext(\"2d\");\r\n      context.font = fontSize + \" \" + fontFamily;\r\n      var metrics = context.measureText(text);\r\n      return metrics.width;\r\n    }\r\n\r\n    getKeyWidth(): number {\r\n      let units = this.objectUnits();\r\n\r\n      if(units == 'px') {\r\n        // For mobile devices, we presently specify width directly in pixels.  Just use that!\r\n        return this.spec['widthpc'];\r\n      } else if(units == '%') {\r\n        // For desktop devices, each key is given a %age of the total OSK width.  We'll need to compute an\r\n        // approximation for that.  `osk._DivVkbd` is the element controlling the OSK's width, set in px.\r\n        // ... and since it's null whenever this method would be called during key construction, we simply\r\n        // grab it from the cookie (or its default values) instead.\r\n        let oskWidth = (<KeymanBase> window['keyman']).osk.getWidthFromCookie();\r\n\r\n        // This is an approximation that tends to be a bit too large, but it's close enough to be useful.\r\n        return Math.floor(oskWidth * this.spec['widthpc'] / 100);\r\n      }\r\n    }\r\n\r\n    objectUnits(): string {\r\n      // Returns a unit string corresponding to how the width for each key is specified.\r\n      if((<KeymanBase>window['keyman']).util.device.formFactor == 'desktop') {\r\n        return '%';\r\n      } else {\r\n        return 'px';\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Replace default key names by special font codes for modifier keys\r\n     *\r\n     *  @param  {string}  oldText\r\n     *  @return {string}\r\n     **/\r\n    protected renameSpecialKey(oldText: string): string {\r\n      let keyman = (<KeymanBase>window['keyman'])\r\n      // If a 'special key' mapping exists for the text, replace it with its corresponding special OSK character.\r\n      let specialCharacters = keyman['osk'].specialCharacters;\r\n      return specialCharacters[oldText] ? String.fromCharCode(0XE000 + specialCharacters[oldText]) : oldText;\r\n    }\r\n\r\n    // Produces a HTMLSpanElement with the key's actual text.\r\n    protected generateKeyText(): HTMLSpanElement {\r\n      let util = (<KeymanBase>window['keyman']).util;\r\n      let spec = this.spec;\r\n\r\n      // Add OSK key labels\r\n      var keyText;\r\n      var t=util._CreateElement('span'), ts=t.style;\r\n      if(spec['text'] == null || spec['text'] == '') {\r\n        keyText='\\xa0';  // default:  nbsp.\r\n        if(typeof spec['id'] == 'string') {\r\n          // If the ID's Unicode-based, just use that code.\r\n          if(/^U_[0-9A-F]{4}$/i.test(spec['id'])) {\r\n            keyText=String.fromCharCode(parseInt(spec['id'].substr(2),16));\r\n          }\r\n        }\r\n      } else {\r\n        keyText=spec['text'];\r\n      }\r\n\r\n      t.className='kmw-key-text';\r\n\r\n      // Use special case lookup for modifier keys\r\n      if(spec['sp'] == '1' || spec['sp'] == '2') {\r\n        // Unique layer-based transformation.\r\n        var tId=((spec['text'] == '*Tab*' && this.layer == 'shift') ? '*TabLeft*' : spec['text']);\r\n\r\n        // Transforms our *___* special key codes into their corresponding PUA character codes for keyboard display.\r\n        keyText=this.renameSpecialKey(tId);\r\n      }\r\n\r\n      // Grab our default for the key's font and font size.\r\n      let osk = (<KeymanBase> window['keyman']).osk;\r\n      ts.fontSize=osk.fontSize;     //Build 344, KMEW-90\r\n\r\n      //Override font spec if set for this key in the layout\r\n      if(typeof spec['font'] == 'string' && spec['font'] != '') {\r\n        ts.fontFamily=spec['font'];\r\n      }\r\n\r\n      if(typeof spec['fontsize'] == 'string' && spec['fontsize'] != 0) {\r\n        ts.fontSize=spec['fontsize'];\r\n      }\r\n\r\n      let keyboardManager = (<KeymanBase>window['keyman']).keyboardManager;\r\n\r\n      // For some reason, fonts will sometimes 'bug out' for the embedded iOS page if we\r\n      // instead assign fontFamily to the existing style 'ts'.  (Occurs in iOS 12.)\r\n      let styleSpec: {fontFamily?: string, fontSize: string} = {fontSize: ts.fontSize};\r\n\r\n      if(ts.fontFamily) {\r\n        styleSpec.fontFamily = ts.fontFamily;\r\n      } else {\r\n        styleSpec.fontFamily = osk.fontFamily; // Helps with style sheet calculations.\r\n      }\r\n\r\n      // Check the key's display width - does the key visualize well?\r\n      var width: number = OSKKey.getTextWidth(keyText, styleSpec);\r\n      if(width == 0 && keyText != '' && keyText != '\\xa0') {\r\n        // Add the Unicode 'empty circle' as a base support for needy diacritics.\r\n        keyText = '\\u25cc' + keyText;\r\n\r\n        if(keyboardManager.isRTL()) {\r\n          // Add the RTL marker to ensure it displays properly.\r\n          keyText = '\\u200f' + keyText;\r\n        }\r\n        \r\n        // Recompute the new width for use in autoscaling calculations below, just in case.\r\n        width = OSKKey.getTextWidth(keyText, styleSpec);\r\n      }\r\n\r\n      let fontSpec = util.getFontSizeStyle(ts.fontSize);\r\n      let keyWidth = this.getKeyWidth();\r\n      let maxProportion = 0.90;\r\n      let proportion = (keyWidth * maxProportion) / width; // How much of the key does the text want to take?\r\n\r\n      // Never upscale keys past the default - only downscale them.\r\n      if(proportion < 1) {\r\n        if(fontSpec.absolute) {\r\n          ts.fontSize = proportion * fontSpec.val + 'px';\r\n        } else {\r\n          ts.fontSize = proportion * fontSpec.val + 'em';\r\n        }\r\n      }\r\n\r\n      // Finalize the key's text.\r\n      t.innerHTML = keyText;\r\n\r\n      return t;\r\n    }\r\n  }\r\n\r\n  export class OSKBaseKey extends OSKKey {\r\n    constructor(spec: OSKKeySpec, layer: string) {\r\n      super(spec, layer);\r\n    }\r\n\r\n    getId(): string {\r\n      // Define each key element id by layer id and key id (duplicate possible for SHIFT - does it matter?)\r\n      return this.layer+'-'+this.spec.id;\r\n    }\r\n\r\n    // Produces a small reference label for the corresponding physical key on a US keyboard.\r\n    private generateKeyCapLabel(): HTMLDivElement {\r\n      // Create the default key cap labels (letter keys, etc.)\r\n      var x = (<KeymanBase>window['keyman'])['osk'].keyCodes[this.spec.id];\r\n      switch(x) {\r\n        // Converts the keyman key id code for common symbol keys into its representative ASCII code.\r\n        // K_COLON -> K_BKQUOTE\r\n        case 186: x=59; break;\r\n        case 187: x=61; break;\r\n        case 188: x=44; break;\r\n        case 189: x=45; break;\r\n        case 190: x=46; break;\r\n        case 191: x=47; break;\r\n        case 192: x=96; break;\r\n        // K_LBRKT -> K_QUOTE\r\n        case 219: x=91; break;\r\n        case 220: x=92; break;\r\n        case 221: x=93; break;\r\n        case 222: x=39; break;\r\n        default:\r\n          // No other symbol character represents a base key on the standard QWERTY English layout.\r\n          if(x < 48 || x > 90) {\r\n            x=0;\r\n          }\r\n      }\r\n\r\n      if(x > 0) {\r\n        let q = (<KeymanBase>window['keyman']).util._CreateElement('div');\r\n        q.className='kmw-key-label';\r\n        q.innerHTML=String.fromCharCode(x);\r\n        return q;\r\n      } else {\r\n        // Keyman-only virtual keys have no corresponding physical key.\r\n        return null;\r\n      }\r\n    }\r\n\r\n    private processSubkeys(btn: HTMLDivElement) {\r\n      // Add reference to subkey array if defined\r\n      var bsn: number, bsk=btn['subKeys'] = this.spec['sk'];\r\n      // Transform any special keys into their PUA representations.\r\n      for(bsn=0; bsn<bsk.length; bsn++) {\r\n        if(bsk[bsn]['sp'] == '1' || bsk[bsn]['sp'] == '2') {\r\n          var oldText=bsk[bsn]['text'];\r\n          bsk[bsn]['text']=this.renameSpecialKey(oldText);\r\n        }\r\n      }\r\n\r\n      // If a subkey array is defined, add an icon\r\n      var skIcon=(<KeymanBase>window['keyman']).util._CreateElement('div');\r\n      skIcon.className='kmw-key-popup-icon';\r\n      //kDiv.appendChild(skIcon);\r\n      btn.appendChild(skIcon);\r\n    }\r\n\r\n    construct(layout, rowStyle: CSSStyleDeclaration, totalPercent: number): {element: HTMLDivElement, percent: number} {\r\n      let util = (<KeymanBase>window['keyman']).util;\r\n      let osk = (<KeymanBase>window['keyman']).osk;\r\n      let spec = this.spec;\r\n      let isDesktop = util.device.formFactor == 'desktop'\r\n\r\n      let kDiv=util._CreateElement('div');\r\n      kDiv['keyId']=spec['id'];\r\n      kDiv.className='kmw-key-square';\r\n\r\n      let ks=kDiv.style;\r\n      ks.width=this.objectGeometry(spec['widthpc']);\r\n\r\n      let originalPercent = totalPercent;\r\n      \r\n      let btn=util._CreateElement('div');\r\n      // Set button class\r\n      osk.setButtonClass(spec,btn,layout);\r\n\r\n      // Set key and button positioning properties.\r\n      if(!isDesktop) {\r\n        // Regularize interkey spacing by rounding key width and padding (Build 390)\r\n        ks.left=this.objectGeometry(totalPercent+spec['padpc']);\r\n        ks.bottom=rowStyle.bottom;\r\n        ks.height=rowStyle.height;  //must be specified in px for rest of layout to work correctly\r\n\r\n        // Set distinct phone and tablet button position properties\r\n        btn.style.left=ks.left;\r\n        btn.style.width=ks.width;\r\n      } else {\r\n        ks.marginLeft=this.objectGeometry(spec['padpc']);\r\n      }\r\n\r\n      totalPercent=totalPercent+spec['padpc']+spec['widthpc'];\r\n\r\n      // Add the (US English) keycap label for desktop OSK or if KDU flag is non-zero\r\n      if(layout.keyLabels || isDesktop) {\r\n        let keyCap = this.generateKeyCapLabel();\r\n\r\n        if(keyCap) {\r\n          btn.appendChild(keyCap);\r\n        }\r\n      }\r\n\r\n      // Define each key element id by layer id and key id (duplicate possible for SHIFT - does it matter?)\r\n      btn.id=this.getId();\r\n      // Keyman 12 goal:  convert btn['key'] to use the 'this' reference instead.\r\n      btn['key']=spec;  //attach reference to key layout spec to element\r\n\r\n      // Define callbacks to handle key touches: iOS and Android tablets and phones\r\n      // TODO: replace inline function calls??\r\n      if(!util.device.touchable) {\r\n        // Highlight key while mouse down or if moving back over originally selected key\r\n        btn.onmouseover=btn.onmousedown=osk.mouseOverMouseDownHandler; // Build 360\r\n\r\n        // Remove highlighting when key released or moving off selected element\r\n        btn.onmouseup=btn.onmouseout=osk.mouseUpMouseOutHandler; //Build 360\r\n      }\r\n\r\n      // Make sure the key text is the element's first child - processSubkeys()\r\n      // will add an extra element if subkeys exist, which can interfere with\r\n      // keyboard/language name display on the space bar!\r\n      btn.appendChild(this.generateKeyText());\r\n\r\n      // Handle subkey-related tasks.\r\n      if(typeof(spec['sk']) != 'undefined' && spec['sk'] != null) {\r\n        this.processSubkeys(btn);\r\n      } else {\r\n        btn['subKeys']=null;\r\n      }\r\n      \r\n      // Add text to button and button to placeholder div\r\n      kDiv.appendChild(btn);\r\n\r\n      // Prevent user selection of key captions\r\n      //t.style.webkitUserSelect='none';\r\n      \r\n      // The 'return value' of this process.\r\n      return {element: kDiv, percent: totalPercent - originalPercent};\r\n    }\r\n\r\n    objectGeometry(v: number): string {\r\n      let unit = this.objectUnits();\r\n      if(unit == '%') {\r\n        return v + unit;\r\n      } else { // unit == 'px'\r\n        return Math.round(v)+unit;\r\n      }\r\n    }\r\n  }\r\n\r\n  export class OSKSubKey extends OSKKey {\r\n    constructor(spec: OSKKeySpec, layer: string) {\r\n      super(spec, layer);\r\n    }\r\n\r\n    getId(): string {\r\n      let spec = this.spec;\r\n      // Create (temporarily) unique ID by prefixing 'popup-' to actual key ID\r\n      if(typeof(this.layer) == 'string' && this.layer != '') {\r\n        return 'popup-'+ this.layer +'-'+spec['id'];\r\n      } else {\r\n        // We only create subkeys when they're needed - the currently-active layer should be fine.\r\n        return 'popup-' + (<KeymanBase> window['keyman']).osk.layerId + '-'+spec['id'];\r\n      }\r\n    }\r\n\r\n    construct(baseKey: HTMLDivElement, topMargin: boolean): HTMLDivElement {\r\n      let osk = (<KeymanBase> window['keyman']).osk;\r\n      let spec = this.spec;\r\n\r\n      let kDiv=document.createElement('div');\r\n      let tKey = osk.getDefaultKeyObject();\r\n      let ks=kDiv.style;\r\n\r\n      for(var tp in tKey) {\r\n        if(typeof spec[tp] != 'string') {\r\n          spec[tp]=tKey[tp];\r\n        }\r\n      }\r\n\r\n      kDiv.className='kmw-key-square-ex';\r\n      kDiv['keyId']=spec['id'];\r\n      if(topMargin) {\r\n        ks.marginTop='5px';\r\n      }\r\n\r\n      if(typeof spec['width'] != 'undefined') {\r\n        ks.width=(parseInt(spec['width'],10)*baseKey.offsetWidth/100)+'px';\r\n      } else {\r\n        ks.width=baseKey.offsetWidth+'px';\r\n      }\r\n      ks.height=baseKey.offsetHeight+'px';\r\n\r\n      let btn=document.createElement('div');\r\n      osk.setButtonClass(spec,btn);\r\n\r\n      btn.id = this.getId();\r\n\r\n      // Plan for Keyman 12:  swap to use the 'this' reference.\r\n      btn['key'] = spec;\r\n\r\n      // Must set button size (in px) dynamically, not from CSS\r\n      let bs=btn.style;\r\n      bs.height=ks.height;\r\n      bs.width=ks.width;\r\n\r\n      // Must set position explicitly, at least for Android\r\n      bs.position='absolute';\r\n\r\n      btn.appendChild(this.generateKeyText());\r\n      kDiv.appendChild(btn);\r\n\r\n      return kDiv;\r\n    }\r\n  }\r\n}\r\n\r\n/***\r\n   KeymanWeb 11.0\r\n   Copyright 2019 SIL International\r\n***/\r\n\r\n// If KMW is already initialized, the KMW script has been loaded more than once. We wish to prevent resetting the\r\n// KMW system, so we use the fact that 'initialized' is only 1 / true after all scripts are loaded for the initial\r\n// load of KMW.\r\nif(!window['keyman']['initialized']) {\r\n  /*****************************************/\r\n  /*                                       */\r\n  /*   On-Screen (Visual) Keyboard Code    */\r\n  /*                                       */\r\n  /*****************************************/\r\n\r\n  (function() {\r\n    // Declare KeymanWeb and member objects\r\n    var keymanweb=window['keyman'], osk=keymanweb['osk'], util=keymanweb['util'], device=util.device, dbg=keymanweb.debug;\r\n    var kbdInterface=keymanweb['interface'];\r\n\r\n    // Define Keyman Developer modifier bit-flags (exposed for use by other modules)\r\n    osk.modifierCodes = {\r\n      \"LCTRL\":0x0001,\r\n      \"RCTRL\":0x0002,\r\n      \"LALT\":0x0004,\r\n      \"RALT\":0x0008,\r\n      \"SHIFT\":0x0010,\r\n      \"CTRL\":0x0020,\r\n      \"ALT\":0x0040,\r\n      \"CAPS\":0x0100,\r\n      \"NO_CAPS\":0x0200,\r\n      \"NUM_LOCK\":0x0400,\r\n      \"NO_NUM_LOCK\":0x0800,\r\n      \"SCROLL_LOCK\":0x1000,\r\n      \"NO_SCROLL_LOCK\":0x2000,\r\n      \"VIRTUAL_KEY\":0x4000\r\n    };\r\n\r\n    osk.modifierBitmasks = {\r\n      \"ALL\":0x007F,\r\n      \"ALT_GR_SIM\": (osk.modifierCodes['LCTRL'] | osk.modifierCodes['LALT']),\r\n      \"CHIRAL\":0x001F,    // The base bitmask for chiral keyboards.  Includes SHIFT, which is non-chiral.\r\n      \"IS_CHIRAL\":0x000F, // Used to test if a bitmask uses a chiral modifier.\r\n      \"NON_CHIRAL\":0x0070 // The default bitmask, for non-chiral keyboards\r\n    };\r\n\r\n    osk.stateBitmasks = {\r\n      \"ALL\":0x3F00,\r\n      \"CAPS\":0x0300,\r\n      \"NUM_LOCK\":0x0C00,\r\n      \"SCROLL_LOCK\":0x3000\r\n    };\r\n\r\n    // Define standard keycode numbers (exposed for use by other modules)\r\n    osk.keyCodes={\r\n      \"K_BKSP\":8,\"K_TAB\":9,\"K_ENTER\":13,\r\n      \"K_SHIFT\":16,\"K_CONTROL\":17,\"K_ALT\":18,\"K_PAUSE\":19,\"K_CAPS\":20,\r\n      \"K_ESC\":27,\"K_SPACE\":32,\"K_PGUP\":33,\r\n      \"K_PGDN\":34,\"K_END\":35,\"K_HOME\":36,\"K_LEFT\":37,\"K_UP\":38,\r\n      \"K_RIGHT\":39,\"K_DOWN\":40,\"K_SEL\":41,\"K_PRINT\":42,\"K_EXEC\":43,\r\n      \"K_INS\":45,\"K_DEL\":46,\"K_HELP\":47,\"K_0\":48,\r\n      \"K_1\":49,\"K_2\":50,\"K_3\":51,\"K_4\":52,\"K_5\":53,\"K_6\":54,\"K_7\":55,\r\n      \"K_8\":56,\"K_9\":57,\"K_A\":65,\"K_B\":66,\"K_C\":67,\"K_D\":68,\"K_E\":69,\r\n      \"K_F\":70,\"K_G\":71,\"K_H\":72,\"K_I\":73,\"K_J\":74,\"K_K\":75,\"K_L\":76,\r\n      \"K_M\":77,\"K_N\":78,\"K_O\":79,\"K_P\":80,\"K_Q\":81,\"K_R\":82,\"K_S\":83,\r\n      \"K_T\":84,\"K_U\":85,\"K_V\":86,\"K_W\":87,\"K_X\":88,\"K_Y\":89,\"K_Z\":90,\r\n      \"K_NP0\":96,\"K_NP1\":97,\"K_NP2\":98,\r\n      \"K_NP3\":99,\"K_NP4\":100,\"K_NP5\":101,\"K_NP6\":102,\r\n      \"K_NP7\":103,\"K_NP8\":104,\"K_NP9\":105,\"K_NPSTAR\":106,\r\n      \"K_NPPLUS\":107,\"K_SEPARATOR\":108,\"K_NPMINUS\":109,\"K_NPDOT\":110,\r\n      \"K_NPSLASH\":111,\"K_F1\":112,\"K_F2\":113,\"K_F3\":114,\"K_F4\":115,\r\n      \"K_F5\":116,\"K_F6\":117,\"K_F7\":118,\"K_F8\":119,\"K_F9\":120,\r\n      \"K_F10\":121,\"K_F11\":122,\"K_F12\":123,\"K_NUMLOCK\":144,\"K_SCROLL\":145,\r\n      \"K_LSHIFT\":160,\"K_RSHIFT\":161,\"K_LCONTROL\":162,\"K_RCONTROL\":163,\r\n      \"K_LALT\":164,\"K_RALT\":165,\r\n      \"K_COLON\":186,\"K_EQUAL\":187,\"K_COMMA\":188,\"K_HYPHEN\":189,\r\n      \"K_PERIOD\":190,\"K_SLASH\":191,\"K_BKQUOTE\":192,\r\n      \"K_LBRKT\":219,\"K_BKSLASH\":220,\"K_RBRKT\":221,\r\n      \"K_QUOTE\":222,\"K_oE2\":226,\r\n      \"K_LOPT\":50001,\"K_ROPT\":50002,\r\n      \"K_NUMERALS\":50003,\"K_SYMBOLS\":50004,\"K_CURRENCIES\":50005,\r\n      \"K_UPPER\":50006,\"K_LOWER\":50007,\"K_ALPHA\":50008,\r\n      \"K_SHIFTED\":50009,\"K_ALTGR\":50010,\r\n      \"K_TABBACK\":50011,\"K_TABFWD\":50012\r\n    };\r\n\r\n    // Cross-reference with the ids in osk.setButtonClass.\r\n    osk.buttonClasses = {\r\n      'DEFAULT':'0',\r\n      'SHIFT':'1',\r\n      'SHIFT-ON':'2',\r\n      'SPECIAL':'3',\r\n      'SPECIAL-ON':'4',\r\n      'DEADKEY':'8',\r\n      'BLANK':'9',\r\n      'HIDDEN':'10'\r\n    };\r\n\r\n    // Defines the PUA code mapping for the various 'special' modifier/control keys on keyboards.\r\n    osk.specialCharacters = {\r\n      '*Shift*':    8,\r\n      '*Enter*':    5,\r\n      '*Tab*':      6,\r\n      '*BkSp*':     4,\r\n      '*Menu*':     11,\r\n      '*Hide*':     10,\r\n      '*Alt*':      25,\r\n      '*Ctrl*':     1,\r\n      '*Caps*':     3,\r\n      '*ABC*':      16,\r\n      '*abc*':      17,\r\n      '*123*':      19,\r\n      '*Symbol*':   21,\r\n      '*Currency*': 20,\r\n      '*Shifted*':  8, // set SHIFTED->9 for filled arrow icon\r\n      '*AltGr*':    2,\r\n      '*TabLeft*':  7,\r\n      '*LAlt*':     0x56,\r\n      '*RAlt*':     0x57,\r\n      '*LCtrl*':    0x58,\r\n      '*RCtrl*':    0x59,\r\n      '*LAltCtrl*':       0x60,\r\n      '*RAltCtrl*':       0x61,\r\n      '*LAltCtrlShift*':  0x62,\r\n      '*RAltCtrlShift*':  0x63,\r\n      '*AltShift*':       0x64,\r\n      '*CtrlShift*':      0x65,\r\n      '*AltCtrlShift*':   0x66,\r\n      '*LAltShift*':      0x67,\r\n      '*RAltShift*':      0x68,\r\n      '*LCtrlShift*':     0x69,\r\n      '*RCtrlShift*':     0x70\r\n    };\r\n   \r\n    osk.modifierSpecials = {\r\n      'leftalt': '*LAlt*',\r\n      'rightalt': '*RAlt*',\r\n      'alt': '*Alt*',\r\n      'leftctrl': '*LCtrl*',\r\n      'rightctrl': '*RCtrl*',\r\n      'ctrl': '*Ctrl*',\r\n      'ctrl-alt': '*AltGr*',\r\n      'leftctrl-leftalt': '*LAltCtrl*',\r\n      'rightctrl-rightalt': '*RAltCtrl*',\r\n      'leftctrl-leftalt-shift': '*LAltCtrlShift*',\r\n      'rightctrl-rightalt-shift': '*RAltCtrlShift*',\r\n      'shift': '*Shift*',\r\n      'shift-alt': '*AltShift*',\r\n      'shift-ctrl': '*CtrlShift*',\r\n      'shift-ctrl-alt': '*AltCtrlShift*',\r\n      'leftalt-shift': '*LAltShift*',\r\n      'rightalt-shift': '*RAltShift*',\r\n      'leftctrl-shift': '*LCtrlShift*',\r\n      'rightctrl-shift': '*RCtrlShift*'\r\n    };\r\n\r\n    var codesUS=[['0123456789',';=,-./`','[\\\\]\\''],[')!@#$%^&*(',':+<_>?~','{|}\"']];\r\n\r\n    var dfltCodes=[\"K_BKQUOTE\",\"K_1\",\"K_2\",\"K_3\",\"K_4\",\"K_5\",\"K_6\",\"K_7\",\"K_8\",\"K_9\",\"K_0\",\r\n      \"K_HYPHEN\",\"K_EQUAL\",\"K_*\",\"K_*\",\"K_*\",\"K_Q\",\"K_W\",\"K_E\",\"K_R\",\"K_T\",\r\n      \"K_Y\",\"K_U\",\"K_I\",\"K_O\",\"K_P\",\"K_LBRKT\",\"K_RBRKT\",\"K_BKSLASH\",\"K_*\",\r\n      \"K_*\",\"K_*\",\"K_A\",\"K_S\",\"K_D\",\"K_F\",\"K_G\",\"K_H\",\"K_J\",\"K_K\",\"K_L\",\r\n      \"K_COLON\",\"K_QUOTE\",\"K_*\",\"K_*\",\"K_*\",\"K_*\",\"K_*\",\"K_oE2\",\r\n      \"K_Z\",\"K_X\",\"K_C\",\"K_V\",\"K_B\",\"K_N\",\"K_M\",\"K_COMMA\",\"K_PERIOD\",\r\n      \"K_SLASH\",\"K_*\",\"K_*\",\"K_*\",\"K_*\",\"K_*\",\"K_SPACE\"];\r\n\r\n    var dfltText='`1234567890-=\\xA7~~qwertyuiop[]\\\\~~~asdfghjkl;\\'~~~~~?zxcvbnm,./~~~~~ '\r\n                +'~!@#$%^&*()_+\\xA7~~QWERTYUIOP{}\\\\~~~ASDFGHJKL:\"~~~~~?ZXCVBNM<>?~~~~~ ';\r\n\r\n    osk._Box = null;              // Main DIV for OSK\r\n    osk._DivVKbd = null;\r\n    osk._DivVKbdHelp = null;\r\n    osk._Visible = 0;             // Whether or not actually visible\r\n    osk._Enabled = 1;             // Whether or not enabled by UI\r\n    osk._VShift = [];\r\n    osk._VKeySpans = [];\r\n    osk._VKeyDown = null;\r\n    osk._VKbdContainer = null;\r\n    osk._VOriginalWidth = 1;      // Non-zero default value needed\r\n    osk._BaseLayout = 'us';       // default BaseLayout\r\n    osk._BaseLayoutEuro = {};     // I1299 (not currently exposed, but may need to be e.g. for external users)\r\n    osk._BaseLayoutEuro['se'] = '\\u00a71234567890+´~~~QWERTYUIOP\\u00c5\\u00a8\\'~~~ASDFGHJKL\\u00d6\\u00c4~~~~~<ZXCVBNM,.-~~~~~ ';  // Swedish\r\n    osk._BaseLayoutEuro['uk'] = '`1234567890-=~~~QWERTYUIOP[]#~~~ASDFGHJKL;\\'~~~~~\\\\ZXCVBNM,./~~~~~ '; // UK\r\n\r\n    // Tracks the OSK-based state of supported state keys.\r\n    // Using the exact keyCode name from above allows for certain optimizations elsewhere in the code.\r\n    osk._stateKeys = {\r\n      \"K_CAPS\":false,\r\n      \"K_NUMLOCK\":false,\r\n      \"K_SCROLL\":false\r\n    };\r\n\r\n    // Additional members (mainly for touch input devices)\r\n    osk.lgTimer = null;           // language switching timer\r\n    osk.lgKey = null;             // language menu key element\r\n    osk.hkKey = null;             // OSK hide key element\r\n    osk.spaceBar = null;          // space bar key element\r\n    osk.lgList = null;            // language menu list\r\n    osk.frameColor = '#ad4a28';   // KeymanWeb standard frame color\r\n    osk.keyPending = null;        // currently depressed key (if any)\r\n    osk.fontFamily = '';          // layout-specified font for keyboard\r\n    osk.fontSize = '1em';         // layout-specified fontsize for keyboard\r\n    osk.layout = null;            // reference to complete layout\r\n    osk.layers = null;            // reference to layout (layers array for this device)\r\n    osk.layerId = 'default';      // currently active OSK layer (if any)\r\n    osk.nextLayer = 'default';    // layer to be activated after pressing key in current layer\r\n    osk.layerIndex = 0;           // currently displayed layer index\r\n    osk.currentKey = '';          // id of currently pressed key (desktop OSK only)\r\n    osk.subkeyDelayTimer = null;  // id for touch-hold delay timer\r\n    osk.popupPending = false;     // Device popup pending flag\r\n    osk.popupVisible = false;     // Device popup displayed\r\n    osk.popupCallout = null;      // OSK popup callout element\r\n    osk.styleSheet = null;        // current OSK style sheet object, if any\r\n    osk.loadRetry = 0;            // counter for delayed loading, if keyboard loading prevents OSK being ready at start\r\n    osk.popupDelay = 500;         // Delay must be less than native touch-hold delay (build 352)\r\n    osk.currentTarget = null;     // Keep track of currently touched key when moving over keyboard\r\n    osk.touchCount = 0;           // Number of active (unreleased) touch points\r\n    osk.touchX = 0;               // First touch point x (to check for sliding off screen)\r\n    osk.deleting = 0;             // Backspace repeat timer\r\n\r\n    // Additional members for desktop OSK\r\n    osk.x = 99;                   // last visible offset left\r\n    osk.y = 0;                    // last visible offset top\r\n    osk.width = 1;                // Saved width of OSK (since actual width only available if visible)\r\n    osk.height = 1;               // Saved height of OSK\r\n    osk.rowHeight = 1;            // Current row height in px\r\n    osk.nRows = 1;                // Number of rows in each layer of current layout\r\n    osk.vpScale = 1;              // Current viewport scale factor  (not valid until initialized)\r\n    osk.closeButton = null;       // icon to hide OSK\r\n    osk.resizeIcon = null;        // resizing icon\r\n    osk.resizing = 0;             // resizing flag\r\n    osk.pinImg = null;            // icon to restore OSK to default position\r\n    osk.userPositioned = 0;       // Set to true(<>0) if dragged by user\r\n    osk.dfltX = '';               // Left position set by page code\r\n    osk.dfltY = '';               // Top position set by page code\r\n    osk.noDrag = false;           // allow page to override user OSK dragging\r\n    osk.keytip = null;            // Key preview (phones)\r\n    osk.touchY = 0;               // First y position of touched key\r\n\r\n    // Placeholder functions\r\n    osk.addCallout = function(e){};\r\n\r\n    osk.shutdown = function() {\r\n      // Remove the OSK's elements from the document, allowing them to be properly cleaned up.\r\n      // Necessary for clean engine testing.\r\n      var _box = osk._Box as HTMLDivElement;\r\n      if(_box.parentElement) {\r\n        _box.parentElement.removeChild(_box);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function     addEventListener\r\n     * Scope        Public\r\n     * @param       {string}            event     event name\r\n     * @param       {function(Object)}  func      event handler\r\n     * @return      {boolean}\r\n     * Description  Wrapper function to add and identify OSK-specific event handlers\r\n     */\r\n    osk['addEventListener'] = function(event, func)\r\n    {\r\n      return util.addEventListener('osk.'+event, func);\r\n    }\r\n\r\n    /**\r\n     * Function     _TitleBarInterior\r\n     * Scope        Private\r\n     * Description  Title bar interior formatting and element event handling\r\n     */\r\n    osk._TitleBarInterior = function()\r\n    {\r\n      var Ldiv = util._CreateElement('DIV');\r\n      var Ls = Ldiv.style;\r\n      Ls.paddingLeft='2px';\r\n      Ls.cursor='move';\r\n      Ls.background='#ad4a28';\r\n      Ls.font='8pt Tahoma,Arial,sans-serif';  //I2186\r\n\r\n      // Add container for buttons, handle mousedown event\r\n      var LdivButtons = util._CreateElement('DIV');\r\n      LdivButtons.className = 'kmw-title-bar-actions';\r\n      LdivButtons.onmousedown=osk._CancelMouse;\r\n\r\n      // Add close button, handle click and mousedown events\r\n      var Limg = util._CreateElement('DIV');\r\n      Limg.className='kmw-close-button';\r\n      Limg.onmousedown=osk._CancelMouse;\r\n      Limg.onclick=function () {osk._Hide(true);}\r\n      osk.closeButton = Limg;\r\n      LdivButtons.appendChild(Limg);\r\n\r\n      /**\r\n       * Move OSK back to default position\r\n       */\r\n      osk.restorePosition = function()\r\n      {\r\n        if(osk._Visible)\r\n        {\r\n          keymanweb.domManager.focusLastActiveElement();  // I2036 - OSK does not unpin to correct location\r\n          osk.loadCookie(); osk.userPositioned=false; osk.saveCookie();\r\n          osk._Show();\r\n          osk.doResizeMove(); //allow the UI to respond to OSK movements\r\n        }\r\n        if(osk.pinImg) osk.pinImg.style.display='none';\r\n        if(window.event) window.event.returnValue=false;\r\n      }\r\n\r\n      // Add 'Unpin' button for restoring OSK to default location, handle mousedown and click events\r\n      Limg=osk.pinImg = util._CreateElement('DIV');  //I2186\r\n      Limg.className='kmw-pin-image';\r\n      Limg.title='Pin the On Screen Keyboard to its default location on the active text box';\r\n      Limg.onclick=osk.restorePosition;\r\n      Limg.onmousedown=osk._CancelMouse;\r\n      Limg.style.display='none';\r\n\r\n      // Do not use Unpin button on touch screens (OSK location fixed)\r\n      if(!device.touchable) LdivButtons.appendChild(Limg); // I3363 (Build 301)\r\n\r\n      // Attach button container to title bar\r\n      Ldiv.appendChild(LdivButtons);\r\n\r\n      // Add title bar caption\r\n      Limg=keymanweb._TitleElement=util._CreateElement('SPAN');  // I1972\r\n      Limg.className='kmw-title-bar-caption';\r\n      Limg.innerHTML='KeymanWeb';\r\n      Ldiv.appendChild(Limg);\r\n\r\n      return Ldiv;\r\n    }\r\n\r\n    // End of TitleBarInterior\r\n\r\n    /**\r\n     * Function     enabled\r\n     * Scope        Public\r\n     * @return      {boolean|number}    True if KMW OSK enabled\r\n     * Description  Test if KMW OSK is enabled\r\n     */\r\n    osk['isEnabled'] = osk.isEnabled = function()\r\n    {\r\n      return osk._Enabled;\r\n    }\r\n\r\n    /**\r\n     * Function     isVisible\r\n     * Scope        Public\r\n     * @return      {boolean|number}    True if KMW OSK visible\r\n     * Description  Test if KMW OSK is actually visible\r\n     * Note that this will usually return false after any UI event that results in (temporary) loss of input focus\r\n     */\r\n    osk['isVisible'] = osk.isVisible = function()\r\n    {\r\n      return osk._Visible;\r\n    }\r\n\r\n    /**\r\n     * Function     getRect //TODO:  This is probably not correct, anyway!!!!!\r\n     * Scope        Public\r\n     * @return      {Object.<string,number>}   Array object with position and size of OSK container\r\n     * Description  Get rectangle containing KMW Virtual Keyboard\r\n     */\r\n    osk['getRect'] = osk.getRect = function() {\t\t// I2405\r\n      var p: any;\r\n      p = {};\r\n\r\n      if(osk._DivVKbd) {\r\n        p['left'] = p.left = util._GetAbsoluteX(osk._DivVKbd);\r\n        p['top']  = p.top  = util._GetAbsoluteY(osk._DivVKbd);\r\n        p['width']  = p.width  = util._GetAbsoluteX(osk._DivVKbdHelp) - util._GetAbsoluteX(osk._DivVKbd) + osk._DivVKbdHelp.offsetWidth;\r\n        p['height'] = p.height = util._GetAbsoluteY(osk._DivVKbdHelp) - util._GetAbsoluteY(osk._DivVKbd) + osk._DivVKbdHelp.offsetHeight;\r\n      } else {\r\n        p['left'] = p.left = util._GetAbsoluteX(osk._Box);\r\n        p['top']  = p.top  = util._GetAbsoluteY(osk._Box);\r\n        p['width']  = p.width  = util._GetAbsoluteX(osk._Box) + osk._Box.offsetWidth;\r\n        p['height'] = p.height = util._GetAbsoluteY(osk._Box) + osk._Box.offsetHeight;\r\n      }\r\n      return p;\r\n    }\r\n\r\n    /**\r\n     * Allow the UI or page to set the position and size of the OSK\r\n     * and (optionally) override user repositioning or sizing\r\n     *\r\n     * @param       {Object.<string,number>}   p  Array object with position and size of OSK container\r\n    **/\r\n    osk['setRect'] = osk.setRect = function(p)\r\n    {\r\n      var q={};\r\n\r\n      if(osk._Box == null || device.formFactor != 'desktop') return;\r\n\r\n      var b=osk._Box,bs=b.style;\r\n      if('left' in p)\r\n      {\r\n        bs.left=(p['left']-util._GetAbsoluteX(b)+b.offsetLeft)+'px';\r\n        osk.dfltX=bs.left;\r\n      }\r\n\r\n      if('top' in p)\r\n      {\r\n        bs.top=(p['top']-util._GetAbsoluteY(b)+b.offsetTop)+'px';\r\n        osk.dfltY=bs.top;\r\n      }\r\n\r\n      //Do not allow user resizing for non-standard keyboards (e.g. EuroLatin)\r\n      if(osk._DivVKbd != null)\r\n      {\r\n        var d=osk._DivVKbd,ds=d.style;\r\n\r\n        // Set width, but limit to reasonable value\r\n        if('width' in p)\r\n        {\r\n          var w=(p['width']-(b.offsetWidth-d.offsetWidth));\r\n          if(w < 0.2*screen.width) w=0.2*screen.width;\r\n          if(w > 0.9*screen.width) w=0.9*screen.width;\r\n          ds.width=w+'px'; osk.width=w;\r\n        }\r\n\r\n        // Set height, but limit to reasonable value\r\n        // This sets the default font size for the OSK in px, but that\r\n        // can be modified at the key text level by setting\r\n        // the font size in em in the kmw-key-text class\r\n        if('height' in p)\r\n        {\r\n          var h=(p['height']-(b.offsetHeight-d.offsetHeight));\r\n          if(h < 0.1*screen.height) h=0.1*screen.height;\r\n          if(h > 0.5*screen.height) h=0.5*screen.height;\r\n          ds.height=h+'px'; ds.fontSize=(h/8)+'px'; osk.height=h;\r\n        }\r\n\r\n        // Fix or release user resizing\r\n        if('nosize' in p)\r\n          if(osk.resizeIcon) osk.resizeIcon.style.display=(p['nosize'] ? 'none' : 'block');\r\n\r\n      }\r\n      // Fix or release user dragging\r\n      if('nomove' in p)\r\n      {\r\n        osk.noDrag=p['nomove'];\r\n        if(osk.pinImg) osk.pinImg.style.display=(p['nomove'] || !osk.userPositioned) ? 'none' : 'block';\r\n      }\r\n      // Save the user-defined OSK size\r\n      osk.saveCookie();\r\n    }\r\n\r\n    osk.getKeyEmFontSize = function() {\r\n      if(util.device.formFactor == 'desktop') {\r\n        let kbdFontSize = osk.getFontSizeFromCookie();\r\n        let keySquareScale = 0.8; // Set in kmwosk.css, is relative.\r\n        return kbdFontSize * keySquareScale;\r\n      } else {\r\n        let emSizeStr = getComputedStyle(document.body).fontSize;\r\n        let emSize = util.getFontSizeStyle(emSizeStr).val;\r\n        let emScale = util.getFontSizeStyle(osk._Box).val;\r\n        return emSize * emScale;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Get position of OSK window\r\n     *\r\n     * @return      {Object.<string,number>}     Array object with OSK window position\r\n    **/\r\n    osk.getPos = function() {\r\n      var Lkbd=osk._Box, p={\r\n        left: osk._Visible ? Lkbd.offsetLeft : osk.x,\r\n        top:osk._Visible ? Lkbd.offsetTop : osk.y\r\n      };\r\n\r\n      return p;\r\n    }\r\n\r\n    /**\r\n     * Function     setPos\r\n     * Scope        Private\r\n     * @param       {Object.<string,number>}    p     Array object with OSK left, top\r\n     * Description  Set position of OSK window, but limit to screen, and ignore if  a touch input device\r\n     */\r\n    osk['setPos'] = osk.setPos = function(p)\r\n    {\r\n      if(typeof(osk._Box) == 'undefined' || device.touchable) return; // I3363 (Build 301)\r\n      if(osk.userPositioned)\r\n      {\r\n        var Px=p['left'],Py=p['top'];\r\n        if(typeof(Px) != 'undefined')\r\n        {\r\n          if(Px < -0.8*osk._Box.offsetWidth) Px = -0.8*osk._Box.offsetWidth;\r\n          if(osk.userPositioned) {osk._Box.style.left=Px+'px'; osk.x = Px;}\r\n        }\r\n        // May not be needed - vertical positioning is handled differently and defaults to input field if off screen\r\n        if(typeof(Py) != 'undefined')\r\n        {\r\n          if(Py < 0) Py = 0;\r\n          if(osk.userPositioned) {osk._Box.style.top=Py+'px'; osk.y = Py;}\r\n        }\r\n      }\r\n\r\n      if(osk.pinImg)\r\n        osk.pinImg.style.display=(osk.userPositioned ? 'block' : 'none');\r\n    }\r\n\r\n    /**\r\n     * Function     _VKeyGetTarget\r\n     * Scope        Private\r\n     * @param       {Object}    e     OSK event\r\n     * @return      {Object}          Target element for key in OSK\r\n     * Description  Identify the OSK key clicked\r\n     */\r\n    osk._VKeyGetTarget = function(e) {\r\n      var Ltarg;\r\n      e = keymanweb._GetEventObject(e);   // I2404 - Manage IE events in IFRAMEs\r\n      Ltarg = util.eventTarget(e);\r\n      if (Ltarg == null) {\r\n        return null;\r\n      }\r\n      if (Ltarg.nodeType == 3) { // defeat Safari bug\r\n        Ltarg = Ltarg.parentNode;\r\n      }\r\n      if (Ltarg.tagName == 'SPAN') {\r\n        Ltarg = Ltarg.parentNode;\r\n      }\r\n      return Ltarg;\r\n    }\r\n\r\n    /**\r\n     *  Add or remove a class from a keyboard key (when touched or clicked)\r\n     *  or add a key preview for phone devices\r\n     *\r\n     *  @param    {Object}    key   key affected\r\n     *  @param    {boolean}   on    add or remove highlighting\r\n     **/\r\n    osk.highlightKey = function(key,on)\r\n    {\r\n      // Do not change element class unless a key\r\n      if(!key || (key.className == '') || (key.className.indexOf('kmw-key-row') >= 0)) return;\r\n\r\n      var classes=key.className, cs = ' kmw-key-touched';\r\n\r\n      // For phones, use key preview rather than highlighting the key,\r\n      // except for space, bksp, enter, shift and popup keys\r\n      var usePreview = ((osk.keytip != null)\r\n        && (classes.indexOf('kmw-key-shift') < 0)\r\n        && (classes.indexOf('kmw-spacebar') < 0)\r\n        && (key.id.indexOf('popup') < 0 ));\r\n\r\n      if(usePreview)\r\n      {\r\n        osk.showKeyTip(key,on);\r\n      }\r\n      else\r\n      {\r\n        if(on && classes.indexOf(cs) < 0)\r\n        {\r\n          key.className=classes+cs;\r\n          osk.showKeyTip(null,false);     // Moved here by Serkan\r\n        }\r\n        else\r\n        {\r\n          key.className=classes.replace(cs,'');\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Display touch-hold array of 'sub-keys' above the currently touched key\r\n     * @param       {Object}    e      primary key element\r\n     */\r\n    osk.showSubKeys = function(e) {\r\n      // Do not show subkeys if key already released\r\n      if(osk.keyPending == null) {\r\n        return;\r\n      }\r\n\r\n      // Create holder DIV for subkey array, and set styles.\r\n      // A subkey array for Shift will only appear if extra layers exist\r\n\r\n      // The holder is position:fixed, but the keys do not need to be, as no scrolling\r\n      // is possible while the array is visible.  So it is simplest to let the keys have\r\n      // position:static and display:inline-block\r\n      var subKeys=document.createElement('DIV'),i,\r\n        t,ts,t1,ts1,kDiv,ks,btn,bs;\r\n\r\n      var tKey = osk.getDefaultKeyObject();\r\n\r\n      subKeys.id='kmw-popup-keys';\r\n      osk.popupBaseKey = e;\r\n\r\n      // Does the popup array include the base key?   *** condition for phone only ***\r\n      if(device.formFactor == 'phone') {\r\n        osk.prependBaseKey(e);\r\n      }\r\n      var idx = e.id.split('-'), baseId = idx[idx.length-1];\r\n      var baseLayer: string = idx.length > 1 ? idx[0] : 'default'; // idx.length should always be > 1, but just in case.\r\n\r\n      // If not, insert at start\r\n      if(device.formFactor == 'phone' && e.subKeys[0].id != baseId) {\r\n        var eCopy={'id':baseId,'layer':''};\r\n        if(idx.length > 1) {\r\n          eCopy['layer'] = baseLayer;\r\n        }\r\n        for(i=0; i<e.childNodes.length; i++) {\r\n          if(osk.hasClass(e.childNodes[i],'kmw-key-text')) {\r\n            break;\r\n          }\r\n        }\r\n        if(i < e.childNodes.length) {\r\n          eCopy['text'] = e.childNodes[i].textContent;\r\n        }\r\n        e.subKeys.splice(0,0,eCopy);\r\n      }\r\n\r\n      // Must set position dynamically, not in CSS\r\n      var ss=subKeys.style;\r\n      ss.bottom=(parseInt(e.style.bottom,10)+parseInt(e.style.height,10)+4)+'px';\r\n\r\n      // Set key font according to layout, or defaulting to OSK font\r\n      // (copied, not inherited, since OSK is not a parent of popup keys)\r\n      ss.fontFamily=osk.fontFamily;\r\n\r\n      // Copy the font size from the parent key, allowing for style inheritance\r\n      ss.fontSize=util.getStyleValue(e,'font-size');\r\n      ss.visibility='hidden';\r\n\r\n      var nKeys=e.subKeys.length,nRow,nRows,nCols;\r\n      nRows=Math.min(Math.ceil(nKeys/9),2);\r\n      nCols=Math.ceil(nKeys/nRows);\r\n      if(nRows > 1) {\r\n        ss.width=(nCols*e.offsetWidth+nCols*5)+'px';\r\n      }\r\n\r\n      // Add nested button elements for each sub-key\r\n      for(i=0; i<nKeys; i++) {\r\n        var needsTopMargin = false;\r\n        let nRow=Math.floor(i/nCols);\r\n        if(nRows > 1 && nRow > 0) {\r\n          needsTopMargin = true;\r\n        }\r\n\r\n        let keyGenerator = new com.keyman.OSKSubKey(e.subKeys[i], baseLayer);\r\n        let kDiv = keyGenerator.construct(e, needsTopMargin);\r\n        \r\n        subKeys.appendChild(kDiv);\r\n      }\r\n\r\n      // Clear key preview if any\r\n      osk.showKeyTip(null,false);\r\n\r\n      // Otherwise append the touch-hold (subkey) array to the OSK\r\n      osk._Box.appendChild(subKeys);\r\n\r\n      // And correct its position with respect to that element\r\n      ss=subKeys.style;\r\n      var x=util._GetAbsoluteX(e)+0.5*(e.offsetWidth-subKeys.offsetWidth), y,\r\n        xMax=(util.landscapeView()?screen.height:screen.width)-subKeys.offsetWidth;\r\n\r\n      if(x > xMax) {\r\n        x=xMax;\r\n      }\r\n      if(x < 0) {\r\n        x=0;\r\n      }\r\n      ss.left=x+'px';\r\n\r\n      // Add the callout\r\n      osk.popupCallout = osk.addCallout(e);\r\n\r\n      // Make the popup keys visible\r\n      ss.visibility='visible';\r\n\r\n      // And add a filter to fade main keyboard\r\n      subKeys.shim = document.createElement('DIV');\r\n      subKeys.shim.id = 'kmw-popup-shim';\r\n      osk._Box.appendChild(subKeys.shim);\r\n\r\n      // Highlight the duplicated base key (if a phone)\r\n      if(device.formFactor == 'phone') {\r\n        var bk = subKeys.childNodes[0].firstChild;\r\n        osk.keyPending = bk;\r\n        osk.highlightKey(bk,true);//bk.className = bk.className+' kmw-key-touched';\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Prepend the base key to the touch-hold key array (for phones)\r\n     *\r\n     * @param {Object}  e   base key object\r\n     */\r\n    osk.prependBaseKey = function(e)\r\n    {\r\n      if(e && typeof(e.id) != 'undefined')\r\n      {\r\n        //TODO: refactor this, it's pretty messy...\r\n        var i, \r\n          idx = e.id.split('-'), \r\n          baseId = idx[idx.length-1], \r\n          layer = e['key'] && e['key']['layer'] ? e['key']['layer'] : (idx.length > 1 ? idx[0] : ''),\r\n          sp = e['key'] && e['key']['sp'],\r\n          nextlayer = e['key'] && e['key']['nextlayer'] ? e['key']['nextlayer'] : null;\r\n        if(typeof e.subKeys != 'undefined' && e.subKeys.length > 0 && (e.subKeys[0].id != baseId || e.subKeys[0].layer != layer))\r\n        {\r\n          var eCopy={'id':baseId,'layer':'','key':undefined};\r\n          if(layer != '') {\r\n            eCopy['layer'] = layer;\r\n          }\r\n          if(sp) {\r\n            eCopy['sp'] = sp;\r\n          }\r\n          if(nextlayer) {\r\n            eCopy['nextlayer'] = nextlayer;\r\n          }\r\n          for(i = 0; i < e.childNodes.length; i++) {\r\n            if(osk.hasClass(e.childNodes[i],'kmw-key-text')) break;\r\n          }\r\n          if(i < e.childNodes.length) eCopy['text'] = e.childNodes[i].textContent;\r\n          e.subKeys.splice(0,0,eCopy);\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n     * @summary Look up a custom virtual key code in the virtual key code dictionary KVKD.  On first run, will build the dictionary.\r\n     *\r\n     * `VKDictionary` is constructed from the keyboard's `KVKD` member. This list is constructed \r\n     * at compile-time and is a list of 'additional' virtual key codes, starting at 256 (i.e. \r\n     * outside the range of standard virtual key codes). These additional codes are both \r\n     * `[T_xxx]` and `[U_xxxx]` custom key codes from the Keyman keyboard language. However, \r\n     * `[U_xxxx]` keys only generate an entry in `KVKD` if there is a corresponding rule that \r\n     * is associated with them in the keyboard rules. If the `[U_xxxx]` key code is only \r\n     * referenced as the id of a key in the touch layout, then it does not get an entry in \r\n     * the `KVKD` property.\r\n     *\r\n     * @private\r\n     * @param       {string}      keyName   custom virtual key code to lookup in the dictionary\r\n     * @return      {number}                key code > 255 on success, or 0 if not found\r\n     */\r\n    osk.getVKDictionaryCode = function(keyName) {\r\n      var activeKeyboard = keymanweb.keyboardManager.activeKeyboard;\r\n      if(!activeKeyboard['VKDictionary']) {\r\n        var a=[];\r\n        if(typeof activeKeyboard['KVKD'] == 'string') {\r\n          // Build the VK dictionary\r\n          // TODO: Move the dictionary build into the compiler -- so compiler generates code such as following.  \r\n          // Makes the VKDictionary member unnecessary.\r\n          //       this.KVKD={\"K_ABC\":256,\"K_DEF\":257,...};\r\n          var s=activeKeyboard['KVKD'].split(' ');\r\n          for(var i=0; i<s.length; i++) {\r\n            a[s[i].toUpperCase()]=i+256; // We force upper-case since virtual keys should be case-insensitive.\r\n          }\r\n        }\r\n        activeKeyboard['VKDictionary']=a;\r\n      }\r\n\r\n      var res=activeKeyboard['VKDictionary'][keyName.toUpperCase()];\r\n      return res ? res : 0;\r\n    }\r\n    /**\r\n     * Select the next keyboard layer for layer switching keys\r\n     * The next layer will be determined from the key name unless otherwise specifed\r\n     *\r\n     *  @param  {string}                    keyName     key identifier\r\n     *  @param  {number|string|undefined}   nextLayerIn optional next layer identifier\r\n     *  @return {boolean}                               return true if keyboard layer changed\r\n     */\r\n    osk.selectLayer = function(keyName,nextLayerIn)\r\n    {\r\n      var nextLayer = arguments.length < 2 ? null : nextLayerIn;\r\n      var isChiral = keymanweb.keyboardManager.isChiral();\r\n\r\n      // Layer must be identified by name, not number (27/08/2015)\r\n      if(typeof nextLayer == 'number')  nextLayer = osk.getLayerId(nextLayer * 0x10);\r\n\r\n      // Identify next layer, if required by key\r\n      if(!nextLayer) switch(keyName)\r\n      {\r\n        case 'K_LSHIFT':\r\n        case 'K_RSHIFT':\r\n        case 'K_SHIFT':\r\n          nextLayer = 'shift'; break;\r\n        case 'K_LCONTROL':\r\n        case 'K_LCTRL':\r\n          if(isChiral) {\r\n            nextLayer = 'leftctrl';\r\n            break;\r\n          }\r\n        case 'K_RCONTROL':\r\n        case 'K_RCTRL':\r\n          if(isChiral) {\r\n            nextLayer = 'rightctrl';\r\n            break;\r\n          }\r\n        case 'K_CTRL':\r\n          nextLayer = 'ctrl'; break;\r\n        case 'K_LMENU':\r\n        case 'K_LALT':\r\n          if(isChiral) {\r\n            nextLayer = 'leftalt';\r\n            break;\r\n          }\r\n        case 'K_RMENU':\r\n        case 'K_RALT':\r\n          if(isChiral) {\r\n            nextLayer = 'rightalt';\r\n            break;\r\n          }\r\n        case 'K_ALT':\r\n          nextLayer = 'alt'; break;\r\n        case 'K_ALTGR':\r\n          if(isChiral) {\r\n            nextLayer = 'leftctrl-rightalt';\r\n          } else {\r\n            nextLayer = 'ctrl-alt';\r\n          }\r\n          break;\r\n        case 'K_CURRENCIES':\r\n        case 'K_NUMERALS':\r\n        case 'K_SHIFTED':\r\n        case 'K_UPPER':\r\n        case 'K_LOWER':\r\n        case 'K_SYMBOLS':\r\n          nextLayer = 'default'; break;\r\n      }\r\n\r\n      if(!nextLayer) return false;\r\n\r\n      // Do not change layer unless needed (27/08/2015)\r\n      if(nextLayer == osk.layerId && device.formFactor != 'desktop') return false;\r\n\r\n      // Change layer and refresh OSK\r\n      osk.updateLayer(nextLayer);\r\n      osk._Show();\r\n\r\n      return true;\r\n    }\r\n\r\n    /**\r\n     * Get the default key string. If keyName is U_xxxxxx, use that Unicode codepoint.\r\n     * Otherwise, lookup the  virtual key code (physical keyboard mapping)\r\n     *\r\n     * @param   {string}  keyName Name of the key\r\n     * @param   {number}  n\r\n     * @param   {number}  keyShiftState\r\n     * @param   {boolean} usingOSK\r\n     * @param   {Object=} Lelem\r\n     * @return  {string}\r\n     */\r\n    osk.defaultKeyOutput = function(keyName,n,keyShiftState,usingOSK,Lelem) {\r\n      var ch = '', checkCodes = false;\r\n      var touchAlias = (Lelem && typeof(Lelem.base) != 'undefined');\r\n      // check if exact match to SHIFT's code.  Only the 'default' and 'shift' layers should have default key outputs.\r\n      if(keyShiftState == 0) {\r\n        checkCodes = true;\r\n      } else if (keyShiftState == osk.modifierCodes['SHIFT']) {\r\n        checkCodes = true; \r\n        keyShiftState = 1; // It's used as an index.\r\n      } else {\r\n        console.warn(\"KMW only defines default key output for the 'default' and 'shift' layers!\");\r\n      }\r\n\r\n      // If this was triggered by the OSK -or- if it was triggered within a touch-aliased DIV element.\r\n      if(touchAlias || usingOSK) {\r\n        var code = osk.keyCodes[keyName];\r\n        if(!code) {\r\n          code = n;\r\n        }\r\n\r\n        switch(code) {\r\n          case osk.keyCodes['K_BKSP']:  //Only desktop UI, not touch devices. TODO: add repeat while mouse down for desktop UI\r\n            kbdInterface.defaultBackspace();\r\n            break;\r\n          case osk.keyCodes['K_TAB']:\r\n            keymanweb.domManager.moveToNext(keyShiftState);\r\n            break;\r\n          case osk.keyCodes['K_TABBACK']:\r\n            keymanweb.domManager.moveToNext(true);\r\n            break;\r\n          case osk.keyCodes['K_TABFWD']:\r\n            keymanweb.domManager.moveToNext(false);\r\n            break;\r\n          case osk.keyCodes['K_ENTER']:\r\n            // Insert new line in text area fields\r\n            if(Lelem.nodeName == 'TEXTAREA' || (typeof Lelem.base != 'undefined' && Lelem.base.nodeName == 'TEXTAREA')) {\r\n              return '\\n';\r\n            // Or move to next field from TEXT fields\r\n            } else if(usingOSK) {\r\n              if(Lelem.nodeName == 'INPUT' && (Lelem.type == 'search' || Lelem.type == 'submit')) {\r\n                Lelem.form.submit();\r\n              } else if(typeof(Lelem.base) != 'undefined' && (Lelem.base.type == 'search' || Lelem.base.type == 'submit')) {\r\n                Lelem.base.disabled=false;\r\n                Lelem.base.form.submit();\r\n              } else {\r\n                keymanweb.domManager.moveToNext(false);\r\n              }\r\n            }\r\n            break;\r\n          case osk.keyCodes['K_SPACE']:\r\n            return ' ';\r\n          // break;\r\n          //\r\n          // // Problem:  clusters, and doing them right.\r\n          // // The commented-out code below should be a decent starting point, but clusters make it complex.\r\n          //\r\n          // case osk.keyCodes['K_LEFT']:\r\n          //   if(touchAlias) {\r\n          //     var caretPos = keymanweb.getTextCaret(Lelem);\r\n          //     keymanweb.setTextCaret(Lelem, caretPos - 1 >= 0 ? caretPos - 1 : 0);\r\n          //   }\r\n          //   break;\r\n          // case osk.keyCodes['K_RIGHT']:\r\n          //   if(touchAlias) {\r\n          //     var caretPos = keymanweb.getTextCaret(Lelem);\r\n          //     keymanweb.setTextCaret(Lelem, caretPos + 1);\r\n          //   }\r\n          //   if(code == osk.keyCodes['K_RIGHT']) {\r\n          //     break;\r\n          //   }\r\n          // // Should we include this?  It could be tricky to do correctly...\r\n          // case osk.keyCodes['K_DEL']:\r\n          //   // Move caret right one unit, then backspace.\r\n          //   if(touchAlias) {\r\n          //     var caretPos = keymanweb.getTextCaret(Lelem);\r\n          //     keymanweb.setTextCaret(Lelem, caretPos + 1);\r\n          //     if(caretPos == keymanweb.getTextCaret(Lelem)) {\r\n          //       // Failed to move right - there's nothing to delete.\r\n          //       break;\r\n          //     }\r\n          //     kbdInterface.defaultBackspace();\r\n          //   }\r\n        }\r\n      }\r\n\r\n      // TODO:  Refactor the overloading of the 'n' parameter here into separate methods.\r\n\r\n      // Test for fall back to U_xxxxxx key id\r\n      // For this first test, we ignore the keyCode and use the keyName\r\n      if((keyName.substr(0,2) == 'U_')) {\r\n        var codePoint = parseInt(keyName.substr(2,6), 16);\r\n        if (((0x0 <= codePoint) && (codePoint <= 0x1F)) || ((0x80 <= codePoint) && (codePoint <= 0x9F))) {\r\n          // Code points [U_0000 - U_001F] and [U_0080 - U_009F] refer to Unicode C0 and C1 control codes.\r\n          // Check the codePoint number and do not allow output of these codes via U_xxxxxx shortcuts.\r\n          console.log(\"Suppressing Unicode control code: U_00\" + codePoint.toString(16));\r\n          return ch;\r\n        } else {\r\n          // String.fromCharCode() is inadequate to handle the entire range of Unicode\r\n          // Someday after upgrading to ES2015, can use String.fromCodePoint()\r\n          ch=String.kmwFromCharCode(codePoint);\r\n        }\r\n        // Hereafter, we refer to keyCodes.\r\n      } else if(checkCodes) { // keyShiftState can only be '1' or '2'.\r\n        try {\r\n          if(n >= osk.keyCodes['K_0'] && n <= osk.keyCodes['K_9']) { // The number keys.\r\n            ch = codesUS[keyShiftState][0][n-osk.keyCodes['K_0']];\r\n          } else if(n >=osk.keyCodes['K_A'] && n <= osk.keyCodes['K_Z']) { // The base letter keys\r\n            ch = String.fromCharCode(n+(keyShiftState?0:32));  // 32 is the offset from uppercase to lowercase.\r\n          } else if(n >= osk.keyCodes['K_COLON'] && n <= osk.keyCodes['K_BKQUOTE']) {\r\n            ch = codesUS[keyShiftState][1][n-osk.keyCodes['K_COLON']];\r\n          } else if(n >= osk.keyCodes['K_LBRKT'] && n <= osk.keyCodes['K_QUOTE']) {\r\n            ch = codesUS[keyShiftState][2][n-osk.keyCodes['K_LBRKT']];\r\n          }\r\n        } catch (e) {\r\n          console.error(\"Error detected with default mapping for key:  code = \" + n + \", shift state = \" + (keyShiftState == 1 ? 'shift' : 'default'));\r\n        }\r\n      }\r\n      return ch;\r\n    }\r\n\r\n    /**\r\n     * Simulate a keystroke according to the touched keyboard button element\r\n     *\r\n     * Note that the test-case oriented 'recorder' stubs this method to facilitate OSK-based input\r\n     * recording for use in test cases.  If changing this function, please ensure the recorder is\r\n     * not affected.\r\n     * \r\n     * @param       {Object}      e      element touched (or clicked)\r\n     */\r\n    osk.clickKey = function(e) {\r\n      var Lelem = keymanweb.domManager.getLastActiveElement(), Ls, Le, Lkc;\r\n\r\n      var activeKeyboard = keymanweb.keyboardManager.activeKeyboard;\r\n\r\n      // Each button id is of the form <layer>-<keyCode>, e.g. 'shift-ctrl-K_Q' or 'popup-shift-K_501', etc.\r\n      var t=e.id.split('-');\r\n      if(t.length < 2) return true; //shouldn't happen, but...\r\n\r\n      // Remove popup prefix before processing keystroke (KMEW-93)\r\n      if(t[0] == 'popup') t.splice(0,1);\r\n\r\n      if(Lelem != null) {\r\n        // Get key name and keyboard shift state (needed only for default layouts and physical keyboard handling)\r\n        // Note - virtual keys should be treated case-insensitive, so we force uppercasing here.\r\n        var layer=t[0], keyName=t[t.length-1].toUpperCase(), keyShiftState=osk.getModifierState(osk.layerId),\r\n          nextLayer = keyShiftState;\r\n\r\n        // Make sure to get the full current layer, since layers are now kebab-case.\r\n        for(var i=1; i < t.length-1; i++) {\r\n          layer = layer + \"-\" + t[i];\r\n        }\r\n\r\n        if(typeof(e.key) != 'undefined') nextLayer=e.key['nextlayer'];\r\n        keymanweb.domManager.initActiveElement(Lelem);\r\n\r\n        // Exclude menu and OSK hide keys from normal click processing\r\n        if(keyName == 'K_LOPT' || keyName == 'K_ROPT') {\r\n          osk.optionKey(e,keyName,true);\r\n          return true;\r\n        }\r\n\r\n        // Turn off key highlighting (or preview)\r\n        osk.highlightKey(e,false);\r\n\r\n        // The default OSK layout for desktop devices does not include nextlayer info, relying on modifier detection here.\r\n        if(device.formFactor == 'desktop') {\r\n          if(osk.selectLayer(keyName, nextLayer)){\r\n            return true;\r\n          }\r\n        }\r\n\r\n        // Prevent any output from 'ghost' (unmapped) keys\r\n        if(keyName != 'K_SPACE')\r\n        {\r\n          var keyText=e.childNodes[0].innerHTML;\r\n          //// if(keyText == '' || keyText == '&nbsp;') return true; --> why?\r\n        }\r\n\r\n        Ls=Lelem._KeymanWebSelectionStart;\r\n        Le=Lelem._KeymanWebSelectionEnd;\r\n        keymanweb.uiManager.setActivatingUI(true);\r\n        com.keyman.DOMEventHandlers.states._IgnoreNextSelChange = 100;\r\n        keymanweb.domManager.focusLastActiveElement();\r\n        if(keymanweb.domManager._IsMozillaEditableIframe(Lelem,0)) Lelem = Lelem.documentElement;\r\n        Lelem._KeymanWebSelectionStart=Ls;\r\n        Lelem._KeymanWebSelectionEnd=Le;\r\n        com.keyman.DOMEventHandlers.states._IgnoreNextSelChange = 0;\r\n        // ...end I3363 (Build 301)\r\n        keymanweb._CachedSelectionStart = null; // I3319\r\n        // Deadkey matching continues to be troublesome.\r\n        // Deleting matched deadkeys here seems to correct some of the issues.   (JD 6/6/14)\r\n        kbdInterface._DeadkeyDeleteMatched();      // Delete any matched deadkeys before continuing\r\n        //kbdInterface._DeadkeyResetMatched();       // I3318   (Not needed if deleted first?)\r\n\r\n\r\n\r\n        // First check the virtual key, and process shift, control, alt or function keys\r\n        Lkc = {Ltarg:Lelem,Lmodifiers:0,Lstates:0,Lcode:osk.keyCodes[keyName],LisVirtualKey:true};\r\n\r\n        // Set the flags for the state keys.\r\n        Lkc.Lstates |= osk._stateKeys['K_CAPS']    ? osk.modifierCodes['CAPS'] : osk.modifierCodes['NO_CAPS'];\r\n        Lkc.Lstates |= osk._stateKeys['K_NUMLOCK'] ? osk.modifierCodes['NUM_LOCK'] : osk.modifierCodes['NO_NUM_LOCK'];\r\n        Lkc.Lstates |= osk._stateKeys['K_SCROLL']  ? osk.modifierCodes['SCROLL_LOCK'] : osk.modifierCodes['NO_SCROLL_LOCK'];\r\n\r\n        // Set LisVirtualKey to false to ensure that nomatch rule does fire for U_xxxx keys\r\n        if(keyName.substr(0,2) == 'U_') Lkc.LisVirtualKey=false;\r\n\r\n        // Get code for non-physical keys (T_KOKAI, U_05AB etc)\r\n        if(typeof Lkc.Lcode == 'undefined')\r\n        {\r\n          Lkc.Lcode = osk.getVKDictionaryCode(keyName);// Updated for Build 347\r\n          if(!Lkc.Lcode) \r\n          {\r\n            // Special case for U_xxxx keys. This vk code will never be used\r\n            // in a keyboard, so we use this to ensure that keystroke processing\r\n            // occurs for the key.\r\n            Lkc.Lcode = 1; \r\n          }\r\n        }\r\n\r\n        // Override key shift state if specified for key in layout (corrected for popup keys KMEW-93)\r\n        var lx=(typeof e.key == 'undefined' ? null : e.key['layer']);\r\n        if(lx == null)\r\n          keyShiftState=osk.getModifierState(layer);\r\n        else\r\n          keyShiftState=osk.getModifierState(lx);\r\n\r\n        // Define modifiers value for sending to keyboard mapping function\r\n        Lkc.Lmodifiers = keyShiftState;\r\n\r\n        // Handles modifier states when the OSK is emulating rightalt through the leftctrl-leftalt layer.\r\n        if((Lkc.Lmodifiers & osk.modifierBitmasks['ALT_GR_SIM']) == osk.modifierBitmasks['ALT_GR_SIM'] && osk.emulatesAltGr()) {\r\n          Lkc.Lmodifiers &= ~osk.modifierBitmasks['ALT_GR_SIM'];\r\n          Lkc.Lmodifiers |= osk.modifierCodes['RALT'];\r\n        }\r\n\r\n        // Include *limited* support for mnemonic keyboards (Sept 2012)\r\n        // If a touch layout has been defined for a mnemonic keyout, do not perform mnemonic mapping for rules on touch devices.\r\n        if(activeKeyboard && activeKeyboard['KM'] && !(activeKeyboard['KVKL'] && device.formFactor != 'desktop')) {\r\n          if(Lkc.Lcode != osk.keyCodes['K_SPACE']) { // exception required, March 2013\r\n            Lkc.vkCode = Lkc.Lcode;\r\n            // So long as the key name isn't prefixed with 'U_', we'll get a default mapping based on the Lcode value.\r\n            // We need to determine the mnemonic base character - for example, SHIFT + K_PERIOD needs to map to '>'.\r\n            var mappedChar: string = osk.defaultKeyOutput('K_xxxx', Lkc.Lcode, (layer.indexOf('shift') != -1 ? 0x10 : 0), false, null);\r\n            if(mappedChar) {\r\n              Lkc.Lcode = mappedChar.charCodeAt(0);\r\n            } // No 'else' - avoid remapping control + modifier keys!\r\n\r\n            if(osk._stateKeys['K_CAPS']) {\r\n              if((Lkc.Lcode >= 65 && Lkc.Lcode <= 90) /* 'A' - 'Z' */ || (Lkc.Lcode >= 97 && Lkc.Lcode <= 122) /* 'a' - 'z' */) {\r\n                Lkc.Lmodifiers ^= 0x10; // Flip the 'shift' bit.\r\n                Lkc.Lcode ^= 0x20; // Flips the 'upper' vs 'lower' bit for the base 'a'-'z' ASCII alphabetics.\r\n              }\r\n            }\r\n          }\r\n        } else {\r\n          Lkc.vkCode=Lkc.Lcode;\r\n        }\r\n\r\n        // Support version 1.0 KeymanWeb keyboards that do not define positional vs mnemonic\r\n        if(typeof activeKeyboard['KM'] == 'undefined')\r\n        {\r\n          Lkc.Lcode=keymanweb.keyMapManager._USKeyCodeToCharCode(Lkc);\r\n          Lkc.LisVirtualKey=false;\r\n        }\r\n\r\n        // Pass this key code and state to the keyboard program\r\n        if(!activeKeyboard || (Lkc.Lcode != 0 && !kbdInterface.processKeystroke(util.device, Lelem, Lkc)))\r\n        {\r\n          // Restore the virtual key code if a mnemonic keyboard is being used\r\n          Lkc.Lcode=Lkc.vkCode;\r\n\r\n          // Handle unmapped keys, including special keys\r\n          switch(keyName)\r\n          {\r\n            case 'K_CAPS':\r\n            case 'K_NUMLOCK':\r\n            case 'K_SCROLL':\r\n              osk._stateKeys[keyName] = ! osk._stateKeys[keyName];\r\n              osk._Show();\r\n              break;\r\n            default:\r\n              // The following is physical layout dependent, so should be avoided if possible.  All keys should be mapped.\r\n              var ch = osk.defaultKeyOutput(keyName,Lkc.Lcode,keyShiftState,true,Lelem);\r\n              if(ch) {\r\n                kbdInterface.output(0, Lelem, ch);\r\n              }\r\n          }\r\n        }\r\n\r\n        // Test if this key has a non-default next layer\r\n        if(typeof e.key != 'undefined' && e.key['nextlayer'] !== null) osk.nextLayer=e.key['nextlayer'];\r\n\r\n        // Swap layer as appropriate.\r\n        osk.selectLayer(keyName, nextLayer);\r\n\r\n        /* I732 END - 13/03/2007 MCD: End Positional Layout support in OSK */\r\n        Lelem._KeymanWebSelectionStart=null;\r\n        Lelem._KeymanWebSelectionEnd=null;\r\n      }\r\n      keymanweb.uiManager.setActivatingUI(false);\t// I2498 - KeymanWeb OSK does not accept clicks in FF when using automatic UI\r\n      return true;\r\n    }\r\n\r\n    /**\r\n     * Function     getLayerId\r\n     * Scope        Private\r\n     * @param       {number}      m     shift modifier code\r\n     * @return      {string}            layer string from shift modifier code (desktop keyboards)\r\n     * Description  Get name of layer from code, where the modifer order is determined by ascending bit-flag value.\r\n     */\r\n    osk.getLayerId = function(m)\r\n    {\r\n      var s='';\r\n      if(m == 0) {\r\n        return 'default';\r\n      } else {\r\n        if(m & osk.modifierCodes['LCTRL']) {\r\n          s = (s.length > 0 ? s + '-' : '') + 'leftctrl';\r\n        }\r\n        if(m & osk.modifierCodes['RCTRL']) {\r\n          s = (s.length > 0 ? s + '-' : '') + 'rightctrl';\r\n        }\r\n        if(m & osk.modifierCodes['LALT']) {\r\n          s = (s.length > 0 ? s + '-' : '') + 'leftalt';\r\n        }\r\n        if(m & osk.modifierCodes['RALT']) {\r\n          s = (s.length > 0 ? s + '-' : '') + 'rightalt';\r\n        }\r\n        if(m & osk.modifierCodes['SHIFT']) {\r\n          s = (s.length > 0 ? s + '-' : '') + 'shift';\r\n        }\r\n        if(m & osk.modifierCodes['CTRL']) {\r\n          s = (s.length > 0 ? s + '-' : '') + 'ctrl';\r\n        }\r\n        if(m & osk.modifierCodes['ALT']) {\r\n          s = (s.length > 0 ? s + '-' : '') + 'alt';\r\n        }\r\n        return s;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Get modifier key state from layer id\r\n     *\r\n     * @param       {string}      layerId       layer id (e.g. ctrlshift)\r\n     * @return      {number}                    modifier key state (desktop keyboards)\r\n     */\r\n    osk.getModifierState = function(layerId)\r\n    {\r\n        var modifier=0;\r\n        if(layerId.indexOf('shift') >= 0) {\r\n          modifier |= osk.modifierCodes['SHIFT'];\r\n        }\r\n\r\n        // The chiral checks must not be directly exclusive due each other to visual OSK feedback.\r\n        var ctrlMatched=false;\r\n        if(layerId.indexOf('leftctrl') >= 0) {\r\n          modifier |= osk.modifierCodes['LCTRL'];\r\n          ctrlMatched=true;\r\n        } \r\n        if(layerId.indexOf('rightctrl') >= 0) {\r\n          modifier |= osk.modifierCodes['RCTRL'];\r\n          ctrlMatched=true;\r\n        } \r\n        if(layerId.indexOf('ctrl')  >= 0 && !ctrlMatched) {\r\n          modifier |= osk.modifierCodes['CTRL'];\r\n        }\r\n\r\n        var altMatched=false;\r\n        if(layerId.indexOf('leftalt') >= 0) {\r\n          modifier |= osk.modifierCodes['LALT'];\r\n          altMatched=true;\r\n        } \r\n        if(layerId.indexOf('rightalt') >= 0) {\r\n          modifier |= osk.modifierCodes['RALT'];\r\n          altMatched=true;\r\n        } \r\n        if(layerId.indexOf('alt')  >= 0 && !altMatched) {\r\n          modifier |= osk.modifierCodes['ALT'];\r\n        }\r\n\r\n        return modifier;\r\n    }\r\n\r\n    /**\r\n     * Sets the new layer id, allowing for toggling shift/ctrl/alt while preserving the remainder\r\n     * of the modifiers represented by the current layer id (where applicable)\r\n     *\r\n     * @param       {string}      id      layer id (e.g. ctrlshift)\r\n     */\r\n    osk.updateLayer = function(id)\r\n    {\r\n      var s=osk.layerId,idx=id;\r\n      var i;\r\n\r\n      if((<KeymanBase>keymanweb).util.device.formFactor == 'desktop') {\r\n        // Need to test if target layer is a standard layer (based on the plain 'default')\r\n        var replacements= ['leftctrl', 'rightctrl', 'ctrl', 'leftalt', 'rightalt', 'alt', 'shift'];\r\n\r\n        for(i=0; i < replacements.length; i++) {\r\n          // Don't forget to remove the kebab-case hyphens!\r\n          idx=idx.replace(replacements[i] + '-', '');\r\n          idx=idx.replace(replacements[i],'');\r\n        }\r\n\r\n        // If we are presently on the default layer, drop the 'default' and go straight to the shifted mode.\r\n        // If on a common symbolic layer, drop out of symbolic mode and go straight to the shifted mode.\r\n        if(osk.layerId == 'default' || osk.layerId == 'numeric' || osk.layerId == 'symbol' || osk.layerId == 'currency' || idx != '') {\r\n          s = id;\r\n        }\r\n        // Otherwise, we are based upon the a layer that accepts modifier variations.\r\n        // Modify the layer according to the current state and key pressed.\r\n        //\r\n        // TODO:  Consider:  should this ever be allowed for a base layer other than 'default'?  If not,\r\n        // if(idx == '') with accompanying if-else structural shift would be a far better test here.\r\n        else\r\n        {\r\n          // Save our current modifier state.\r\n          var modifier=osk.getModifierState(s);\r\n\r\n          // Strip down to the base modifiable layer.\r\n          for(i=0; i < replacements.length; i++) {\r\n            // Don't forget to remove the kebab-case hyphens!\r\n            s=s.replace(replacements[i] + '-', '');\r\n            s=s.replace(replacements[i],'');\r\n          }\r\n\r\n          // Toggle the modifier represented by our input argument.\r\n          switch(id)\r\n          {\r\n            case 'shift':\r\n              modifier ^= osk.modifierCodes['SHIFT'];\r\n              break;\r\n            case 'leftctrl':\r\n              modifier ^= osk.modifierCodes['LCTRL'];\r\n              break;\r\n            case 'rightctrl':\r\n              modifier ^= osk.modifierCodes['RCTRL'];\r\n              break;\r\n            case 'ctrl':\r\n              modifier ^= osk.modifierCodes['CTRL'];\r\n              break;\r\n            case 'leftalt':\r\n              modifier ^= osk.modifierCodes['LALT'];\r\n              break;\r\n            case 'rightalt':\r\n              modifier ^= osk.modifierCodes['RALT'];\r\n              break;\r\n            case 'alt':\r\n              modifier ^= osk.modifierCodes['ALT'];\r\n              break;\r\n            default:\r\n              s = id;\r\n          }\r\n          // Combine our base modifiable layer and attach the new modifier variation info to obtain our destination layer.\r\n          if(s != 'default') {\r\n            if(s == '') {\r\n              s = osk.getLayerId(modifier);\r\n            } else {\r\n              s = osk.getLayerId(modifier) + '-' + s;\r\n            }\r\n          }\r\n        }\r\n        \r\n        if(s == '') {\r\n          s = 'default';\r\n        }\r\n      } else {\r\n        // Mobile form-factor.  Either the layout is specified by a keyboard developer with direct layer name references\r\n        // or all layers are accessed via subkey of a single layer-shifting key - no need for modifier-combining logic.\r\n        s = id;\r\n      }\r\n\r\n      // Actually set the new layer id.\r\n      osk.layerId = s;\r\n\r\n      // Check that requested layer is defined   (KMEA-1, but does not resolve issue)\r\n      for(i=0; i<osk.layers.length; i++)\r\n        if(osk.layerId == osk.layers[i].id) return;\r\n\r\n      // Show default layer if an undefined layer has been requested\r\n      osk.layerId='default';\r\n    }\r\n\r\n    /**\r\n     * Indicate the current language and keyboard on the space bar\r\n     **/\r\n    osk.showLanguage = function() {\r\n      var lgName='',kbdName='';\r\n      var activeStub = keymanweb.keyboardManager.activeStub;\r\n\r\n      if(activeStub) {\r\n        lgName=activeStub['KL'];\r\n        kbdName=activeStub['KN'];\r\n      } else if(keymanweb._ActiveLanguage) {\r\n        lgName=keymanweb._ActiveLanguage['KN'];\r\n      } else {\r\n        lgName='English';\r\n      }\r\n\r\n      try\r\n      {\r\n        var t=osk.spaceBar.firstChild.firstChild;\r\n        if(typeof(t.parentNode.className) == 'undefined' || t.parentNode.className == '')\r\n          t.parentNode.className='kmw-spacebar';\r\n        else\r\n          t.parentNode.className +=' kmw-spacebar';\r\n\r\n        t.className='kmw-spacebar-caption';\r\n        kbdName=kbdName.replace(/\\s*keyboard\\s*/i,'');\r\n\r\n        // We use a separate variable here to keep down on MutationObserver messages in keymanweb.js code.\r\n        var keyboardName = \"\";\r\n        if(kbdName == lgName) {\r\n          keyboardName=lgName;\r\n        } else {\r\n          keyboardName=lgName+' ('+kbdName+')';\r\n        }\r\n        // It sounds redundant, but this dramatically cuts down on browser DOM processing.\r\n        if(t.innerHTML != keyboardName) {\r\n          t.innerHTML = keyboardName;\r\n        }\r\n      }\r\n      catch(ex){}\r\n    }\r\n\r\n    /**\r\n     * Display list of installed keyboards in pop-up menu\r\n     **/\r\n    osk.showLanguageMenu = function()\r\n    {\r\n      var n=0,kbdList=keymanweb.keyboardManager.keyboardStubs,nKbds=kbdList.length;\r\n      if(nKbds < 1) return;\r\n\r\n      // Create the menu list container element\r\n      var menu=osk.lgList=util._CreateElement('DIV'),ss;\r\n      osk.lgList.id='kmw-language-menu';\r\n\r\n      // Insert a transparent overlay to prevent anything else happening during keyboard selection,\r\n      // but allow the menu to be closed if anywhere else on screen is touched\r\n      menu.shim=util._CreateElement('DIV');\r\n      menu.shim.id='kmw-language-menu-background';\r\n      menu.shim.addEventListener('touchstart',\r\n        function(e)\r\n        {\r\n          e.preventDefault(); osk.hideLanguageList();\r\n\r\n          // Display build only if touching menu, space *and* one other point on screen (build 369)\r\n          if(e.touches.length > 2)\r\n          {\r\n            var sX=e.touches[1].pageX,sY=e.touches[1].pageY;\r\n            if(sX > osk.spaceBar.offsetLeft && sX < osk.spaceBar.offsetLeft+osk.spaceBar.offsetWidth &&\r\n              sY > osk.spaceBar.offsetTop && sY < osk.spaceBar.offsetTop+osk.spaceBar.offsetHeight) osk.showBuild();\r\n          }\r\n        },false);\r\n      document.body.appendChild(menu.shim);\r\n\r\n      // Add two nested DIVs to properly support iOS scrolling with momentum\r\n      //  c.f. https://github.com/joelambert/ScrollFix/issues/2\r\n      var m2=util._CreateElement('DIV'),s2=m2.style,\r\n          m3=util._CreateElement('DIV'),s3=m3.style;\r\n      m2.id='kmw-menu-scroll-container'; m3.id='kmw-menu-scroller';\r\n\r\n      // Support momentum scrolling on iOS\r\n      if('WebkitOverflowScrolling' in s2) s2.WebkitOverflowScrolling='touch';\r\n\r\n      m2.appendChild(m3);\r\n      menu.appendChild(m2);\r\n\r\n      // Add menu index strip\r\n      var i,x,mx=util._CreateElement('DIV');\r\n      mx.id='kmw-menu-index';\r\n      for(i=1; i<=26; i++)\r\n      {\r\n        x=util._CreateElement('P');\r\n        x.innerHTML=String.fromCharCode(i+64);\r\n        mx.appendChild(x);\r\n      }\r\n\r\n      // Add index selection (for a large menu)\r\n      mx.addEventListener('touchstart',function(e){osk.scrollToLanguage(e,m2,m3);},false);\r\n      mx.addEventListener('touchend',function(e){e.stopPropagation();e.preventDefault();},false);\r\n      menu.appendChild(mx);\r\n\r\n  //TODO: not sure if either of these two handlers ar actually needed.  touchmove handler may be doing all that is necessary.\r\n      // Add scroll end event handling to override body scroll\r\n      menu.addEventListener('scroll',function(e){\r\n        osk.lgList.scrolling=true;\r\n        },false);\r\n      m2.addEventListener('scroll',function(e){\r\n        //osk.lgList.scrolling=true;\r\n        if(m2.scrollTop < 1)m2.scrollTop=1;\r\n        if(m2.scrollTop > m2.scrollHeight-m2.offsetHeight-1)m2.scrollTop=m2.scrollHeight-m2.offsetHeight-1;\r\n        },false);\r\n\r\n      // Add a list of keyboards to the innermost DIV\r\n      osk.lgList.activeLgNo=osk.addLanguagesToMenu(m3,kbdList);\r\n\r\n      // Get number of visible (language) selectors\r\n      var nLgs=m3.childNodes.length-1;\r\n\r\n      // Do not display until sizes have been calculated\r\n      osk.lgList.visibility='hidden';\r\n\r\n      // Append menu to document body, not to OSK\r\n      document.body.appendChild(osk.lgList);\r\n\r\n      // Adjust size for viewport scaling (probably not needed for iOS, but check!)\r\n      if(device.OS == 'Android' && 'devicePixelRatio' in window)\r\n        osk.lgList.style.fontSize=(2/window.devicePixelRatio)+'em';\r\n\r\n\r\n      // Adjust width for pixel scaling on Android tablets\r\n      if(device.OS == 'Android' && device.formFactor == 'tablet' && 'devicePixelRatio' in window)\r\n      {\r\n        var w=parseInt(util.getStyleValue(menu,'width'),10),ms=menu.style;\r\n        if(!isNaN(w)) ms.width=ms.maxWidth=(2*w/window.devicePixelRatio)+'px';\r\n        w=parseInt(util.getStyleValue(m2,'width'),10); ms=m2.style;\r\n        if(!isNaN(w)) ms.width=ms.maxWidth=(2*w/window.devicePixelRatio)+'px';\r\n        w=parseInt(util.getStyleValue(m3,'width'),10); ms=m3.style;\r\n        if(!isNaN(w)) ms.width=ms.maxWidth=(2*w/window.devicePixelRatio)+'px';\r\n      }\r\n\r\n      // Adjust initial top and height of menu\r\n      osk.adjustLanguageMenu(0);\r\n\r\n      // Adjust the index font size and line height\r\n      var dy=mx.childNodes[1].offsetTop-mx.childNodes[0].offsetTop,\r\n          lineHeight=Math.floor(menu.offsetHeight/26.0),\r\n          scale=Math.round(100.0*lineHeight/dy)/100.0,\r\n          factor=(scale > 0.6 ? 1 : 2);\r\n\r\n      if(scale > 1.25) scale=1.25;\r\n\r\n      for(i=0;i<26;i++)\r\n      {\r\n        var qs=mx.childNodes[i].style;\r\n        if(factor == 2 && (i%2) == 1)\r\n        {\r\n          qs.display='none';\r\n        }\r\n        else\r\n        {\r\n          qs.fontSize=(scale*factor)+'em';\r\n          qs.lineHeight=(lineHeight*factor)+'px';\r\n        }\r\n      }\r\n\r\n      // Increase width of outer menu DIV by index, else hide index\r\n      var menuWidth=m2.offsetWidth;\r\n      if(m2.scrollHeight > m2.offsetHeight+3)\r\n        menuWidth = menuWidth+mx.offsetWidth;\r\n      else\r\n        mx.style.display='none';\r\n\r\n      menu.style.width=menuWidth+'px';\r\n\r\n      // Now display the menu\r\n      osk.lgList.visibility='';\r\n\r\n      // Set initial scroll to show current language (but never less than 1, to avoid dragging body)\r\n      var top=m3.firstChild.offsetHeight*osk.lgList.activeLgNo+1;\r\n      m2.scrollTop=top;\r\n\r\n      // The scrollTop value is limited by the device, and must be limited to avoid dragging the document body\r\n      if(m2.scrollTop < top) m2.scrollTop=m2.scrollHeight-m2.offsetHeight;\r\n      if(m2.scrollTop > m2.scrollHeight-m2.offsetHeight-1)m2.scrollTop=m2.scrollHeight-m2.offsetHeight-1;\r\n\r\n    }\r\n\r\n    /**\r\n     * Adjust top and height of language menu\r\n     *\r\n     * @param   {number}  nKbds number of displayed keyboards to add to number of languages\r\n     **/\r\n    osk.adjustLanguageMenu = function(nKbds)\r\n    {\r\n      var menu=osk.lgList,m2=menu.firstChild,m3=m2.firstChild,\r\n        barWidth=0,s=menu.style,mx=menu.childNodes[1],\r\n        maxHeight=window.innerHeight-osk.lgKey.offsetHeight-16,\r\n        nItems=m3.childNodes.length+nKbds-1,      // Number of (visible) keyboard selectors\r\n        itemHeight=m3.firstChild.firstChild.offsetHeight,\r\n        menuHeight=nItems*itemHeight;\r\n\r\n      // Correct maxheight for viewport scaling (iPhone/iPod only) and internal position corrections\r\n      if(device.OS == 'iOS')\r\n      {\r\n        if(device.formFactor == 'phone')\r\n        {\r\n          barWidth=(util.landscapeView() ? 36 : 0);\r\n          maxHeight=(window.innerHeight-barWidth-16)*util.getViewportScale();\r\n        }\r\n        else if(device.formFactor == 'tablet')\r\n        {\r\n          barWidth=(util.landscapeView() ? 16 : 0);\r\n          maxHeight=(maxHeight-barWidth);\r\n        }\r\n      }\r\n\r\n      // Explicitly set position and height\r\n      s.left=util._GetAbsoluteX(osk.lgKey)+'px';\r\n      if(menuHeight > maxHeight) menuHeight=maxHeight;\r\n      s.height=menuHeight+'px';\r\n\r\n      // Position menu at bottom of screen, but referred to top (works for both iOS and Firefox)\r\n      s.top=(util._GetAbsoluteY(osk._Box)+osk._Box.offsetHeight-menuHeight+window.pageYOffset-6)+'px';\r\n      s.bottom='auto';\r\n\r\n      // Explicitly set the scroller and index heights to the container height\r\n      mx.style.height=m2.style.height=s.height;\r\n\r\n    }\r\n\r\n    /**\r\n     * Add an index to the language menu\r\n     *\r\n     *  @param  {Object}  e         touch start event from index\r\n     *  @param  {Object}  m2        menu scroller DIV\r\n     *  @param  {Object}  menu      DIV with list of languages\r\n     */\r\n    osk.scrollToLanguage = function(e,m2,menu)\r\n    {\r\n      e.stopImmediatePropagation();e.stopPropagation();e.preventDefault();\r\n      if(e.touches[0].target.nodeName != 'P') return;\r\n      var i,t,top=0,initial=e.touches[0].target.innerHTML.charCodeAt(0),nn=menu.childNodes;\r\n      try {\r\n        for(i=0; i<nn.length-1; i++)\r\n        {\r\n          t=nn[i].firstChild.innerHTML.toUpperCase().charCodeAt(0);\r\n          if(t >= initial) break;\r\n        }\r\n      }\r\n      catch(ex){}\r\n      try\r\n      {\r\n        top=menu.firstChild.offsetHeight*i+1;\r\n        m2.scrollTop=top;\r\n      }\r\n      catch(ex){top=0;}\r\n      try\r\n      {\r\n        if(m2.scrollTop < top) m2.scrollTop=m2.scrollHeight-m2.offsetHeight;\r\n        if(m2.scrollTop > m2.scrollHeight-m2.offsetHeight-1) m2.scrollTop=m2.scrollHeight-m2.offsetHeight-1;\r\n      }\r\n      catch(ex){}\r\n    }\r\n\r\n    /**\r\n     * Display all languages for installed keyboards in scrollable list\r\n     *\r\n     *    @param    {Object}    menu      DIV to which language selectors will be added\r\n     *    @param    {Object}    kbdList   array of keyboard stub objects\r\n     *    @return   {number}              index of currently active language\r\n     **/\r\n    osk.addLanguagesToMenu = function(menu,kbdList)\r\n    {\r\n      var nStubs=kbdList.length;\r\n\r\n      // Create and sort a list of languages\r\n      var k,n,lg,langs=[];\r\n      for(n=0; n<nStubs; n++)\r\n      {\r\n        lg=kbdList[n]['KL'];\r\n        if(langs.indexOf(lg) == -1) langs.push(lg);\r\n      }\r\n      langs.sort();\r\n\r\n      // Get current scale factor (reciprocal of viewport scale)\r\n      var scale=Math.round(100/util.getViewportScale())/100;\r\n\r\n      var dx,lgBar,kList,i,kb,activeLanguageIndex=-1;\r\n      for(k=0; k<langs.length; k++)\r\n      {\r\n        dx=util._CreateElement('DIV');dx.className='kbd-list-closed';\r\n        lgBar=util._CreateElement('P');\r\n        lgBar.kList=[];\r\n\r\n        for(n=0; n<nStubs; n++)\r\n        {\r\n          if(kbdList[n]['KL'] == langs[k]) lgBar.kList.push(kbdList[n]);\r\n        }\r\n\r\n        // Adjust bar size for current viewport scaling (iOS only!)\r\n        if(device.OS == 'iOS') lgBar.style.fontSize=scale+'em';\r\n\r\n        // Add to menu\r\n        dx.appendChild(lgBar);\r\n        menu.appendChild(dx);\r\n\r\n        if(langs[k] == (<KeymanBase>keymanweb).keyboardManager.activeStub['KL']) activeLanguageIndex=k;\r\n\r\n        // Several keyboards for this language\r\n        if(lgBar.kList.length > 1)\r\n        {\r\n          lgBar.className='kbd-list';\r\n          lgBar.innerHTML=langs[k]+'...';\r\n          lgBar.scrolled=false;\r\n          lgBar.ontouchend=function(e)\r\n          {\r\n            e.preventDefault();e.stopPropagation();\r\n            if(e.target.scrolled)\r\n              e.target.scrolled=false;\r\n            else\r\n              this.parentNode.className=(this.parentNode.className=='kbd-list-closed'?'kbd-list-open':'kbd-list-closed');\r\n\r\n            // Adjust top of menu to allow for expanded list\r\n            osk.adjustLanguageMenu(this.parentNode.className=='kbd-list-closed'?0:this.kList.length);\r\n          }\r\n          lgBar.addEventListener('touchstart',function(e){e.stopPropagation();},false);\r\n          lgBar.addEventListener('touchmove',function(e){e.target.scrolled=true;e.stopPropagation();},false);\r\n\r\n          for(i=0; i<lgBar.kList.length; i++)\r\n          {\r\n            kb=util._CreateElement('P');kb.className='kbd-list-entry';\r\n            if(device.OS == 'iOS') kb.style.fontSize=scale+'em';\r\n            osk.addKeyboardToMenu(lgBar.kList[i],kb,false);\r\n            dx.appendChild(kb);\r\n          }\r\n        }\r\n\r\n        // Only one keyboard for this language\r\n        else\r\n        {\r\n          lgBar.innerHTML=langs[k];\r\n          lgBar.className='kbd-single-entry';\r\n          osk.addKeyboardToMenu(lgBar.kList[0],lgBar,true);\r\n        }\r\n        if(k == activeLanguageIndex) lgBar.className=lgBar.className+' current';\r\n      }\r\n\r\n      // Add a non-selectable bottom bar so to allow scrolling to the last language\r\n      var padLast=util._CreateElement('DIV'); padLast.id='kmw-menu-footer';\r\n      var cancelTouch=function(e){e.preventDefault();e.stopPropagation();};\r\n      padLast.addEventListener('touchstart',cancelTouch,false);\r\n      padLast.addEventListener('touchmove',cancelTouch,false);\r\n      padLast.addEventListener('touchend',cancelTouch,false);\r\n      menu.appendChild(padLast);\r\n\r\n      return activeLanguageIndex;\r\n    }\r\n\r\n    /**\r\n     * Add a keyboard entry to the language menu *\r\n     *\r\n     * @param   {Object}    kbd     keyboard object\r\n     * @param   {Object}    kb      element being added and styled\r\n     * @param   {boolean}   unique  is this the only keyboard for the language?\r\n     */\r\n    osk.addKeyboardToMenu = function(kbd,kb,unique)\r\n    {\r\n      kb.kn=kbd['KI'];        // InternalName;\r\n      kb.kc=kbd['KLC'];       // LanguageCode;\r\n      kb.innerHTML=unique?kbd['KL']:kbd['KN'].replace(' Keyboard',''); // Name\r\n\r\n      // Touchstart (or mspointerdown) event highlights the touched list item\r\n      var touchStart=function(e)\r\n      {\r\n        e.stopPropagation();\r\n        if(this.className.indexOf('selected') <= 0) this.className=this.className+' selected';\r\n        osk.lgList.scrolling=false;\r\n        osk.lgList.y0=e.touches[0].pageY;//osk.lgList.childNodes[0].scrollTop;\r\n        return true;\r\n      },\r\n  //TODO: Still drags Android background sometimes (not consistently)\r\n      // Touchmove drags the list and prevents release from selecting the language\r\n      touchMove=function(e)\r\n      {\r\n        e.stopImmediatePropagation();\r\n        var scroller=osk.lgList.childNodes[0],\r\n            yMax=scroller.scrollHeight-scroller.offsetHeight,\r\n        y, dy;\r\n\r\n        if(\"undefined\" != typeof e.pageY) y = e.pageY;\r\n        else if(\"undefined\" != typeof e.touches) y = e.touches[0].pageY;\r\n        else return;\r\n\r\n        dy=y-osk.lgList.y0;\r\n\r\n        // Scroll up (show later listed languages)\r\n        if(dy < 0)\r\n        {\r\n          if(scroller.scrollTop >= yMax-1)\r\n          {\r\n            e.preventDefault(); osk.lgList.y0=y;\r\n          }\r\n        }\r\n        // Scroll down (show earlier listed languages)\r\n        else if(dy > 0)\r\n        {\r\n          if(scroller.scrollTop < 2)\r\n          {\r\n            e.preventDefault(); osk.lgList.y0=y;\r\n          }\r\n        }\r\n        // Dont' scroll - can happen if changing scroll direction\r\n        else\r\n          return;\r\n\r\n        // Disable selected language if drag more than 5px\r\n        if(dy < -5 || dy > 5)\r\n        {\r\n          osk.lgList.scrolling=true;\r\n          this.className=this.className.replace(/\\s*selected/,'');\r\n          osk.lgList.y0=y;\r\n        }\r\n        return true;\r\n      },\r\n\r\n      // Touch release (click) event selects touched list item\r\n      touchEnd=function(e)\r\n      {\r\n        e.preventDefault();\r\n        if(typeof(e.stopImmediatePropagation) != 'undefined') e.stopImmediatePropagation();else e.stopPropagation();\r\n\r\n        if(osk.lgList.scrolling)\r\n        {\r\n          this.className=this.className.replace(/\\s*selected/,'');\r\n        }\r\n        else\r\n        {\r\n          com.keyman.DOMEventHandlers.states.setFocusTimer();\r\n\r\n          osk.lgList.style.display='none'; //still allows blank menu momentarily on selection\r\n          keymanweb.keyboardManager._SetActiveKeyboard(this.kn,this.kc,true);\r\n          keymanweb.keyboardManager.doKeyboardChange(this.kn,this.kc);\r\n          keymanweb.domManager.focusLastActiveElement();\r\n          osk.hideLanguageList();\r\n\r\n          // Update the OSK with the new keyboard\r\n          osk._Show();\r\n        }\r\n        return true;\r\n      };\r\n\r\n      kb.onmspointerdown=touchStart;\r\n      kb.addEventListener('touchstart',touchStart,false);\r\n      kb.onmspointermove=touchMove;\r\n      kb.addEventListener('touchmove',touchMove,false);\r\n      kb.onmspointerout=touchEnd;\r\n      kb.addEventListener('touchend',touchEnd,false);\r\n    }\r\n\r\n    /**\r\n     * Remove the language menu again\r\n     **/\r\n    osk.hideLanguageList = function()\r\n    {\r\n      if(osk.lgList)\r\n      {\r\n        osk.highlightKey(osk.lgKey.firstChild,false);\r\n        osk.lgList.style.visibility='hidden';\r\n        window.setTimeout(function(){\r\n        if(osk.lgList != null && typeof osk.lgList != 'undefined') {\r\n            document.body.removeChild(osk.lgList.shim);\r\n            document.body.removeChild(osk.lgList);\r\n      }\r\n          osk.lgList=null;\r\n          },500);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function     _UpdateVKShift\r\n     * Scope        Private\r\n     * @param       {Object}            e     OSK event\r\n     * @param       {number}            v     keyboard shift state\r\n     * @param       {(boolean|number)}  d     set (1) or clear(0) shift state bits\r\n     * @return      {boolean}                 Always true\r\n     * Description  Update the current shift state within KMW\r\n     */\r\n    osk._UpdateVKShift = function(e, v, d) {\r\n      var keyShiftState=0, lockStates=0, i;\r\n\r\n      var lockNames  = ['CAPS', 'NUM_LOCK', 'SCROLL_LOCK'];\r\n      var lockKeys   = ['K_CAPS', 'K_NUMLOCK', 'K_SCROLL'];\r\n\r\n      if(e) {\r\n        // read shift states from Pevent\r\n        keyShiftState = e.Lmodifiers;\r\n        lockStates = e.Lstates;\r\n\r\n        // Are we simulating AltGr?  If it's a simulation and not real, time to un-simulate for the OSK.\r\n        if(keymanweb.keyboardManager.isChiral() && osk.emulatesAltGr() && \r\n            (com.keyman.DOMEventHandlers.states.modStateFlags & osk.modifierBitmasks['ALT_GR_SIM']) == osk.modifierBitmasks['ALT_GR_SIM']) {\r\n          keyShiftState |= osk.modifierBitmasks['ALT_GR_SIM'];\r\n          keyShiftState &= ~osk.modifierCodes['RALT'];\r\n        }\r\n\r\n        for(i=0; i < lockNames.length; i++) {\r\n          if(lockStates & osk.stateBitmasks[lockNames[i]]) {\r\n            osk._stateKeys[lockKeys[i]] = lockStates & osk.modifierCodes[lockNames[i]];\r\n          }\r\n        }\r\n      } else if(d) {\r\n        keyShiftState |= v;\r\n\r\n        for(i=0; i < lockNames.length; i++) {\r\n          if(v & osk.stateBitmasks[lockNames[i]]) {\r\n            osk._stateKeys[lockKeys[i]] = true;\r\n          }\r\n        }\r\n      } else {\r\n        keyShiftState &= ~v;\r\n\r\n        for(i=0; i < lockNames.length; i++) {\r\n          if(v & osk.stateBitmasks[lockNames[i]]) {\r\n            osk._stateKeys[lockKeys[i]] = false;\r\n          }\r\n        }\r\n      }\r\n\r\n      // Find and display the selected OSK layer\r\n      osk.layerId=osk.getLayerId(keyShiftState);\r\n\r\n      // osk._UpdateVKShiftStyle will be called automatically upon the next _Show.\r\n      if(osk._Visible) {\r\n        osk._Show();\r\n      }\r\n\r\n      return true;\r\n    }\r\n\r\n    /**\r\n     * Function     _UpdateVKShiftStyle\r\n     * Scope        Private\r\n     * @param       {string=}   layerId\r\n     * Description  Updates the OSK's visual style for any toggled state keys\r\n     */\r\n    osk._UpdateVKShiftStyle = function(layerId) {\r\n      var i, n, layer=null, layerElement=null;\r\n\r\n      if(layerId) {\r\n        for(n=0; n<osk.layers.length; n++) {\r\n          if(osk.layers[n]['id'] == osk.layerId) {\r\n            break;\r\n          }\r\n        }\r\n\r\n        return;  // Failed to find the requested layer.\r\n      } else {\r\n        n=osk.layerIndex;\r\n        layerId=osk.layers[n]['id'];\r\n      }\r\n\r\n      layer=osk.layers[n];\r\n      \r\n      // Set the on/off state of any visible state keys.\r\n      var states =['K_CAPS',      'K_NUMLOCK',  'K_SCROLL'];\r\n      var keys   =[layer.capsKey, layer.numKey, layer.scrollKey];\r\n\r\n      for(i=0; i < keys.length; i++) {\r\n        // Skip any keys not in the OSK!\r\n        if(keys[i] == null) {\r\n          continue;\r\n        }\r\n\r\n        keys[i]['sp'] = osk._stateKeys[states[i]] ? osk.buttonClasses['SHIFT-ON'] : osk.buttonClasses['SHIFT'];\r\n        var btn = document.getElementById(layerId+'-'+states[i]);\r\n\r\n        osk.setButtonClass(keys[i], btn, osk.layout);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function     _CancelMouse\r\n     * Scope        Private\r\n     * @param       {Object}      e     event\r\n     * @return      {boolean}           always false\r\n     * Description  Closes mouse click event\r\n     */\r\n    osk._CancelMouse=function(e)\r\n    {\r\n      e = keymanweb._GetEventObject(e);   // I2404 - Manage IE events in IFRAMEs\r\n      if(e && e.preventDefault) e.preventDefault();\r\n      if(e) { e.cancelBubble=true; e.returnValue=false; } // I2409 - Avoid focus loss for visual keyboard events\r\n      return false;\r\n    }\r\n\r\n    /**\r\n     * Function     showLayer\r\n     * Scope        Private\r\n     * @param       {string}      id      ID of the layer to show\r\n     * @return      {boolean}             true if the layer is shown, or false if it cannot be found\r\n     * Description  Shows the layer identified by 'id' in the on screen keyboard\r\n     */\r\n    osk.showLayer = function(id)\r\n    {\r\n      if(keymanweb.keyboardManager.activeKeyboard)\r\n      {\r\n        for(var i=0; i<osk.layers.length; i++)\r\n        {\r\n          if(osk.layers[i].id == id)\r\n          {\r\n            osk.layerId=id;\r\n            osk._Show();\r\n            return true;\r\n          }\r\n        }\r\n      }\r\n      return false;\r\n    }\r\n\r\n    /**\r\n     * Get the wanted height of the OSK for touch devices\r\n     *\r\n     *  @return   {number}    height in pixels\r\n     **/\r\n    osk.getHeight=function()\r\n    {\r\n\r\n      // KeymanTouch - get OSK height from device\r\n      if(typeof(keymanweb['getOskHeight']) == 'function') return keymanweb['getOskHeight']();\r\n\r\n      var oskHeightLandscapeView=Math.floor(Math.min(screen.availHeight,screen.availWidth)/2),\r\n          height=oskHeightLandscapeView;\r\n\r\n      if(device.formFactor == 'phone')\r\n      {\r\n        var sx=Math.min(screen.height,screen.width),\r\n            sy=Math.max(screen.height,screen.width);\r\n\r\n        if(util.portraitView())\r\n          height=Math.floor(Math.max(screen.availHeight,screen.availWidth)/3);\r\n        else\r\n          height=height*(sy/sx)/1.6;  //adjust for aspect ratio, increase slightly for iPhone 5\r\n      }\r\n\r\n      // Correct for viewport scaling (iOS - Android 4.2 does not want this, at least on Galaxy Tab 3))\r\n      if(device.OS == 'iOS') {\r\n        height=height/util.getViewportScale();\r\n      }\r\n\r\n      // Correct for devicePixelratio - needed on Android 4.1.2 phones,\r\n      // for Opera, Chrome and Firefox, but not for native browser!   Exclude native browser for Build 344.\r\n      if(device.OS == 'Android' && device.formFactor == 'phone' && 'devicePixelRatio' in window)\r\n      {\r\n        var bMatch=/Firefox|Chrome|OPR/;\r\n        if(bMatch.test(navigator.userAgent)) height = height*window.devicePixelRatio;\r\n      }\r\n\r\n      return height;\r\n    }\r\n\r\n    /**\r\n     * Get the wanted width of the OSK for touch devices\r\n     *\r\n     *  @return   {number}    height in pixels\r\n     **/\r\n    osk.getWidth=function() {\r\n      // KeymanTouch - get OSK height from device\r\n      if(typeof(keymanweb['getOskWidth']) == 'function') {\r\n        return keymanweb['getOskWidth']();\r\n      }\r\n\r\n      var width: number;\r\n      if(util.device.OS == \"iOS\") {\r\n        // iOS does not interchange these values when the orientation changes!\r\n        //width = util.portraitView() ? screen.width : screen.height;\r\n        width = window.innerWidth;\r\n      } else if(device.OS == 'Android') {\r\n        try {\r\n          width=document.documentElement.clientWidth;\r\n          }\r\n        catch(ex) {\r\n          width=screen.availWidth;\r\n          }\r\n      } else {\r\n        width=screen.width;\r\n      }\r\n\r\n      return width;\r\n    }\r\n\r\n    /**\r\n     * Mouse down/mouse over event handler (desktop only)\r\n     *\r\n     * @param   {Event}  e  mouse over/mouse down event object\r\n     */\r\n    osk.mouseOverMouseDownHandler = function(e)\r\n    {\r\n      var t=util.eventTarget(e);\r\n      if(t === null || device.formFactor != 'desktop') return;\r\n\r\n      if(t.nodeName == 'SPAN') t=t.parentNode;\r\n      if(t.className.indexOf('kmw-key-label') >= 0) {\r\n        t = t.parentNode;\r\n      }\r\n      if(util.eventType(e) == 'mousedown')\r\n      {\r\n        osk.currentKey=t.id; osk._CancelMouse(e);\r\n        osk.highlightKey(t,true);\r\n      }\r\n      else if(t.id == osk.currentKey)\r\n      {\r\n        osk.highlightKey(t,true);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Mouse up/mouse out event handler (desktop only)\r\n     *\r\n     * @param   {Event}  e  mouse up/out event object\r\n     */\r\n    osk.mouseUpMouseOutHandler = function(e)\r\n    {\r\n      var t=util.eventTarget(e);\r\n      if(t === null || device.formFactor != 'desktop') return;\r\n\r\n      if(t.nodeName == 'SPAN') t=t.parentNode;\r\n      if(t.className.indexOf('kmw-key-label') >= 0) {\r\n        t = t.parentNode;\r\n      }\r\n      osk.highlightKey(t,false);\r\n\r\n      // Process as click if mouse button released anywhere over key\r\n      if(util.eventType(e) == 'mouseup')\r\n      {\r\n          if(t.id == osk.currentKey) osk.clickKey(t);\r\n          osk.currentKey='';\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Returns the default properties for a key object, used to construct\r\n     * both a base keyboard key and popup keys\r\n     *\r\n     * @return    {Object}    An object that contains default key properties\r\n     */\r\n    osk.getDefaultKeyObject = function() {\r\n      return {\r\n        'text': '',\r\n        'width': '100',\r\n        'pad': '15',\r\n        'sp': '0',\r\n        'layer': null,\r\n        'nextlayer': null\r\n      };\r\n    };\r\n\r\n    /**\r\n     * Create the OSK for a particular keyboard and device\r\n     *\r\n     * @param       {Object}              layout      OSK layout definition\r\n     * @param       {string}              formFactor  layout form factor\r\n     * @return      {Object}                          fully formatted OSK object\r\n     */\r\n    osk.deviceDependentLayout=function(layout,formFactor)\r\n    {\r\n        var lDiv=util._CreateElement('DIV'),ls=lDiv.style,actualHeight=0;\r\n\r\n        // Set OSK box default style\r\n        lDiv.className='kmw-key-layer-group';\r\n\r\n        // Adjust OSK height for mobile and tablet devices TODO move outside this function???\r\n        switch(formFactor)\r\n        {\r\n          case 'phone':\r\n          case 'tablet':\r\n            actualHeight=osk.getHeight();\r\n            ls.height=actualHeight+'px';\r\n            break;\r\n        }\r\n\r\n        // Return empty DIV if no layout defined\r\n        if(layout == null) return lDiv;\r\n\r\n        // Set default OSK font size (Build 344, KMEW-90)\r\n        let layoutFS = layout['fontsize'];\r\n        if(typeof layoutFS == 'undefined' || layoutFS == null || layoutFS == '')\r\n          ls.fontSize='1em';\r\n        else\r\n          ls.fontSize=layout['fontsize'];\r\n\r\n        osk.fontSize=ls.fontSize;       //TODO: move outside function*********\r\n\r\n        // Create a separate OSK div for each OSK layer, only one of which will ever be visible\r\n        var n,i,j,layers,layer,gDiv,rows,row,rowHeight,rDiv,keys,key,kDiv,pDiv,rs,ks,btn,bs,ps,gs;\r\n\r\n        layers=layout['layer'];\r\n\r\n        // Set key default attributes (must use exportable names!)\r\n        var tKey=osk.getDefaultKeyObject();\r\n        tKey['fontsize']=ls.fontSize;\r\n\r\n        // Identify key labels (e.g. *Shift*) that require the special OSK font\r\n        var specialLabel=/\\*\\w+\\*/;\r\n\r\n        // ***Delete any empty rows at the end added by compiler bug...\r\n        for(n=0; n<layers.length; n++)\r\n        {\r\n          layer=layers[n]; rows=layer['row'];\r\n          for(i=rows.length; i>0; i--)\r\n          {\r\n            if(rows[i-1]['key'].length > 0) break;\r\n          }\r\n          if(i < rows.length) rows.splice(i-rows.length,rows.length-i);\r\n        }\r\n        // ...remove to here when compiler bug fixed ***\r\n\r\n        // Set the OSK row height, **assuming all layers have the same number of rows**\r\n\r\n        // Calculate default row height\r\n        rowHeight=100/rows.length;\r\n\r\n        // For desktop OSK, use a percentage of the OSK height\r\n        if(formFactor == 'desktop')\r\n        {\r\n          rowHeight=100/rows.length;\r\n        }\r\n\r\n        // Get the actual available document width and scale factor according to device type\r\n        var objectWidth;\r\n        if(formFactor == 'desktop') {\r\n          objectWidth = 100;\r\n        } else {\r\n          objectWidth = osk.getWidth();\r\n        }\r\n\r\n        if(device.touchable) //  /*&& ('ontouchstart' in window)*/ // Except Chrome emulation doesn't set this.\r\n        {                                                          // Not to mention, it's rather redundant.\r\n          lDiv.addEventListener('touchstart', osk.touch,true);\r\n          // The listener below fails to capture when performing automated testing checks in Chrome emulation unless 'true'.\r\n          lDiv.addEventListener('touchend', osk.release,true); \r\n          lDiv.addEventListener('touchmove', osk.moveOver,false);\r\n          //lDiv.addEventListener('touchcancel', osk.cancel,false); //event never generated by iOS\r\n        }\r\n\r\n        for(n=0; n<layers.length; n++)\r\n        {\r\n          layer=layers[n];\r\n          layer.aligned=false;\r\n          gDiv=util._CreateElement('DIV'),gs=gDiv.style;\r\n          gDiv.className='kmw-key-layer';\r\n\r\n          // Always make the first layer visible\r\n          gs.display=(n==0?'block':'none');\r\n          gs.height=ls.height;\r\n\r\n          // Set font for layer if defined in layout\r\n          if('font' in layout) gs.fontFamily=layout['font']; else gs.fontFamily='';\r\n\r\n          gDiv.layer=gDiv.nextLayer=layer['id'];\r\n          if(typeof layer['nextlayer'] == 'string') gDiv.nextLayer=layer['nextlayer'];\r\n\r\n          // Create a DIV for each row of the group\r\n          rows=layer['row'];\r\n\r\n          // Calculate the maximum row width (in layout units)\r\n          var totalWidth=0;\r\n          for(i=0; i<rows.length; i++)\r\n          {\r\n            var width=0;\r\n            row=rows[i]; keys=row['key'];\r\n            for(j=0; j<keys.length; j++)\r\n            {\r\n              key=keys[j];\r\n\r\n              // Test for a trailing comma included in spec, added as null object by IE\r\n              if(key == null)\r\n              {\r\n                keys.length = keys.length-1;\r\n              }\r\n              else\r\n              {\r\n                var kw, kp;\r\n                kw = (typeof key['width'] == 'string' && key['width'] != '') ? parseInt(key['width'],10) : 100;\r\n                if(isNaN(kw) || kw == 0) kw = 100;\r\n                key['width'] = kw.toString();\r\n                kp = (typeof key['pad'] == 'string' && key['pad'] != '') ? parseInt(key['pad'],10) : 15;\r\n                if(isNaN(kp) || kp == 0) kp = 15;  // KMEW-119\r\n                key['pad'] = kp.toString();\r\n                width += kw + kp;\r\n                //if(typeof key['width'] == 'string' && key['width'] != '') width += parseInt(key['width'],10); else width += 100;\r\n                //if(typeof key['pad'] == 'string' && key['pad'] != '') width += parseInt(key['pad'],10); else width += 5;\r\n              }\r\n            }\r\n            if(width > totalWidth) totalWidth = width;\r\n          }\r\n\r\n          // Add default right margin\r\n          if(formFactor == 'desktop') {\r\n            totalWidth += 5;  // KMEW-117\r\n          } else {\r\n            // TODO: Not entirely clear why this needs to be 15 instead of 5 on touch layouts.  We probably have\r\n            // a miscalculation somewhere\r\n            totalWidth += 15;\r\n          }\r\n\r\n          for(i=0; i<rows.length; i++)\r\n          {\r\n            rDiv=util._CreateElement('DIV');\r\n            rDiv.className='kmw-key-row';\r\n            // The following event trap is needed to prevent loss of focus in IE9 when clicking on a key gap.\r\n            // Unclear why normal _CreateElement prevention of loss of focus does not seem to work here.\r\n            // Appending handler to event handler chain does not work (other event handling remains active).\r\n            rDiv.onmousedown=util.mouseDownPreventDefaultHandler; // Build 360\r\n            //util.attachDOMEvent(rDiv,'mousedown',function(e){if(e)e.preventDefault();\r\n\r\n            row=rows[i]; rs=rDiv.style;\r\n\r\n            // Set row height. (Phone and tablet heights are later recalculated\r\n            // and set in px, allowing for viewport scaling.)\r\n            rs.maxHeight=rs.height=rowHeight+'%';\r\n\r\n            // Apply defaults, setting the width and other undefined properties for each key\r\n            keys=row['key'];\r\n            for(j=0; j<keys.length; j++)\r\n            {\r\n              key=keys[j];\r\n              for(var tp in tKey) { // tKey = osk.getDefaultKeyObject();\r\n                if(typeof key[tp] != 'string') key[tp]=tKey[tp];\r\n              }\r\n\r\n              // Modify the key type for special keys with non-standard labels\r\n              // to allow the keyboard font to ovveride the SpecialOSK font.\r\n              // Blank keys are no longer reclassed - can use before/after CSS to add text\r\n              switch(key['sp'])\r\n              {\r\n                case '1':\r\n                  if(!specialLabel.test(key['text']) && key['text'] != '') key['sp']='3';\r\n                  break;\r\n                case '2':\r\n                  if(!specialLabel.test(key['text']) && key['text'] != '') key['sp']='4';\r\n                  break;\r\n              }\r\n            }\r\n\r\n            // Calculate actual key widths by summing defined widths and scaling each key to %,\r\n            // adjusting the width of the last key to make the total exactly 100%\r\n            // Save each percentage key width as a separate member (do *not* overwrite layout specified width!)\r\n            // NB: the 'percent' suffix is historical, units are percent on desktop devices, but pixels on touch devices\r\n            // All key widths and paddings are rounded for uniformity\r\n            var keyPercent,padPercent,totalPercent=0;\r\n            for(j=0; j<keys.length-1; j++)\r\n            {\r\n              keyPercent=Math.round(parseInt(keys[j]['width'],10)*objectWidth/totalWidth);\r\n              keys[j]['widthpc']=keyPercent;\r\n              padPercent=Math.round(parseInt(keys[j]['pad'],10)*objectWidth/totalWidth);\r\n              keys[j]['padpc']=padPercent;\r\n              totalPercent += padPercent+keyPercent;\r\n            }\r\n\r\n            // Allow for right OSK margin (15 layout units)\r\n            totalPercent += Math.round(15*objectWidth/totalWidth);\r\n\r\n            // If a single key, and padding is negative, add padding to right align the key\r\n            if(keys.length == 1 && parseInt(keys[0]['pad'],10) < 0)\r\n            {\r\n              keyPercent=Math.round(parseInt(keys[0]['width'],10)*objectWidth/totalWidth);\r\n              keys[0]['widthpc']=keyPercent;\r\n              totalPercent += keyPercent;\r\n              keys[0]['padpc']=(objectWidth-totalPercent);\r\n            }\r\n            else if(keys.length > 0)\r\n            {\r\n              j=keys.length-1;\r\n              padPercent=Math.round(parseInt(keys[j]['pad'],10)*objectWidth/totalWidth);\r\n              keys[j]['padpc']=padPercent;\r\n              totalPercent += padPercent;\r\n              keys[j]['widthpc']=(objectWidth-totalPercent);\r\n            }\r\n\r\n            //Create the key square (an outer DIV) for each key element with padding, and an inner DIV for the button (btn)\r\n            totalPercent=0;\r\n            for(j=0; j<keys.length; j++) {\r\n              key=keys[j];\r\n              \r\n              var keyGenerator = new com.keyman.OSKBaseKey(key, layer['id']);\r\n              var keyTuple = keyGenerator.construct(layout, rs, totalPercent);\r\n\r\n              rDiv.appendChild(keyTuple.element);\r\n              totalPercent += keyTuple.percent;\r\n            }\r\n            // Add row to layer\r\n            gDiv.appendChild(rDiv);\r\n          }\r\n          // Add layer to group\r\n          lDiv.appendChild(gDiv);\r\n        }\r\n        return lDiv;\r\n    }\r\n\r\n    osk.clearPopup = function()\r\n    {\r\n      // Remove the displayed subkey array, if any, and cancel popup request\r\n      var sk=document.getElementById('kmw-popup-keys');\r\n      if(sk != null)\r\n      {\r\n        if(sk.shim) osk._Box.removeChild(sk.shim);\r\n        sk.parentNode.removeChild(sk);\r\n      }\r\n\r\n      if(osk.popupCallout) osk._Box.removeChild(osk.popupCallout);\r\n      osk.popupCallout = null;\r\n\r\n      if(osk.subkeyDelayTimer)\r\n      {\r\n          window.clearTimeout(osk.subkeyDelayTimer);\r\n          osk.subkeyDelayTimer = null;\r\n      }\r\n      osk.popupBaseKey = null;\r\n    }\r\n\r\n    /**\r\n     * OSK touch start event handler\r\n     *\r\n     *  @param  {Event} e   touch start event object\r\n     *\r\n     */\r\n    osk.touch = function(e)\r\n    {\r\n      // Identify the key touched\r\n      var t = e.changedTouches[0].target, key = osk.keyTarget(t);\r\n\r\n      // Save the touch point\r\n      osk.touchX = e.changedTouches[0].pageX;\r\n\r\n      // Set the key for the new touch point to be current target, if defined\r\n      osk.currentTarget = key;\r\n\r\n      // Prevent multi-touch if popup displayed\r\n      var sk = document.getElementById('kmw-popup-keys');\r\n      if((sk && sk.style.visibility == 'visible') || osk.popupVisible) return;\r\n\r\n      // Keep track of number of active (unreleased) touch points\r\n      osk.touchCount = e.touches.length;\r\n\r\n      // Get nearest key if touching a hidden key or the end of a key row\r\n      if((key && (key.className.indexOf('key-hidden') >= 0))\r\n        || t.className.indexOf('kmw-key-row') >= 0) {\r\n        key = osk.findNearestKey(e,t);\r\n      }\r\n      // Do not do anything if no key identified!\r\n      if(key == null) {\r\n        return;\r\n      }\r\n\r\n      // Get key name (K_...) from element ID\r\n      var keyIdComponents = key.id.split('-');\r\n      var keyName=keyIdComponents[keyIdComponents.length-1];\r\n\r\n      // Highlight the touched key\r\n      osk.highlightKey(key,true);\r\n\r\n      // Special function keys need immediate action\r\n      if(keyName == 'K_LOPT' || keyName == 'K_ROPT')\r\n      {\r\n        window.setTimeout(function(){osk.clickKey(key);},0);\r\n        osk.keyPending = null;\r\n      }\r\n      // Also backspace, to allow delete to repeat while key held\r\n      else if(keyName == 'K_BKSP') {\r\n        // While we could inline the execution of the delete key here, we lose the ability to\r\n        // record the backspace key if we do so.\r\n        osk.clickKey(key);\r\n        osk.deleteKey = key;\r\n        osk.deleting = window.setTimeout(osk.repeatDelete,500);\r\n        osk.keyPending = null;\r\n      } else {\r\n        if(osk.keyPending) {\r\n          osk.highlightKey(osk.keyPending,false);\r\n          osk.clickKey(osk.keyPending);\r\n          osk.clearPopup();\r\n          // Decrement the number of unreleased touch points to prevent\r\n          // sending the keystroke again when the key is actually released\r\n          osk.touchCount--;\r\n        } else {\r\n          // If this key has subkey, start timer to display subkeys after delay, set up release\r\n          osk.touchHold(key);\r\n          //if(key.subKeys != null) osk.subkeyDelayTimer=window.setTimeout(function(){osk.showSubKeys(key);},osk.popupDelay);\r\n        }\r\n        osk.keyPending = key;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * OSK touch release event handler\r\n     *\r\n     *  @param  {Event} e   touch release event object\r\n     *\r\n     **/\r\n    osk.release = function(e)\r\n    {\r\n      // Prevent incorrect multi-touch behaviour if native or device popup visible\r\n      var sk = document.getElementById('kmw-popup-keys'), t = osk.currentTarget;\r\n      if((sk && sk.style.visibility == 'visible') || osk.popupVisible)\r\n      {\r\n        // Ignore release if a multiple touch\r\n        if(e.touches.length > 0) return;\r\n\r\n        // Cancel (but do not execute) pending key if neither a popup key or the base key\r\n        if((t == null) || ((t.id.indexOf('popup') < 0) && (t.id != osk.popupBaseKey.id)))\r\n        {\r\n          osk.highlightKey(osk.keyPending,false);\r\n          osk.clearPopup();\r\n          osk.keyPending = null;\r\n        }\r\n      }\r\n\r\n      // Handle menu key release event\r\n      if(t && t.id) osk.optionKey(e,t.id,false);\r\n\r\n      // Test if moved off screen (effective release point must be corrected for touch point horizontal speed)\r\n      // This is not completely effective and needs some tweaking, especially on Android\r\n      var x = e.changedTouches[0].pageX,\r\n          beyondEdge = ((x < 2 && osk.touchX > 5) ||\r\n            (x > window.innerWidth - 2 && osk.touchX < window.innerWidth - 5));\r\n\r\n      // Save then decrement current touch count\r\n      var tc=osk.touchCount;\r\n      if(osk.touchCount > 0) osk.touchCount--;\r\n\r\n      // Process and clear highlighting of pending target\r\n      if(osk.keyPending)\r\n      {\r\n        osk.highlightKey(osk.keyPending,false);\r\n\r\n        // Output character unless moved off key\r\n        if(osk.keyPending.className.indexOf('hidden') < 0 &&\r\n            tc > 0 && !beyondEdge) osk.clickKey(osk.keyPending);\r\n        osk.clearPopup();\r\n        osk.keyPending = null;\r\n      }\r\n      // Always clear highlighting of current target on release (multi-touch)\r\n      else\r\n      {\r\n        var tt = e.changedTouches[0];\r\n        t = osk.keyTarget(tt.target);\r\n        if(!t)\r\n        {\r\n          var t1 = document.elementFromPoint(tt.clientX,tt.clientY);\r\n          t = osk.findNearestKey(e,t1);\r\n        }\r\n        osk.highlightKey(t,false);\r\n      }\r\n\r\n      // Clear repeated backspace if active\r\n      if(osk.deleting) window.clearTimeout(osk.deleting);\r\n      osk.deleting = 0;\r\n    }\r\n\r\n    /**\r\n     * OSK touch move event handler\r\n     *\r\n     *  @param  {Event} e   touch move event object\r\n     *\r\n     **/\r\n    osk.moveOver = function(e)\r\n    {\r\n      e.preventDefault(); e.cancelBubble=true;\r\n      if(typeof e.stopImmediatePropagation == 'function') e.stopImmediatePropagation();\r\n      else if(typeof e.stopPropagation == 'function') e.stopPropagation();\r\n\r\n      // Do not attempt to support reselection of target key for overlapped keystrokes\r\n      if(e.touches.length > 1 || osk.touchCount == 0) return;\r\n\r\n      // Get touch position\r\n      var x=typeof e.touches == 'object' ? e.touches[0].clientX : e.clientX,\r\n          y=typeof e.touches == 'object' ? e.touches[0].clientY : e.clientY;\r\n\r\n      // Move target key and highlighting\r\n      var t = e.changedTouches[0],\r\n          t1 = document.elementFromPoint(x,y),\r\n          key0 = osk.keyPending,\r\n          key1 = osk.keyTarget(t1);\r\n\r\n      // Find the nearest key to the touch point if not on a visible key\r\n      if((key1 && key1.className.indexOf('key-hidden') >= 0) ||\r\n        (t1 && (!key1) && t1.className.indexOf('key-row') >= 0))\r\n      {\r\n          key1 = osk.findNearestKey(e,t1);\r\n      }\r\n\r\n      // Stop repeat if no longer on BKSP key\r\n      if(key1 && (typeof key1.id == 'string') && (key1.id.indexOf('BKSP') < 0))\r\n      {\r\n        if(osk.deleting) window.clearTimeout(osk.deleting);\r\n        osk.deleting = 0;\r\n      }\r\n\r\n      // Do not move over keys if device popup visible\r\n      if(osk.popupVisible)\r\n      {\r\n        if(key1 == null)\r\n        {\r\n          if(key0) osk.highlightKey(key0,false);\r\n          osk.keyPending=null;\r\n        }\r\n        else\r\n        {\r\n          if(key1 == osk.popupBaseKey)\r\n          {\r\n            if(!osk.hasClass(key1,'kmw-key-touched')) osk.highlightKey(key1,true);\r\n            osk.keyPending = key1;\r\n          }\r\n          else\r\n          {\r\n            if(key0) osk.highlightKey(key0,false);\r\n            osk.keyPending = null;\r\n          }\r\n        }\r\n        return;\r\n      }\r\n\r\n      // Use the popup duplicate of the base key if a phone with a visible popup array\r\n      var sk=document.getElementById('kmw-popup-keys');\r\n      if(sk && sk.style.visibility == 'visible'\r\n        && device.formFactor == 'phone' && key1 == osk.popupBaseKey)\r\n      {\r\n        key1 = sk.childNodes[0].firstChild;\r\n      }\r\n\r\n      // Identify current touch position (to manage off-key release)\r\n      osk.currentTarget = key1;\r\n\r\n      // Clear previous key highlighting\r\n      if(key0 && key1 && (key1.id != key0.id)) osk.highlightKey(key0,false);\r\n\r\n      // If popup is visible, need to move over popup, not over main keyboard\r\n      osk.highlightSubKeys(key1,x,y);\r\n\r\n      if(sk && sk.style.visibility == 'visible')\r\n      {\r\n        if(key1 && key1.id.indexOf('popup') < 0 && key1 != osk.popupBaseKey) return;\r\n        if(key1 && key1 == osk.popupBaseKey && key1.className.indexOf('kmw-key-touched') < 0) osk.highlightKey(key1,true);\r\n      }\r\n      // Cancel touch if moved up and off keyboard, unless popup keys visible\r\n      else\r\n      {\r\n        var yMin = Math.max(5,osk._Box.offsetTop - 0.25*osk._Box.offsetHeight);\r\n        if(key0 && e.touches[0].pageY < Math.max(5,osk._Box.offsetTop - 0.25*osk._Box.offsetHeight))\r\n        {\r\n          osk.highlightKey(key0,false); osk.showKeyTip(null,false); osk.keyPending = null;\r\n        }\r\n      }\r\n\r\n      // Replace the target key, if any, by the new target key\r\n      // Do not replace a null target, as that indicates the key has already been released\r\n      if(key1 && osk.keyPending) osk.keyPending = key1;\r\n\r\n      if(osk.keyPending)\r\n      {\r\n        if(key0 != key1 || key1.className.indexOf('kmw-key-touched') < 0) osk.highlightKey(key1,true);\r\n      }\r\n\r\n      if(key0 && key1 && (key1 != key0) && (key1.id != ''))\r\n      {\r\n        //  Display the touch-hold keys (after a pause)\r\n        osk.touchHold(key1);\r\n        /*\r\n      // Clear and restart the popup timer\r\n        if(osk.subkeyDelayTimer)\r\n        {\r\n          window.clearTimeout(osk.subkeyDelayTimer);\r\n          osk.subkeyDelayTimer = null;\r\n        }\r\n        if(key1.subKeys != null)\r\n        {\r\n          osk.subkeyDelayTimer = window.setTimeout(\r\n            function()\r\n            {\r\n              osk.clearPopup();\r\n              osk.showSubKeys(key1);\r\n            },\r\n            osk.popupDelay);\r\n        }\r\n        */\r\n      }\r\n    }\r\n\r\n    // osk.cancel = function(e) {} //cancel event is never generated by iOS\r\n\r\n    /**\r\n     * More reliable way of identifying  element class\r\n     * @param   {Object}  e HTML element\r\n     * @param   {string}  name  class name\r\n     * @return  {boolean}\r\n     */\r\n    osk.hasClass = function(e, name)\r\n    {\r\n      var className = \" \" + name + \" \";\r\n      return (\" \" + e.className + \" \").replace(/[\\n\\t\\r\\f]/g, \" \").indexOf(className) >= 0;\r\n    }\r\n\r\n    /**\r\n     * Get the current key target from the touch point element within the key\r\n     *\r\n     * @param   {Object}  t   element at touch point\r\n     * @return  {Object}      the key element (or null)\r\n     **/\r\n    osk.keyTarget = function(t)\r\n    {\r\n      try {\r\n        if(t)\r\n        {\r\n          if(osk.hasClass(t,'kmw-key')) return t;\r\n          if(t.parentNode && osk.hasClass(t.parentNode,'kmw-key')) return t.parentNode;\r\n          if(t.firstChild && osk.hasClass(t.firstChild,'kmw-key')) return t.firstChild;\r\n        }\r\n      } catch(ex){}\r\n      return null;\r\n    }\r\n\r\n    /**\r\n     * Identify the key nearest to the touch point if at the end of a key row,\r\n     * but return null more than about 0.6 key width from the nearest key.\r\n     *\r\n     *  @param  {Event}   e   touch event\r\n     *  @param  {Object}  t   HTML object at touch point\r\n     *  @return {Object}      nearest key to touch point\r\n     *\r\n     **/\r\n    osk.findNearestKey = function(e,t)\r\n    {\r\n      if((!e) || (typeof e.changedTouches == 'undefined')\r\n        || (e.changedTouches.length == 0)) return null;\r\n\r\n      // Get touch point on screen\r\n      var x = e.changedTouches[0].pageX;\r\n\r\n      // Get key-row beneath touch point\r\n      while(t && t.className.indexOf('key-row') < 0) t = t.parentNode;\r\n      if(!t) return null;\r\n\r\n      // Find minimum distance from any key\r\n      var k, k0=0, dx, dxMax=24, dxMin=100000, x1, x2;\r\n      for(k = 0; k < t.childNodes.length; k++)\r\n      {\r\n        if(t.childNodes[k].firstChild.className.indexOf('key-hidden') >= 0) continue;\r\n        x1 = t.childNodes[k].offsetLeft;\r\n        x2 = x1 + t.childNodes[k].offsetWidth;\r\n        dx =x1 - x;\r\n        if(dx >= 0 && dx < dxMin)\r\n        {\r\n          k0 = k; dxMin = dx;\r\n        }\r\n        dx = x - x2;\r\n        if(dx >= 0 && dx < dxMin)\r\n        {\r\n          k0 = k; dxMin = dx;\r\n        }\r\n      }\r\n      if(dxMin < 100000)\r\n      {\r\n        t = t.childNodes[k0];\r\n        x1 = t.offsetLeft;\r\n        x2 = x1 + t.offsetWidth;\r\n\r\n        // Limit extended touch area to the larger of 0.6 of key width and 24 px\r\n        if(t.offsetWidth > 40) dxMax = 0.6 * t.offsetWidth;\r\n        if(((x1 - x) >= 0 && (x1 - x) < dxMax) ||\r\n            ((x - x2) >= 0 && (x - x2) < dxMax))\r\n          return t.firstChild;\r\n      }\r\n      return null;\r\n    }\r\n\r\n    /**\r\n     *  Repeat backspace as long as the backspace key is held down\r\n     **/\r\n    osk.repeatDelete = function() {\r\n      if(osk.deleting) {\r\n        osk.clickKey(osk.deleteKey);\r\n        osk.deleting = window.setTimeout(osk.repeatDelete,100);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Attach appropriate class to each key button, according to the layout\r\n     *\r\n     * @param       {Object}    key     key object\r\n     * @param       {Object}    btn     button object\r\n     * @param       {Object=}   layout  source layout description (optional, sometimes)\r\n     */\r\n    osk.setButtonClass = function(key,btn,layout) {\r\n      var n=0, keyTypes=['default','shift','shift-on','special','special-on','','','','deadkey','blank','hidden'];\r\n      if(typeof key['dk'] == 'string' && key['dk'] == '1') { \r\n        n=8;\r\n      }\r\n\r\n      if(typeof key['sp'] == 'string') {\r\n        n=parseInt(key['sp'],10);\r\n      } \r\n\r\n      if(n < 0 || n > 10) {\r\n        n=0;\r\n      }\r\n\r\n      layout=layout||osk.layout;\r\n\r\n      // Apply an overriding class for 5-row layouts\r\n      var nRows=layout['layer'][0]['row'].length;\r\n      if(nRows > 4 && util.device.formFactor == 'phone') {\r\n        btn.className='kmw-key kmw-5rows kmw-key-'+keyTypes[n];\r\n      } else {\r\n        btn.className='kmw-key kmw-key-'+keyTypes[n];\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Converts the legacy BK property from pre 10.0 into the KLS keyboard layer spec format,\r\n     * sparsifying it as possible to pre-emptively check invalid layers.\r\n     * \r\n     * @param   {Array}   BK      keyboard object (as loaded)\r\n     * @return  {Object}\r\n     */\r\n    osk.processLegacyDefinitions = function(BK) {\r\n      //['default','shift','ctrl','shiftctrl','alt','shiftalt','ctrlalt','shiftctrlalt'];\r\n      var idList=osk.generateLayerIds(false); // Non-chiral.\r\n\r\n      var KLS = {};\r\n\r\n      // The old default:  eight auto-managed layers...\r\n      for(var n=0; n<idList.length; n++) {\r\n        var id = idList[n], arr = [], valid = false;\r\n\r\n        // ... with keycode mappings in blocks of 65.\r\n        for(var k=0; k < 65; k++) {\r\n          var index = k + 65 * n;\r\n          arr.push(BK[index]);\r\n\r\n          // The entry for K_SPACE's keycode tends to hold ' ' instead of '', which causes\r\n          // the whole layer to be treated as 'valid' if not included in the conditional.\r\n          if(index < BK.length && BK[index] != '' && k != dfltCodes.indexOf('K_SPACE')) {\r\n            valid = true;\r\n          }\r\n        }\r\n\r\n        if(valid) {\r\n          KLS[id] = arr;\r\n        }\r\n      }\r\n\r\n      // There must always be at least a plain 'default' layer.  Array(65).fill('') would be preferable but isn't supported on IE, \r\n      // but buildDefaultLayer will set the defaults for these layers if no entry exists for them in the array due to length.\r\n      if(typeof KLS['default'] == 'undefined' || ! KLS['default']) {\r\n        KLS['default'] = [''];\r\n      }\r\n\r\n      // There must always be at least a plain 'shift' layer.\r\n      if(typeof KLS['shift'] == 'undefined' || ! KLS['shift']) {\r\n        KLS['shift'] = [''];\r\n      }\r\n\r\n      return KLS;\r\n    }\r\n\r\n    /**\r\n     * Sets a formatting property for the modifier keys when constructing a default layout for a keyboard.\r\n     * \r\n     * @param   {Object}    layer   // One layer specification\r\n     * @param   {boolean}   chiral  // Whether or not the keyboard uses chiral modifier information.\r\n     * @param   {string}    formFactor  // The form factor of the device the layout is being constructed for.\r\n     * @param   {boolean}   key102      // Whether or not the extended key 102 should be hidden.\r\n     */\r\n    osk.formatDefaultLayer = function(layer, chiral, formFactor, key102) {\r\n      var layerId = layer['id'];\r\n\r\n      // Correct appearance of state-dependent modifier keys according to group\r\n      for(var i=0; i<layer['row'].length; i++) {\r\n        var row=layer['row'][i];\r\n        var keys=row['key'];\r\n        for(var j=0; j<keys.length; j++) {\r\n          var key=keys[j];\r\n          switch(key['id']) {\r\n            case 'K_SHIFT':\r\n            case 'K_LSHIFT':\r\n            case 'K_RSHIFT':\r\n              if(layerId.indexOf('shift') != -1) {\r\n                key['sp'] = osk.buttonClasses['SHIFT-ON'];\r\n              } \r\n              if((formFactor != 'desktop') && (layerId != 'default')) {\r\n                key['nextlayer']='default';\r\n              }\r\n              break;\r\n            case 'K_LCTRL':\r\n            case 'K_LCONTROL':\r\n              if(chiral) {\r\n                if(layerId.indexOf('leftctrl') != -1) {\r\n                  key['sp'] = osk.buttonClasses['SHIFT-ON'];\r\n                }\r\n                break;\r\n              } \r\n            case 'K_RCTRL':\r\n            case 'K_RCONTROL':\r\n              if(chiral) {\r\n                if(layerId.indexOf('rightctrl') != -1) {\r\n                  key['sp'] = osk.buttonClasses['SHIFT-ON'];\r\n                }\r\n                break;\r\n              }\r\n            case 'K_CONTROL':\r\n              if(layerId.indexOf('ctrl') != -1) {\r\n                if(!chiral || (layerId.indexOf('leftctrl') != -1 && layerId.indexOf('rightctrl') != -1)) {\r\n                  key['sp'] = osk.buttonClasses['SHIFT-ON'];              \r\n                }\r\n              }\r\n              break;\r\n            case 'K_LALT':\r\n              if(chiral) {\r\n                if(layerId.indexOf('leftalt') != -1) {\r\n                  key['sp'] = osk.buttonClasses['SHIFT-ON'];\r\n                }\r\n                break;\r\n              } \r\n            case 'K_RALT':\r\n              if(chiral) {\r\n                if(layerId.indexOf('rightalt') != -1) {\r\n                  key['sp'] = osk.buttonClasses['SHIFT-ON'];\r\n                }\r\n                break;\r\n              } \r\n            case 'K_ALT':\r\n              if(layerId.indexOf('alt') != -1) {\r\n                if(!chiral || (layerId.indexOf('leftalt') != -1 && layerId.indexOf('rightalt') != -1)) {\r\n                  key['sp'] = osk.buttonClasses['SHIFT-ON'];              \r\n                }\r\n              }\r\n              break;\r\n            case 'K_oE2':\r\n              if(typeof key102 == 'undefined' || !key102) {\r\n                if(formFactor == 'desktop') {\r\n                  keys.splice(j--, 1);\r\n                  keys[0]['width']='200';\r\n                } else {\r\n                  keys[j]['sp']=osk.buttonClasses['HIDDEN'];\r\n                }\r\n              }\r\n              break;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Generates a list of potential layer ids for the specified chirality mode.\r\n     * \r\n     * @param   {boolean|number}   chiral    // Does the keyboard use chiral modifiers or not?\r\n     */\r\n    osk.generateLayerIds = function(chiral) {\r\n      var layerCnt, offset;\r\n\r\n      if(chiral) {\r\n        layerCnt=32;\r\n        offset=0x01;\r\n      } else {\r\n        layerCnt=8;\r\n        offset=0x10;\r\n      }\r\n\r\n      var layerIds = [];\r\n\r\n      for(var i=0; i < layerCnt; i++) {\r\n        layerIds.push(osk.getLayerId(i * offset));\r\n      }\r\n\r\n      return layerIds;\r\n    }\r\n\r\n    /**\r\n     * Signifies whether or not the OSK facilitates AltGr / Right-alt emulation for this keyboard.\r\n     * @param   {Object=}   keyLabels\r\n     * @return  {boolean}\r\n     */\r\n    osk.emulatesAltGr = function(keyLabels) {\r\n      var layers;\r\n\r\n      // If we're not chiral, we're not emulating.\r\n      if(!keymanweb.keyboardManager.isChiral()) {\r\n        return false;\r\n      }\r\n\r\n      if(!keyLabels) {\r\n        var activeKeyboard = keymanweb.keyboardManager.activeKeyboard;\r\n        if(activeKeyboard == null || activeKeyboard['KV'] == null) {\r\n          return false;\r\n        }\r\n        \r\n        layers = activeKeyboard['KV']['KLS'];\r\n      } else {\r\n        layers = keyLabels;\r\n      }\r\n\r\n      var emulationMask = osk.modifierCodes['LCTRL'] | osk.modifierCodes['LALT'];\r\n\r\n      var unshiftedEmulationLayer = layers[osk.getLayerId(emulationMask)];\r\n      var shiftedEmulationLayer = layers[osk.getLayerId(osk.modifierCodes['SHIFT'] | emulationMask)];\r\n      \r\n      // buildDefaultLayout ensures that these are aliased to the original modifier set being emulated.\r\n      // As a result, we can directly test for reference equality.\r\n      if(unshiftedEmulationLayer != null && \r\n          unshiftedEmulationLayer != layers[osk.getLayerId(osk.modifierCodes['RALT'])]) {\r\n        return false;\r\n      }\r\n\r\n      if(shiftedEmulationLayer != null && \r\n          shiftedEmulationLayer != layers[osk.getLayerId(osk.modifierCodes['RALT'] | osk.modifierCodes['SHIFT'])]) {\r\n        return false;\r\n      }\r\n\r\n      // It's technically possible for the OSK to not specify anything while allowing chiral input.  A last-ditch catch:\r\n\r\n      var bitmask = keymanweb.keyboardManager.getKeyboardModifierBitmask();\r\n      if((bitmask & emulationMask) != emulationMask) {\r\n        // At least one of the emulation modifiers is never used by the keyboard!  We can confirm everything's safe.\r\n        return true;\r\n      }\r\n\r\n      if(unshiftedEmulationLayer == null && shiftedEmulationLayer == null) {\r\n        // We've run out of things to go on; we can't detect if chiral AltGr emulation is intended or not.\r\n        if(!osk.altGrWarning) {\r\n          console.warn(\"Could not detect if AltGr emulation is safe, but defaulting to active emulation!\")\r\n          // Avoid spamming the console with warnings on every call of the method.\r\n          osk.altGrWarning = true;\r\n        }\r\n      }\r\n      return true;\r\n    }\r\n\r\n    /**\r\n     * Build a default layout for keyboards with no explicit layout\r\n     *\r\n     * @param   {Object}  PVK         keyboard object (as loaded)\r\n     * @param   {Number}  kbdBitmask  keyboard modifier bitmask\r\n     * @param   {string}  formFactor\r\n     * @return  {Object}\r\n     */\r\n    osk.buildDefaultLayout = function(PVK,kbdBitmask,formFactor)\r\n    {\r\n      var layout;\r\n\r\n      // Build a layout using the default for the device\r\n      var layoutType=formFactor, dfltLayout=keymanweb['dfltLayout'];\r\n      if(typeof dfltLayout[layoutType] != 'object') {\r\n        layoutType = 'desktop';\r\n      }\r\n\r\n      // Clone the default layout object for this device\r\n      layout=util.deepCopy(dfltLayout[layoutType]);\r\n\r\n      var n,layers=layout['layer'], keyLabels=PVK['KLS'], key102=PVK['K102'];\r\n      var i, j, k, m, row, rows, key, keys;\r\n      var chiral = (kbdBitmask & osk.modifierBitmasks.IS_CHIRAL);\r\n\r\n      var kmw10Plus = !(typeof keyLabels == 'undefined' || !keyLabels);\r\n      if(!kmw10Plus) {\r\n        // Save the processed key label information to the keyboard's general data.\r\n        // Makes things more efficient elsewhere and for reloading after keyboard swaps.\r\n        keyLabels = PVK['KLS'] = osk.processLegacyDefinitions(PVK['BK']);\r\n      }\r\n\r\n      // Identify key labels (e.g. *Shift*) that require the special OSK font\r\n      var specialLabel=/\\*\\w+\\*/;\r\n\r\n      // *** Step 1:  instantiate the layer objects. ***\r\n\r\n      // Get the list of valid layers, enforcing that the 'default' layer must be the first one processed.\r\n      var validIdList = Object.getOwnPropertyNames(keyLabels), invalidIdList = [];\r\n      validIdList.splice(validIdList.indexOf('default'), 1);\r\n      validIdList = [ 'default' ].concat(validIdList);\r\n\r\n      // Automatic AltGr emulation if the 'leftctrl-leftalt' layer is otherwise undefined.\r\n      if(osk.emulatesAltGr(keyLabels)) {\r\n        // We insert only the layers that need to be emulated.\r\n        if((validIdList.indexOf('leftctrl-leftalt') == -1) && validIdList.indexOf('rightalt') != -1) {\r\n          validIdList.push('leftctrl-leftalt');\r\n          keyLabels['leftctrl-leftalt'] = keyLabels['rightalt'];\r\n        }\r\n\r\n        if((validIdList.indexOf('leftctrl-leftalt-shift') == -1) && validIdList.indexOf('rightalt-shift') != -1) {\r\n          validIdList.push('leftctrl-leftalt-shift');\r\n          keyLabels['leftctrl-leftalt-shift'] = keyLabels['rightalt-shift'];\r\n        }\r\n      }\r\n\r\n      // For desktop devices, we must create all layers, even if invalid.\r\n      if(formFactor == 'desktop') {\r\n        invalidIdList = osk.generateLayerIds(chiral);\r\n\r\n        // Filter out all ids considered valid.  (We also don't want duplicates in the following list...)\r\n        for(n=0; n<invalidIdList.length; n++) {\r\n          if(validIdList.indexOf(invalidIdList[n]) != -1) {\r\n            invalidIdList.splice(n--, 1);\r\n          }\r\n        }\r\n      }\r\n\r\n      // This ensures all 'valid' layers are at the front of the layer array and managed by the main loop below.\r\n      // 'invalid' layers aren't handled by the loop and thus remain blank after it.\r\n      var idList = validIdList.concat(invalidIdList);\r\n\r\n      if(kmw10Plus && formFactor != 'desktop') { // KLS exists, so we know the exact layer set.\r\n        // Find the SHIFT key...\r\n        var shiftKey = null;\r\n\r\n        rows = layers[0]['row'];\r\n        for(var r=0; r < rows.length; r++) {\r\n          keys = rows[r]['key'];\r\n          for(var c=0; c < keys.length; c++) {\r\n            key = keys[c];\r\n            if(key['id'] == 'K_SHIFT') {\r\n              shiftKey = key;\r\n            }\r\n          }\r\n        }\r\n\r\n        if(shiftKey) {\r\n          // Erase the legacy shifted subkey array.\r\n          shiftKey['sk'] = [];\r\n\r\n          for(var layerID in keyLabels) {            \r\n            if(layerID == 'default' || layerID == 'shift') {\r\n              // These two are accessible from the layer without subkeys.\r\n              continue;\r\n            }\r\n\r\n            // Create a new subkey for the specified layer so that it will be accessible via OSK.\r\n            var specialChar = osk.modifierSpecials[layerID];\r\n            shiftKey['sk'].push(new com.keyman.OSKKeySpec(\"K_\" + specialChar, specialChar, null, \"1\", layerID));\r\n          }\r\n        } else {\r\n          // Seriously, this should never happen.  It's here for the debugging log only.\r\n          console.warn(\"Error in default layout - cannot find default Shift key!\");\r\n        }\r\n      }\r\n\r\n      for(n=0; n<idList.length; n++) {\r\n        // Populate non-default (shifted) keygroups\r\n        if(n > 0) {\r\n          layers[n]=util.deepCopy(layers[0]);\r\n        }\r\n        layers[n]['id']=idList[n];\r\n        layers[n]['nextlayer']=idList[n]; // This would only be different for a dynamic keyboard\r\n\r\n        // Extraced into a helper method to improve readability.\r\n        osk.formatDefaultLayer(layers[n], chiral != 0, formFactor, !!key102);\r\n      }\r\n\r\n      // *** Step 2: Layer objects now exist; time to fill them with the appropriate key labels and key styles ***\r\n      for(n=0; n<layers.length; n++)\r\n      {\r\n        var layer=layers[n], kx, shiftKey=null, nextKey=null, allText='';\r\n        var capsKey = null, numKey = null, scrollKey = null;  // null if not in the OSK layout.\r\n        var layerSpec = keyLabels[layer['id']];\r\n        var isShift = layer['id'] == 'shift' ? 1 : 0;\r\n        var isDefault = layer['id'] == 'default' || isShift ? 1 : 0;\r\n\r\n        rows=layer['row'];\r\n        for(i=0; i<rows.length; i++)\r\n        {\r\n          keys=rows[i]['key'];\r\n          for(j=0; j<keys.length; j++)\r\n          {\r\n            key=keys[j];\r\n            kx=dfltCodes.indexOf(key['id']);\r\n\r\n            // Only create keys for defined layers.  ('default' and 'shift' are always defined.)\r\n            if(layerSpec || isDefault) {\r\n              // Get keycap text from visual keyboard array, if defined in keyboard\r\n              if(layerSpec) {\r\n                if(kx >= 0 && kx < layerSpec.length) key['text']=layerSpec[kx];\r\n              }\r\n\r\n              // Fall back to US English keycap text as default for the base two layers if not otherwise defined.\r\n              // (Any 'ghost' keys must be explicitly defined in layout for these layers.)\r\n              if(isDefault) {\r\n                if((key['text'] == '' || typeof key['text'] == 'undefined') &&  key['id'] != 'K_SPACE' && kx+65 * isShift < dfltText.length) {\r\n                  key['text']=dfltText[kx+65*isShift];\r\n                }\r\n              }\r\n            }\r\n\r\n            // Leave any unmarked key caps as null strings\r\n            if(typeof(key['text']) == 'undefined') { \r\n              key['text']='';\r\n            }\r\n            // Detect important tracking keys.\r\n            switch(key['id']) {\r\n              case \"K_SHIFT\":\r\n                shiftKey=key;\r\n                break;\r\n              case \"K_TAB\":\r\n                nextKey=key;\r\n                break;\r\n              case \"K_CAPS\":\r\n                capsKey=key;\r\n                break;\r\n              case \"K_NUMLOCK\":\r\n                numKey=key;\r\n                break;\r\n              case \"K_SCROLL\":\r\n                scrollKey=key;\r\n                break;\r\n            }\r\n\r\n            // Remove pop-up shift keys referencing invalid layers (Build 349)\r\n            if(key['sk'] != null) {\r\n              for(k=0; k<key['sk'].length; k++) {\r\n                if(validIdList.indexOf(key['sk'][k]['nextlayer']) == -1) {\r\n                  key['sk'].splice(k--, 1);\r\n                }\r\n              }\r\n\r\n              if(key['sk'].length == 0) {\r\n                key['sk']=null;\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        // We're done with the layer keys initialization pass.  Time to do post-analysis layer-level init where necessary.\r\n        layer.shiftKey=shiftKey;\r\n        layer.capsKey=capsKey;\r\n        layer.numKey=numKey;\r\n        layer.scrollKey=scrollKey;\r\n\r\n        // Set modifier key appearance and behaviour for non-desktop devices using the default layout\r\n        if(formFactor != 'desktop') {\r\n          if(n > 0 && shiftKey != null) {\r\n            shiftKey['sp']=osk.buttonClasses['SHIFT-ON'];\r\n            shiftKey['sk']=null;\r\n            shiftKey['text'] = osk.modifierSpecials[layers[n].id] ? osk.modifierSpecials[layers[n].id] : \"*Shift*\";\r\n          }\r\n        }\r\n      }\r\n\r\n      return layout;\r\n    }\r\n\r\n    /**\r\n     * Function     _GenerateVisualKeyboard\r\n     * Scope        Private\r\n     * @param       {Object}      PVK         Visual keyboard name\r\n     * @param       {Object}      Lhelp       true if OSK defined for this keyboard\r\n     * @param       {Object}      layout0 \r\n     * @param       {Number}      kbdBitmask  Keyboard modifier bitmask\r\n     * Description  Generates the visual keyboard element and attaches it to KMW\r\n     */\r\n    osk._GenerateVisualKeyboard = function(PVK,Lhelp,layout0,kbdBitmask)\r\n    {\r\n      var Ldiv,LdivC,layout=layout0;\r\n      var Lkbd=util._CreateElement('DIV'), oskWidth;//s=Lkbd.style,\r\n      var activeKeyboard = keymanweb.keyboardManager.activeKeyboard;\r\n\r\n      // Build a layout using the default for the device\r\n      if(typeof layout != 'object' || layout == null)\r\n        layout=osk.buildDefaultLayout(PVK,kbdBitmask,device.formFactor);\r\n\r\n      // Create the collection of HTML elements from the device-dependent layout object\r\n      osk.layout=layout;\r\n      osk.layers=layout['layer'];\r\n\r\n      // Override font if specified by keyboard\r\n      if('font' in layout) osk.fontFamily=layout['font']; else osk.fontFamily='';\r\n\r\n      // Set flag to add default (US English) key label if specified by keyboard\r\n      if(typeof layout['displayUnderlying'] != 'undefined') {\r\n        layout.keyLabels = layout['displayUnderlying'] == true; // force bool\r\n      } else {\r\n        layout.keyLabels = activeKeyboard && ((typeof(activeKeyboard['KDU']) != 'undefined') && activeKeyboard['KDU']);\r\n      }\r\n\r\n      LdivC=osk.deviceDependentLayout(layout,device.formFactor);\r\n\r\n      osk.ddOSK = true;\r\n\r\n      // Append the OSK layer group container element to the containing element\r\n      osk.keyMap = LdivC; Lkbd.appendChild(LdivC);\r\n\r\n      // Set base class and box class - OS and keyboard added for Build 360\r\n      osk._DivVKbdHelp = osk._DivVKbd = Lkbd;\r\n      osk._Box.className=device.formFactor+' '+device.OS.toLowerCase()+' kmw-osk-frame';\r\n      Lkbd.className=device.formFactor+' kmw-osk-inner-frame';\r\n\r\n      // Add header element to OSK only for desktop browsers\r\n      if(device.formFactor == 'desktop')\r\n        osk._Box.appendChild(osk.controlBar());\r\n\r\n      // Add primary keyboard element to OSK\r\n      osk._Box.appendChild(Lkbd);\r\n\r\n      // Add footer element to OSK only for desktop browsers\r\n      if(device.formFactor == 'desktop')\r\n        osk._Box.appendChild(osk.resizeBar());\r\n\r\n      // For other devices, adjust the object heights, allowing for viewport scaling\r\n      else\r\n        osk.adjustHeights();\r\n    }\r\n\r\n    /**\r\n     * Create copy of the OSK that can be used for embedding in documentation or help\r\n     * The currently active keyboard will be returned if PInternalName is null\r\n     *\r\n     *  @param  {string}          PInternalName   internal name of keyboard, with or without Keyboard_ prefix\r\n     *  @param  {number}          Pstatic         static keyboard flag  (unselectable elements)\r\n     *  @param  {string=}         argFormFactor   layout form factor, defaulting to 'desktop'\r\n     *  @param  {(string|number)=}  argLayerId    name or index of layer to show, defaulting to 'default'\r\n     *  @return {Object}                          DIV object with filled keyboard layer content\r\n     */\r\n    keymanweb['BuildVisualKeyboard'] = keymanweb.buildOSK = function(PInternalName,Pstatic,argFormFactor,argLayerId)  // I777\r\n    {\r\n      var PKbd=keymanweb.keyboardManager.activeKeyboard,Ln,kbd=null,\r\n          formFactor=(typeof(argFormFactor) == 'undefined' ? 'desktop' : argFormFactor),\r\n          layerId=(typeof(argLayerId) == 'undefined' ? 'default' : argLayerId);\r\n\r\n      var keyboardsList = keymanweb.keyboardManager.keyboards;\r\n\r\n      if(PInternalName != null) {\r\n        var p=PInternalName.toLowerCase().replace('keyboard_','');\r\n\r\n        for(Ln=0; Ln<keyboardsList.length; Ln++) {\r\n          if(p == keyboardsList[Ln]['KI'].toLowerCase().replace('keyboard_','')) {\r\n            PKbd=keyboardsList[Ln]; break;\r\n          }\r\n        }\r\n      }\r\n\r\n      if(!PKbd) return null;\r\n\r\n      var layouts=PKbd['KVKL'],layout=null,PVK=PKbd['KV'];\r\n\r\n      // Get the layout defined in the keyboard, or its nearest equivalent\r\n      if(typeof layouts == 'object')\r\n      {\r\n        if(typeof(layouts[formFactor]) == 'object' && layouts[formFactor] != null)\r\n          layout=layouts[formFactor];\r\n        else if(formFactor == 'phone' && typeof(layouts['tablet']) == 'object' && layouts['tablet'] != null)\r\n          layout=layouts['tablet'];\r\n        else if(formFactor == 'tablet' && typeof(layouts['phone']) == 'object' && layouts['phone'] != null)\r\n          layout=layouts['phone'];\r\n        else if(typeof(layouts['desktop']) == 'object' && layouts['desktop'] != null)\r\n          layout=layouts['desktop'];\r\n      }\r\n\r\n      // Else get a default layout for the device for this keyboard\r\n      if(layout == null && PVK != null)\r\n        layout=osk.buildDefaultLayout(PVK,keymanweb.keyboardManager.getKeyboardModifierBitmask(PKbd),formFactor);\r\n\r\n      // Cannot create an OSK if no layout defined, just return empty DIV\r\n      if(layout != null) {\r\n        if(typeof layout['displayUnderlying'] != 'undefined') {\r\n          layout.keyLabels = layout['displayUnderlying'] == true; // force bool\r\n        } else {\r\n          layout.keyLabels = typeof(PKbd['KDU']) != 'undefined' && PKbd['KDU'];\r\n        }\r\n      }\r\n\r\n      kbd=osk.deviceDependentLayout(layout,formFactor);\r\n      kbd.className=formFactor+'-static kmw-osk-inner-frame';\r\n\r\n      // Select the layer to display, and adjust sizes\r\n      if(layout != null)\r\n      {\r\n        var layer,row,key,Lr,Lk;\r\n        for(Ln=0; Ln<layout.layer.length; Ln++)\r\n        {\r\n          layer=kbd.childNodes[Ln];\r\n          for(Lr=0; Lr<layer.childNodes.length; Lr++)\r\n          {\r\n            row=layer.childNodes[Lr];\r\n            for(Lk=0; Lk<row.childNodes.length; Lk++)\r\n            {\r\n              key=row.childNodes[Lk];\r\n              key.style.height='100%';\r\n            }\r\n          }\r\n          if(typeof(layerId) == 'number')\r\n            layer.style.display=(Ln == layerId && layerId >= 0 ? 'block' : 'none');\r\n          else if(typeof(layerId) == 'string')\r\n            layer.style.display=(layout.layer[Ln].id == layerId ? 'block' : 'none');\r\n          else\r\n            layer.style.display=(Ln == 0 ? 'block' : 'none');\r\n        }\r\n      }\r\n      else\r\n      {\r\n        kbd.innerHTML=\"<p style='color:#c40; font-size:0.5em;margin:10px;'>No \"+formFactor+\" layout is defined for \"+PKbd['KN']+\".</p>\";\r\n      }\r\n      // Add a faint border\r\n      kbd.style.border='1px solid #ccc';\r\n      return kbd;\r\n    }\r\n\r\n    /**\r\n     * Adjust the absolute height of each keyboard element after a rotation\r\n     *\r\n     **/\r\n    osk.adjustHeights=function()\r\n    {\r\n    if(!osk._Box || !osk._Box.firstChild || !osk._Box.firstChild.firstChild || !osk._Box.firstChild.firstChild.childNodes) return;\r\n      var layers=osk._Box.firstChild.firstChild.childNodes,\r\n          nRows=layers[0].childNodes.length,\r\n          oskHeight=osk.getHeight(),\r\n          rowHeight=Math.floor(oskHeight/(nRows == 0 ? 1 : nRows)),\r\n          nLayer,nRow,rs,keys,nKeys,nKey,key,ks,j,pad,fs=1.0;\r\n\r\n      if(device.OS == 'Android' && 'devicePixelRatio' in window)\r\n        rowHeight = rowHeight/window.devicePixelRatio;\r\n\r\n      oskHeight=nRows*rowHeight;\r\n\r\n      var b=osk._Box,bs=b.style;\r\n      bs.height=bs.maxHeight=(oskHeight+3)+'px';\r\n      b=b.firstChild.firstChild; bs=b.style;\r\n      bs.height=bs.maxHeight=(oskHeight+3)+'px';\r\n\r\n      // TODO: Logically, this should be needed for Android, too - may need to be changed for the next version!\r\n      if(device.OS == 'iOS')\r\n        fs=fs/util.getViewportScale();\r\n\r\n      bs.fontSize=fs+'em';\r\n      var resizeLabels=(device.OS == 'iOS' && device.formFactor == 'phone' && util.landscapeView());\r\n\r\n      for(nLayer=0;nLayer<layers.length; nLayer++)\r\n      {\r\n        // Check the heights of each row, in case different layers have different row counts.\r\n        nRows=layers[nLayer].childNodes.length;\r\n        rowHeight=Math.floor(oskHeight/(nRows == 0 ? 1 : nRows));\r\n\r\n        pad = Math.round(0.15*rowHeight);\r\n        layers[nLayer].style.height=(oskHeight+3)+'px';\r\n        for(nRow=0; nRow<nRows; nRow++)\r\n        {\r\n          rs=layers[nLayer].childNodes[nRow].style;\r\n          rs.bottom=(nRows-nRow-1)*rowHeight+1+'px';\r\n          rs.maxHeight=rs.height=rowHeight+'px';\r\n          keys=layers[nLayer].childNodes[nRow].childNodes;\r\n          nKeys=keys.length;\r\n          for(nKey=0;nKey<nKeys;nKey++)\r\n          {\r\n            key=keys[nKey];\r\n            //key.style.marginTop = (device.formFactor == 'phone' ? pad : 4)+'px';\r\n            //**no longer needed if base key label and popup icon are within btn, not container**\r\n\r\n            // Must set the height of the btn DIV, not the label (if any)\r\n            for(j=0; j<key.childNodes.length; j++)\r\n              if(osk.hasClass(key.childNodes[j],'kmw-key')) break;\r\n            ks=key.childNodes[j].style;\r\n            ks.bottom=rs.bottom;\r\n            ks.height=ks.minHeight=(rowHeight-pad)+'px';\r\n\r\n            // Rescale keycap labels on iPhone (iOS 7)\r\n            if(resizeLabels && (j > 0)) key.childNodes[0].style.fontSize='6px';\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Create a control bar with title and buttons for the desktop OSK\r\n     */\r\n    osk.controlBar = function()\r\n    {\r\n      var bar=util._CreateElement('DIV'),title='';\r\n      bar.id='keymanweb_title_bar';\r\n      bar.className='kmw-title-bar';\r\n      bar.onmousedown=osk._VMoveMouseDown;\r\n\r\n      if(keymanweb.keyboardManager.activeKeyboard) {\r\n        title=keymanweb.keyboardManager.activeKeyboard['KN'];\r\n      }\r\n      var Ltitle=util._CreateElement('SPAN');\r\n      Ltitle.className='kmw-title-bar-caption';\r\n      Ltitle.innerHTML=title;\r\n      bar.appendChild(Ltitle);\r\n\r\n      var Limg=osk.closeButton=util._CreateElement('DIV');\r\n      Limg.id='kmw-close-button';\r\n      Limg.className='kmw-title-bar-image';\r\n      Limg.onmousedown=osk._CancelMouse;\r\n      Limg.onclick=function(){osk._Hide(true);}\r\n      bar.appendChild(Limg);\r\n\r\n      Limg=osk.helpImg=util._CreateElement('DIV');\r\n      Limg.id='kmw-help-image';\r\n      Limg.className='kmw-title-bar-image';\r\n      Limg.title='KeymanWeb Help';\r\n      Limg.onclick=function()\r\n        {\r\n          var p={}; util.callEvent('osk.helpclick',p);\r\n          if(window.event) window.event.returnValue=false;\r\n          return false;\r\n        }\r\n      Limg.onmousedown=osk._CancelMouse;\r\n      bar.appendChild(Limg);\r\n\r\n      Limg=osk.configImg=util._CreateElement('DIV');\r\n      Limg.id='kmw-config-image';\r\n      Limg.className='kmw-title-bar-image';\r\n      Limg.title='KeymanWeb Configuration Options';\r\n      Limg.onclick=function()\r\n        {\r\n          var p={}; util.callEvent('osk.configclick',p);\r\n          if(window.event) window.event.returnValue=false;\r\n          return false;\r\n        }\r\n      Limg.onmousedown=osk._CancelMouse;\r\n      bar.appendChild(Limg);\r\n\r\n      Limg=osk.pinImg=util._CreateElement('DIV');  //I2186\r\n      Limg.id='kmw-pin-image';\r\n      Limg.className='kmw-title-bar-image';\r\n      Limg.title='Pin the On Screen Keyboard to its default location on the active text box';\r\n      Limg.onclick=function()\r\n        {\r\n          osk.loadCookie(); osk.userPositioned=false; osk.saveCookie();\r\n          osk._Show();\r\n          osk.doResizeMove(); //allow the UI to respond to OSK movements\r\n          if(osk.pinImg) osk.pinImg.style.display='none';\r\n          if(window.event) window.event.returnValue=false;\r\n          return false;\r\n        }\r\n      Limg.onmousedown=osk._CancelMouse;\r\n      bar.appendChild(Limg);\r\n\r\n      return bar;\r\n    }\r\n\r\n    /**\r\n     * Display build number\r\n     */\r\n    osk.showBuild = function()\r\n    {\r\n      util.alert('KeymanWeb Version '+keymanweb['version']+'.'+keymanweb['build']+'<br /><br />'\r\n        +'<span style=\"font-size:0.8em\">Copyright &copy; 2017 SIL International</span>');\r\n    }\r\n\r\n    /**\r\n     * Create a bottom bar with a resizing icon for the desktop OSK\r\n     */\r\n    osk.resizeBar = function()\r\n    {\r\n      var bar=util._CreateElement('DIV');\r\n      bar.className='kmw-footer';\r\n      bar.onmousedown=osk._CancelMouse;\r\n\r\n      // Add caption\r\n      var Ltitle=util._CreateElement('DIV');\r\n      Ltitle.className='kmw-footer-caption';\r\n      Ltitle.innerHTML='<a href=\"https://keyman.com/developer/keymanweb/\">KeymanWeb</a>';\r\n      Ltitle.id='keymanweb-osk-footer-caption';\r\n\r\n      // Display build number on shift+double click\r\n      util.attachDOMEvent(Ltitle,'dblclick',function(e){if(e && e.shiftKey)osk.showBuild();},false);\r\n\r\n      // Prevent selection of caption (IE - set by class for other browsers)\r\n      if('onselectstart' in Ltitle) Ltitle.onselectstart= util.selectStartHandler; //IE (Build 360)\r\n\r\n      bar.appendChild(Ltitle);\r\n\r\n      var Limg = util._CreateElement('DIV');\r\n      Limg.className='kmw-footer-resize';\r\n      Limg.onmousedown=osk._VResizeMouseDown;\r\n      Limg.onmouseover=Limg.onmouseout=osk._VResizeMouseOut;\r\n      bar.appendChild(Limg);\r\n      osk.resizeIcon=Limg;\r\n      //TODO: the image never appears in IE8, have no idea why!\r\n      return bar;\r\n    }\r\n\r\n    /**\r\n     * Function     _VKbdMouseOver\r\n     * Scope        Private\r\n     * @param       {Object}      e      event\r\n     * Description  Activate the KMW UI on mouse over\r\n     */\r\n    osk._VKbdMouseOver = function(e)\r\n    {\r\n      keymanweb.uiManager.setActivatingUI(true);\r\n    }\r\n\r\n    /**\r\n     * Function     _VKbdMouseOut\r\n     * Scope        Private\r\n     * @param       {Object}      e      event\r\n     * Description  Cancel activation of KMW UI on mouse out\r\n     */\r\n    osk._VKbdMouseOut = function(e)\r\n    {\r\n      keymanweb.uiManager.setActivatingUI(false);\r\n    }\r\n\r\n    /**\r\n     * Function     _VResizeMouseOver, _VResizeMouseOut\r\n     * Scope        Private\r\n     * @param       {Object}      e      event\r\n     * Description  Process end of resizing of KMW UI\r\n     */\r\n    osk._VResizeMouseOver = osk._VResizeMouseOut = function(e)\r\n    {\r\n      e = keymanweb._GetEventObject(e);   // I2404 - Manage IE events in IFRAMEs\r\n      if(!e) return false;\r\n      if(e  &&  e.preventDefault) e.preventDefault();\r\n      var r=osk.getRect();\r\n      osk.width=r.width; osk.height=r.height;\r\n      e.cancelBubble = true;\r\n      return false;\r\n    }\r\n\r\n    /**\r\n     * Function     _VResizeMouseDown\r\n     * Scope        Private\r\n     * @param       {Object}      e      event\r\n     * Description  Process resizing of KMW UI\r\n     */\r\n    osk._VResizeMouseDown = function(e)\r\n    {\r\n      keymanweb.uiManager.justActivated = true;\r\n      e = keymanweb._GetEventObject(e);   // I2404 - Manage IE events in IFRAMEs\r\n      if(!e) return true;\r\n      osk.resizing = 1;\r\n      var Lposx,Lposy;\r\n      if (e.pageX) {\r\n        Lposx = e.pageX; Lposy = e.pageY;\r\n        }\r\n      else if(e.clientX) {\r\n        Lposx = e.clientX + document.body.scrollLeft;\r\n        Lposy = e.clientY + document.body.scrollTop;\r\n        }\r\n      osk._ResizeMouseX = Lposx;\r\n      osk._ResizeMouseY = Lposy;\r\n      if(document.onmousemove != osk._VResizeMouseMove  &&  document.onmousemove != osk._VMoveMouseMove)  // I1472 - Dragging off edge of browser window causes muckup\r\n      {\r\n        osk._VPreviousMouseMove = document.onmousemove;\r\n        osk._VPreviousMouseUp = document.onmouseup;\r\n      }\r\n      osk._VPreviousCursor = document.body.style.cursor;\r\n      osk._VPreviousMouseButton = (typeof(e.which)=='undefined' ? e.button : e.which);\r\n\r\n      osk._VOriginalWidth = osk._DivVKbd.offsetWidth;\r\n      osk._VOriginalHeight = osk._DivVKbd.offsetHeight;\r\n      document.onmousemove = osk._VResizeMouseMove;\r\n      document.onmouseup = osk._VResizeMoveMouseUp;\r\n\r\n      if(document.body.style.cursor) document.body.style.cursor = 'se-resize';\r\n      if(e  &&  e.preventDefault) e.preventDefault();\r\n      e.cancelBubble = true;\r\n      return false;\r\n    }\r\n\r\n    /**\r\n     * Function     _VResizeMouseMove\r\n     * Scope        Private\r\n     * @param       {Object}      e      event\r\n     * Description  Process mouse movement during resizing of OSK\r\n     */\r\n    osk._VResizeMouseMove = function(e)\r\n    {\r\n      var Lposx,Lposy;\r\n      e = keymanweb._GetEventObject(e);   // I2404 - Manage IE events in IFRAMEs\r\n      if(!e) return true;\r\n      osk.resizing = 1;\r\n\r\n      if(osk._VPreviousMouseButton != (typeof(e.which)=='undefined' ? e.button : e.which)) // I1472 - Dragging off edge of browser window causes muckup\r\n      {\r\n        return osk._VResizeMoveMouseUp(e);\r\n      }\r\n      else\r\n      {\r\n        if (e.pageX) {\r\n          Lposx = e.pageX; Lposy=e.pageY;\r\n          }\r\n        else if (e.clientX) {\r\n          Lposx = e.clientX + document.body.scrollLeft;\r\n          Lposy = e.clientY + document.body.scrollTop;\r\n          }\r\n        var newWidth=(osk._VOriginalWidth + Lposx - osk._ResizeMouseX),\r\n            newHeight=(osk._VOriginalHeight + Lposy - osk._ResizeMouseY);\r\n\r\n        // Set the smallest and largest OSK size\r\n        if(newWidth < 0.2*screen.width) newWidth = 0.2*screen.width;\r\n        if(newHeight < 0.1*screen.height) newHeight = 0.1*screen.height;\r\n        if(newWidth > 0.9*screen.width) newWidth=0.9*screen.width;\r\n        if(newHeight > 0.5*screen.height) newWidth=0.5*screen.height;\r\n\r\n        // Set OSK width\r\n        osk._DivVKbd.style.width=newWidth+'px';\r\n\r\n        // Explicitly change OSK height and font size - cannot safely rely on scaling from font\r\n        osk._DivVKbd.style.height=newHeight+'px';\r\n        osk._DivVKbd.style.fontSize=(newHeight/8)+'px';\r\n\r\n        if(e  &&  e.preventDefault) e.preventDefault();\r\n        e.cancelBubble = true;\r\n        return false;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function     _VMoveMouseDown\r\n     * Scope        Private\r\n     * @param       {Object}      e      event\r\n     * Description  Process mouse down on OSK\r\n     */\r\n    osk._VMoveMouseDown = function(e)\r\n    {\r\n      var Lposx, Lposy;\r\n      keymanweb.uiManager.justActivated = true;\r\n      e = keymanweb._GetEventObject(e);   // I2404 - Manage IE events in IFRAMEs\r\n      if(!e) return true;\r\n\r\n      osk.resizing = 1;\r\n      if (e.pageX)\r\n        { Lposx = e.pageX; Lposy = e.pageY; }\r\n      else if (e.clientX)\r\n        { Lposx = e.clientX + document.body.scrollLeft; Lposy = e.clientY + document.body.scrollTop; }\r\n\r\n      if(document.onmousemove != osk._VResizeMouseMove  &&  document.onmousemove != osk._VMoveMouseMove)  // I1472 - Dragging off edge of browser window causes muckup\r\n      {\r\n        osk._VPreviousMouseMove = document.onmousemove;\r\n        osk._VPreviousMouseUp = document.onmouseup;\r\n      }\r\n      osk._VPreviousCursor = document.body.style.cursor;\r\n      osk._VPreviousMouseButton = (typeof(e.which)=='undefined' ? e.button : e.which);\r\n\r\n      osk._VMoveX = Lposx - osk._Box.offsetLeft;\r\n      osk._VMoveY = Lposy - osk._Box.offsetTop;\r\n\r\n      if(keymanweb.keyboardManager.isCJK()) osk.pinImg.style.left='15px';\r\n\r\n      document.onmousemove = osk._VMoveMouseMove;\r\n      document.onmouseup = osk._VResizeMoveMouseUp;\r\n      if(document.body.style.cursor) document.body.style.cursor = 'move';\r\n      if(e  &&  e.preventDefault) e.preventDefault();\r\n      e.cancelBubble = true;\r\n      return false;\r\n    }\r\n\r\n    /**\r\n     * Process mouse drag on OSK\r\n     *\r\n     * @param       {Object}      e      event\r\n     */\r\n    osk._VMoveMouseMove = function(e)\r\n    {\r\n      var Lposx, Lposy;\r\n      e = keymanweb._GetEventObject(e);   // I2404 - Manage IE events in IFRAMEs\r\n      if(!e) return true;\r\n\r\n      if(osk.noDrag) return true;\r\n\r\n      osk.resizing = 1;\r\n\r\n      osk.userPositioned = true;\r\n      osk.pinImg.style.display='block';\r\n\r\n      if(osk._VPreviousMouseButton != (typeof(e.which)=='undefined' ? e.button : e.which)) // I1472 - Dragging off edge of browser window causes muckup\r\n      {\r\n        return osk._VResizeMoveMouseUp(e);\r\n      }\r\n      else\r\n      {\r\n        if (e.pageX)\r\n          { Lposx = e.pageX; Lposy = e.pageY; }\r\n        else if (e.clientX)\r\n          { Lposx = e.clientX + document.body.scrollLeft; Lposy = e.clientY + document.body.scrollTop; }\r\n        osk._Box.style.left = (Lposx-osk._VMoveX)+'px';\r\n        osk._Box.style.top = (Lposy-osk._VMoveY)+'px';\r\n\r\n        if(e  &&  e.preventDefault) e.preventDefault();\r\n        var r=osk.getRect();\r\n        osk.width=r.width;osk.height=r.height;\r\n        e.cancelBubble = true;\r\n        return false;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function     _VResizeMoveMouseUp\r\n     * Scope        Private\r\n     * @param       {Object}      e      event\r\n     * Description  Process mouse up during resizing of KMW UI\r\n     */\r\n    osk._VResizeMoveMouseUp = function(e)\r\n    {\r\n      e = keymanweb._GetEventObject(e);   // I2404 - Manage IE events in IFRAMEs\r\n      if(!e) return true;\r\n      osk.resizing = 0; osk.currentKey=null;\r\n      document.onmousemove = osk._VPreviousMouseMove;\r\n      document.onmouseup = osk._VPreviousMouseUp;\r\n      if(document.body.style.cursor) document.body.style.cursor = osk._VPreviousCursor;\r\n      keymanweb.domManager.focusLastActiveElement();\r\n      if(e  &&  e.preventDefault) e.preventDefault();\r\n      keymanweb.uiManager.justActivated = false;\r\n      keymanweb.uiManager.setActivatingUI(false);\r\n      if(osk._DivVKbd) {\r\n        osk._VOriginalWidth = osk._DivVKbd.offsetWidth;\r\n        osk._VOriginalHeight = osk._DivVKbd.offsetHeight;\r\n        }\r\n      osk.doResizeMove();\r\n      e.cancelBubble = true;\r\n      osk.saveCookie();\r\n      return false;\r\n    }\r\n\r\n    /**\r\n     * Function     userPositioned\r\n     * Scope        Public\r\n     * @return      {(boolean|number)}          true if user located\r\n     * Description  Test if OSK window has been repositioned by user\r\n     */\r\n    osk['userLocated'] = function()\r\n    {\r\n      return osk.userPositioned;\r\n    }\r\n\r\n    /**\r\n     * Description  Display KMW OSK (at position set in callback to UI)\r\n     * Function     show\r\n     * Scope        Public\r\n     * @param       {(boolean|number)=}      bShow     True to display, False to hide, omitted to toggle\r\n     */\r\n    osk['show'] = function(bShow)\r\n    {\r\n      if(arguments.length > 0)\r\n      {\r\n        osk._Enabled=bShow;\r\n        if(bShow) osk._Show(); else osk._Hide(true);\r\n      }\r\n      else\r\n      {\r\n        if(osk._Visible) osk._Hide(true); else osk._Show();\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Allow UI to respond to OSK being shown (passing position and properties)\r\n     *\r\n     * @param       {Object=}       p     object with coordinates and userdefined flag\r\n     * @return      {boolean}\r\n     *\r\n     */\r\n    osk.doShow = function(p)\r\n    {\r\n      return util.callEvent('osk.show',p);\r\n    }\r\n\r\n    /**\r\n     * Allow UI to update respond to OSK being hidden\r\n     *\r\n     * @param       {Object=}       p     object with coordinates and userdefined flag\r\n     * @return      {boolean}\r\n     *\r\n     */\r\n    osk.doHide = function(p)\r\n    {\r\n      return util.callEvent('osk.hide',p);\r\n    }\r\n\r\n    /**\r\n     * Allow UI to update OSK position and properties\r\n     *\r\n     * @param       {Object=}     p       object with coordinates and userdefined flag\r\n     *\r\n     */\r\n    osk.doResizeMove = function(p)\r\n    {\r\n      return util.callEvent('osk.resizemove',p);\r\n    }\r\n\r\n\r\n    /**\r\n     * Display KMW OSK at specified position (returns nothing)\r\n     *\r\n     * @param       {number=}     Px      x-coordinate for OSK rectangle\r\n     * @param       {number=}     Py      y-coordinate for OSK rectangle\r\n     */\r\n    osk._Show = function(Px, Py)\r\n    {\r\n      // Do not try to display OSK if undefined, or no active element\r\n      if(osk._Box == null || keymanweb.domManager.getActiveElement() == null) return;\r\n\r\n      // Never display the OSK for desktop browsers unless KMW element is focused, and a keyboard selected\r\n      if((!device.touchable) && (keymanweb.keyboardManager.activeKeyboard == null || !osk._Enabled)) return;\r\n\r\n      var Ls = osk._Box.style;\r\n\r\n      // Do not display OSK until it has been positioned correctly\r\n      if(device.touchable && Ls.bottom == '') {\r\n        Ls.visibility='hidden';\r\n      }\r\n\r\n      if(device.touchable) {\r\n        /* In case it's still '0' from a hide() operation.\r\n         * Happens when _Show is called before the transitionend events are processed,\r\n         * which can happen in bulk-rendering contexts.\r\n         * \r\n         * (Opacity is only modified when device.touchable = true, though a couple of extra\r\n         * conditions may apply.)\r\n         */\r\n        Ls.opacity='1';\r\n      }\r\n\r\n      // The following code will always be executed except for externally created OSK such as EuroLatin\r\n      if(osk.ddOSK)\r\n      {\r\n        // Enable the currently active keyboard layer and update the default nextLayer member\r\n        var n,nLayer=-1,b=osk._DivVKbd.childNodes[0].childNodes;\r\n        for(n=0; n<b.length; n++)\r\n        {\r\n          if(b[n].layer == osk.layerId)\r\n          {\r\n            b[n].style.display='block';\r\n            //b[n].style.visibility='visible';\r\n            osk.nextLayer=osk.layerId;\r\n            osk.layerIndex=nLayer=n;\r\n            if(typeof osk.layers[n]['nextlayer'] == 'string') osk.nextLayer=osk.layers[n]['nextlayer'];\r\n\r\n            // If osk._Show has been called, there's probably been a change in modifier or state key state.  Keep it updated!\r\n            osk._UpdateVKShiftStyle();\r\n          }\r\n          else\r\n          {\r\n            b[n].style.display='none';\r\n            //b[n].style.visibility='hidden';\r\n          }\r\n        }\r\n\r\n        if(device.touchable)\r\n        {\r\n          Ls.position='fixed';\r\n          Ls.left=Ls.bottom='0px';\r\n          Ls.height=Ls.maxHeight=osk._Box.firstChild.firstChild.style.height;\r\n          Ls.border='none'; Ls.borderTop='1px solid gray';\r\n          osk._Enabled=1; osk._Visible=1; // I3363 (Build 301)\r\n\r\n          // Identify and save references to the language key, hide keyboard key, and space bar\r\n          osk.lgKey=osk.getSpecialKey(nLayer,'K_LOPT');     //TODO: should be saved with layer\r\n          osk.hkKey=osk.getSpecialKey(nLayer,'K_ROPT');\r\n\r\n          // Always adjust screen height if iPhone or iPod, to take account of viewport changes\r\n          if(device.OS == 'iOS' && device.formFactor == 'phone') osk.adjustHeights();\r\n        }\r\n\r\n        // Define for both desktop and touchable OSK\r\n        osk.spaceBar=osk.getSpecialKey(nLayer,'K_SPACE'); //TODO: should be saved with layer\r\n      }\r\n\r\n      //TODO: may need to return here for touch devices??\r\n      Ls.display='block'; //Ls.visibility='visible';\r\n      osk.showLanguage();\r\n\r\n      if(device.formFactor == 'desktop')\r\n      {\r\n        Ls.position='absolute'; Ls.display='block'; //Ls.visibility='visible';\r\n        Ls.left='0px';\r\n        osk.loadCookie();\r\n        if(Px >= 0) //probably never happens, legacy support only\r\n        {\r\n          Ls.left = Px + 'px'; Ls.top = Py + 'px';\r\n        }\r\n        else\r\n        {\r\n          if(osk.userPositioned)\r\n          {\r\n            Ls.left=osk.x+'px'; Ls.top=osk.y+'px';\r\n          }\r\n          else\r\n          {\r\n            var el=keymanweb.domManager.getActiveElement();\r\n            if(osk.dfltX != '')\r\n              Ls.left=osk.dfltX;\r\n            else if(typeof el != 'undefined' && el != null)\r\n              Ls.left=util._GetAbsoluteX(el)+'px';\r\n\r\n            if(osk.dfltY != '')\r\n              Ls.top=osk.dfltY;\r\n            else if(typeof el != 'undefined' && el != null)\r\n              Ls.top=(util._GetAbsoluteY(el)+el.offsetHeight)+'px';\r\n          }\r\n        }\r\n        osk._Enabled=1; osk._Visible=1;\r\n        if(osk._DivVKbd)\r\n        {\r\n          osk.width=osk._DivVKbd.offsetWidth; osk.height=osk._DivVKbd.offsetHeight;\r\n        }\r\n\r\n        osk.saveCookie();\r\n\r\n        var pin=osk.pinImg;\r\n        if(typeof pin != 'undefined' && pin != null)\r\n          pin.style.display=osk.userPositioned?'block':'none';\r\n      }\r\n\r\n      // If OSK still hidden, make visible only after all calculation finished\r\n      if(Ls.visibility == 'hidden')\r\n        window.setTimeout(function(){osk._Box.style.visibility='visible';},0);\r\n\r\n      // Allow desktop UI to execute code when showing the OSK\r\n      if(!device.touchable)\r\n      {\r\n        var Lpos={};\r\n        Lpos['x']=osk._Box.offsetLeft;\r\n        Lpos['y']=osk._Box.offsetTop;\r\n        Lpos['userLocated']=osk.userPositioned;\r\n        osk.doShow(Lpos);\r\n      }\r\n    }\r\n\r\n    /**\r\n     *  Adjust the width of the last cell in each row for length differences\r\n     *  due to rounding percentage widths to nearest pixel.\r\n     *\r\n     *  @param  {number}  nLayer    Index of currently visible layer\r\n     */\r\n    osk.adjustRowLengths = function(nLayer)\r\n    {\r\n      if(nLayer >= 0) return;   //TODO: TEST ONLY - remove code if not needed\r\n\r\n      var maxWidth,layers=osk._DivVKbd.childNodes[0].childNodes;\r\n\r\n      if(nLayer < 0 || nLayer >= layers.length || layers[nLayer].aligned) return;\r\n\r\n      // Do not try and align if not visible!\r\n      if(layers[nLayer].style.display != 'block') return;\r\n\r\n      // Set max width to be 6 px less than OSK layer width (allow for inter-key spacing)\r\n      // TODO: Adjustment needs to be device and orientation specific\r\n      maxWidth=osk._DivVKbd.childNodes[0].offsetWidth-6;\r\n\r\n      if(device.OS == 'Windows')\r\n      {\r\n        maxWidth -= util.landscapeView() ? 4: 40;\r\n      }\r\n      var i,rows=layers[nLayer].childNodes,keys,nKeys,lastKey,xMax;\r\n      for(i=0; i<rows.length; i++)\r\n      {\r\n        keys=rows[i].childNodes;\r\n        nKeys=keys.length;\r\n        xMax=keys[nKeys-2].offsetLeft+keys[nKeys-2].offsetWidth;\r\n        lastKey=keys[nKeys-1];\r\n        lastKey.style.width=(maxWidth-xMax)+'px';\r\n      }\r\n      layers[nLayer].aligned=true;\r\n    }\r\n\r\n    /**\r\n     *  Clear the row alignment flag for each layer\r\n     *  @return   {number}    number of currently active layer\r\n     *\r\n     */\r\n    osk.resetRowLengths = function()\r\n    {\r\n      var j,layers=osk._DivVKbd.childNodes[0].childNodes,nLayer=-1;\r\n      for(j=0; j<layers.length; j++)\r\n      {\r\n        if(layers[j].style.display == 'block') nLayer=j;\r\n        layers[j].aligned=false;\r\n      }\r\n      return nLayer;\r\n    }\r\n\r\n    /**\r\n     *  Set the reference to a special function key for the\r\n     *  currently visible OSK layer\r\n     *\r\n     *  @param    {number}  nLayer  Index of visible layer\r\n     *  @param    {string}  keyId   key identifier\r\n     *  @return   {Object}          Reference to key\r\n     */\r\n    osk.getSpecialKey = function(nLayer,keyId)\r\n    {\r\n      var k,layers,rows,keys;\r\n      layers=osk._DivVKbd.childNodes[0].childNodes;\r\n      if(nLayer >= 0 && nLayer < layers.length)\r\n      {\r\n        // Special function keys will always be in bottom row (must modify code if not)\r\n        rows=layers[nLayer].childNodes;\r\n        keys=rows[rows.length-1].childNodes;\r\n        for(k=0; k<keys.length; k++)\r\n        {\r\n          if(keys[k].keyId == keyId) return keys[k];\r\n        }\r\n      }\r\n      return null;\r\n    }\r\n\r\n    /**\r\n     * Function     hide\r\n     * Scope        Public\r\n     * Description  Prevent display of OSK window on focus\r\n     */\r\n    osk['hide'] = function()\r\n    {\r\n      osk._Enabled=0; osk._Hide(true);\r\n    }\r\n\r\n    /**\r\n     * Hide Keymanweb On Screen Keyboard\r\n     *\r\n     * @param       {boolean}   hiddenByUser    Distinguish between hiding on loss of focus and explicit hiding by user\r\n     */\r\n    osk._Hide = function(hiddenByUser)\r\n    {\r\n      // The test for CJK languages is necessary to prevent a picklist (displayed in the OSK) from being hidden by the user\r\n      // Once picklist functionality is separated out, this will no longer be needed.\r\n      // Logic is: execute always if hidden on lost focus, but if requested by user, only if not CJK\r\n\r\n      // Save current size if visible\r\n      if(osk._Box && osk._Box.style.display == 'block' && osk._DivVKbd)\r\n      {\r\n        osk.width=osk._DivVKbd.offsetWidth; osk.height=osk._DivVKbd.offsetHeight;\r\n      }\r\n      if(hiddenByUser)\r\n      {\r\n        //osk.loadCookie(); // preserve current offset and userlocated state\r\n        osk._Enabled = ((keymanweb.keyboardManager.isCJK() || device.touchable)?1:0); // I3363 (Build 301)\r\n        osk.saveCookie();  // Save current OSK state, size and position (desktop only)\r\n      }\r\n      else if(device.formFactor == 'desktop')\r\n      {\r\n        //Allow desktop OSK to remain visible on blur if body class set\r\n        if(document.body.className.indexOf('osk-always-visible') >= 0) return;\r\n      }\r\n\r\n      osk._Visible = 0;\r\n      if(osk._Box && device.touchable && osk._Box.offsetHeight > 0) // I3363 (Build 301)\r\n      {\r\n        var os=osk._Box.style,h=osk._Box.offsetHeight;\r\n        //Firefox doesn't transition opacity if start delay is explicitly set to 0!\r\n        if(typeof(os.MozBoxSizing) == 'string')\r\n          os.transition='opacity 0.8s linear';\r\n        else\r\n          os.transition=os.msTransition=os.WebkitTransition='opacity 0.5s linear 0';\r\n\r\n        // Cannot hide the OSK smoothly using a transitioned drop, since for\r\n        // position:fixed elements transitioning is incompatible with translate3d(),\r\n        // and also does not work with top, bottom or height styles.\r\n        // Opacity can be transitioned and is probably the simplest alternative.\r\n        // We must condition on osk._Visible in case focus has since been moved to another\r\n        // input (in which case osk._Visible will be non-zero)\r\n        window.setTimeout(function()\r\n        {\r\n          var os=osk._Box.style;\r\n          if(osk._Visible)\r\n          {\r\n            // Leave opacity alone and clear transition if another element activated\r\n            os.transition=os.msTransition=os.MozTransition=os.WebkitTransition='';\r\n          }\r\n          else\r\n          {\r\n            // Set opacity to zero, should decrease smoothly\r\n            os.opacity='0';\r\n\r\n            // Actually hide the OSK at the end of the transition\r\n            osk._Box.addEventListener('transitionend',osk.hideNow,false);\r\n            osk._Box.addEventListener('webkitTransitionEnd',osk.hideNow,false);\r\n          }\r\n        },200);      // Wait a bit before starting, to allow for moving to another element\r\n\r\n      }\r\n      else\r\n      {\r\n        if(osk._Box) osk._Box.style.display = 'none';\r\n      }\r\n\r\n      // Allow UI to execute code when hiding the OSK\r\n      var p={}; p['HiddenByUser']=hiddenByUser;\r\n      osk.doHide(p);\r\n\r\n      // If hidden by the UI, be sure to restore the focus\r\n      if(hiddenByUser) keymanweb.domManager.focusLastActiveElement();\r\n    }\r\n\r\n    /**\r\n     * Function     hideNow\r\n     * Scope        Private\r\n     * Description  Hide the OSK unconditionally and immediately, cancel any pending transition\r\n     */\r\n    osk.hideNow = function() // I3363 (Build 301)\r\n    {\r\n      osk._Box.removeEventListener('transitionend',osk.hideNow,false);\r\n      osk._Box.removeEventListener('webkitTransitionEnd',osk.hideNow,false);\r\n\r\n      var os=osk._Box.style;\r\n      os.display='none';\r\n      os.opacity='1';\r\n      osk._Visible=0;\r\n      os.transition=os.msTransition=os.mozTransition=os.WebkitTransition='';\r\n\r\n      // Remove highlighting from hide keyboard key, if applied\r\n      if(osk.hkKey && typeof(osk.hkKey) != 'undefined') osk.highlightKey(osk.hkKey.firstChild,false);\r\n\r\n    }\r\n\r\n    // First time initialization of OSK\r\n    osk.prepare = function()\r\n    {\r\n      // Defer loading the OSK until KMW code initialization complete\r\n      if(!keymanweb['initialized'])\r\n      {\r\n        window.setTimeout(osk.prepare,200);\r\n        return;\r\n      }\r\n      // OSK initialization - create DIV and set default styles\r\n      if(!osk.ready)\r\n      {\r\n        osk._Box = util._CreateElement('DIV');   // Container for OSK (Help DIV, displayed when user clicks Help icon)\r\n        document.body.appendChild(osk._Box);\r\n\r\n        // Install the default OSK stylesheet\r\n        util.linkStyleSheet(keymanweb.getStyleSheetPath('kmwosk.css'));\r\n\r\n        // For mouse click to prevent loss of focus\r\n        util.attachDOMEvent(osk._Box,'mousedown', function(){keymanweb.uiManager.setActivatingUI(true);});\r\n\r\n        // And to prevent touch event default behaviour on mobile devices\r\n        // TODO: are these needed, or do they interfere with other OSK event handling ????\r\n        if(device.touchable) // I3363 (Build 301)\r\n        {\r\n          var cancelEventFunc = function(e) {\r\n            if(e.cancelable) {\r\n              e.preventDefault();\r\n            }\r\n            e.stopPropagation();\r\n            return false;\r\n          };\r\n          \r\n          util.attachDOMEvent(osk._Box, 'touchstart', function(e) {\r\n            keymanweb.uiManager.setActivatingUI(true); \r\n            return cancelEventFunc(e);\r\n          });\r\n          \r\n          util.attachDOMEvent(osk._Box, 'touchend', cancelEventFunc);\r\n          util.attachDOMEvent(osk._Box, 'touchmove', cancelEventFunc);\r\n          util.attachDOMEvent(osk._Box, 'touchcancel', cancelEventFunc);\r\n\r\n          // Can only get (initial) viewport scale factor after page is fully loaded!\r\n          osk.vpScale=util.getViewportScale();\r\n        }\r\n      }\r\n      osk.loadCookie();\r\n      osk.ready=true;\r\n    }\r\n    /**\r\n     * Function     _Load\r\n     * Scope        Private\r\n     * Description  OSK initialization when keyboard selected\r\n     */\r\n    osk._Load = function()   // Load Help\r\n    {\r\n      var activeKeyboard = keymanweb.keyboardManager.activeKeyboard;\r\n\r\n      // If _Load called before OSK is ready, must wait and call again\r\n      if(osk._Box == null)\r\n      {\r\n        if(osk.loadRetry >= 99) return; // fail silently, but should not happen\r\n        window.setTimeout(osk._Load,100);\r\n        osk.loadRetry++;\r\n        return;\r\n      }\r\n\r\n      osk.loadRetry = 0;\r\n\r\n      if(keymanweb._TitleElement) keymanweb._TitleElement.innerHTML = 'KeymanWeb'; // I1972\r\n\r\n\r\n      osk._Visible=0;  // I3363 (Build 301)\r\n      osk.layerId='default';\r\n      var s=osk._Box.style;\r\n      s.zIndex='9999'; s.display='none'; s.width='auto';\r\n      s.position = (device.formFactor == 'desktop' ? 'absolute' : 'fixed');\r\n\r\n      // Use smaller base font size for mobile devices\r\n      //if(screen.availHeight < 500) s.fontSize='10pt';\r\n      //else if(screen.availHeight < 800) s.fontSize='11pt';\r\n      //else s.fontSize='12pt';\r\n\r\n      // Set scaling for mobile devices here.\r\n      if(device.touchable) {\r\n        var fontScale: number = 1;\r\n        if(device.formFactor == 'phone') {\r\n          fontScale = 1.6 * (keymanweb.isEmbedded ? 0.65 : 0.6) * 1.2;  // Combines original scaling factor with one previously applied to the layer group.\r\n        } else {\r\n          // The following is a *temporary* fix for small format tablets, e.g. PendoPad\r\n          var pixelRatio = 1;\r\n          if(device.OS == 'Android' && 'devicePixelRatio' in window) {\r\n            pixelRatio = window.devicePixelRatio;\r\n          }\r\n          \r\n          if(device.OS == 'Android' && device.formFactor == 'tablet' && parseInt(osk.getHeight(),10) < 300 * pixelRatio) {\r\n            fontScale *= 1.2;\r\n          } else {\r\n            fontScale *= 2; //'2.5em';\r\n          }\r\n        }\r\n\r\n        // Finalize the font size parameter.\r\n        s.fontSize = fontScale + 'em';\r\n      }\r\n\r\n      osk._DivVKbd = osk._DivVKbdHelp = null;  // I1476 - Handle SELECT overlapping\r\n      osk._Box.innerHTML = '';\r\n      osk._Box.onmouseover = osk._VKbdMouseOver;\r\n      osk._Box.onmouseout = osk._VKbdMouseOut;\r\n\r\n      // TODO: find out and document why this should not be done for touch devices!!\r\n      // (Probably to avoid having a null keyboard. But maybe that *is* an option, if there remains a way to get the language menu,\r\n      //  such as a minimized menu button?)\r\n      if(activeKeyboard == null && !device.touchable)\r\n      {\r\n        var Ldiv=util._CreateElement('DIV');\r\n        Ldiv.className = \"kmw-title-bar\";\r\n        Ldiv.appendChild(osk._TitleBarInterior());\r\n        Ldiv.onmousedown = osk._VMoveMouseDown;\r\n        osk._Box.appendChild(Ldiv);\r\n\r\n        Ldiv = util._CreateElement('DIV');\r\n        Ldiv.className='kmw-osk-none';\r\n        osk._Box.appendChild(Ldiv);\r\n      }\r\n      else\r\n      {\r\n        var Lviskbd=null,layouts=null,layout=null,Lhelp='';\r\n        osk._Box.className = \"\";\r\n        if(activeKeyboard != null)\r\n        {\r\n          Lviskbd=activeKeyboard['KV']; Lhelp=activeKeyboard['KH'];\r\n\r\n          // Check if dynamic layout is defined within keyboard\r\n          layouts=activeKeyboard['KVKL'];\r\n\r\n          // If any keyboard layout file is provided, use that to override the generated layout\r\n          if(typeof layouts != 'undefined' && layouts != null)\r\n          {\r\n            layout=layouts[device.formFactor];\r\n\r\n            // Use the layout for the device, if defined, otherwise use the desktop (default) layout\r\n            if(typeof layout == 'undefined' || layout == null)\r\n            {\r\n              if(device.formFactor == 'phone') layout=layouts['tablet'];\r\n              else if(device.formFactor == 'tablet') layout=layouts['phone'];\r\n              if(typeof layout == 'undefined' || layout == null) layout=layouts['desktop'];\r\n            }\r\n          }\r\n        }\r\n\r\n        // Test if Visual keyboard is simply a place holder, set to null if so\r\n        if(Lviskbd != null && Lviskbd['BK'] != null)\r\n        {\r\n          var keyCaps=Lviskbd['BK'],noKeyCaps=true;\r\n          {\r\n            for(var i=0; i<keyCaps.length; i++)\r\n            {\r\n              if(keyCaps[i].length > 0)\r\n              {\r\n                noKeyCaps = false; break;\r\n              }\r\n            }\r\n          }\r\n          if(noKeyCaps) Lviskbd=null;\r\n        }\r\n\r\n        // Generate a visual keyboard from the layout (or layout default)\r\n        // TODO: this should probably be unconditional now\r\n        if(Lviskbd != null || Lhelp == '' || device.touchable) // I3363 (Build 301)\r\n        {\r\n          // TODO: May want to define a default BK array here as well\r\n          if(Lviskbd == null) Lviskbd={'F':'Tahoma','BK':dfltText}; //DDOSK\r\n\r\n          osk._GenerateVisualKeyboard(Lviskbd, Lhelp, layout, keymanweb.keyboardManager.getKeyboardModifierBitmask());\r\n        }\r\n\r\n        else //The following code applies only to preformatted 'help' such as European Latin\r\n        {\r\n          osk.ddOSK = false;\r\n          Ldiv=util._CreateElement('DIV');\r\n          Ldiv.className = \"kmw-title-bar\";\r\n          Ldiv.appendChild(osk._TitleBarInterior());\r\n          Ldiv.onmousedown = osk._VMoveMouseDown;\r\n          osk._Box.appendChild(Ldiv);\r\n\r\n          //Add content\r\n          var Ldiv = util._CreateElement('DIV');\r\n          Ldiv.className='kmw-osk-static';\r\n          Ldiv.innerHTML = Lhelp;\r\n          osk._Box.appendChild(Ldiv);\r\n          if(activeKeyboard['KHF']) activeKeyboard['KHF'](osk._Box);\r\n        }\r\n        if(keymanweb._TitleElement)\r\n        {\r\n          keymanweb._TitleElement.innerHTML = \"<span style='font-weight:bold'>\"\r\n            + activeKeyboard['KN'] + '</span> - ' + keymanweb._TitleElement.innerHTML; // I1972  // I2186\r\n          keymanweb._TitleElement.className=''; keymanweb._TitleElement.style.color='#fff';\r\n        }\r\n      }\r\n\r\n      // Create the key preview (for phones)\r\n      osk.createKeyTip();\r\n\r\n      // Correct the classname for the (inner) OSK frame (Build 360)\r\n      var innerFrame=osk._Box.firstChild,\r\n        kbdClass=' kmw-keyboard-'+(activeKeyboard ? activeKeyboard['KI'].replace('Keyboard_','') : '');\r\n      if(innerFrame.id == 'keymanweb_title_bar') innerFrame=innerFrame.nextSibling;\r\n      innerFrame.className='kmw-osk-inner-frame'+kbdClass;\r\n\r\n      // Append a stylesheet for this keyboard for keyboard specific styles\r\n      // or if needed to specify an embedded font\r\n      osk.appendStyleSheet();\r\n      if(osk._Enabled) osk._Show();\r\n    }\r\n\r\n    /**\r\n     *  Append a style sheet for the current keyboard if needed for specifying an embedded font\r\n     *  or to re-apply the default element font\r\n     *\r\n     **/\r\n    osk.appendStyleSheet = function() {\r\n      var activeKeyboard = keymanweb.keyboardManager.activeKeyboard;\r\n      var activeStub: com.keyman.KeyboardStub = keymanweb.keyboardManager.activeStub;\r\n\r\n      // Do not do anything if a null stub\r\n      if(activeStub == null) {\r\n        return;\r\n      }\r\n\r\n      // First remove any existing keyboard style sheet\r\n      if(osk.styleSheet) {\r\n        util.removeStyleSheet(osk.styleSheet);\r\n      }\r\n\r\n      var i, kfd=activeStub['KFont'], ofd=activeStub['KOskFont'];\r\n\r\n      // Add style sheets for embedded fonts if necessary (each font-face style will only be added once)\r\n      util.addFontFaceStyleSheet(kfd); util.addFontFaceStyleSheet(ofd);\r\n\r\n      // Temporarily hide duplicated elements on non-desktop browsers\r\n      keymanweb.hideInputs();\r\n\r\n      // Build the style string and append (or replace) the font style sheet\r\n      // Note: Some browsers do not download the font-face font until it is applied,\r\n      //       so must apply style before testing for font availability\r\n      // Extended to allow keyboard-specific custom styles for Build 360\r\n      var customStyle=osk.addFontStyle(kfd,ofd);\r\n      if( activeKeyboard != null && typeof(activeKeyboard['KCSS']) == 'string')  // KMEW-129\r\n        customStyle=customStyle+activeKeyboard['KCSS'];\r\n\r\n      osk.styleSheet = util.addStyleSheet(customStyle); //Build 360\r\n\r\n      // Wait until font is loaded then align duplicated input elements with page elements\r\n      if(osk.waitForFonts(kfd,ofd)) {\r\n        keymanweb.alignInputs();\r\n      }\r\n    }\r\n\r\n    /**\r\n     *  Add or replace the style sheet used to set the font for input elements and OSK\r\n     *\r\n     *  @param  {Object}  kfd   KFont font descriptor\r\n     *  @param  {Object}  ofd   OSK font descriptor (if any)\r\n     *  @return {string}\r\n     *\r\n     **/\r\n    osk.addFontStyle = function(kfd,ofd)\r\n    {\r\n      // Get name of font to be applied\r\n      var fn=keymanweb.baseFont;\r\n      if(typeof(kfd) != 'undefined' && typeof(kfd['family']) != 'undefined') fn=kfd['family'];\r\n\r\n      // Unquote font name in base font (if quoted)\r\n      fn = fn.replace(/\\u0022/g,'');\r\n\r\n      // Set font family chain for mapped elements and remove any double quotes\r\n      var rx=new RegExp('\\\\s?'+fn+',?'), ff=keymanweb.appliedFont.replace(/\\u0022/g,'');\r\n\r\n      // Remove base font name from chain if present\r\n      ff = ff.replace(rx,''); ff = ff.replace(/,$/,'');\r\n\r\n      // Then replace it at the head of the chain\r\n      if(ff == '') ff=fn; else ff=fn+','+ff;\r\n\r\n      // Re-insert quotes around individual font names\r\n      ff = '\"' + ff.replace(/\\,\\s?/g,'\",\"') + '\"';\r\n\r\n      // Add to the stylesheet, quoted, and with !important to override any explicit style\r\n      var s='.keymanweb-font{\\nfont-family:' + ff + ' !important;\\n}\\n';\r\n\r\n      // Set font family for OSK text\r\n      if(typeof(ofd) != 'undefined')\r\n        s=s+'.kmw-key-text{\\nfont-family:\"'+ofd['family'].replace(/\\u0022/g,'').replace(/,/g,'\",\"')+'\";\\n}\\n';\r\n      else if(typeof(kfd) != 'undefined')\r\n        s=s+'.kmw-key-text{\\nfont-family:\"'+kfd['family'].replace(/\\u0022/g,'').replace(/,/g,'\",\"')+'\";\\n}\\n';\r\n\r\n      // Store the current font chain (with quote-delimited font names)\r\n      keymanweb.appliedFont = ff;\r\n\r\n      // Return the style string\r\n      return s;\r\n    }\r\n\r\n    /**\r\n     * Function     _Unload\r\n     * Scope        Private\r\n     * Description  Clears OSK variables prior to exit (JMD 1.9.1 - relocation of local variables 3/9/10)\r\n     */\r\n    osk._Unload = function()\r\n    {\r\n      osk._VShift = osk._DivVKbd = osk._VKeySpans = osk._Box = 0;\r\n    }\r\n\r\n    /**\r\n     * Save size, position, font size and visibility of OSK\r\n     */\r\n    osk.saveCookie = function()\r\n    {\r\n      var c = util.loadCookie('KeymanWeb_OnScreenKeyboard');\r\n      var p=osk.getPos();\r\n\r\n      c['visible'] = osk._Enabled ? 1 : 0;\r\n      c['userSet'] = osk.userPositioned ? 1 : 0;\r\n      c['left'] = p.left; c['top'] = p.top;\r\n      if(osk._DivVKbd)\r\n      {\r\n        c['width'] = osk.width; c['height'] = osk.height;\r\n      }\r\n      util.saveCookie('KeymanWeb_OnScreenKeyboard',c);\r\n    }\r\n\r\n    /**\r\n     * Restore size, position, font size and visibility of desktop OSK\r\n     *\r\n     *  @return {boolean}\r\n     */\r\n    osk.loadCookie = function()\r\n    {\r\n      var c = util.loadCookie('KeymanWeb_OnScreenKeyboard');\r\n      if(typeof(c) == 'undefined' || c == null)\r\n      {\r\n        osk.userPositioned=false; return false;\r\n      }\r\n      osk._Enabled = util.toNumber(c['visible'],true);\r\n      osk.userPositioned = util.toNumber(c['userSet'],false);\r\n      osk.x = util.toNumber(c['left'],-1);\r\n      osk.y = util.toNumber(c['top'],-1);\r\n\r\n      // Restore OSK size - font size now fixed in relation to OSK height, unless overridden (in em) by keyboard\r\n      var dfltWidth=0.3*screen.width;\r\n      //if(util.toNumber(c['width'],0) == 0) dfltWidth=0.5*screen.width;\r\n      var newWidth=util.toNumber(c['width'],dfltWidth),\r\n          newHeight=util.toNumber(c['height'],0.15*screen.height);\r\n\r\n      // Limit the OSK dimensions to reasonable values\r\n      if(newWidth < 0.2*screen.width) newWidth = 0.2*screen.width;\r\n      if(newHeight < 0.1*screen.height) newHeight = 0.1*screen.height;\r\n      if(newWidth > 0.9*screen.width) newWidth=0.9*screen.width;\r\n      if(newHeight > 0.5*screen.height) newHeight=0.5*screen.height;\r\n\r\n      if(osk._DivVKbd)\r\n      {\r\n        osk._DivVKbd.style.width=newWidth+'px';\r\n        osk._DivVKbd.style.height=newHeight+'px';\r\n        osk._DivVKbd.style.fontSize=(newHeight/8)+'px';\r\n      }\r\n\r\n      // and OSK position if user located\r\n      if(osk.x == -1 || osk.y == -1 || (!osk._Box)) osk.userPositioned = false;\r\n\r\n      if(osk.x < window.pageXOffset-0.8*newWidth) osk.x=window.pageXOffset-0.8*newWidth;\r\n      if(osk.y < 0) {osk.x=-1; osk.y=-1; osk.userPositioned=false;}\r\n\r\n      if(osk.userPositioned && osk._Box) osk.setPos({'left':osk.x,'top':osk.y});\r\n\r\n      return true;\r\n    }\r\n\r\n    osk.getWidthFromCookie = function(): number {\r\n      var c = util.loadCookie('KeymanWeb_OnScreenKeyboard');\r\n      if(typeof(c) == 'undefined' || c == null) {\r\n        return screen.width * 0.3;\r\n      }\r\n\r\n      // Restore OSK size - font size now fixed in relation to OSK height, unless overridden (in em) by keyboard\r\n      var newWidth=util.toNumber(c['width'], 0.3 * screen.width); // Default - 30% of screen's width.\r\n\r\n      if(newWidth < 0.2*screen.width) {\r\n        newWidth = 0.2*screen.width;\r\n      } else if(newWidth > 0.9*screen.width) {\r\n        newWidth=0.9*screen.width;\r\n      }\r\n\r\n      return newWidth;\r\n    }\r\n\r\n    osk.getFontSizeFromCookie = function(): number {\r\n      var c = util.loadCookie('KeymanWeb_OnScreenKeyboard');\r\n      if(typeof(c) == 'undefined' || c == null) {\r\n        return 16;\r\n      }\r\n\r\n      var newHeight=util.toNumber(c['height'],0.15*screen.height);\r\n      if(newHeight > 0.5*screen.height) {\r\n        newHeight=0.5*screen.height;\r\n      }\r\n\r\n      return (newHeight/8);\r\n    }\r\n\r\n  })();\r\n\r\n}","// References the base KMW object.\r\n/// <reference path=\"kmwbase.ts\" />\r\n\r\nnamespace com.keyman {\r\n  class RotationState {\r\n    innerWidth: number;\r\n    innerHeight: number;\r\n\r\n    constructor() {\r\n      this.innerWidth = window.innerWidth;\r\n      this.innerHeight = window.innerHeight;\r\n    }\r\n\r\n    equals(other: RotationState) {\r\n      return this.innerWidth == other.innerWidth && this.innerHeight == other.innerHeight;\r\n    }\r\n  }\r\n\r\n  // Please reference /testing/rotation-events/index.html and update it as necessary when maintaining this class.\r\n  export class RotationManager {\r\n    private keyman: KeymanBase;\r\n\r\n    // State variables used by rotations.\r\n    private oskVisible: boolean;\r\n    private isActive: boolean;\r\n\r\n    // iOS-oriented members \r\n    // --------------------\r\n    // We'll assume permutations are complete after this many 'update' iterations.\r\n    private static readonly IDLE_PERMUTATION_CAP = 15;\r\n    // Tracks the number of idle 'update' iterations since the last permutation.\r\n    private idlePermutationCounter: number = RotationManager.IDLE_PERMUTATION_CAP;\r\n    // Tracks the most recent rotation state snapshot.\r\n    private rotState: RotationState;\r\n    // Tracks the window.setTimeout id for rotation update checks.\r\n    private updateTimer: number;\r\n    private static readonly UPDATE_INTERVAL = 20; // 20 ms, that is.\r\n    // --------------------\r\n    \r\n    constructor(keyman: KeymanBase) {\r\n      this.keyman = keyman;\r\n    }\r\n\r\n    resolve() {\r\n      this.keyman.alignInputs();\r\n\r\n      var osk = this.keyman.osk;\r\n      osk.hideLanguageList();\r\n      osk._Load();\r\n      if(this.oskVisible) {\r\n        osk._Show();\r\n      }\r\n\r\n      this.isActive = false;\r\n\r\n      // If we've been using an update interval loop, we should clear the state information.\r\n      if(this.updateTimer) {\r\n        window.clearInterval(this.updateTimer);\r\n        this.rotState = null;\r\n      }\r\n    }\r\n\r\n    // Used by both Android and iOS.\r\n    initNewRotation() {\r\n      this.oskVisible = this.keyman.osk.isVisible();\r\n      this.keyman.osk.hideNow();\r\n      this.isActive = true;\r\n    }\r\n\r\n    /**\r\n     * Establishes rotation-oriented event handling for native-mode KeymanWeb.  At this time, tablet PCs are not directly supported.\r\n     */\r\n    init() {\r\n      // If we're in embedded mode, we really should NOT run this method.\r\n      if(this.keyman.isEmbedded) {\r\n        return;\r\n      }\r\n\r\n      // Note:  we use wrapper functions instead of `.bind(this)` in this method to facilitate stubbing for our rotation test page.\r\n      var os = this.keyman.util.device.OS;\r\n      var util = this.keyman.util;\r\n\r\n      var rotationManager = this;\r\n\r\n      if(os == 'iOS') {\r\n      /* iOS is rather inconsistent about these events, with changes to important window state information -\r\n       * especially to `window.innerWidth` - possible after the events trigger!  They don't always trigger\r\n       * the same amount or in a consistently predictable manner.\r\n       * \r\n       * The overall idea is to wait out all those changes so that we don't produce a bad keyboard layout.\r\n       */\r\n        util.attachDOMEvent(window, 'orientationchange', function() {\r\n          rotationManager.iOSEventHandler();\r\n          return false;\r\n        });\r\n        util.attachDOMEvent(window, 'resize', function() {\r\n          rotationManager.iOSEventHandler();\r\n          return false;\r\n        });\r\n      } else if(os == 'Android') {\r\n        // Android's far more consistent with its event generation than iOS.\r\n        if('onmozorientationchange' in screen) {\r\n          util.attachDOMEvent(screen, 'mozorientationchange', function() {\r\n            rotationManager.initNewRotation();\r\n            return false;\r\n          });\r\n        } else {\r\n          util.attachDOMEvent(window, 'orientationchange', function() {\r\n            rotationManager.initNewRotation();\r\n            return false;\r\n          });\r\n        }\r\n\r\n        util.attachDOMEvent(window, 'resize', function() {\r\n          rotationManager.resolve();\r\n          return false;\r\n        });\r\n      }\r\n    }\r\n    \r\n    iOSEventHandler() {\r\n      if(!this.isActive) {\r\n        this.initNewRotation();\r\n        this.rotState = new RotationState();\r\n\r\n        this.updateTimer = window.setInterval(this.iOSEventUpdate.bind(this), RotationManager.UPDATE_INTERVAL);\r\n      }\r\n\r\n      // If one of the rotation-oriented events just triggered, we should ALWAYS reset the counter.\r\n      this.idlePermutationCounter = 0;\r\n    }\r\n\r\n    iOSEventUpdate() {\r\n      var newState = new RotationState();\r\n\r\n      if(this.rotState.equals(newState)) {\r\n        if(++this.idlePermutationCounter == RotationManager.IDLE_PERMUTATION_CAP) {\r\n          this.resolve();\r\n        }\r\n      } else {\r\n        this.rotState = newState;\r\n        this.idlePermutationCounter = 0;\r\n      }\r\n    }\r\n  }\r\n}","// Includes KMW string extension declarations.\r\n/// <reference path=\"kmwstring.ts\" />\r\n// Contains event management for mobile device rotation events.\r\n/// <reference path=\"kmwrotation.ts\" />\r\n\r\n/***\r\n   KeymanWeb 11.0\r\n   Copyright 2019 SIL International\r\n***/\r\n\r\n// If KMW is already initialized, the KMW script has been loaded more than once. We wish to prevent resetting the \r\n// KMW system, so we use the fact that 'initialized' is only 1 / true after all scripts are loaded for the initial\r\n// load of KMW.\r\nif(!window['keyman']['initialized']) { \r\n  /*****************************************/\r\n  /*                                       */\r\n  /*   On-Screen (Visual) Keyboard Code    */\r\n  /*                                       */\r\n  /*****************************************/\r\n  (function() {\r\n    // Declare KeymanWeb object\r\n    var keymanweb=window['keyman'],osk=keymanweb['osk'],util=keymanweb['util'],device=util.device;\r\n    var dbg=keymanweb.debug;\r\n\r\n    // Force full initialization\r\n    keymanweb.isEmbedded = false;\r\n\r\n    /**\r\n     * Set default device options\r\n     * @param {Object}  opt device options object\r\n     */\r\n    keymanweb.setDefaultDeviceOptions=function(opt) {\r\n      // Element attachment type\r\n      if(opt['attachType'] == '') opt['attachType'] = (device.touchable ? 'manual' : 'auto');\r\n    }\r\n\r\n  /**\r\n     * Customized wait display\r\n     * \r\n     * @param   {string|boolean}   s       displayed text (or false)\r\n     */\r\n    util.wait = function(s) {\r\n      // Keyboards loaded with page are initialized before the page is ready,\r\n      // so cannot use the wait indicater (and don't need it, anyway)\r\n      // Do not display if a blocking cloud server error has occurred (to prevent multiple errors)\r\n      var bg=this.waiting;\r\n      if(typeof(bg) == 'undefined' || bg == null || keymanweb.warned) {\r\n        return;\r\n      }\r\n      \r\n      var nn=bg.firstChild.childNodes;\r\n      if(s) {\r\n        bg.pending=true;\r\n        window.setTimeout(function() {\r\n            if(bg.pending) {\r\n              window.scrollTo(0,0);\r\n              nn[0].style.display='none';\r\n              nn[1].className='kmw-wait-text'; nn[1].innerHTML=s;\r\n              nn[2].style.display='block';\r\n              bg.style.display='block';\r\n            }\r\n          },1000);\r\n      } else {\r\n        if(bg.pending) {\r\n          nn[1].innerHTML='';\r\n          bg.pending=false; bg.style.display='none';\r\n        }\r\n      }\r\n    }\r\n      \r\n    // Get default style sheet path\r\n    keymanweb.getStyleSheetPath=function(ssName) {\r\n      var ssPath = util['getOption']('resources')+'osk/'+ssName;\r\n      return ssPath;\r\n    }\r\n\r\n    /**\r\n     * Get keyboard path (relative or absolute)\r\n     * KeymanWeb 2 revised keyboard location specification:\r\n     *  (a) absolute URL (includes ':') - load from specified URL\r\n     *  (b) relative URL (starts with /, ./, ../) - load with respect to current page\r\n     *  (c) filename only (anything else) - prepend keyboards option to URL \r\n     *      (e.g. default keyboards option will be set by Cloud)\r\n     *           \r\n     * @param {string}  Lfilename  keyboard file name with optional prefix                     \r\n     */   \r\n    keymanweb.getKeyboardPath=function(Lfilename) {           \r\n      var rx=RegExp('^(([\\\\.]/)|([\\\\.][\\\\.]/)|(/))|(:)');   \r\n      return (rx.test(Lfilename) ? '' : keymanweb.options['keyboards']) + Lfilename;\r\n    }\r\n    \r\n    /**\r\n     * Get (uncached) keyboard context for a specified range, relative to caret\r\n     * \r\n     * @param       {number}      n       Number of characters to move back from caret\r\n     * @param       {number}      ln      Number of characters to return\r\n     * @param       {Object}      Pelem   Element to work with (must be currently focused element)\r\n     * @return      {string}              Context string \r\n     * \r\n     * Example     [abcdef|ghi] as INPUT, with the caret position marked by |:\r\n     *             KC(2,1,Pelem) == \"e\"\r\n     *             KC(3,3,Pelem) == \"def\"\r\n     *             KC(10,10,Pelem) == \"XXXXabcdef\"  i.e. return as much as possible of the requested string, where X = \\uFFFE\r\n     */    \r\n    keymanweb.KC_ = function(n, ln, Pelem) {\r\n      var Ldv, tempContext = '';\r\n      if(Pelem.body) {\r\n        var Ldoc=Pelem; \r\n      } else {\r\n        var Ldoc=Pelem.ownerDocument; // I1481 - use Ldoc to get the ownerDocument when no selection is found\r\n      }\r\n\r\n      if(device.touchable) {\r\n        tempContext = keymanweb.touchAliasing.getTextBeforeCaret(Pelem);\r\n      } else if(Ldoc  &&  (Ldv=Ldoc.defaultView)  &&  Ldv.getSelection  &&\r\n        (Ldoc.designMode.toLowerCase() == 'on' || Pelem.contentEditable == 'true' || Pelem.contentEditable == 'plaintext-only' || Pelem.contentEditable === '')) {\r\n        // I2457 - support contentEditable elements in mozilla, webkit\r\n        /* Mozilla midas html editor and editable elements */\r\n        var Lsel = Ldv.getSelection();\r\n        if(Lsel.focusNode.nodeType == 3) {\r\n          tempContext = Lsel.focusNode.substringData(0, Lsel.focusOffset);\r\n        }\r\n      } else if (Pelem.setSelectionRange) {\r\n        /* Mozilla other controls */\r\n        var LselectionStart, LselectionEnd;\r\n        if(Pelem._KeymanWebSelectionStart) {\r\n          LselectionStart = Pelem._KeymanWebSelectionStart;\r\n          LselectionEnd = Pelem._KeymanWebSelectionEnd;\r\n          //KeymanWeb._Debug('KeymanWeb.KC: _KeymanWebSelectionStart=TRUE LselectionStart='+LselectionStart+'; LselectionEnd='+LselectionEnd);\r\n        } else {\r\n          if(keymanweb._CachedSelectionStart === null || Pelem.selectionStart !== keymanweb._LastCachedSelection) { // I3319, KMW-1\r\n            keymanweb._LastCachedSelection = Pelem.selectionStart; // KMW-1\r\n            keymanweb._CachedSelectionStart = Pelem.value._kmwCodeUnitToCodePoint(Pelem.selectionStart); // I3319\r\n            keymanweb._CachedSelectionEnd = Pelem.value._kmwCodeUnitToCodePoint(Pelem.selectionEnd);     // I3319\r\n          }\r\n          LselectionStart = keymanweb._CachedSelectionStart; // I3319\r\n          LselectionEnd = keymanweb._CachedSelectionEnd;     // I3319           \r\n        }\r\n        tempContext = Pelem.value._kmwSubstr(0, LselectionStart);\r\n      }\r\n\r\n      if(tempContext._kmwLength() < n) {\r\n        tempContext = Array(n-tempContext._kmwLength()+1).join(\"\\uFFFE\") + tempContext;\r\n      }\r\n      \r\n      return tempContext._kmwSubstr(-n)._kmwSubstr(0,ln);\r\n    }      \r\n\r\n    /**\r\n     * Align input fields (should not be needed with KMEI, KMEA), making them visible if previously hidden.\r\n     * \r\n     *  @param  {object}   eleList    A list of specific elements to align.  If nil, selects all elements.\r\n     * \r\n     **/\r\n    keymanweb.alignInputs = function(eleList: HTMLElement[]) {\r\n      if(device.touchable) {\r\n        var domManager = keymanweb.domManager;\r\n        var processList: HTMLElement[] = [];\r\n\r\n        if(eleList) {\r\n          // Did the user specify the actual element or the touch-alias?\r\n          eleList.forEach(function(element: HTMLElement){\r\n            if(element.base) {\r\n              // It's a touch-alias element, which is what we wish to perform alignment on.\r\n              processList.push(element);\r\n            } else {\r\n              // This retrieves an element's touch-alias, should it exist.\r\n              let touchAlias = element['kmw_ip'] as HTMLDivElement;\r\n              if(touchAlias) {\r\n                processList.push(element['kmw_ip']);\r\n              }\r\n            }\r\n          });\r\n        } else {\r\n          processList = domManager.inputList;\r\n        }\r\n\r\n        // Supported by IE 9 and all modern browsers.\r\n        processList.forEach(function(element: HTMLElement) {\r\n          domManager.touchHandlers.updateInput(element);\r\n          element.style.visibility = 'visible';\r\n          if(element.base.textContent.length > 0) {\r\n            element.base.style.visibility = 'hidden';\r\n          }\r\n        })      \r\n      }\r\n    }\r\n\r\n    /**\r\n     * Programatically hides all input fields with underlying elements.  Restore with .alignInputs.    \r\n     * \r\n     *  @param  {boolean}   align    align and make visible, else hide\r\n     * \r\n     **/\r\n    keymanweb.hideInputs = function() {\r\n      var domManager = keymanweb.domManager;\r\n      if(device.touchable) {\r\n        for(var i=0; i<domManager.inputList.length; i++) {\r\n          domManager.inputList[i].style.visibility='hidden';\r\n          domManager.inputList[i].base.style.visibility='visible';\r\n        }        \r\n      }\r\n    }\r\n\r\n    /**\r\n     * Test if caret position is determined from the active element, or \r\n     * from the synthesized overlay element (touch devices)\r\n     * \r\n     * @return  {boolean}\r\n     **/          \r\n    keymanweb.isPositionSynthesized = function() {\r\n      return device.touchable;\r\n    }\r\n\r\n    // Manage popup key highlighting \r\n    osk.highlightSubKeys=function(k,x,y)\r\n    {      \r\n      // Test for subkey array, return if none\r\n      if(k == null || k.subKeys == null) return;\r\n\r\n      // Highlight key at touch position (and clear other highlighting) \r\n      var i,sk,x0,y0,x1,y1,onKey,skBox=document.getElementById('kmw-popup-keys');\r\n\r\n      // Show popup keys immediately if touch moved up towards key array (KMEW-100, Build 353)\r\n      if((osk.touchY-y > 5) && skBox == null)\r\n      {\r\n        if(osk.subkeyDelayTimer) window.clearTimeout(osk.subkeyDelayTimer);\r\n        osk.showSubKeys(k); skBox=document.getElementById('kmw-popup-keys');\r\n      } \r\n          \r\n      for(i=0; i<k.subKeys.length; i++)\r\n      {\r\n        try \r\n        {\r\n          sk=skBox.childNodes[i].firstChild;\r\n          x0=util._GetAbsoluteX(sk); y0=util._GetAbsoluteY(sk);//-document.body.scrollTop;\r\n          x1=x0+sk.offsetWidth; y1=y0+sk.offsetHeight;\r\n          onKey=(x > x0 && x < x1 && y > y0 && y < y1);\r\n          osk.highlightKey(sk,onKey);\r\n          if(onKey) osk.highlightKey(k,false);\r\n        } catch(ex){}           \r\n      }    \r\n    }\r\n    \r\n    osk.optionKey=function(e,keyName,keyDown)\r\n    {       \r\n      if(keyDown) \r\n      {\r\n        if(keyName.indexOf('K_LOPT') >= 0) osk.showLanguageMenu();\r\n        else if(keyName.indexOf('K_ROPT') >= 0)\r\n        {\r\n          keymanweb.uiManager.setActivatingUI(false);\r\n          osk._Hide(true); \r\n          keymanweb.touchAliasing.hideCaret();\r\n          keymanweb.domManager.clearLastActiveElement();\r\n        }\r\n      }\r\n    }\r\n\r\n    /** \r\n     *  Create a key preview element for phone devices\r\n     */    \r\n    osk.createKeyTip=function()\r\n    { \r\n      if(device.formFactor == 'phone')\r\n      {\r\n        if(osk.keytip == null)\r\n        {  \r\n          osk.keytip=(<Util>util)._CreateElement('div'); \r\n          osk.keytip.className='kmw-keytip';\r\n          osk.keytip.id = 'kmw-keytip';\r\n          \r\n          // The following style is critical, so do not rely on external CSS\r\n          osk.keytip.style.pointerEvents='none'; \r\n          \r\n          // Add CANVAS element for outline and SPAN for key label\r\n          osk.keytip.appendChild((<Util>util)._CreateElement('canvas'));\r\n          osk.keytip.appendChild((<Util>util)._CreateElement('span'));   \r\n          osk.keytip.key = null;\r\n          osk.keytip.state = false;     \r\n        }\r\n        \r\n        // Always append to _Box (since cleared during OSK Load) \r\n        osk._Box.appendChild(osk.keytip);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Add (or remove) the keytip preview (if KeymanWeb on a phone device)\r\n     * \r\n     * @param   {Object}  key   HTML key element\r\n     * @param   {boolean} on    show or hide\r\n     */              \r\n    osk.showKeyTip=function(key,on) \r\n    { \r\n      var tip=osk.keytip;\r\n\r\n      // Do not change the key preview unless key or state has changed\r\n      if(tip == null || (key == tip.key && on == tip.state)) return;  \r\n\r\n      var sk=document.getElementById('kmw-popup-keys'),\r\n          popup = (sk && sk.style.visibility == 'visible')\r\n\r\n      // Create and display the preview\r\n      if(on && !popup)\r\n      {                                                       \r\n        var y0 = util._GetAbsoluteY(osk._Box),\r\n            h0 = osk._Box.offsetHeight,  \r\n            xLeft = util._GetAbsoluteX(key),\r\n            xTop = util._GetAbsoluteY(key),\r\n            xWidth = key.offsetWidth,\r\n            xHeight = key.offsetHeight,\r\n            kc = key.firstChild,\r\n            kcs = kc.style, \r\n            kts = tip.style, \r\n            ktLabel = tip.childNodes[1],\r\n            ktls = ktLabel.style,\r\n            edge = 0,\r\n            canvas = tip.firstChild, \r\n            previewFontScale = 1.8;\r\n            \r\n        // Find key text element\r\n        for(var i=0; i<key.childNodes.length; i++)\r\n        {\r\n          kc = key.childNodes[i];\r\n          if(osk.hasClass(kc,'kmw-key-text')) break;    \r\n        }\r\n        \r\n        // Canvas dimensions must be set explicitly to prevent clipping\r\n        canvas.width = 1.6 * xWidth;\r\n        canvas.height = 2.3 * xHeight;\r\n  \r\n        kts.top = 'auto';\r\n        kts.bottom = (y0 + h0 - xTop - xHeight)+'px';\r\n        kts.textAlign = 'center';   kts.overflow = 'visible';\r\n        kts.fontFamily = util.getStyleValue(kc,'font-family');\r\n        kts.width = canvas.width+'px';\r\n        kts.height = canvas.height+'px';\r\n\r\n        var px=util.getStyleInt(kc,'font-size');\r\n        if(px != 0) {\r\n          let popupFS = previewFontScale * px;\r\n          kts.fontSize = popupFS + 'px';\r\n\r\n          let textWidth = com.keyman.OSKKey.getTextWidth(ktLabel.textContent, kts);\r\n          // We use a factor of 0.9 to serve as a buffer in case of mild measurement error.\r\n          let proportion = canvas.width * 0.9 / (textWidth);\r\n\r\n          // Prevent the preview from overrunning its display area.\r\n          if(proportion < 1) {\r\n            kts.fontSize = (popupFS * proportion) + 'px';\r\n          }\r\n        }\r\n        \r\n        ktLabel.textContent = kc.textContent;\r\n        ktls.display = 'block';\r\n        ktls.position = 'absolute';\r\n        ktls.textAlign = 'center';\r\n        ktls.width='100%';\r\n        ktls.top = '2%';\r\n        ktls.bottom = 'auto';\r\n        \r\n        // Adjust canvas shape if at edges\r\n        var xOverflow = (canvas.width - xWidth) / 2;\r\n        if(xLeft < xOverflow)\r\n        {\r\n          edge = -1; xLeft += xOverflow;\r\n        }\r\n        else if(xLeft > window.innerWidth - xWidth - xOverflow)\r\n        {\r\n          edge = 1; xLeft -= xOverflow \r\n        }\r\n\r\n        osk.drawPreview(canvas, xWidth, xHeight, edge);\r\n                  \r\n        kts.left=(xLeft - xOverflow)+'px';\r\n        kts.display = 'block';        \r\n      }\r\n      \r\n      // Hide the key preview\r\n      else\r\n      {        \r\n        tip.style.display = 'none';\r\n      }\r\n      \r\n      // Save the key preview state\r\n      tip.key = key; tip.state = on;\r\n    }\r\n\r\n    /**\r\n     * Draw key preview in element using CANVAS\r\n     *  @param  {Object}  canvas CANVAS element \r\n     *  @param  {number}  w width of touched key, px\r\n     *  @param  {number}  h height of touched key, px      \r\n     *  @param  {number}  edge  -1 left edge, 1 right edge, else 0     \r\n     */\r\n    osk.drawPreview = function(canvas,w,h,edge)\r\n    {\r\n      var ctx = canvas.getContext('2d'), dx = (canvas.width - w)/2, hMax = canvas.height,\r\n          w0 = 0, w1 = dx, w2 = w + dx, w3 = w + 2 * dx, \r\n          h1 = 0.5 * hMax, h2 = 0.6 * hMax, h3 = hMax, r = 8; \r\n      \r\n      if(device.OS == 'Android') \r\n      {\r\n        r = 3;\r\n      }\r\n      \r\n      // Adjust the preview shape at the edge of the keyboard\r\n      switch(edge)\r\n      {\r\n        case -1:\r\n          w1 -= dx; w2 -= dx;\r\n          break;\r\n        case 1:\r\n          w1 += dx; w2 += dx;\r\n          break;\r\n      }\r\n      \r\n      // Clear the canvas\r\n      ctx.clearRect(0,0,canvas.width,canvas.height);     \r\n\r\n      // Define appearance of preview (cannot be done directly in CSS)\r\n      if(device.OS == 'Android') \r\n      {\r\n        var wx=(w1+w2)/2; \r\n        w1 = w2 = wx;    \r\n        ctx.fillStyle = '#999';\r\n      }\r\n      else\r\n      {\r\n        ctx.fillStyle = '#ffffff';\r\n      }  \r\n      ctx.lineWidth = '1';\r\n      ctx.strokeStyle = '#cccccc';\r\n\r\n      // Draw outline\r\n      ctx.save();\r\n      ctx.beginPath();\r\n      ctx.moveTo(w0+r,0);\r\n      ctx.arcTo(w3,0,w3,r,r);\r\n      if(device.OS == 'Android')\r\n      {    \r\n        ctx.arcTo(w3,h1,w2,h2,r);\r\n        ctx.arcTo(w2,h2,w1,h2,r);\r\n        ctx.arcTo(w1,h2,w0,h1-r,r);\r\n      }\r\n      else\r\n      {\r\n        ctx.arcTo(w3,h1,w2,h2,r);\r\n        ctx.arcTo(w2,h2,w2-r,h3,r);\r\n        ctx.arcTo(w2,h3,w1,h3,r);\r\n        ctx.arcTo(w1,h3,w1,h2-r,r);\r\n        ctx.arcTo(w1,h2,w0,h1-r,r);\r\n      }\r\n      ctx.arcTo(w0,h1,w0,r,r);\r\n      ctx.arcTo(w0,0,w0+r,0,r);\r\n      ctx.fill();\r\n      ctx.stroke();\r\n      ctx.restore();  \r\n    }\r\n    \r\n    /**\r\n     * Add a callout for popup keys (if KeymanWeb on a phone device)\r\n     * \r\n     * @param   {Object}  key   HTML key element\r\n     * @return  {Object}        callout object   \r\n     */              \r\n    osk.addCallout = function(key) \r\n    {   \r\n      if(device.formFactor != 'phone' || device.OS != 'iOS') return null;\r\n        \r\n      var cc = (<Util>util)._CreateElement('div'),ccs = cc.style;\r\n      cc.id = 'kmw-popup-callout';\r\n      osk._Box.appendChild(cc);\r\n      \r\n      // Create the callout\r\n      var xLeft = key.offsetLeft,\r\n          xTop = key.offsetTop,\r\n          xWidth = key.offsetWidth,\r\n          xHeight = key.offsetHeight;\r\n\r\n      // Set position and style \r\n      ccs.top = (xTop-6)+'px'; ccs.left = xLeft+'px'; \r\n      ccs.width = xWidth+'px'; ccs.height = (xHeight+6)+'px';\r\n      \r\n      // Return callout element, to allow removal later\r\n      return cc;  \r\n    }\r\n    \r\n    /**\r\n     * Touch hold key display management\r\n     * \r\n     * @param   {Object}  key   base key object\r\n     */\r\n    osk.touchHold = function(key)\r\n    {\r\n    // Clear and restart the popup timer\r\n      if(osk.subkeyDelayTimer) \r\n      {\r\n        window.clearTimeout(osk.subkeyDelayTimer);\r\n        osk.subkeyDelayTimer = null;\r\n      }    \r\n      if(typeof key.subKeys != 'undefined' && key.subKeys != null) \r\n      {\r\n        osk.subkeyDelayTimer = window.setTimeout(\r\n          function()\r\n          {\r\n            osk.clearPopup();\r\n            osk.showSubKeys(key);\r\n          }, \r\n          osk.popupDelay\r\n        );\r\n      }                                            \r\n    }\r\n\r\n    /**\r\n     * Use rotation events to adjust OSK and input element positions and scaling as necessary\r\n     */     \r\n    keymanweb.handleRotationEvents=function() {\r\n      var rotationManager = new com.keyman.RotationManager(keymanweb);\r\n\r\n      rotationManager.init();\r\n    }\r\n\r\n    /**\r\n     * Possible way to detect the start of a rotation and hide the OSK before it is adjusted in size\r\n     * \r\n     *  @param  {Object}    e   accelerometer rotation event      \r\n     *      \r\n    keymanweb.testRotation = function(e)\r\n    {\r\n      var r=e.rotationRate;\r\n      if(typeof(r) != 'undefined')\r\n      {\r\n        dbg(r.alpha+' '+r.beta+' '+r.gamma);\r\n      }\r\n    }\r\n    */ \r\n\r\n    /**\r\n     * Wait until font is loaded before applying stylesheet - test each 100 ms\r\n     * @param   {Object}  kfd   main font descriptor\r\n     * @param   {Object}  ofd   secondary font descriptor (OSK only)\r\n     * @return  {boolean}\r\n     */       \r\n    osk.waitForFonts=function(kfd,ofd)\r\n    {\r\n      if(typeof(kfd) == 'undefined' && typeof(ofd) == 'undefined') return true;\r\n      \r\n      if(typeof(kfd['files']) == 'undefined' && typeof(ofd['files']) == 'undefined') return true;\r\n\r\n\r\n      var kReady=util.checkFontDescriptor(kfd),oReady=util.checkFontDescriptor(ofd); \r\n      if(kReady && oReady) return true;\r\n\r\n      keymanweb.fontCheckTimer=window.setInterval(function()\r\n      {        \r\n        if(util.checkFontDescriptor(kfd) && util.checkFontDescriptor(ofd))\r\n        {\r\n          window.clearInterval(keymanweb.fontCheckTimer);\r\n          keymanweb.fontCheckTimer=null;\r\n          keymanweb.alignInputs();    \r\n        }    \r\n      },100);\r\n      \r\n      // Align anyway as best as can if font appears to remain uninstalled after 5 seconds   \r\n      window.setTimeout(function()\r\n      {\r\n        if(keymanweb.fontCheckTimer)\r\n        {\r\n          window.clearInterval(keymanweb.fontCheckTimer);\r\n          keymanweb.fontCheckTimer=null;\r\n          keymanweb.alignInputs();\r\n          // Don't notify - this is a management issue, not anything the user needs to deal with\r\n          // TODO: Consider having an icon in the OSK with a bubble that indicates missing font\r\n          //util.alert('Unable to download the font normally used with '+ks['KN']+'.');\r\n        }\r\n      },5000);\r\n      return false;\r\n    }\r\n\r\n\r\n\r\n  })();\r\n}","/***\r\n   KeymanWeb 11.0\r\n   Copyright 2019 SIL International\r\n***/\r\nif (!window['keyman']['initialized']) {\r\n    window['keyman']['dfltLayout'] = {\r\n        \"desktop\":\r\n        {\r\n            \"font\": \"Tahoma,Helvetica\",\r\n            \"layer\": [\r\n                {\r\n                    \"id\": \"default\",\r\n                    \"row\": [\r\n                        {\r\n                            \"id\": \"1\",\r\n                            \"key\": [\r\n                                { \"id\": \"K_BKQUOTE\" },\r\n                                { \"id\": \"K_1\" },\r\n                                { \"id\": \"K_2\" },\r\n                                { \"id\": \"K_3\" },\r\n                                { \"id\": \"K_4\" },\r\n                                { \"id\": \"K_5\" },\r\n                                { \"id\": \"K_6\" },\r\n                                { \"id\": \"K_7\" },\r\n                                { \"id\": \"K_8\" },\r\n                                { \"id\": \"K_9\" },\r\n                                { \"id\": \"K_0\" },\r\n                                { \"id\": \"K_HYPHEN\" },\r\n                                { \"id\": \"K_EQUAL\" },\r\n                                { \"id\": \"K_BKSP\", \"text\": \"*BkSp*\", \"sp\": \"1\", \"width\": \"130\" }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"id\": \"2\",\r\n                            \"key\": [\r\n                                { \"id\": \"K_TAB\", \"text\": \"*Tab*\", \"sp\": \"1\", \"width\": \"130\" },\r\n                                { \"id\": \"K_Q\" },\r\n                                { \"id\": \"K_W\" },\r\n                                { \"id\": \"K_E\" },\r\n                                { \"id\": \"K_R\" },\r\n                                { \"id\": \"K_T\" },\r\n                                { \"id\": \"K_Y\" },\r\n                                { \"id\": \"K_U\" },\r\n                                { \"id\": \"K_I\" },\r\n                                { \"id\": \"K_O\" },\r\n                                { \"id\": \"K_P\" },\r\n                                { \"id\": \"K_LBRKT\" },\r\n                                { \"id\": \"K_RBRKT\" },\r\n                                { \"id\": \"K_BKSLASH\" }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"id\": \"3\",\r\n                            \"key\": [\r\n                                { \"id\": \"K_CAPS\", \"text\": \"*Caps*\", \"sp\": \"1\", \"width\": \"165\" },\r\n                                { \"id\": \"K_A\" },\r\n                                { \"id\": \"K_S\" },\r\n                                { \"id\": \"K_D\" },\r\n                                { \"id\": \"K_F\" },\r\n                                { \"id\": \"K_G\" },\r\n                                { \"id\": \"K_H\" },\r\n                                { \"id\": \"K_J\" },\r\n                                { \"id\": \"K_K\" },\r\n                                { \"id\": \"K_L\" },\r\n                                { \"id\": \"K_COLON\" },\r\n                                { \"id\": \"K_QUOTE\" },\r\n                                { \"id\": \"K_ENTER\", \"text\": \"*Enter*\", \"sp\": \"1\", \"width\": \"165\" }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"id\": \"4\",\r\n                            \"key\": [\r\n                                { \"id\": \"K_SHIFT\", \"text\": \"*Shift*\", \"sp\": \"1\", \"width\": \"130\" },\r\n                                { \"id\": \"K_oE2\" },\r\n                                { \"id\": \"K_Z\" },\r\n                                { \"id\": \"K_X\" },\r\n                                { \"id\": \"K_C\" },\r\n                                { \"id\": \"K_V\" },\r\n                                { \"id\": \"K_B\" },\r\n                                { \"id\": \"K_N\" },\r\n                                { \"id\": \"K_M\" },\r\n                                { \"id\": \"K_COMMA\" },\r\n                                { \"id\": \"K_PERIOD\" },\r\n                                { \"id\": \"K_SLASH\" },\r\n                                { \"id\": \"K_RSHIFT\", \"text\": \"*Shift*\", \"sp\": \"1\", \"width\": \"130\" }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"id\": \"5\",\r\n                            \"key\": [\r\n                                { \"id\": \"K_LCONTROL\", \"text\": \"*Ctrl*\", \"sp\": \"1\", \"width\": \"170\" },\r\n                                { \"id\": \"K_LALT\", \"text\": \"*Alt*\", \"sp\": \"1\", \"width\": \"160\" },\r\n                                { \"id\": \"K_SPACE\", \"text\": \"\", \"width\": \"770\" },\r\n                                { \"id\": \"K_RALT\", \"text\": \"*Alt*\", \"sp\": \"1\", \"width\": \"160\" },\r\n                                { \"id\": \"K_RCONTROL\", \"text\": \"*Ctrl*\", \"sp\": \"1\", \"width\": \"170\" }\r\n                            ]\r\n                        }\r\n                    ]\r\n                }\r\n            ]\r\n        },\r\n        \"tablet\":\r\n        {\r\n            \"font\": \"Tahoma,Helvetica\",\r\n            \"layer\": [\r\n                {\r\n                    \"id\": \"default\",\r\n                    \"row\": [\r\n                        {\r\n                            \"id\": \"0\",\r\n                            \"key\": [\r\n                                { \"id\": \"K_1\" },\r\n                                { \"id\": \"K_2\" },\r\n                                { \"id\": \"K_3\" },\r\n                                { \"id\": \"K_4\" },\r\n                                { \"id\": \"K_5\" },\r\n                                { \"id\": \"K_6\" },\r\n                                { \"id\": \"K_7\" },\r\n                                { \"id\": \"K_8\" },\r\n                                { \"id\": \"K_9\" },\r\n                                { \"id\": \"K_0\" },\r\n                                { \"id\": \"K_HYPHEN\" },\r\n                                { \"id\": \"K_EQUAL\" },\r\n                                { \"sp\": \"10\", \"width\": \"1\" }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"id\": \"1\",\r\n                            \"key\": [\r\n                                { \"id\": \"K_Q\", \"pad\": \"25\" },\r\n                                { \"id\": \"K_W\" },\r\n                                { \"id\": \"K_E\" },\r\n                                { \"id\": \"K_R\" },\r\n                                { \"id\": \"K_T\" },\r\n                                { \"id\": \"K_Y\" },\r\n                                { \"id\": \"K_U\" },\r\n                                { \"id\": \"K_I\" },\r\n                                { \"id\": \"K_O\" },\r\n                                { \"id\": \"K_P\" },\r\n                                { \"id\": \"K_LBRKT\" },\r\n                                { \"id\": \"K_RBRKT\" },\r\n                                { \"sp\": \"10\", \"width\": \"1\" }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"id\": \"2\",\r\n                            \"key\": [\r\n                                { \"id\": \"K_A\", \"pad\": \"50\" },\r\n                                { \"id\": \"K_S\" },\r\n                                { \"id\": \"K_D\" },\r\n                                { \"id\": \"K_F\" },\r\n                                { \"id\": \"K_G\" },\r\n                                { \"id\": \"K_H\" },\r\n                                { \"id\": \"K_J\" },\r\n                                { \"id\": \"K_K\" },\r\n                                { \"id\": \"K_L\" },\r\n                                { \"id\": \"K_COLON\" },\r\n                                { \"id\": \"K_QUOTE\" },\r\n                                { \"id\": \"K_BKSLASH\", \"width\": \"90\" }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"id\": \"3\",\r\n                            \"key\": [\r\n                                { \"id\": \"K_oE2\", \"width\": \"90\" },\r\n                                { \"id\": \"K_Z\" },\r\n                                { \"id\": \"K_X\" },\r\n                                { \"id\": \"K_C\" },\r\n                                { \"id\": \"K_V\" },\r\n                                { \"id\": \"K_B\" },\r\n                                { \"id\": \"K_N\" },\r\n                                { \"id\": \"K_M\" },\r\n                                { \"id\": \"K_COMMA\" },\r\n                                { \"id\": \"K_PERIOD\" },\r\n                                { \"id\": \"K_SLASH\" },\r\n                                { \"id\": \"K_BKQUOTE\" },\r\n                                { \"sp\": \"10\", \"width\": \"1\" }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"id\": \"4\",\r\n                            \"key\": [\r\n                                {\r\n                                    \"id\": \"K_SHIFT\", \"text\": \"*Shift*\", \"sp\": \"1\", \"width\": \"200\", \"sk\": [\r\n                                        { \"id\": \"K_LCONTROL\", \"text\": \"*Ctrl*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"ctrl\" },\r\n                                        { \"id\": \"K_LCONTROL\", \"text\": \"*LCtrl*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"leftctrl\" },\r\n                                        { \"id\": \"K_RCONTROL\", \"text\": \"*RCtrl*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"rightctrl\" },\r\n                                        { \"id\": \"K_LALT\", \"text\": \"*Alt*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"alt\" },\r\n                                        { \"id\": \"K_LALT\", \"text\": \"*LAlt*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"leftalt\" },\r\n                                        { \"id\": \"K_RALT\", \"text\": \"*RAlt*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"rightalt\" },\r\n                                        { \"id\": \"K_ALTGR\", \"text\": \"*AltGr*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"ctrl-alt\" }]\r\n                                },\r\n                                { \"id\": \"K_LOPT\", \"text\": \"*Menu*\", \"sp\": \"1\", \"width\": \"150\" },\r\n                                { \"id\": \"K_SPACE\", \"text\": \"\", \"width\": \"570\" },\r\n                                { \"id\": \"K_BKSP\", \"text\": \"*BkSp*\", \"sp\": \"1\", \"width\": \"150\" },\r\n                                { \"id\": \"K_ENTER\", \"text\": \"*Enter*\", \"sp\": \"1\", \"width\": \"200\" }\r\n                            ]\r\n                        }\r\n                    ]\r\n                }\r\n            ]\r\n        },\r\n        \"phone\":\r\n        {\r\n            \"font\": \"Tahoma,Helvetica\",\r\n            \"layer\": [\r\n                {\r\n                    \"id\": \"default\",\r\n                    \"row\": [\r\n                        {\r\n                            \"id\": \"0\",\r\n                            \"key\": [\r\n                                { \"id\": \"K_1\" },\r\n                                { \"id\": \"K_2\" },\r\n                                { \"id\": \"K_3\" },\r\n                                { \"id\": \"K_4\" },\r\n                                { \"id\": \"K_5\" },\r\n                                { \"id\": \"K_6\" },\r\n                                { \"id\": \"K_7\" },\r\n                                { \"id\": \"K_8\" },\r\n                                { \"id\": \"K_9\" },\r\n                                { \"id\": \"K_0\" },\r\n                                { \"id\": \"K_HYPHEN\" },\r\n                                { \"id\": \"K_EQUAL\" },\r\n                                { \"sp\": \"10\", \"width\": \"1\" }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"id\": \"1\",\r\n                            \"key\": [\r\n                                { \"id\": \"K_Q\", \"pad\": \"25\" },\r\n                                { \"id\": \"K_W\" },\r\n                                { \"id\": \"K_E\" },\r\n                                { \"id\": \"K_R\" },\r\n                                { \"id\": \"K_T\" },\r\n                                { \"id\": \"K_Y\" },\r\n                                { \"id\": \"K_U\" },\r\n                                { \"id\": \"K_I\" },\r\n                                { \"id\": \"K_O\" },\r\n                                { \"id\": \"K_P\" },\r\n                                { \"id\": \"K_LBRKT\" },\r\n                                { \"id\": \"K_RBRKT\" },\r\n                                { \"sp\": \"10\", \"width\": \"1\" }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"id\": \"2\",\r\n                            \"key\": [\r\n                                { \"id\": \"K_A\", \"pad\": \"50\" },\r\n                                { \"id\": \"K_S\" },\r\n                                { \"id\": \"K_D\" },\r\n                                { \"id\": \"K_F\" },\r\n                                { \"id\": \"K_G\" },\r\n                                { \"id\": \"K_H\" },\r\n                                { \"id\": \"K_J\" },\r\n                                { \"id\": \"K_K\" },\r\n                                { \"id\": \"K_L\" },\r\n                                { \"id\": \"K_COLON\" },\r\n                                { \"id\": \"K_QUOTE\" },\r\n                                { \"id\": \"K_BKSLASH\", \"width\": \"90\" }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"id\": \"3\",\r\n                            \"key\": [\r\n                                { \"id\": \"K_oE2\", \"width\": \"90\" },\r\n                                { \"id\": \"K_Z\" },\r\n                                { \"id\": \"K_X\" },\r\n                                { \"id\": \"K_C\" },\r\n                                { \"id\": \"K_V\" },\r\n                                { \"id\": \"K_B\" },\r\n                                { \"id\": \"K_N\" },\r\n                                { \"id\": \"K_M\" },\r\n                                { \"id\": \"K_COMMA\" },\r\n                                { \"id\": \"K_PERIOD\" },\r\n                                { \"id\": \"K_SLASH\" },\r\n                                { \"id\": \"K_BKQUOTE\" },\r\n                                { \"sp\": \"10\", \"width\": \"1\" }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"id\": \"4\",\r\n                            \"key\": [\r\n                                {\r\n                                    \"id\": \"K_SHIFT\", \"text\": \"*Shift*\", \"sp\": \"1\", \"width\": \"200\", \"sk\": [\r\n                                        { \"id\": \"K_LCONTROL\", \"text\": \"*Ctrl*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"ctrl\" },\r\n                                        { \"id\": \"K_LCONTROL\", \"text\": \"*LCtrl*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"leftctrl\" },\r\n                                        { \"id\": \"K_RCONTROL\", \"text\": \"*RCtrl*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"rightctrl\" },\r\n                                        { \"id\": \"K_LALT\", \"text\": \"*Alt*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"alt\" },\r\n                                        { \"id\": \"K_LALT\", \"text\": \"*LAlt*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"leftalt\" },\r\n                                        { \"id\": \"K_RALT\", \"text\": \"*RAlt*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"rightalt\" },\r\n                                        { \"id\": \"K_ALTGR\", \"text\": \"*AltGr*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"ctrl-alt\" }]\r\n                                },\r\n                                { \"id\": \"K_LOPT\", \"text\": \"*Menu*\", \"width\": \"150\", \"sp\": \"1\" },\r\n                                { \"id\": \"K_SPACE\", \"width\": \"570\", \"text\": \"\" },\r\n                                { \"id\": \"K_BKSP\", \"text\": \"*BkSp*\", \"width\": \"150\", \"sp\": \"1\" },\r\n                                { \"id\": \"K_ENTER\", \"text\": \"*Enter*\", \"width\": \"200\", \"sp\": \"1\" }\r\n                            ]\r\n                        }\r\n                    ]\r\n                }\r\n            ]\r\n        }\r\n    };\r\n}\r\n","/***\r\n   KeymanWeb 11.0\r\n   Copyright 2019 SIL International\r\n***/\r\n\r\n/********************************************************/\r\n/*                                                      */\r\n/* Automatically initialize keymanweb with defaults     */ \r\n/* after the page is fully loaded                       */ \r\n/*                                                      */\r\n/********************************************************/\r\n\r\n(function() {\r\n  // Declare KeymanWeb object\r\n  var keymanweb=window['keyman'];\r\n\r\n  // We don't want to instantly init() in case this code is used via bookmarklet.\r\n  var readyStateCheckInterval = window.setInterval(function() {\r\n    if (document.readyState === \"complete\") {\r\n      window.clearInterval(readyStateCheckInterval);\r\n      keymanweb.init(null);\r\n    }\r\n  }, 10);\r\n  \r\n})();\r\n","/* Prevents the unneeded deps.js SCRIPT auto-inject when doing uncompiled tests.\r\n\r\n * Because of how TypeScript's <reference/> tag works, this must be in its own file and declared above \r\n * goog/base.js in order to prevent unfortunate side-effects from occuring.  We don't need the functionality\r\n * that the Closure library tries to import otherwise.\r\n */\r\n\r\ndeclare var CLOSURE_NO_DEPS: boolean;\r\nvar CLOSURE_NO_DEPS = true;","/// <reference path=\"closure.ts\" />\r\n/// <reference path=\"kmwbase.ts\" />\r\n/// <reference path=\"kmwutils.ts\" />\r\n/// <reference path=\"kmwcallback.ts\" />\r\n\r\n/**\r\n * This file generates aliases linking renamed functions to some of our published developer API for KMW.\r\n * This won't enable Closure to do \"advanced minification\", but it's useful for ensuring we don't break\r\n * things people depended on in legacy versions.\r\n */\r\n\r\n// Util.ts\r\n(function() {\r\n  let prototype = com.keyman.Util.prototype;\r\n\r\n  var publishAPI = function(miniName: string, longName: string) {\r\n    prototype[miniName] = prototype[longName];\r\n  }\r\n\r\n  publishAPI('getAbsoluteX', \"_GetAbsoluteX\");\r\n  publishAPI(\"getAbsoluteY\", \"_GetAbsoluteY\");\r\n  publishAPI(\"getAbsolute\", \"_GetAbsolute\");\r\n  publishAPI(\"toNzString\", \"nzString\");\r\n}());\r\n\r\n// Keyboard callbacks\r\n(function() {\r\n  let prototype = com.keyman.KeyboardInterface.prototype;\r\n\r\n  var exportKBCallback = function(miniName: string, longName: string) {\r\n    prototype[miniName] = prototype[longName];\r\n  }\r\n\r\n  exportKBCallback('KSF', 'saveFocus');\r\n  exportKBCallback('KBR', 'beepReset');\r\n  exportKBCallback('KT', 'insertText');\r\n  exportKBCallback('KR', 'registerKeyboard');\r\n  exportKBCallback('KRS', 'registerStub');\r\n  exportKBCallback('KC', 'context');\r\n  exportKBCallback('KN', 'nul');\r\n  exportKBCallback('KCM', 'contextMatch');\r\n  exportKBCallback('KFCM', 'fullContextMatch');\r\n  exportKBCallback('KIK', 'isKeypress');\r\n  exportKBCallback('KKM', 'keyMatch');\r\n  exportKBCallback('KSM', 'stateMatch');\r\n  exportKBCallback('KKI', 'keyInformation');\r\n  exportKBCallback('KDM', 'deadkeyMatch');\r\n  exportKBCallback('KB', 'beep');\r\n  exportKBCallback('KA', 'any');\r\n  exportKBCallback('KDC', 'deleteContext');\r\n  exportKBCallback('KO', 'output');\r\n  exportKBCallback('KDO', 'deadkeyOutput');\r\n  exportKBCallback('KIO', 'indexOutput');\r\n  exportKBCallback('KIFS', 'ifStore');\r\n  exportKBCallback('KSETS', 'setStore');\r\n  exportKBCallback('KLOAD', 'loadStore');\r\n  exportKBCallback('KSAVE', 'saveStore');\r\n}());"]}