{"version":3,"file":"kmwuitoggle.js","sourceRoot":"","sources":["../source/kmwuitoggle.ts"],"names":[],"mappings":"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","sourcesContent":["/// <reference path=\"kmwexthtml.ts\" />  // Includes KMW-added property declaration extensions for HTML elements.\r\n\r\n/***\r\n   KeymanWeb 11.0\r\n   Copyright 2019 SIL International\r\n***/\r\n\r\n// If a UI module has been loaded, we can rely on the publically-published 'name' property\r\n// having been set as a way to short-out a UI reload.  Its parent object always exists by\r\n// this point in the build process.\r\nif(!window['keyman']['ui']['name']) { \r\n  /********************************/\r\n  /*                              */\r\n  /* Toggle User Interface Code   */\r\n  /*                              */\r\n  /********************************/\r\n      \r\n  /**\r\n   * Do not enclose in an anonymous function, as the compiler may create\r\n   * global scope variables to replace true, false, null, which may collide\r\n   * with other variables.\r\n   * Instead, use the --output-wrapper command during optimization, which will\r\n   * add the anonymous function to enclose all code, including those optimized\r\n   * variables which would otherwise have global scope.\r\n   **/  \r\n\r\n  try {\r\n\r\n    // Declare KeymanWeb, OnScreen Keyboard and Util objects\r\n    var keymanweb=window['keyman'],osk=keymanweb['osk'],util=keymanweb['util'];\r\n    var dbg=keymanweb['debug'];\r\n    \r\n    // Disable UI for touch devices\r\n    if(util['isTouchDevice']()) throw '';\r\n\r\n    // Initialize user interface common variables       \r\n    var ui:any=keymanweb['ui'] = {\r\n      name: 'toggle',\r\n      initialized: false,\r\n      controller: null,\r\n      oskButton: null,\r\n      kbdButton: null,\r\n      controllerHovered: false,\r\n      keyboards: [],\r\n      lastActiveKeyboard: -1,\r\n      selectedMenuItem: null,\r\n      updateList: true,\r\n      updateTimer: null    \r\n    }\r\n    \r\n    /**\r\n     * Update the KeymanWeb user interface when an input element is focused or blurred\r\n     * \r\n     * @param       {Object}            someElement     focused element\r\n     * @param       {(boolean|number)}  focusing        true if focusing\r\n     * @param       {Object}            activeControl   Object representing API specs for the control, if it exists and is now focused.\r\n     */    \r\n    ui.doFocus = function(someElement,focusing, activeControl) {\r\n      // This callback must be ignored until UI is initialized, or for touch devices (which can never initialize the UI)\r\n      if(!ui.initialized) {\r\n        return;\r\n      }\r\n      \r\n      // We don't want to shift the controller to something that's not an input element,\r\n      // but do want to account for window.event's data when legitimate.\r\n      if(window.event && keymanweb['isAttached'](window.event.srcElement)) {\r\n        someElement=window.event.srcElement;\r\n      }\r\n\r\n      if(focusing)\r\n      {\r\n        ui.controller.style.display = 'block';\r\n      } \r\n      else \r\n      {\r\n        if(!(keymanweb['getUIState']()['activationPending']) && !ui.controllerHovered)\r\n        {\r\n          ui.controller.style.display = 'none';   \r\n        }\r\n      }\r\n      \r\n    /* I2406 - Find an appropriate position for the controller */  \r\n      var x, y, w, h, p;\r\n    \r\n      p = util['getAbsolute'](someElement); x = p['x']; y=p['y'];\r\n\r\n      if(someElement.defaultView && someElement.defaultView.frameElement)\r\n      { \r\n        w = someElement.defaultView.frameElement.clientWidth;\r\n        h = someElement.defaultView.frameElement.clientHeight;\r\n      }\r\n      else\r\n      {\r\n        w = someElement.offsetWidth;\r\n        h = someElement.offsetHeight;\r\n      }\r\n      if(x + w > window.innerWidth + document.documentElement.scrollLeft - ui.controller.offsetWidth - 1)\r\n        y += h;\r\n      else\r\n      {\r\n        x += w + 2;  \r\n        //y += h - ui.controller.offsetHeight - 1; // ui.controller.offsetheight is returned as its prior value, which results in incorrect UI positioning\r\n        // so better to set the offset absolutely JMD 11/2/11\r\n        y += h - 29; //prevent UI being positioned *above* the top of the element \r\n      }\r\n        \r\n      if(isNaN(x) || isNaN(y)) return;\r\n      ui.controller.style.left = x + 'px';\r\n      ui.controller.style.top = y + 'px';    \r\n    }\r\n\r\n    keymanweb['addEventListener']('controlfocused',function(params){ui.doFocus(params.target,true, params['activeControl']);});\r\n    keymanweb['addEventListener']('controlblurred',function(params){ui.doFocus(params.target,false, null);});\r\n\r\n    osk['addEventListener']('show',\r\n      function(oskPosition)\r\n      {\r\n        // Ensure that the ui.controller is visible if help is displayed\r\n        ui.controller.style.display = 'block';\r\n        ui.oskButton._setSelected(true);\r\n      \r\n  /* The following is probably not needed for KMW2, since OSK position is set by KMW, not by the UI        \r\n        //TODO:  This may not be correct - may need to refer to userLocated argument, not function???\r\n        // Check if OSK position is user-defined, return if so\r\n        if (osk['userLocated']()) return oskPosition;\r\n      \r\n        // Otherwise, return the position with respect to the focussed element\r\n        var someElement = keymanweb['getLastActiveElement'](), x, y, w, h, p;\r\n        if(someElement != null)\r\n        {\r\n          p = util['getAbsolute'](someElement); x = p['x']; y = p['y'];\r\n          if(someElement.parentWindow && someElement.parentWindow.frameElement)\r\n          {\r\n            w = someElement.parentWindow.frameElement.clientWidth;\r\n            h = someElement.parentWindow.frameElement.clientHeight;\r\n          }\r\n          else if(someElement.defaultView && someElement.defaultView.frameElement)\r\n          { \r\n            w = someElement.defaultView.frameElement.clientWidth;\r\n            h = someElement.defaultView.frameElement.clientHeight;\r\n          }\r\n          else\r\n          {\r\n            w = someElement.offsetWidth;\r\n            h = someElement.offsetHeight;\r\n          }\r\n    //TODO:  check the logic of this - it doesn't look right!!!  Signs on top, height??\r\n          var r = osk['getRect']();\r\n          x += 32;\r\n          if(y + h + (r.height - r.top) > (window.clientHeight?window.clientHeight:window.innerHeight) + document.documentElement.scrollTop && \r\n            y - (r.height - r.top) >= document.documentElement.scrollTop)\r\n          {\r\n            y -= (r.height - r.top);\r\n          }\r\n          else\r\n            y += h;\r\n        }\r\n        else\r\n        {\r\n          x = ui.controller.offsetLeft;\r\n          y = ui.controller.offsetTop + ui.controller.offsetHeight;\r\n        }\r\n        oskPosition['x'] = x; \r\n        oskPosition['y'] = y; \r\n  */      \r\n        return oskPosition;\r\n      });\r\n    \r\n    osk['addEventListener']('hide',\r\n      function(byUser)\r\n      {\r\n        if(byUser['HiddenByUser']) ui.oskButton._setSelected(false);\r\n      });\r\n    \r\n    /**\r\n     * Toggle the on screen keyboard display - KMW button control event \r\n     **/\r\n    ui.switchOsk = function()\r\n    {\r\n      // Check that user control of OSK is allowed\r\n      if((keymanweb['getActiveKeyboard']() == '') || keymanweb['isCJK']() ) return;  \r\n      \r\n      osk['show'](!osk['isEnabled']());  \r\n    }\r\n    \r\n    /**\r\n     * Toggle a single keyboard on or off - KMW button control event \r\n     **/\r\n    ui.switchSingleKbd = function()\r\n    {\r\n      var _v = (keymanweb['getActiveKeyboard']() == ''),nLastKbd=0,kbdName='',lgCode='';\r\n      if(_v)\r\n      {\r\n        if(ui.keyboards.length == 0) return;\r\n        if(ui.lastActiveKeyboard < ui.keyboards.length && ui.lastActiveKeyboard >= 0) nLastKbd = ui.lastActiveKeyboard;\r\n        kbdName = ui.keyboards[nLastKbd]._InternalName;\r\n        lgCode = ui.keyboards[nLastKbd]._LanguageCode;\r\n        keymanweb['setActiveKeyboard'](kbdName,lgCode);\r\n        ui.lastActiveKeyboard = nLastKbd;\r\n      }\r\n      else\r\n      {\r\n        keymanweb['setActiveKeyboard']('');\r\n      }\r\n      if(ui.kbdButton) ui.kbdButton._setSelected(_v);\r\n    }\r\n    \r\n    /**\r\n     * Switch to the next keyboard in the list - KMW button control event \r\n     **/\r\n    ui.switchNextKbd = function()\r\n    {\r\n      var _v = (keymanweb['getActiveKeyboard']() == ''),kbdName='',lgCode='';\r\n      if(_v)\r\n      {\r\n        if(ui.keyboards.length == 0) return;\r\n        kbdName = ui.keyboards[0]._InternalName;\r\n        lgCode = ui.keyboards[0]._LanguageCode;\r\n        keymanweb['setActiveKeyboard'](kbdName,lgCode);\r\n        ui.lastActiveKeyboard = 0;\r\n      }\r\n      else\r\n      {\r\n        if(ui.lastActiveKeyboard == ui.keyboards.length-1)\r\n        {\r\n          keymanweb['setActiveKeyboard']('');\r\n          _v = false;\r\n        }\r\n        else\r\n        {\r\n          kbdName = ui.keyboards[++ui.lastActiveKeyboard]._InternalName;\r\n          lgCode = ui.keyboards[ui.lastActiveKeyboard]._LanguageCode; \r\n          keymanweb['setActiveKeyboard'](kbdName,lgCode);\r\n          _v = true;\r\n        }\r\n      }\r\n      if(ui.kbdButton) ui.kbdButton._setSelected(_v);\r\n    }\r\n    \r\n    /**\r\n     * Create a button object for KeymanWeb UI buttons\r\n     * \r\n     * @constructor   \r\n     * @param       {string}    _src\r\n     * @param       {string}    _caption\r\n     * @param       {boolean}   _selected\r\n     * @return      {Object}    \r\n     * \r\n     * @suppress {suspiciousCode}  // Closure isn't smart enough to realize that _onmouseover\r\n     *                             // and the like are defined on individual instances later.\r\n     *                             // It thinks they're always null.        \r\n     **/\r\n    ui.button = function(_src, _caption, _selected)\r\n    {\r\n      this._onclick = null;\r\n      this._onmouseover = null;\r\n      this._onmouseout = null;\r\n      this._elem = null;\r\n      this._down = false;\r\n      this._over = false;\r\n      this._selected = _selected;\r\n    \r\n      /*public*/ this.getElem = function()\r\n      {\r\n        return this._owningObject._elem;\r\n      };\r\n      \r\n      /*private*/ this.__updatestyle = function()\r\n      {\r\n        var ss=this._owningObject._elem.style;\r\n        if(this._owningObject._over)\r\n        {\r\n          ss.margin = '0px';\r\n          if(this._owningObject._selected) {\r\n            ss.border = 'solid 1px #ad4a28';\r\n            ss.background = '#dfb4b4';\r\n          }\r\n          else {\r\n            ss.border = 'solid 1px #dfb4b4';\r\n            ss.background = '#f3e5de';\r\n          }\r\n        }\r\n        else if(this._owningObject._selected)\r\n        {\r\n          ss.background = '#f3e5de';\r\n          ss.margin = '0px';\r\n          ss.border = 'solid 1px #ad4a28';\r\n        }\r\n        else\r\n        {\r\n          ss.background = 'none';\r\n          ss.margin = '1px';\r\n          ss.border = 'none';\r\n        }\r\n      };\r\n      \r\n      /*private*/ this.__mouseover = function()\r\n      {\r\n        ui.controllerHovered = true;\r\n        this._owningObject._over = true;\r\n        if(this._owningObject._onmouseover != null) this._owningObject._onmouseover();\r\n        this._owningObject.__updatestyle();\r\n      };\r\n      \r\n      /*private*/ this.__mouseout = function()\r\n      { \r\n        ui.controllerHovered = false;\r\n        this._owningObject._over = false;\r\n        if(this._owningObject._onmouseout != null) this._owningObject._onmouseout();\r\n        this._owningObject.__updatestyle();\r\n      };\r\n      \r\n      /*private*/ this.__click = function()\r\n      { \r\n        keymanweb['activatingUI'](false); // Clear activating UI flag once click is acknowledged\r\n        if(this._owningObject._onclick != null) \r\n            return this._owningObject._onclick();\r\n        return false;\r\n      };\r\n    \r\n      /*private*/ this.__mousedown = function()\r\n      {\r\n        keymanweb['activatingUI'](true);  // Set activating UI flag (to manage focus/blur) on any UI mouse down event\r\n        this._owningObject._down = true;\r\n        this._owningObject.__updatestyle();\r\n        return false;\r\n      };\r\n      \r\n      /*private*/ this.__mouseup = function()\r\n      {\r\n        this._owningObject._down = false;\r\n        this._owningObject.__updatestyle();\r\n      };\r\n      \r\n      /*public*/ this._setSelected = function(_value)\r\n      {\r\n        keymanweb['activatingUI'](false); // Always clear activating UI flag after selecting UI\r\n        this._owningObject._selected = _value;\r\n        this._owningObject.__updatestyle();\r\n      };\r\n      \r\n      /*public*/ this._getSelected = function()\r\n      {\r\n        return this._owningObject._selected;\r\n      };\r\n    \r\n      /*public*/ this._getOver = function()\r\n      {\r\n        return this._owningObject._over;\r\n      };\r\n      \r\n      /*public*/ this._getDown = function()\r\n      {\r\n        return this._owningObject._down;\r\n      };\r\n    \r\n      this._owningObject = this; // simplifies meaning of 'this'\r\n      \r\n      var imgPath=util['getOption']('resources') + 'ui/toggle/';\r\n      var _elemImg = util['createElement']('img');\r\n      this._elem = util['createElement']('div');\r\n      this._elem._owningObject = this;\r\n      _elemImg.style.display = 'block';\r\n      _elemImg.src = imgPath + _src;\r\n      _elemImg.id = 'KMW_Controller_Img';\r\n      this._elem.style.margin = '0px'; //display = 'inline';\r\n      this._elem.style.width = '24px';\r\n      this._elem.style.height = '24px';\r\n      this._elem.style.zIndex = '10002';\r\n      this._elem.style.lineHeight = '100%';\r\n      this._elem.style.styleFloat = this._elem.style.cssFloat = 'left';\r\n    \r\n      _elemImg.title = _caption;\r\n      _elemImg.alt = _caption;\r\n      this._elem.appendChild(_elemImg);\r\n      this._elem.onmouseover = this.__mouseover;\r\n      this._elem.onmouseout = this.__mouseout;\r\n      this._elem.onmousedown = this.__mousedown;\r\n      this._elem.onmouseup = this.__mouseup;\r\n      _elemImg._owningObject = this;\r\n      _elemImg.onclick = this.__click;\r\n      \r\n      this.__updatestyle();\r\n      \r\n      return this;\r\n    };\r\n    \r\n    /**\r\n     * Function     Initialize\r\n     * Scope        Private   \r\n     * Description  Initialize Toggle User Interface\r\n     **/   \r\n    ui['initialize'] = ui.Initialize = function()\r\n    { \r\n      //Never initialize before KMW!\r\n      if(!keymanweb['initialized'] || util['isTouchDevice']()) return;\r\n        \r\n      if(!ui.initialized)  // I2403 - Allow toggle design to be loaded twice\r\n      {\r\n        ui.controller = util['createElement']('div');\r\n      }\r\n      else\r\n        ui.controller.innerHTML = '';  // I2403 - Allow toggle design to be loaded twice\r\n      \r\n      var imgPath = util['getOption']('resources')+'ui/toggle/';\t\r\n      ui.controller.style.background = 'url('+imgPath+'kmwcontroller2x.gif)';    \r\n      ui.controller.style.padding = '1px 2px';\r\n\r\n      // Create keyboard list and OSK control buttones, and set initial styles\r\n      var v1=util['loadCookie']('KeymanWeb_Keyboard'),kbdEnabledOnLoad=false;\r\n      if(typeof(v1['current'])!='undefined') kbdEnabledOnLoad = (v1['current'].indexOf('---') < 0);\r\n      ui.kbdButton = new ui.button('kmw_logo_16.gif', 'Use Web Keyboard', kbdEnabledOnLoad); \r\n      ui.controller.appendChild(ui.kbdButton.getElem());\r\n    \r\n      var v2 = util['loadCookie']('KeymanWeb_OnScreenKeyboard'),oskEnabledOnLoad=true; \r\n      if(typeof(v2['visible'])!='undefined') oskEnabledOnLoad=(v2['visible'] == 1); \r\n    \r\n      // Add keyboard icon\r\n      ui.oskButton = new ui.button('kmw_osk_16.gif','Show On Screen Keyboard',oskEnabledOnLoad); \r\n      ui.oskButton._onclick = ui.switchOsk;\r\n      ui.controller.appendChild(ui.oskButton.getElem());\r\n\r\n      // Hide controller unless already initialized\r\n      if(!ui.initialized) ui.controller.style.display = 'none';\r\n      ui.controller.style.zIndex = '10001';\r\n      ui.controller.style.position = 'absolute';\r\n      \r\n      // The following three lines prevent the UI from being positioned incorrectly when the page is resized,\r\n      // but don't fix the problem completely, as the kbd icon still moves.  probably need to insert a DIV\r\n      // between the button and the container, and make that DIV fixed height and overflow:hidden \r\n      //ui.controller.style.maxHeight = '26px';  \r\n      //ui.oskButton.getElem().style.position = 'relative';  \r\n      //ui.oskButton.getElem().style.overflow = 'hidden';\t\r\n      \r\n      if(!ui.initialized)  // I2403 - Allow toggle design to be loaded more than once if necessary\r\n        document.body.appendChild(ui.controller);\t   \r\n    \r\n      // Set initialized true  \r\n      ui.initialized = true;  // I2403 - Allow toggle design to be loaded more than once if needed\r\n\r\n      // Then update the keyboard list if keyboards already loaded (i.e. in page script)\r\n      ui.updateKeyboardList();     \r\n      \r\n    }\r\n\r\n    ui.shutdown = function() {\r\n      var root = ui.controller;\r\n\r\n      if(root) {\r\n        root.parentNode.removeChild(root);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function     updateKeyboardList\r\n     * Scope        Private   \r\n     * Description  Rebuild the UI and keyboard list\r\n     **/   \r\n    ui.updateKeyboardList=function()\r\n    {                 \r\n      if(!(keymanweb['initialized'] || ui.initialized)) return; //TODO: may want to restart the timer??\r\n                      \r\n      ui.updateList = false;\r\n\r\n      var _kbds=keymanweb['getKeyboards'](),imgPath=util['getOption']('resources') +'ui/toggle/';\t   \r\n  \r\n      // Check the number of installed keyboards to determine whether or not we will have a dropdown\r\n      if(_kbds.length > 1)\r\n      {\r\n        // Multiple keyboards\r\n        var _kmw_ctrl_img=<HTMLImageElement> document.getElementById('KMW_Controller_Img')\r\n        _kmw_ctrl_img.src = imgPath+'kmw_logo_16_down.gif';\r\n        _kmw_ctrl_img.style.width = '100%';\r\n            \r\n        ui.controller.style.background = 'url('+imgPath+'kmwcontroller2x.gif)';\r\n        \r\n        ui.kbdButton.getElem().id = 'kmwico';\r\n        ui.kbdButton.getElem().style.width = '36px';\r\n        ui.kbdButton._onmouseover = function()\r\n          {\r\n            ui.keyboardMenu.className=\"sfhover\";\r\n          };\r\n        ui.kbdButton._onmouseout = function()\r\n          {\r\n            ui.keyboardMenu.className=\"sfunhover\";\r\n          };\r\n        ui.kbdButton._onclick = null;\r\n        ui.createMenu();\r\n      }\r\n      // Single keyboard\r\n      else if(_kbds.length == 1)\r\n      {\r\n        var _kmw_ctrl_img=<HTMLImageElement> document.getElementById('KMW_Controller_Img')\r\n        _kmw_ctrl_img.src = imgPath+'kmw_logo_16.gif';\r\n        \r\n        ui.kbdButton.getElem().id = 'kmwico';\r\n        ui.kbdButton.getElem().style.width = '24px';\r\n\r\n        var Lki=_kbds[0]['InternalName'];    \r\n        var Lklc=_kbds[0]['LanguageCode'];  \r\n        ui.controller.style.background = 'url('+imgPath+'kmwcontroller2.gif)';\r\n        ui.keyboards.push({_InternalName: Lki, _LanguageCode: Lklc, _Index: 0});\r\n        ui.kbdButton._onclick = ui.switchSingleKbd;\r\n        ui.kbdButton._onmouseover = function() { };\r\n        ui.kbdButton._onmouseout = function() { };\r\n\r\n        // We must reconstruct the ui.keyboards array, and this done by ui.createMenu.\r\n        ui.createMenu();\r\n\r\n        // Must remove menu if keyboards have been removed leaving only a single keyboard\r\n        if(typeof(ui.keyboardMenu) != 'undefined') delete ui.keyboardMenu;\r\n      }\r\n      \r\n      // Highlight the last active keyboard\r\n      var sk=keymanweb['getSavedKeyboard']().split(':');\r\n      ui.updateMenu(sk[0],sk[1]);\r\n    }  \r\n\r\n    /**\r\n     * Keyboard registration event handler\r\n     *    \r\n     * Set a timer to update the UI keyboard list on timeout after each keyboard is registered, \r\n     * thus updating only once when only if multiple keyboards are registered together\r\n     */   \r\n    keymanweb['addEventListener']('keyboardregistered', \r\n      function(p)\r\n      {   \r\n          ui.updateList = true;\r\n          if(ui.updateTimer) clearTimeout(ui.updateTimer);\r\n          ui.updateTimer = setTimeout(ui.updateKeyboardList,200);\r\n      });       \r\n\r\n\r\n    /**\r\n     * Keyboard change event handler\r\n     *        \r\n     * Update menu selection and control OSK display appropriately\r\n     */\r\n    keymanweb['addEventListener']('keyboardchange',  \r\n      function(p)\r\n      {\r\n        ui.updateMenu(p['internalName'],p['languageCode']);  \r\n      });\r\n    \r\n    /* ----------------------------------------\r\n      Drop down menu\r\n      ---------------------------------------- */\r\n    \r\n  //  var  _SelectedMenuItem;\r\n    \r\n    /**\r\n     * Function     selecKbd\r\n     * Scope        Private \r\n     * @param       {number}  _kbd         \r\n     * Description  Select a keyboard from the drop down menu \r\n     **/\r\n    ui.selectKbd = function(_kbd)\r\n    {\r\n        var _name,_lgCode,_index;\r\n        if(_kbd < 0) \r\n        { \r\n          _name = ''; _lgCode='';_index = ''; \r\n        }\r\n        else \r\n        { \r\n          _name = ui.keyboards[_kbd]._InternalName; _lgCode = ui.keyboards[_kbd]._LanguageCode; _index = ui.keyboards[_kbd]._Index; \r\n        }\r\n        keymanweb['setActiveKeyboard'](_name,_lgCode);\r\n        keymanweb['focusLastActiveElement']();\r\n        ui.kbdButton._setSelected(_name != '');\r\n        if(_kbd >= 0) ui.lastActiveKeyboard = _kbd;\r\n\r\n        return false;\r\n    };\r\n    \r\n    /**\r\n     * Function     updateMenu\r\n     * Scope        Private\r\n     * @param       {string}    kbdName\r\n     * @param       {?string=}  lgCode\r\n     * Description  Updates the menu selection when a change is required\r\n     **/    \r\n    ui.updateMenu = function(kbdName,lgCode)\r\n    {        \r\n      var i,_k=document.getElementById('KMWSel_$');\r\n\r\n      for(i=0; i<ui.keyboards.length; i++)\r\n      { \r\n        if(ui.keyboards[i]._InternalName == kbdName && ui.keyboards[i]._LanguageCode == lgCode)\r\n          _k=document.getElementById('KMWSel_'+ui.keyboards[i]._InternalName+'$'+ui.keyboards[i]._Index);\r\n      }\r\n    \r\n      if(_k)\r\n      {\r\n        if(ui.selectedMenuItem != null) ui.selectedMenuItem.className='';\r\n        _k.className='selected'; ui.selectedMenuItem=_k;\r\n      }\r\n\r\n      // Hide the OSK button for CJK keyboards (or non-mapped)\r\n      if(lgCode=='cmn' || lgCode=='jpn' || lgCode=='kor')\r\n      {\r\n        ui.oskButton.getElem().style.display='none';\r\n        //osk['show'](true);\r\n      }\r\n      else if(kbdName == '')\r\n      {\r\n        ui.oskButton.getElem().style.display='none';\r\n      }\r\n      else\r\n      {\r\n        ui.oskButton.getElem().style.display='block';\r\n        //osk['show'](osk['isEnabled']());\r\n      }\r\n    }\r\n    util['addStyleSheet'](\r\n      \"#KeymanWeb_KbdList {\"+\r\n        \"display: block;\"+\r\n        \"position: absolute;\"+\r\n        \"width: auto;\"+ ((util['getIEVersion']() < 8) ? \"200px;\" : \"auto;\")+\r\n        \"line-height: 100%;\"+\r\n        \"margin: 0;\"+\r\n        \"clear: both;\"+\r\n        \"float: none;\"+\r\n        \"top: auto;\"+\r\n        \"border: solid 2px #ad4a28;\"+\r\n        \"-moz-border-radius: 4px;\"+\r\n        \"-webkit-border-radius: 4px;\"+\r\n        \"border-radius: 4px;\"+\r\n        \"box-shadow: 4px 4px 2px rgba(136,136,136,.5);\"+\r\n        \"-webkit-box-shadow: 4px 4px 2px rgba(136,136,136,.5);\"+\r\n        \"-moz-box-shadow: 4px 4px 2px rgba(136,136,136,.5);\"+\r\n        ((util['getIEVersion']() < 99) ? \"filter:progid:DXImageTransform.Microsoft.DropShadow(OffX=4,OffY=4,Color=#80646464);\" : \"\")+\r\n        \"list-style: none;\"+\r\n        \"padding: 0;\"+\r\n        \"background: white;\"+\r\n        \"max-height: 300px;\"+\r\n        \"overflow-y: scroll;\"+ \r\n        \"overflow-x: hidden;\"+\r\n        \"white-space: nowrap;\"+\r\n        \"z-index: 10001; /* above the osk */\"+\r\n      \"}\"+\r\n      ((util['getIEVersion']() < 7) ? \r\n        \"* html #KeymanWeb_KbdList {height: expression(this.scrollHeight > 299 ? '300px' : 'auto');}\" : \"\")+    \r\n      \".sfunhover#KeymanWeb_KbdList {\"+\r\n        \"display: none; left: -999px;\"+\r\n      \"}\"+\r\n      \".sfhover#KeymanWeb_KbdList {\"+\r\n        \"display: block;\"+\r\n        \"left: auto;\"+\r\n      \"}\"+\r\n      \"#KeymanWeb_KbdList li {\"+\r\n        \"float: none;\"+\r\n        \"width: auto;\"+\r\n        \"padding: 0;\"+\r\n        \"margin: 0;\"+\r\n      \"text-align: left;\"+\r\n      \"}\"+\r\n      \"#KeymanWeb_KbdList li a {\"+\r\n        \"display: block; \"+\r\n        \"padding: 2px 4px;\"+\r\n        \"color: #404040;\"+\r\n        \"font-family: Tahoma,Verdana,Arial,sans-serif;\"+\r\n        \"font-size: 8pt;\"+\r\n        \"text-decoration: none;\"+\r\n      \"}\"+\r\n      \"#KeymanWeb_KbdList li a.selected {\"+\r\n        \"font-weight: bold;\"+\r\n        \"color: black;\"+\r\n      \"}\"+\r\n      \"#KeymanWeb_KbdList li a:hover {\"+\r\n        \"color: white;\"+\r\n        \"background-color: #ad4a28;\"+\r\n        \"text-decoration: underline;\"+\r\n      \"}\");\r\n    \r\n    /**\r\n     * Function     createMenu\r\n     * Scope        Private   \r\n     * Description  Create the drop down menu and populate with loaded KeymanWeb keyboards \r\n     **/\r\n    ui.createMenu = function()\r\n    {    \r\n      if(typeof(ui.keyboardMenu) == 'undefined')  // I2403 - Allow toggle design to be loaded twice\r\n      {\r\n        ui.keyboardMenu=util['createElement']('ul');\r\n        ui.keyboardMenu.id='KeymanWeb_KbdList';\r\n        ui.keyboardMenu.className='sfunhover';\r\n      }\r\n      else ui.keyboardMenu.innerHTML = '';  // I2403 - Allow toggle design to be loaded twice\r\n      \r\n      var _li=util['createElement']('li');\r\n      var _a=util['createElement']('a');\r\n      _a.innerHTML='English';\r\n      _a.href=\"#\";\r\n      _a.onclick = function() { return ui.selectKbd(-1); };\r\n      _a.id='KMWSel_$';\r\n      _a.className='selected';\r\n      _li.appendChild(_a);\r\n      \r\n      ui.selectedMenuItem=_a;\r\n      ui.keyboardMenu.appendChild(_li);\r\n        \r\n      var _kbds=keymanweb['getKeyboards'](), _added=[];\r\n      ui.keyboards=[];\r\n      for(var _kbd = 0; _kbd < _kbds.length; _kbd++)\r\n      {\r\n          var _li1=util['createElement']('li');\r\n          var _a1=util['createElement']('a');\r\n          _a1.innerHTML=_kbds[_kbd]['LanguageName'] + ' - ' + _kbds[_kbd]['Name'];\r\n          if(!_added[_kbds[_kbd]['InternalName']]) _added[_kbds[_kbd]['InternalName']]=0;\r\n          _added[_kbds[_kbd]['InternalName']]++;\r\n    \r\n          var _n=_added[_kbds[_kbd]['InternalName']];\r\n          ui.keyboards.push({_InternalName: _kbds[_kbd]['InternalName'], _LanguageCode:_kbds[_kbd]['LanguageCode'], _Index: _n});\r\n\r\n          _a1.href=\"#\";\r\n          _a1.onclick = (function(x) { return function() { return ui.selectKbd(x); } })(ui.keyboards.length-1);\r\n          _a1.id='KMWSel_'+_kbds[_kbd]['InternalName']+'$'+_n;\r\n    \r\n          _li1.appendChild(_a1);\r\n          ui.keyboardMenu.appendChild(_li1);\r\n      }\r\n      \r\n      //if(!ui.initialized) // I2403 - Allow toggle design to be loaded twice\r\n      if(ui.keyboardMenu.parentNode != ui.kbdButton.getElem()) ui.kbdButton.getElem().appendChild(ui.keyboardMenu);  \r\n    };\r\n    \r\n    keymanweb['addHotKey'](191,0x20,ui.switchSingleKbd);\r\n    keymanweb['addHotKey'](191,0x30,ui.switchNextKbd);\r\n    keymanweb['addHotKey'](191,0x40,ui.switchOsk);\r\n\r\n    // Initialize after KMW is fully initialized\r\n    keymanweb['addEventListener']('loaduserinterface',ui.Initialize);\r\n    \r\n    // but also execute here, for asynchronous UI script loading (occurring after KMW initialization)\r\n    ui.Initialize();\r\n      \r\n  } catch(ex){}\r\n}"]}